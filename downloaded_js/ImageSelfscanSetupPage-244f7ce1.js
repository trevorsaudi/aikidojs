import{_ as T,X as w,H as C,B as b,V as v,f as I,a3 as k,aM as B,aN as S,Q as p,aO as A,aP as M,r,k as h,m,o as e,n as s,w as t,p as L,F as P,q as l,s as n,u as f}from"./index-13ff96f4.js";import{P as R}from"./PageHeader-46c38a32.js";import{C as z}from"./ContinuousIntegrationCopyTokenModal-b6dba601.js";import{S as D}from"./SelfScanVersion-a1a382ab.js";const U={components:{XPreloader:w,PageHeader:R,BaseHeading:C,BaseParagraph:b,InputText:v,ContinuousIntegrationCopyTokenModal:z,BaseButton:I},data(){return{loaded:!1,showTokenModal:!1,token:void 0,tokenUpdatedAt:void 0,tokenCreatedBy:void 0,selfscan_version:D}},async mounted(){try{await this.handleFetchToken()}finally{this.loaded=!0}},computed:{breadcrumbs(){return[{label:"Connect registry"},{label:"Local Image Scanning"}]},isIntegrationActive(){return this.loaded&&this.token},redactedToken(){return`********************${this.token.slice(-4)}`},isSelfScanAccount(){var a;return((a=this.$group)==null?void 0:a.scm_type)==="selfscan"},formattedTokenUpdatedAtTimestamp(){return this.tokenUpdatedAt?k.fromUnix(this.tokenUpdatedAt).format(k.US_FRIENDLY_DATE_WITH_TIME):null}},methods:{handleCopyToken(){window.isSecureContext&&navigator.clipboard.writeText(this.token)},async handleAddIntegration(){const a=await B();this.token=a.token,this.showTokenModal=!0},async handleFetchToken(){this.isLoading=!0;try{const a=await S({disable_toasts:!0});this.token=a.token,this.tokenUpdatedAt=a.updated_at,this.tokenCreatedBy=a.created_by_name}finally{this.isLoading=!1}},async handleRotateToken(){if(await p({headerText:"Rotate token",description:"Do you want to rotate the CI auth token? This will invalidate the current token and you will need to update it in your CI configuration.",buttonSubmitText:"Yes, rotate"})){this.isLoading=!0;try{const a=await A();this.token=a.token,this.showTokenModal=!0}finally{this.isLoading=!1}}},async handleRevokeToken(){if(await p({headerText:"Revoke token",description:"Do you want to revoke the CI auth token?",buttonSubmitText:"Yes, revoke"})){this.isLoading=!1;try{await M(),this.token=void 0}finally{this.isLoading=!1}}},async handleCloseTokenModal(){this.showTokenModal=!1,this.token="***",await this.handleFetchToken()}}},H={class:"page-content flex flex-column gap-32px"},N={class:"mb-16px"},V={class:"mb-16px"},F={key:1,class:"flex flex-column gap-8px"},E={class:"flex align-center gap-8px"},X=s("i",{class:"icon icon-refresh icon-12px"},null,-1),G=s("span",{class:"text--semi"},"Rotate token",-1),O=s("span",{class:"text--semi"},"Revoke token",-1);function Y(a,W,q,Q,d,o){const _=r("XPreloader"),g=r("PageHeader"),u=r("BaseHeading"),c=r("BaseParagraph"),i=r("BaseButton"),y=r("InputText"),x=r("ContinuousIntegrationCopyTokenModal");return d.loaded?(l(),m(P,{key:1},[e(g,{title:"Local Image Scanning Setup",breadcrumbs:o.breadcrumbs},null,8,["breadcrumbs"]),s("div",H,[s("section",N,[e(u,{as:"h4"},{default:t(()=>[n("1. Download binary")]),_:1}),e(c,{class:"mt-16px mb-16px",color:"gray"},{default:t(()=>[n(" This contains the actual image scanner to run locally. ")]),_:1}),e(i,{class:"float-left mr-12px mb-12px",as:"outside-link",href:`https://aikido-local-scanner.s3.eu-west-1.amazonaws.com/v${this.selfscan_version}/linux_X86_64/aikido-local-scanner.zip`,variation:"secondary"},{default:t(()=>[n("Download for Linux x86_64")]),_:1},8,["href"]),e(i,{class:"float-left mr-12px mb-12px",as:"outside-link",href:`https://aikido-local-scanner.s3.eu-west-1.amazonaws.com/v${this.selfscan_version}/darwin_ARM64/aikido-local-scanner.zip`,variation:"secondary"},{default:t(()=>[n("Download for MacOS arm64")]),_:1},8,["href"]),e(i,{class:"float-left mr-12px mb-12px",as:"outside-link",href:`https://aikido-local-scanner.s3.eu-west-1.amazonaws.com/v${this.selfscan_version}/windows_X86_64/aikido-local-scanner.zip`,variation:"secondary"},{default:t(()=>[n("Download for Windows x86_64")]),_:1},8,["href"])]),s("section",V,[e(u,{as:"h4"},{default:t(()=>[n("2. Token Generation")]),_:1}),e(c,{class:"mt-16px mb-16px",color:"gray"},{default:t(()=>[n(" Use this generated token when running the Local Scan binary and sync your scan results with your Aikido workspace. ")]),_:1}),o.isIntegrationActive?(l(),m("div",F,[s("div",E,[e(y,{name:"token",modelValue:o.redactedToken,disabled:!0,ref:"input",class:"truncate flex-1 max-w-400px",inputClass:"bg-white"},null,8,["modelValue"]),e(i,{size:"small",variation:"primary",onClicked:o.handleRotateToken},{default:t(()=>[X,G]),_:1},8,["onClicked"]),e(i,{size:"small",variation:"plain",onClicked:o.handleRevokeToken},{default:t(()=>[O]),_:1},8,["onClicked"])]),e(c,{size:"tiny"},{default:t(()=>[n("Token generated on "+f(o.formattedTokenUpdatedAtTimestamp)+" by "+f(d.tokenCreatedBy),1)]),_:1})])):(l(),h(i,{key:0,size:"small",variation:"secondary",onClicked:o.handleAddIntegration},{default:t(()=>[n(" Generate Token ")]),_:1},8,["onClicked"]))]),s("section",null,[e(u,{as:"h4"},{default:t(()=>[n("3. Setup instructions")]),_:1}),e(c,{class:"mt-16px mb-16px",color:"gray"},{default:t(()=>[n(" Check out the step-by-step guide to complete your Local Scanning setup. ")]),_:1}),e(i,{as:"outside-link",href:"https://help.aikido.dev/en/articles/9179273-setting-up-image-scanning-with-local-scanner",variation:"primary",target:"_blank"},{default:t(()=>[n("Go to setup instructions")]),_:1})]),d.showTokenModal?(l(),h(x,{key:0,token:d.token,onClose:o.handleCloseTokenModal},null,8,["token","onClose"])):L("",!0)])],64)):(l(),h(_,{key:0,class:"supercenter",theme:"transparent"}))}const $=T(U,[["render",Y]]);export{$ as default};
