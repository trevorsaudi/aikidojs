import{g as A,u as F,a as j}from"./privatePackageRegistry-bdc7d523.js";import{l as H,h as Q}from"./autofix-68b65188.js";import{_ as w,f as B,x as S,V as U,r as d,q as n,m as c,o as s,ai as W,p as R,B as Y,aw as q,w as u,s as m,F as J,t as z,k,n as _,M as K,H as Z,cF as X,g as $,al as ee,u as I}from"./index-13ff96f4.js";import{B as te}from"./ButtonMultiOption-12e505fb.js";const ie={props:{index:Number,envVar:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},emits:["update","remove"],components:{BaseButton:B,BaseIcon:S,InputText:U},data(){return{localEnvVar:{...this.envVar}}},methods:{emitChange(){this.$emit("update",this.localEnvVar)},emitRemove(){this.$emit("remove",this.envVar.key)}}},se={class:"flex gap-4px align-center w-full justify-between"};function ne(t,i,o,r,e,a){const h=d("InputText"),v=d("BaseIcon");return n(),c("div",se,[s(h,{modelValue:e.localEnvVar.key,"onUpdate:modelValue":i[0]||(i[0]=g=>e.localEnvVar.key=g),onInput:a.emitChange,placeholder:"Key",name:`envVarKey_${o.index}`,class:"flex-1",disabled:o.disabled},null,8,["modelValue","onInput","name","disabled"]),s(h,{modelValue:e.localEnvVar.value,"onUpdate:modelValue":i[1]||(i[1]=g=>e.localEnvVar.value=g),onInput:a.emitChange,placeholder:"Value",name:`envVarValue_${o.index}`,class:"flex-1",disabled:o.disabled},null,8,["modelValue","onInput","name","disabled"]),o.disabled?R("",!0):(n(),c("button",{key:0,onClick:i[2]||(i[2]=W((...g)=>a.emitRemove&&a.emitRemove(...g),["stop"])),class:"plain-button plain-button--hover plain-button--icon",variation:"tertiary",border:!1},[s(v,{icon:"icon-close"})]))])}const oe=w(ie,[["render",ne]]),ae={props:{envVars:{type:Array,required:!0,default:()=>[]}},components:{BaseButton:B,BaseIcon:S,BaseParagraph:Y,ConfigureEnvironmentVariablesInput:oe},emits:["update"],data(){let t=[...this.envVars??[]];return t.length===0&&t.push({key:"",value:""}),{localEnvVars:t}},methods:{addEnvVar(){this.localEnvVars.push({key:"",value:""})},removeEnvVar(t){this.localEnvVars=this.localEnvVars.filter(i=>i.key!==t),this.$emit("update",this.localEnvVars)},updateEnvVar:q(function(t,i){this.localEnvVars=this.localEnvVars.map((o,r)=>r!==t?o:i),this.$emit("update",this.localEnvVars)},300)}},re={class:"flex flex-column gap-12px"},le=_("i",{class:"icon icon-add"},null,-1);function de(t,i,o,r,e,a){const h=d("BaseParagraph"),v=d("ConfigureEnvironmentVariablesInput"),g=d("BaseButton");return n(),c("div",re,[s(h,null,{default:u(()=>[m("Add the environment variables which are needed when installing dependencies in your repos. The values will be encrypted by Aikido and injected when patching dependencies.")]),_:1}),(n(!0),c(J,null,z(e.localEnvVars,(C,y)=>(n(),k(v,{key:y,"env-var":C,index:y,onRemove:a.removeEnvVar,onUpdate:f=>a.updateEnvVar(y,f),disabled:!t.$groupUser.admin},null,8,["env-var","index","onRemove","onUpdate","disabled"]))),128)),t.$groupUser.admin?(n(),k(g,{key:0,onClick:a.addEnvVar,variation:"plain",size:"small"},{default:u(()=>[le,m("Add Variable")]),_:1},8,["onClick"])):R("",!0)])}const ce=w(ae,[["render",de]]),V="npm",E="go",x="nuget",b="composer",O="maven",P="pypi",T="poetry",p="custom",M=[{id:V,title:"Npm"},{id:E,title:"Go"},{id:x,title:"Nuget"},{id:b,title:"Composer"},{id:O,title:"Maven"},{id:P,title:"PyPI"},{id:T,title:"Poetry"},{id:p,title:"custom"}],ue={[V]:{url:"https://help.aikido.dev/en/articles/8838893-aikido-autofix-with-private-packages",text:"on how to configure a private NPM registry."},[E]:{url:"https://help.aikido.dev/en/articles/8838893-aikido-autofix-with-private-packages",text:"on how to configure a private Go registry."},[x]:{url:"https://help.aikido.dev/doc/private-packages---nuget/docgt5VYfQOE",text:"on how to configure your nuget.config file."},[b]:{url:"https://help.aikido.dev/doc/private-packages---composer/docGH94ssGSn",text:"on how to configure your auth.json file."},[p]:{url:"https://help.aikido.dev/doc/private-packages---custom-config/docQ3WJSEZTf",text:"on how to configure environment variables"},[T]:{url:"https://help.aikido.dev/doc/poetry---private-packages/docBPPl9x1zN",text:"on how to configure a private poetry repo"},[P]:{url:"https://help.aikido.dev/doc/private-packages---custom-config/docQ3WJSEZTf",text:"on how to configure a private pip registry."}},pe={props:{url:String},emits:["close"],components:{BaseModal:K,BaseParagraph:Y,BaseHeading:Z,BaseButton:B,InputText:U,InputTextArea:X,BaseLink:$,ButtonMultiOption:te,ConfigureEnvironmentVariablesForm:ce,LoadingSpinner:ee},data(){return{isLoading:!0,isSaving:!1,registryDocsInfo:ue,inputRegistryData:{[V]:{},[E]:{},[x]:{},[b]:{},[O]:{},[P]:{},[T]:{},[p]:[]},originalRegistryData:{[V]:{},[E]:{},[x]:{},[b]:{},[O]:{},[P]:{},[T]:{},[p]:[]},selectedRegistryOption:V,envVars:[],showCustomConfigTab:!0}},async mounted(){await Promise.allSettled([this.handleFetchPrivatePackageRegistry(),this.handleFetchEnvVariables()]),this.isLoading=!1},computed:{selectedRegistryDocsUrl(){return this.registryDocsInfo[this.selectedRegistryOption].url||"https://help.aikido.dev/section/aikido-autofix/sgQMoUQEbbtY"},selectedRegistryDocsText(){return this.registryDocsInfo[this.selectedRegistryOption].text||"on how to configure a private registry."},selectedRegistryData(){return this.inputRegistryData[this.selectedRegistryOption]},selectedRegistryId(){var t;return((t=this.selectedRegistryData)==null?void 0:t.id)||""},selectedRegistryTitle(){var t;return((t=this.registryOptions.find(i=>i.id===this.selectedRegistryOption))==null?void 0:t.title)||""},registryOptions(){return this.showCustomConfigTab?M:M.filter(({id:t})=>t!==p)},typesWithEdits(){return this.registryOptions.map(t=>t.id).filter(t=>{var r,e;if(t===p)return JSON.stringify(this.originalRegistryData[t])!==JSON.stringify(this.inputRegistryData[t]);const i=this.inputRegistryData[t].url!==((r=this.originalRegistryData[t])==null?void 0:r.url),o=!!((e=this.inputRegistryData[t].token)!=null&&e.trim());return i||o})}},methods:{handleCloseModal(){this.$emit("close")},async handleFetchEnvVariables(){try{const t=await H({disable_toasts:!0});this.originalRegistryData[p]=t,this.inputRegistryData[p]=t}catch{this.showCustomConfigTab=!1}},handleUpdateEnvVars(t){this.inputRegistryData[p]=t},async handleFetchPrivatePackageRegistry(){let t=[];try{t=await A({disable_toasts:!0})}catch{}for(const i of t){const{type:o,id:r,url:e}=i;this.inputRegistryData[o]={id:r,url:e},this.originalRegistryData[o]={id:r,url:e}}},async handleConfirm(){if(this.isSaving=!0,!this.typesWithEdits.length){this.handleCloseModal();return}let t=!1;for(const i of this.typesWithEdits){if(i===p)try{await Q({env_vars:this.inputRegistryData[i]});continue}catch{t=!0;break}let{id:o,token:r,url:e}=this.inputRegistryData[i];i===x&&(r=this.minifyNugetConfig(r));try{o?await F(o,e,r):await j(e,r,i)}catch{t=!0;continue}}this.isSaving=!1,t||(Toast.success({title:"Private package registry connection saved",description:"You have successfully saved the connection to your private package registry."}),this.handleCloseModal())},handleDelete(){this.$modal.show("DeletePrivatePackageRegistryModal",{registryId:this.selectedRegistryId})},minifyNugetConfig(t){return t.replace(/>\s+</g,"><").replace(/<!--[\s\S]*?-->/g,"").replace(/\s+\/>/g,"/>")}}},ge=_("div",null,null,-1),me={class:"flex flex-column gap-16px"},ye={key:0,class:"w-full flex align-center justify-center py-16px mb-8px"},he={key:1,class:"flex flex-column gap-12px"},ve={class:"flex flex-column gap-8px"},fe=_("span",{class:"text--semi-bold text-14px text-gray-500"},"Select package manager",-1),Re={key:0,class:"flex flex-column gap-8px"},_e={key:1,class:"flex flex-column gap-8px"},ke={key:2,class:"flex flex-column gap-8px"},Ve={key:3,class:"flex flex-column gap-8px"},xe={key:4},Ee={key:5},be={key:6,class:"flex flex-column gap-12px"},Pe={class:"flex align-center ml-auto gap-12px"};function Te(t,i,o,r,e,a){const h=d("BaseHeading"),v=d("BaseParagraph"),g=d("LoadingSpinner"),C=d("ButtonMultiOption"),y=d("InputTextArea"),f=d("InputText"),N=d("ConfigureEnvironmentVariablesForm"),G=d("BaseLink"),D=d("BaseButton"),L=d("BaseModal");return n(),k(L,{width:650,onClose:a.handleCloseModal,allowBackgroundClose:!1},{header:u(()=>[ge]),content:u(()=>[_("div",me,[s(h,{as:"h3"},{default:u(()=>[m(" Connect to a private registry ")]),_:1}),s(v,null,{default:u(()=>[m(" If your projects includes private packages, Aikido needs read access so we can scan and provide fixes for your dependency issues. ")]),_:1}),e.isLoading?(n(),c("div",ye,[s(g,{color:"#645dd7","background-color":"#d0cdff",width:32,height:32})])):(n(),c("div",he,[_("div",ve,[fe,s(C,{title:"Registry type",class:"issue-detail__card__questionaire__answer",options:a.registryOptions,modelValue:e.selectedRegistryOption,"onUpdate:modelValue":i[0]||(i[0]=l=>e.selectedRegistryOption=l)},null,8,["options","modelValue"])]),e.selectedRegistryOption==="nuget"?(n(),c("div",Re,[s(y,{title:"Nuget.config",placeholder:"Paste your nuget.config file here",modelValue:e.inputRegistryData[e.selectedRegistryOption].token,"onUpdate:modelValue":i[1]||(i[1]=l=>e.inputRegistryData[e.selectedRegistryOption].token=l),modelModifiers:{trim:!0},name:"privateRegistryToken",rows:"6"},null,8,["modelValue"])])):R("",!0),e.selectedRegistryOption==="composer"?(n(),c("div",_e,[s(y,{title:"auth.json",placeholder:"Paste your auth.json file contents here",modelValue:e.inputRegistryData[e.selectedRegistryOption].token,"onUpdate:modelValue":i[2]||(i[2]=l=>e.inputRegistryData[e.selectedRegistryOption].token=l),modelModifiers:{trim:!0},name:"privateRegistryToken",rows:"6"},null,8,["modelValue"])])):R("",!0),e.selectedRegistryOption==="maven"?(n(),c("div",ke,[s(y,{title:"settings.xml",placeholder:"Paste your ~/.m2/settings.xml file contents here",modelValue:e.inputRegistryData[e.selectedRegistryOption].token,"onUpdate:modelValue":i[3]||(i[3]=l=>e.inputRegistryData[e.selectedRegistryOption].token=l),modelModifiers:{trim:!0},name:"privateRegistryToken",rows:"6"},null,8,["modelValue"])])):e.selectedRegistryOption==="pypi"?(n(),c("div",Ve,[s(f,{title:"Private registry index url",placeholder:"https://user:password@myregistry.com/api",modelValue:e.inputRegistryData[e.selectedRegistryOption].url,"onUpdate:modelValue":i[4]||(i[4]=l=>e.inputRegistryData[e.selectedRegistryOption].url=l),modelModifiers:{trim:!0},name:"privateRegistryToken"},null,8,["modelValue"])])):e.selectedRegistryOption==="custom"?(n(),c("div",xe,[s(N,{"env-vars":e.inputRegistryData.custom,onUpdate:a.handleUpdateEnvVars},null,8,["env-vars","onUpdate"])])):e.selectedRegistryOption==="poetry"?(n(),c("div",Ee,[s(f,{title:"Private registry service account key",placeholder:"{}",modelValue:e.inputRegistryData[e.selectedRegistryOption].token,"onUpdate:modelValue":i[5]||(i[5]=l=>e.inputRegistryData[e.selectedRegistryOption].token=l),modelModifiers:{trim:!0},name:"privateRegistryToken"},null,8,["modelValue"])])):(n(),c("div",be,[s(f,{title:"Private registry host",placeholder:"npm.pkg.github.com",modelValue:e.inputRegistryData[e.selectedRegistryOption].url,"onUpdate:modelValue":i[6]||(i[6]=l=>e.inputRegistryData[e.selectedRegistryOption].url=l),modelModifiers:{trim:!0},name:"privateRegistryUrl"},null,8,["modelValue"]),s(f,{title:"Private registry token",placeholder:"****",modelValue:e.inputRegistryData[e.selectedRegistryOption].token,"onUpdate:modelValue":i[7]||(i[7]=l=>e.inputRegistryData[e.selectedRegistryOption].token=l),modelModifiers:{trim:!0},name:"privateRegistryToken"},null,8,["modelValue"])])),e.registryDocsInfo[e.selectedRegistryOption]?(n(),k(v,{key:7,size:"small"},{default:u(()=>[s(G,{href:this.selectedRegistryDocsUrl,target:"_blank"},{default:u(()=>[m(" See documentation ")]),_:1},8,["href"]),m(" "+I(this.selectedRegistryDocsText),1)]),_:1})):R("",!0)]))])]),footer:u(()=>[a.selectedRegistryId?(n(),k(D,{key:0,onClicked:a.handleDelete,variation:"destructive",disabled:e.isLoading},{default:u(()=>[m(" Delete "+I(this.selectedRegistryTitle)+" config ",1)]),_:1},8,["onClicked","disabled"])):R("",!0),_("div",Pe,[s(D,{onClicked:a.handleCloseModal,variation:"plain",class:"ml-auto"},{default:u(()=>[m("Cancel")]),_:1},8,["onClicked"]),s(D,{onClicked:a.handleConfirm,"is-loading":e.isSaving,disabled:e.isLoading},{default:u(()=>[m("Apply Changes")]),_:1},8,["onClicked","is-loading","disabled"])])]),_:1},8,["onClose"])}const Be=w(pe,[["render",Te]]);export{Be as default};
