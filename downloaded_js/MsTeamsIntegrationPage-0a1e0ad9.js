import{g as b,l as y,u as w,s as D}from"./ms-teams-5bb92351.js";import{s as V}from"./sortBy-b18e8152.js";import{aE as M,a as h,_ as B,X as F,B as k,z as U,N as L,f as P,H as x,r as l,k as T,m as u,o as a,w as r,n as c,F as f,p as I,q as d,s as g}from"./index-13ff96f4.js";import{P as R}from"./PageHeader-46c38a32.js";import{S as O}from"./SettingsEmptyState-8e8644cd.js";import{E as H}from"./EmptyUsersIllustration-1a5638d0.js";function G(){const e=z(),t=W(),i=M("ms-teams"),_=new URLSearchParams({client_id:e,scope:"Team.ReadBasic.All user.read offline_access Channel.ReadBasic.All ChannelMessage.Send",redirect_uri:t,response_type:"code",state:i});return`${Y()}?${_.toString()}`}function z(){return h()==="staging"||h()==="production","6c44fbb7-ccd9-46e8-b06c-d9ea14b00501"}function W(){let e="http://app.local.aikido.io";return h()==="staging"?e="https://app.test.aikido.dev":h()==="production"&&(e="https://app.aikido.dev"),`${e}/settings/integrations/notifications/ms-teams/callback`}function Y(){return h()==="staging"||h()==="production"?"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize":"http://localhost:5001/ms-teams"}const X="https://cdn.aikido.dev/assets/icons/ms-teams.svg?v=2",q={components:{XPreloader:F,SettingsEmptyState:O,EmptyUsersIllustration:H,PageHeader:R,BaseParagraph:k,InputSwitch:U,BaseSelect:L,BaseButton:P,BaseHeading:x},data(){return{loaded:!1,channels:[],selectedDigestFridayChannel:null,selectedDigestFridayChannelName:null,selectedNewCriticalsChannel:null,selectedNewCriticalsChannelName:null,digestFridayChannelActive:0,newCriticalsChannelActive:0,showDeactivateIntegrationButton:!1}},async created(){this.init()},computed:{breadcrumbs(){return[{label:"Settings",href:"/settings"},{label:"Integrations",href:"/settings/integrations"},{label:"Microsoft Teams"}]}},methods:{async init(){const e=await b();if(!e){this.loaded=!0;return}try{let t=await y();const i=V(t,"title");this.channels=i}catch{this.showDeactivateIntegrationButton=!0}this.channels.length===0&&(this.showDeactivateIntegrationButton=!0),this.selectedDigestFridayChannel=e.digest_friday_channel,this.selectedDigestFridayChannelName=e.digest_friday_channel_name,this.selectedNewCriticalsChannel=e.new_criticals_channel,this.selectedNewCriticalsChannelName=e.new_criticals_channel_name,this.digestFridayChannelActive=e.push_digest_friday,this.newCriticalsChannelActive=e.push_new_criticals,this.loaded=!0},handleAddIntegration(){const e=G();window.location=e},async deactivateIntegration(){confirm(this.$t("CONFIRM_DEACTIVATE_MS_TEAMS"))&&(await w(),this.channels=[],this.showDeactivateIntegrationButton=!1,this.init(),Toast.success({title:this.$t("NOTIFICATIONS.INTEGRATION_DEACTIVATED.TITLE"),description:this.$t("MS_TEAMS_DEACTIVATED")}))},async saveSettings(){if(this.digestFridayChannelActive&&!this.selectedDigestFridayChannel)return Toast.error({description:this.$t("MS_TEAMS_DIGEST_FRIDAY_CHANNEL_MISSING")});if(this.newCriticalsChannelActive&&!this.selectedNewCriticalsChannel)return Toast.error({description:this.$t("MS_TEAMS_NEW_CRITICALS_CHANNEL_MISSING")});await D({push_digest_friday:this.digestFridayChannelActive,digest_friday_channel:this.selectedDigestFridayChannel,digest_friday_channel_name:this.selectedDigestFridayChannelName,push_new_criticals:this.newCriticalsChannelActive,new_criticals_channel:this.selectedNewCriticalsChannel,new_criticals_channel_name:this.selectedNewCriticalsChannelName}),Toast.success({title:this.$t("NOTIFICATIONS.INTEGRATION_UPDATED.TITLE"),description:this.$t("CHANGES_SAVED")})},handleSetCriticalsChannelName(e){const t=this.channels.find(i=>i.id===e);t&&(this.selectedNewCriticalsChannelName=t.title)},handleSetDigestChannelName(e){const t=this.channels.find(i=>i.id===e);t&&(this.selectedDigestFridayChannelName=t.title)},handleToggleDigest(e){e!==1&&(this.selectedDigestFridayChannel=null,this.selectedDigestFridayChannelName=null)},handleToggleCriticals(e){e!==1&&(this.selectedNewCriticalsChannel=null,this.selectedNewCriticalsChannelName=null)}}},j={class:"flex align-center gap-16px"},J=c("img",{src:X,height:"40",class:"rounded-2px"},null,-1),K={class:"page-content"},Q={key:0},Z={key:0,class:"box"},$={class:"flex flex-column gap-16px flex-wrap"},ee={class:"relative flex-1"},te={class:"relative flex-1"},ne={class:"mt-32px gap-12px flex"};function ae(e,t,i,_,n,s){const S=l("XPreloader"),N=l("BaseHeading"),m=l("BaseButton"),E=l("PageHeader"),A=l("EmptyUsersIllustration"),v=l("SettingsEmptyState"),C=l("BaseSelect"),p=l("InputSwitch");return n.loaded?(d(),u(f,{key:1},[a(E,{breadcrumbs:s.breadcrumbs},{title:r(()=>[c("div",j,[J,a(N,{as:"h1"},{default:r(()=>[g(" Microsoft teams integration ")]),_:1})])]),rightContent:r(()=>[n.showDeactivateIntegrationButton?(d(),T(m,{key:0,size:"medium",variation:"plain",onClick:s.deactivateIntegration},{default:r(()=>[g(" Deactivate Integration ")]),_:1},8,["onClick"])):I("",!0)]),_:1},8,["breadcrumbs"]),c("div",K,[n.loaded&&n.channels.length===0&&!n.showDeactivateIntegrationButton?(d(),u("div",Q,[a(v,{title:e.$t("SETTINGS.MS_TEAMS.OVERVIEW.EMPTY_STATE_TITLE"),description:e.$t("SETTINGS.MS_TEAMS.OVERVIEW.EMPTY_STATE_DESCRIPTION"),actionLabel:e.$t("SETTINGS.MS_TEAMS.OVERVIEW.EMPTY_STATE_ACTION_LABEL"),onAction:s.handleAddIntegration},{default:r(()=>[a(A)]),_:1},8,["title","description","actionLabel","onAction"])])):(d(),u(f,{key:1},[n.channels.length>0?(d(),u("div",Z,[c("div",$,[c("div",ee,[a(C,{class:"text-gray-900",options:n.channels,modelValue:n.selectedDigestFridayChannel,"onUpdate:modelValue":[t[0]||(t[0]=o=>n.selectedDigestFridayChannel=o),s.handleSetDigestChannelName],label:e.$t("CHANNEL_DIGEST"),sublabel:e.$t("NOTIFY_DIGEST"),disabled:!n.digestFridayChannelActive},null,8,["options","modelValue","label","sublabel","disabled","onUpdate:modelValue"]),a(p,{modelValue:n.digestFridayChannelActive,"onUpdate:modelValue":[t[1]||(t[1]=o=>n.digestFridayChannelActive=o),s.handleToggleDigest],class:"absolute right-0 top-11px"},null,8,["modelValue","onUpdate:modelValue"])]),c("div",te,[a(C,{class:"text-gray-900",options:n.channels,modelValue:n.selectedNewCriticalsChannel,"onUpdate:modelValue":[t[2]||(t[2]=o=>n.selectedNewCriticalsChannel=o),s.handleSetCriticalsChannelName],label:e.$t("CHANNEL_NEW_CRITICALS"),sublabel:e.$t("NOTIFY_NEW_CRITICALS"),disabled:!n.newCriticalsChannelActive},null,8,["options","modelValue","label","sublabel","disabled","onUpdate:modelValue"]),a(p,{modelValue:n.newCriticalsChannelActive,"onUpdate:modelValue":[t[3]||(t[3]=o=>n.newCriticalsChannelActive=o),s.handleToggleCriticals],class:"absolute right-0 top-11px"},null,8,["modelValue","onUpdate:modelValue"])])]),c("div",ne,[a(m,{size:"small",onClick:s.deactivateIntegration,variation:"destructive",class:"ml-auto"},{default:r(()=>[g(" Unlink Microsoft Teams ")]),_:1},8,["onClick"]),a(m,{size:"small",onClick:s.saveSettings},{default:r(()=>[g("Save")]),_:1},8,["onClick"])])])):I("",!0)],64))])],64)):(d(),T(S,{key:0,class:"supercenter",theme:"transparent"}))}const de=B(q,[["render",ae]]);export{de as default};
