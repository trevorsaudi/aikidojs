import{O}from"./OverviewEmptyState-c8440b9c.js";import{G as L}from"./GenericIllustration-4aca88e5.js";import{g as V}from"./repoName-872812ed.js";import{_ as w,B as T,d as C,a2 as B,r as l,q as r,k as S,w as o,o as a,m as f,p as I,n as p,s as c,u as b,ai as k,A as N,U as E,aQ as K,F as G,t as P,I as M}from"./index-13ff96f4.js";import{a as A}from"./autofixSastIssues-779ec5b4.js";import{a as D}from"./autofixable-c6560249.js";import{D as j,a as U}from"./DataTable-e31a825a.js";import{D as X,a as q}from"./DataTableCell-51c0104f.js";import{D as Q}from"./DataTableSeverityIndicator-48ffb8dc.js";import{C as z,I as H}from"./CreateAutoFixProgressFlow-8111d22c.js";import{I as J}from"./IssueStatusTag-dacefc0a.js";import{D as W}from"./DataTableCellSelectable-71ffdbc4.js";import{T as Y}from"./TableListActionMenu-8ca3c15b.js";import{I as Z}from"./InputCheckbox-81cb3ca6.js";import{A as $}from"./AutofixFilter-262abaef.js";import{Q as ee}from"./QueueSidebar-47492277.js";import"./RadioButtonList-1d4cdaad.js";import"./EnableIntegrationModal-48b01f56.js";import"./ActionMenu-3e4470bf.js";import"./FilterButton-bb5393a7.js";import"./SelectRepoSearchable-f2be202e.js";import"./InputSearchDropdown-02988f6b.js";import"./languages-12749071.js";import"./SidebarActionMenu-1bf6804b.js";import"./focusModePreference-150f170e.js";import"./TableListHeader-e50d01d1.js";import"./BaseRadioInput-a7ac3557.js";import"./BaseLabel-a1c0ca00.js";import"./AIText-891d4f7b.js";import"./BreakSlashes-925eef0e.js";import"./UnignoreIssue-5dff8957.js";import"./CreateTicketModal-c14deeb1.js";import"./ManualInputSearchDropdown-6a7ece3e.js";import"./taskTrackerNaming-55adac3e.js";import"./taskTrackerIcon-504ea566.js";import"./index-b87db690.js";import"./dateFns-a344cb79.js";import"./lock-files-cdbb050f.js";import"./BaseCodeBlock-cec75629.js";import"./string-814c5ffd.js";import"./ButtonMultiOption-12e505fb.js";import"./transform-c376ec3f.js";import"./linear-efb37b7f.js";import"./arc-12e4470a.js";import"./BaseForm-4c6fa06f.js";import"./XTabs-d492da26.js";import"./BaseCard-471d3203.js";import"./AccordionContainer-09dc0ed4.js";import"./trycatch-83445d5b.js";import"./licenses-6ab38515.js";const te={props:{fix:Object,active:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1}},emits:["rowClicked","createAutofixClicked","toggleSelectFix"],components:{DataTableCell:X,BaseParagraph:T,DataTableSeverityIndicator:Q,DataTableRow:q,BasePill:C,CreateAutoFixProgressFlow:z,IssueStatusTag:J,DataTableCellSelectable:W,TableListActionMenu:Y,XTooltip:B,IssueStatus:H},computed:{description(){if(this.fix.issue_count===1){const e=this.fix.related_issues[0];return this.getLineText(e)}return this.$t("X_PLACES_AFFECTED",this.fix.related_issues.length)},descriptionTooltip(){return this.fix.related_issues.map(e=>this.getLineText(e)).join(`
`)},issue(){return{id:this.fix.id,repo_id:this.fix.repo_id}},isActionButtonAlwaysVisible(){const{sidebarIssue:e,fix:t}=this.$route.query;return e==this.fix.grouped_issue_id&&t==this.fix.id},sections(){const e=[{title:"Actions",items:[{label:"Preview Autofix",onClick:()=>this.previewAutofix(),icon:"icon-preview",useBaseIcon:!0}]}];return D(this.fix.rule_id)||e[0].items.push({label:"Create PR",onClick:()=>this.createAutofix(),icon:"icon-shield_check",iconColor:"secondary"}),e}},methods:{getLineText(e){return e.start_line==e.end_line?`Line ${e.start_line}`:`From line ${e.start_line} to line ${e.end_line}`},async createAutofix(){await A(this.fix.related_issues,!1,this.fix.title)},async previewAutofix(){await A(this.fix.related_issues,!0,this.fix.title,!0)},selectFix(){this.$emit("toggleSelectFix")}}},se={key:0,class:"absolute h-full pin-t pin-l bg-purple-accent w-5px"},ie={class:"flex flex-column gap-4px overflow-hidden"};function ae(e,t,s,x,n,i){const F=l("DataTableCellSelectable"),_=l("BaseParagraph"),g=l("XTooltip"),h=l("DataTableCell"),v=l("DataTableSeverityIndicator"),m=l("IssueStatus"),y=l("TableListActionMenu"),d=l("DataTableRow");return r(),S(d,{clickable:"",onClick:t[2]||(t[2]=u=>e.$emit("rowClicked",s.fix)),class:"group"},{default:o(()=>[a(F,{mode:"edit",selected:s.isSelected,onSelect:i.selectFix,useSelectedValueForCheckboxState:!0},null,8,["selected","onSelect"]),a(h,null,{default:o(()=>[s.active?(r(),f("span",se)):I("",!0),p("div",ie,[a(_,{truncate:!0},{default:o(()=>[c(b(s.fix.file),1)]),_:1}),a(_,{color:"subdued",truncate:!0},{default:o(()=>[c(b(i.description)+" ",1),a(g,{class:"ws-break-spaces"},{default:o(()=>[c(b(i.descriptionTooltip),1)]),_:1})]),_:1})])]),_:1}),a(v,{priority:s.fix.aikido_priority},null,8,["priority"]),a(h,{onClick:t[0]||(t[0]=k(()=>{},["stop"]))},{default:o(()=>[a(m,{groupedIssue:{enhanced_status:s.fix.enhanced_status,id:s.fix.related_issues[0].grouped_issue_id,preview_task_id:s.fix.preview_task_id},filterRepoId:s.fix.repo_id},null,8,["groupedIssue","filterRepoId"])]),_:1}),a(h,null,{default:o(()=>[a(y,{iconButtonClass:"opacity-0 group_hover_opacity-100",sections:i.sections,onClick:t[1]||(t[1]=k(()=>{},["prevent","stop"]))},null,8,["sections"])]),_:1})]),_:1})}const le=w(te,[["render",ae]]),oe={components:{DataTable:j,DataTableHeader:U,AutofixSastOverviewPageRow:le,BaseParagraph:T,BasePill:C,InputCheckbox:Z,XTooltip:B},props:{fixableSastIssueGroup:Object,isSearchFilteringActive:Boolean},data(){return{selectedFixableSastIssueKeys:[],shouldShowAllSastIssues:!1,freePlanAllowedFileFixesAmount:1}},computed:{selectedFixableSastIssues(){return this.fixableSastIssueGroup.filter(e=>this.selectedFixableSastIssueKeys.includes(e.key))},availableSelectedFixableSastIssueKeys(){return this.selectedFixableSastIssues.map(e=>e.key)},repoName(){return V(this.fixableSastIssueGroup[0])},visibleFixableSastIssueGroup(){return this.shouldShowAllSastIssues?this.fixableSastIssueGroup:this.fixableSastIssueGroup.slice(0,5)},showMoreText(){return`Show ${this.fixableSastIssueGroup.length-this.visibleFixableSastIssueGroup.length} more`},previewOnly(){return D(this.fixableSastIssueGroup[0].rule_id)}},methods:{onToggleSelectFix(e){const t=this.selectedFixableSastIssueKeys.indexOf(e);if(t===-1){if(!this.handleLimitationForBulkAutofix(this.selectedFixableSastIssueKeys.length+1))return;this.selectedFixableSastIssueKeys.push(e)}else this.selectedFixableSastIssueKeys.splice(t,1)},handleToggleSelectAllVisibleSastIssues(e){if(e){if(!this.handleLimitationForBulkAutofix(this.visibleFixableSastIssueGroup.length)){this.selectedFixableSastIssueKeys=this.visibleFixableSastIssueGroup.map(s=>s.key).slice(0,this.freePlanAllowedFileFixesAmount);return}this.selectedFixableSastIssueKeys=this.visibleFixableSastIssueGroup.map(s=>s.key)}else this.selectedFixableSastIssueKeys=[]},async startAutofixForSelection(e=!1){const t=this.selectedFixableSastIssues.length===0?this.visibleFixableSastIssueGroup.length:this.selectedFixableSastIssues.length;if(!this.handleLimitationForBulkAutofix(t))return;this.selectedFixableSastIssues.length===0&&this.handleToggleSelectAllVisibleSastIssues(!0);const x=this.selectedFixableSastIssues.map(i=>i.related_issues).flat(1),n=this.fixableSastIssueGroup[0].title;await A(x,e,n,e)},handleLimitationForBulkAutofix(e){return N.hasExpiredFullTrial()&&e>this.freePlanAllowedFileFixesAmount?(this.$modal.show("UpgradeAccountModal",{title:"Upgrade to fix multiple files at once",msg:`Our free plan allows you to fix up to ${this.freePlanAllowedFileFixesAmount} file. Upgrade now to any paid plan to fix more files at once.`}),!1):!0},openSidebar(){var s,x,n;const e=((s=this.fixableSastIssueGroup[0])==null?void 0:s.repo_id)??-1,t=((n=(x=this.fixableSastIssueGroup[0])==null?void 0:x.related_issues[0])==null?void 0:n.grouped_issue_id)??void 0;this.$emit("openSidebar",{repoId:e,groupedIssueId:t})}}},re={class:"bg-white rounded-8px mb-32px"},ne={class:"p-16px flex justify-between align-center"},ue={class:"text--semi-bold"},ce=p("i",{class:"icon icon-information icon-12px opacity-0 group_hover_opacity-100"},null,-1),de={class:"flex align-center gap-16px"},pe={key:0},me={class:"text-primary-aik-100 px-16px py-8px cursor-pointer"};function fe(e,t,s,x,n,i){const F=l("BaseParagraph"),_=l("BasePill"),g=l("BaseButton"),h=l("InputCheckbox"),v=l("XTooltip"),m=l("DataTableHeader"),y=l("AutofixSastOverviewPageRow"),d=l("DataTable");return r(),f("div",re,[p("div",ne,[a(F,{class:"cursor-pointer hover_text-surface-blue-100 group"},{default:o(()=>[p("div",{class:"flex align-center gap-4px",onClick:t[0]||(t[0]=(...u)=>i.openSidebar&&i.openSidebar(...u))},[p("span",ue,b(s.fixableSastIssueGroup[0].title),1),c(" | "),p("span",null,b(i.repoName),1),ce])]),_:1}),p("div",de,[i.availableSelectedFixableSastIssueKeys.length>0?(r(),S(_,{key:0,title:e.$t("X_FILES_SELECTED",i.availableSelectedFixableSastIssueKeys.length),variation:"gray-fill"},null,8,["title"])):I("",!0),i.previewOnly?I("",!0):(r(),S(g,{key:1,class:"flex gap-8px text--normal align-center",as:"button",size:"small",variation:"plain",onClick:t[1]||(t[1]=()=>i.startAutofixForSelection(!1))},{default:o(()=>[c(" Create PR ")]),_:1})),a(g,{class:"flex gap-8px text--normal align-center",as:"button",size:"small",onClick:t[2]||(t[2]=()=>i.startAutofixForSelection(!0))},{default:o(()=>[c(" Preview Autofix ")]),_:1})])]),a(d,null,{header:o(()=>[a(m,{width:"48px",alignment:"center",spacing:"compact"},{default:o(()=>[a(h,{disabled:s.isSearchFilteringActive,"semi-checked":e.hasSelectedFixes,modelValue:e.areAllFixesSelected,"onUpdate:modelValue":i.handleToggleSelectAllVisibleSastIssues},null,8,["disabled","semi-checked","modelValue","onUpdate:modelValue"]),E(a(v,null,{default:o(()=>[c("Not available when search is active")]),_:1},512),[[K,s.isSearchFilteringActive]])]),_:1}),a(m,{width:"auto"},{default:o(()=>[c("Filename")]),_:1}),a(m,{width:"120px"},{default:o(()=>[c("Severity")]),_:1}),a(m,{width:"120px"},{default:o(()=>[c("Status")]),_:1}),a(m,{width:"48px"})]),body:o(()=>[(r(!0),f(G,null,P(i.visibleFixableSastIssueGroup,u=>(r(),S(y,{fix:u,key:u.key,isSelected:n.selectedFixableSastIssueKeys.includes(u.key),onToggleSelectFix:R=>i.onToggleSelectFix(u.key),onRowClicked:R=>i.onToggleSelectFix(u.key)},null,8,["fix","isSelected","onToggleSelectFix","onRowClicked"]))),128))]),customBody:o(()=>[i.visibleFixableSastIssueGroup.length<s.fixableSastIssueGroup.length?(r(),f("tr",pe,[p("td",{colspan:"5",class:"px-6px py-2px bg-carbon-5",onClick:t[3]||(t[3]=u=>n.shouldShowAllSastIssues=!0)},[p("div",me,b(i.showMoreText),1)])])):I("",!0)]),_:1})])}const xe=w(oe,[["render",fe]]),he={components:{OverviewEmptyState:O,GenericIllustration:L,AutofixSastOverviewRepoGroup:xe,AutofixFilter:$,InputSearch:M,QueueSidebar:ee},props:{fixableSastIssueGroupsMap:{type:Object,required:!0},amountFixableSastIssues:{type:Number,required:!0},isSearchFilteringActive:{type:Boolean,default:!1},loadingAllSastIssues:{type:Boolean,default:!1},searchTerm:{type:String,default:""},repoOwnerNames:{type:Array,default:()=>[]},shouldShowRepoPathsFilter:{type:Boolean,default:!1},hideLanguageFilter:{type:Boolean,default:!1},groupedIssueFilter:{type:[String,Number]}},emits:["fetchAllSastIssues","update:searchTerm","onFilterChanged"],data(){return{sidebarRepoId:-1}},computed:{amountFixablePackagesVisible(){let e=0;for(const t of Object.values(this.fixableSastIssueGroupsMap))e+=t.length;return e},emptystateTitle(){return"No Autofixes Available"},emptystateDescription(){return"There are no issues available for autofix with these search terms or filter settings."}},methods:{openSidebar({groupedIssueId:e,repoId:t}){this.sidebarRepoId=t,this.$router.replace({path:this.$route.path,query:{...this.$route.query,sidebarIssue:e}})}}},Se={class:"flex align-center gap-8px mb-16px"},be={key:0,class:"card"},_e={key:1,class:"flex justify-center mt-16px"};function ge(e,t,s,x,n,i){const F=l("InputSearch"),_=l("AutofixFilter"),g=l("GenericIllustration"),h=l("OverviewEmptyState"),v=l("AutofixSastOverviewRepoGroup"),m=l("BaseButton"),y=l("QueueSidebar");return r(),f("div",null,[p("div",Se,[a(F,{modelValue:s.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=d=>e.$emit("update:searchTerm",d)),spacing:"compact"},null,8,["modelValue"]),(r(),S(_,{key:e.$route.name,groupedIssueFilterProp:s.groupedIssueFilter,hideLockfileFilter:!0,onSelectFilter:t[1]||(t[1]=d=>e.$emit("onFilterChanged",d)),shouldShowRepoPathsFilter:s.shouldShowRepoPathsFilter,repoOwnerNames:s.repoOwnerNames,hideLanguageFilter:s.hideLanguageFilter},null,8,["groupedIssueFilterProp","shouldShowRepoPathsFilter","repoOwnerNames","hideLanguageFilter"]))]),i.amountFixablePackagesVisible==0?(r(),f("div",be,[a(h,{title:i.emptystateTitle,description:i.emptystateDescription,variation:"empty",class:"mx-auto"},{default:o(()=>[a(g)]),_:1},8,["title","description"])])):I("",!0),(r(!0),f(G,null,P(s.fixableSastIssueGroupsMap,(d,u)=>(r(),S(v,{key:u,fixableSastIssueGroup:d,isSearchFilteringActive:s.isSearchFilteringActive,onOpenSidebar:i.openSidebar},null,8,["fixableSastIssueGroup","isSearchFilteringActive","onOpenSidebar"]))),128)),i.amountFixablePackagesVisible<s.amountFixableSastIssues?(r(),f("div",_e,[a(m,{onClick:t[2]||(t[2]=d=>e.$emit("fetchAllSastIssues")),size:"small",theme:"secondary",isLoading:s.loadingAllSastIssues,disabled:s.loadingAllSastIssues},{default:o(()=>[c(" Load all SAST autofixes ("+b(s.amountFixableSastIssues)+") ",1)]),_:1},8,["isLoading","disabled"])])):I("",!0),(r(),S(y,{key:n.sidebarRepoId,filterRepoId:n.sidebarRepoId},null,8,["filterRepoId"]))])}const St=w(he,[["render",ge]]);export{St as default};
