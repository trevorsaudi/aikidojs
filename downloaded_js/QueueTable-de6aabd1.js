import{_ as S,a3 as y,r as l,q as o,m as f,o as s,w as u,s as r,u as m,e as L,bk as U,a2 as F,A as H,k as d,n as D,p as h,B as V,Z as v,S as w,F as C,a1 as E,c7 as Q,t as R,aa as x}from"./index-13ff96f4.js";import{m as W,c as q}from"./dateFns-a344cb79.js";import{D as G,a as B}from"./DataTableCell-51c0104f.js";import{I as X,a as P,b as j,c as Y}from"./IssueGroupSeverityColumn-7631c77a.js";import{I as Z}from"./IssueGroupTypeColumn-03f014b0.js";import{I as J}from"./CreateAutoFixProgressFlow-8111d22c.js";import{S as K}from"./StackedAvatars-4925baeb.js";import $ from"./CreateTicketModal-c14deeb1.js";import{D as ee,a as te}from"./DataTable-e31a825a.js";const se={props:{groupedIssue:{type:Object,required:!0}},computed:{snoozedUntilDate(){const t=this.groupedIssue.issues.map(e=>e.snooze_until_timestamp).filter(e=>e>-1),a=Math.min(...t);return y.fromUnix(a).format(y.SHORT_ISO_FORMAT)}}},ae={class:"flex"};function ue(t,a,e,p,g,n){const i=l("BaseParagraph");return o(),f("div",ae,[s(i,null,{default:u(()=>[r(m(n.snoozedUntilDate),1)]),_:1})])}const ne=S(se,[["render",ue]]),oe={props:{issueGroup:{type:Object,required:!0}},components:{BaseIconButton:L,CreateTicketModal:$,DataTableCell:G,BaseBody:U,StackedAvatars:K,XTooltip:F},data(){return{showAddTaskModal:!1}},computed:{hasOpenTask(){return this.issueGroup.tasks.filter(a=>!a.is_deleted).length>0},assigneeText(){var t,a;return this.uniqueTaskAssignees.length==1?((t=this.uniqueTaskAssignees[0].full_name)==null?void 0:t.split(" ")[0])??"user":this.uniqueTaskAssignees.length>1?(((a=this.uniqueTaskAssignees[0].full_name)==null?void 0:a.split(" ")[0])??"user")+" + "+(this.issueGroup.tasks.length-1)+" more":""},assigneeTextFull(){return this.uniqueTaskAssignees.length==1?this.uniqueTaskAssignees[0].full_name??"user":this.uniqueTaskAssignees.length>1?(this.uniqueTaskAssignees[0].full_name??"user")+" + "+(this.issueGroup.tasks.length-1)+" more":""},avatarUrl(){var t;return(t=this.issueGroup.tasks[0])==null?void 0:t.task_assignee_avatar_url},uniqueTaskAssignees(){const t={};for(const e of this.issueGroup.tasks)e.is_deleted||(t[e.task_assignee_name+"_"+e.task_assignee_avatar_url]={full_name:e.task_assignee_name,avatar:e.task_assignee_avatar_url});const a=Object.values(t);return a.sort((e,p)=>e.full_name==="Unassigned"?1:p.full_name==="Unassigned"?-1:0),a},canCreateTask(){var t;return((t=this.issueGroup)==null?void 0:t.status)!="closed"}},methods:{handleOpenAddTaskModal(){if(H.hasExpiredFullTrial()&&!this.$featureflags.force_enable_task_trackers)return this.$modal.show("UpgradeAccountModal");this.showAddTaskModal=!0},openTasks(){this.$router.replace({path:this.$route.path,query:{...this.$route.query,sidebarIssue:this.issueGroup.id,sidebarTab:"tasks"}})}}},le={key:0,class:"w-full"};function ie(t,a,e,p,g,n){const i=l("StackedAvatars"),c=l("BaseBody"),I=l("XTooltip"),T=l("BaseIconButton"),b=l("CreateTicketModal"),k=l("DataTableCell");return o(),d(k,null,{default:u(()=>[n.hasOpenTask?(o(),f("span",le,[D("div",{class:"flex align-center gap-8px overflow-hidden",onClick:a[0]||(a[0]=(..._)=>n.openTasks&&n.openTasks(..._))},[s(i,{size:"24",users:n.uniqueTaskAssignees,amountVisibleUsers:3,noUnravel:!0},null,8,["users"]),n.assigneeText?(o(),d(c,{key:0,truncate:"",class:"hidden desktop-ultra-wide_inline-block"},{default:u(()=>[r(m(n.assigneeText),1)]),_:1})):h("",!0),n.assigneeTextFull?(o(),d(c,{key:1,truncate:"",class:"desktop-ultra-wide_hidden"},{default:u(()=>[r(m(n.assigneeTextFull)+" ",1),s(I,null,{default:u(()=>[r(m(n.assigneeTextFull),1)]),_:1})]),_:1})):h("",!0)])])):n.canCreateTask?(o(),d(T,{key:1,icon:"icon-plus",onClicked:n.handleOpenAddTaskModal,class:"data-table__row__action"},null,8,["onClicked"])):h("",!0),g.showAddTaskModal?(o(),d(b,{key:2,issueGroupId:e.issueGroup.id,onCancel:a[1]||(a[1]=_=>g.showAddTaskModal=!1),onCreated:a[2]||(a[2]=_=>g.showAddTaskModal=!1)},null,8,["issueGroupId"])):h("",!0)]),_:1})}const re=S(oe,[["render",ie]]),de={emits:["rowClicked"],components:{IssueStatus:J,BaseParagraph:V,DataTableRow:B,DataTableCell:G,IssueGroupTypeColumn:Z,IssueGroupNameColumn:X,IssueGroupSeverityColumn:P,IssueGroupLocationColumn:j,IssueGroupActionMenuColumn:Y,IssueGroupTaskAssigneeColumn:re,XTooltip:F,SnoozedUntil:ne},props:{groupedIssue:Object,filterRepoId:{type:[Number,String],default:void 0},filterImageId:{type:[Number,String],default:void 0},filterCloudId:{type:[Number,String],default:void 0},filterDomainId:{type:[Number,String],default:void 0},filterInstanceGroupId:{type:[Number,String],default:void 0},quickFilter:{type:String,default:""},isSnoozedIssuesView:{type:Boolean,default:!1},showSolvedDate:{type:Boolean,default:!1}},computed:{active(){return this.$route.query.sidebarIssue===this.groupedIssue.id.toString()},timetofix(){return this.groupedIssue.time_to_fix>=100*60?this.$t("HR",["> 100"]):W(this.groupedIssue.time_to_fix)},showAssigneeColumn(){return!!v.data.issueTracker},shouldBeFadedColor(){return this.$route.name==="feed"&&(this.groupedIssue.enhanced_status==="auto-ignored"||this.groupedIssue.enhanced_status==="ignored")},dueDate(){let t=this.groupedIssue.sla_remediate_by_date;return this.quickFilter==="due_soon"&&(t=this.groupedIssue.sla_due_soon_date),t<1?"":y.fromUnix(t).format(y.SHORT_ISO_FORMAT)},dueDateRelative(){let t=this.groupedIssue.sla_remediate_by_date;if(this.quickFilter==="due_soon"&&(t=this.groupedIssue.sla_due_soon_date),t<1)return"";const a=q(t);return a===0?this.$t("TODAY"):a>=30?this.$t("X_MOS_AGO",Math.floor(a/30)):a>0?this.$t("X_DAYS_AGO",a):this.$t("X_DAYS_AHEAD",Math.abs(a))},solvedDate(){const t=this.groupedIssue.issues.map(p=>p.closed_timestamp),a=Math.max(...t);return q(a)===0?this.$t("TODAY"):y.fromUnix(a).format(y.SHORT_ISO_FORMAT)}}};function ce(t,a,e,p,g,n){const i=l("IssueGroupTypeColumn"),c=l("IssueGroupNameColumn"),I=l("IssueGroupSeverityColumn"),T=l("IssueGroupLocationColumn"),b=l("XTooltip"),k=l("BaseParagraph"),_=l("DataTableCell"),A=l("SnoozedUntil"),M=l("IssueStatus"),O=l("IssueGroupTaskAssigneeColumn"),N=l("IssueGroupActionMenuColumn"),z=l("DataTableRow");return o(),d(z,{onClick:a[0]||(a[0]=Ce=>e.groupedIssue.is_blurred?()=>{}:t.$emit("rowClicked",e.groupedIssue)),clickable:!0,id:e.groupedIssue.id,faded:n.shouldBeFadedColor,class:w({"data-table__row--unavailable":e.groupedIssue.is_blurred,"hover-trigger":e.groupedIssue.is_blurred})},{default:u(()=>[s(i,{active:n.active,"issue-group":e.groupedIssue},null,8,["active","issue-group"]),s(c,{"issue-group":e.groupedIssue},null,8,["issue-group"]),s(I,{"issue-group":e.groupedIssue},null,8,["issue-group"]),s(T,{"issue-group":e.groupedIssue,class:w({"data-table__column__folded":t.$route.query.sidebarIssue})},null,8,["issue-group","class"]),s(_,null,{default:u(()=>[["due_soon","out_of_sla"].includes(e.quickFilter)?(o(),f(C,{key:0},[s(b,null,{default:u(()=>[r(m(n.dueDate),1)]),_:1}),s(k,null,{default:u(()=>[r(m(n.dueDateRelative),1)]),_:1})],64)):e.showSolvedDate?(o(),d(k,{key:1},{default:u(()=>[r(m(n.solvedDate),1)]),_:1})):(o(),d(k,{key:2},{default:u(()=>[r(m(n.timetofix),1)]),_:1}))]),_:1}),s(_,{"prevent-fade":"",class:w({"data-table__column__folded":t.$route.query.sidebarIssue})},{default:u(()=>[e.isSnoozedIssuesView?(o(),d(A,{key:0,groupedIssue:e.groupedIssue},null,8,["groupedIssue"])):(o(),d(M,{key:1,groupedIssue:e.groupedIssue,filterRepoId:e.filterRepoId,rootClass:"sidebar-open_opacity-0"},null,8,["groupedIssue","filterRepoId"]))]),_:1},8,["class"]),n.showAssigneeColumn?(o(),d(O,{key:0,"issue-group":e.groupedIssue},null,8,["issue-group"])):h("",!0),s(N,{"issue-group":e.groupedIssue,filterRepoId:e.filterRepoId,filterImageId:e.filterImageId,filterCloudId:e.filterCloudId,filterDomainId:e.filterDomainId,filterInstanceGroupId:e.filterInstanceGroupId},null,8,["issue-group","filterRepoId","filterImageId","filterCloudId","filterDomainId","filterInstanceGroupId"])]),_:1},8,["id","faded","class"])}const _e=S(de,[["render",ce]]),fe={components:{LoadingSkeleton:E,DataTableRow:B,DataTableCell:G},methods:{calculateDynamicWidth(t=90){return`${Math.random()*(t-20)+20}%`}},computed:{showAssigneeColumn(){return!!v.data.issueTracker}}},me={class:"flex flex-column gap-4px w-full"};function pe(t,a,e,p,g,n){const i=l("LoadingSkeleton"),c=l("DataTableCell"),I=l("DataTableRow");return o(),d(I,null,{default:u(()=>[s(c,null,{default:u(()=>[s(i,{height:"16px"})]),_:1}),s(c,null,{default:u(()=>[D("div",me,[s(i,{height:"18px",width:n.calculateDynamicWidth(50),class:"mb-4px"},null,8,["width"]),s(i,{height:"14px",width:n.calculateDynamicWidth()},null,8,["width"])])]),_:1}),s(c,null,{default:u(()=>[s(i,{height:"16px"})]),_:1}),s(c,null,{default:u(()=>[s(i,{height:"16px",width:n.calculateDynamicWidth()},null,8,["width"])]),_:1}),s(c,null,{default:u(()=>[s(i,{height:"16px"})]),_:1}),s(c,null,{default:u(()=>[s(i,{height:"16px"})]),_:1}),n.showAssigneeColumn?(o(),d(c,{key:0},{default:u(()=>[s(i,{height:"16px"})]),_:1})):h("",!0),s(c,null,{default:u(()=>[s(i,{height:"16px"})]),_:1})]),_:1})}const he=S(fe,[["render",pe]]),ge={emits:["itemClicked","reachContentEnd"],components:{QueueTableRow:_e,LoadingQueueTableRow:he,DataTable:ee,DataTableHeader:te,DataTableRow:B},props:{filterRepoId:{type:[Number,String],default:void 0},filterImageId:{type:[Number,String],default:void 0},filterCloudId:{type:[Number,String],default:void 0},filterDomainId:{type:[Number,String],default:void 0},filterInstanceGroupId:{type:[Number,String],default:void 0},cloudFilter:[Number,String],groupedIssues:Array,isLoading:{type:Boolean,default:!1},showEmptyState:Boolean,hideHeader:{type:Boolean,default:!1},showBody:{type:Boolean,default:!0},quickFilter:{type:[String,void 0],default:void 0},hasActiveFilter:{type:Boolean,default:!1},showSolvedDate:{type:Boolean,default:!1}},computed:{showAssigneeColumn(){return!!v.data.issueTracker},shouldShowSLAInfo(){return["due_soon","out_of_sla"].includes(this.quickFilter)},isSnoozedIssuesView(){return this.$route.meta.status==="snoozed"},statusColumnHeaderText(){return this.isSnoozedIssuesView?"Snoozed Until":"Status"},statusColumnHeaderWidth(){return this.isSnoozedIssuesView?"128px":"120px"}}},Ie={class:"bg-white rounded-8px relative"},ke={key:0,colspan:"7"},Te={key:1,colspan:"7"},ye={class:"py-20px px-16px"},we={key:2,colspan:"7"},be={class:"py-20px px-16px"};function Se(t,a,e,p,g,n){const i=l("DataTableHeader"),c=l("LoadingQueueTableRow"),I=l("QueueTableRow"),T=l("BaseParagraph"),b=l("DataTableRow"),k=l("DataTable");return o(),f("div",Ie,[s(k,{class:w({"data-table--no-header":e.hideHeader})},Q({header:u(()=>[s(i,{width:"48px",alignment:"center"},{default:u(()=>[r("Type")]),_:1}),s(i,{width:"auto"},{default:u(()=>[r("Name")]),_:1}),s(i,{width:"100px",alignment:"center"},{default:u(()=>[r("Severity")]),_:1}),s(i,{width:"auto",class:w(["data-table__column__location",{"data-table__column__folded":t.$route.query.sidebarIssue}])},{default:u(()=>[r("Location")]),_:1},8,["class"]),n.shouldShowSLAInfo?(o(),d(i,{key:0,width:"120px"},{default:u(()=>[r("Due Date")]),_:1})):e.showSolvedDate?(o(),d(i,{key:1,width:"120px"},{default:u(()=>[r("Solved Date")]),_:1})):(o(),d(i,{key:2,width:"120px"},{default:u(()=>[r("Fix time")]),_:1})),s(i,{width:n.statusColumnHeaderWidth,class:w({"data-table__column__folded":t.$route.query.sidebarIssue})},{default:u(()=>[r(m(n.statusColumnHeaderText),1)]),_:1},8,["width","class"]),n.showAssigneeColumn?(o(),d(i,{key:3,width:"15%"},{default:u(()=>[r("Assignee")]),_:1})):h("",!0),s(i,{width:"48px",alignment:"center"})]),_:2},[e.showBody?{name:"body",fn:u(()=>[e.isLoading?(o(),f(C,{key:0},R(10,_=>s(c,{key:_})),64)):(o(),f(C,{key:1},[x(t.$slots,"fixedRow"),(o(!0),f(C,null,R(e.groupedIssues,_=>(o(),d(I,{key:_.id,groupedIssue:_,filterRepoId:e.filterRepoId,filterImageId:e.filterImageId,filterCloudId:e.filterCloudId,filterDomainId:e.filterDomainId,filterInstanceGroupId:e.filterInstanceGroupId,quickFilter:e.quickFilter,showSolvedDate:e.showSolvedDate,isSnoozedIssuesView:n.isSnoozedIssuesView,onRowClicked:a[0]||(a[0]=A=>t.$emit("itemClicked",A))},null,8,["groupedIssue","filterRepoId","filterImageId","filterCloudId","filterDomainId","filterInstanceGroupId","quickFilter","showSolvedDate","isSnoozedIssuesView"]))),128))],64)),e.showEmptyState?(o(),d(b,{key:2},{default:u(()=>[t.$slots.emptyState?(o(),f("td",ke,[x(t.$slots,"emptyState")])):e.hasActiveFilter?(o(),f("td",Te,[D("div",ye,[s(T,{color:"carbon-100"},{default:u(()=>[r(" No Issues found with these filters.")]),_:1})])])):(o(),f("td",we,[D("div",be,[s(T,{color:"carbon-100"},{default:u(()=>[r(" No Issues found.")]),_:1})])]))]),_:3})):h("",!0)]),key:"0"}:void 0]),1032,["class"]),x(t.$slots,"bottomContent",{showEmptyState:e.showEmptyState,isLoading:e.isLoading})])}const Me=S(ge,[["render",Se]]);export{Me as Q};
