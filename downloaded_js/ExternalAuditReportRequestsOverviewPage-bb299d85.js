import{_ as g,f,an as r,Z as d,fb as m,fc as _,aU as q,r as i,m as w,o as s,w as n,n as o,F as x,q as E,s as c}from"./index-13ff96f4.js";import{P as A}from"./PageHeader-46c38a32.js";import{X as v}from"./XTabs-d492da26.js";const k={components:{PageHeader:A,XTabs:v,BaseButton:f},watch:{tab(){this.$router.push({name:this.tab})}},data(){return{tab:this.$route.name,tabs:[{title:"Generate report",id:"createExternalAuditReport"},{title:"Request inbox",id:"externalAuditReportRequests"}],isLoading:!0,requests:[],groupReference:void 0}},created(){r.on("auditReportRequestApproved",this.loadRequests),r.on("auditReportRequestRejected",this.loadRequests)},beforeUnmount(){r.off("auditReportRequestApproved",this.loadRequests),r.off("auditReportRequestRejected",this.loadRequests)},async mounted(){await Promise.allSettled([this.loadRequests(),this.loadIntegrationStatus()])},computed:{breadcrumbs(){let e=[{label:"Reports",href:"/reports"},{label:"Security audit reports"}];return this.tab==="externalAuditReportRequests"&&e.push({label:"Inbox"}),this.tab==="createExternalAuditReport"&&e.push({label:"Create report"}),e},pendingRequests(){return this.requests.filter(e=>e.status==="open")},subtitle(){return this.$t("X_PENDING_EXTERNAL_AUDIT_REPORT_REQUESTS",this.pendingRequests.length)},isAuditReportsEnabled(){return!!d.data.auditReports}},methods:{async loadRequests(){this.requests=await m(),this.isLoading=!1},async loadIntegrationStatus(){this.isAuditReportsEnabled||await this.handleEnableIntegration();const e=await _();this.groupReference=e.group_reference},async handleEnableIntegration(){await q(),await d.fetchIntegrationStatusOverview()},handleCopyRequestLink(){const e=`${window.location.origin}/audit-report/external/${this.groupReference}/request`;window.isSecureContext&&(Toast.show({title:"Request link copied"}),navigator.clipboard.writeText(e))}}},C={class:"flex align-center tablet_flex-column gap-8px"},I=o("i",{class:"icon icon-link"},null,-1),T={class:"page-content"};function y(e,u,B,S,t,a){const p=i("XTabs"),l=i("BaseButton"),b=i("PageHeader"),R=i("router-view");return E(),w(x,null,[s(b,{breadcrumbs:a.breadcrumbs,title:"Security audit reports",subtitle:a.subtitle},{tabs:n(()=>[s(p,{class:"page-tabs",tabs:t.tabs,modelValue:t.tab,"onUpdate:modelValue":u[0]||(u[0]=h=>t.tab=h)},null,8,["tabs","modelValue"])]),rightContent:n(()=>[o("div",C,[s(l,{variation:"blue",size:"small",disabled:!a.isAuditReportsEnabled,onClick:a.handleCopyRequestLink},{default:n(()=>[I,c(" Copy request link ")]),_:1},8,["disabled","onClick"]),s(l,{variation:"plain",size:"small",as:"outside-link",href:"/settings/integrations/audit-report"},{default:n(()=>[c(" Widget for website ")]),_:1})])]),_:1},8,["breadcrumbs","subtitle"]),o("div",T,[s(R,{"is-loading":t.isLoading,requests:t.requests},null,8,["is-loading","requests"])])],64)}const V=g(k,[["render",y]]);export{V as default};
