import{_ as S,an as u,fk as P,aH as v,fl as k,at as y,r as l,k as d,m as w,o as r,w as n,n as c,F as T,q as h,s as O,u as C,p as x}from"./index-13ff96f4.js";import{P as B}from"./PageHeader-46c38a32.js";import{X as L}from"./XTabs-d492da26.js";const R={components:{PageHeader:B,XTabs:L},data(){return{fixablePackagesByPackageAndLockfile:{},isLoading:!0,repositoryId:null,activeFixId:null,breadcrumbs:[{label:"Autofix"}],selectedFixableIssueIds:[],amountFixablePackages:0,loadingAllPackages:!1,lockfileFilter:"all",repoFilter:"all",languageFilter:"all",selectedRepoPath:"all",selectedSeverity:"all",searchTerm:"",groupedIssueFilter:void 0,hasActiveAutofixConfiguration:!0,tab:"AutofixOverview",fixableSastIssueGroupsMap:{},amountFixableSastIssues:0,loadingAllSastIssues:!1,fixableIacIssueGroupsMap:{},amountFixableIacIssues:0,loadingAllIacIssues:!1,repoOwnerNames:[]}},created(){u.on("issueUpdated",this.loadFixes),u.on("autofix_preview_modal_closed",this.loadFixes)},beforeUnmount(){u.off("issueUpdated",this.loadFixes),u.off("autofix_preview_modal_closed",this.loadFixes)},async mounted(){this.tabs.find(e=>e.id==this.$route.name)?this.tab=this.$route.name:this.$router.push({name:"AutofixOverview"}),this.$route.query.groupedIssue&&this.$route.query.groupedIssue>0&&(this.groupedIssueFilter=this.$route.query.groupedIssue),this.$route.query.repo_id&&this.$route.query.repo_id>0&&(this.repoFilter=this.$route.query.repo_id),await Promise.allSettled([this.fetchFixes(),this.loadAutoFixConfiguration(),this.fetchSastFixes(),this.loadRepoPaths(),this.fetchIacFixes()]),this.isLoading=!1},watch:{"$route.name"(){this.tab=this.$route.name,localStorage.setItem("aik.autofix.lastPage",this.$route.name)}},computed:{emptystateDescription(){return this.lockfileFilter=="all"&&this.repoFilter=="all"&&this.languageFilter=="all"&&this.selectedRepoPath=="all"&&this.selectedSeverity=="all"&&!this.searchTerm?this.$teamContext?"There are no issues available for autofix in the current selected team.":"There are no issues available for autofix.":"There are no issues available for autofix with these search terms or filter settings."},amountFixablePackagesVisible(){let t=0;for(const[e,i]of Object.entries(this.fixablePackagesByPackageAndLockfile))t+=i.length;return t},emptystateTitle(){return this.$teamContext?"No Autofixes available for this team":"No Autofixes available"},tabs(){const t=[{title:"Dependencies",id:"AutofixOverview"}];return t.push({title:"SAST",id:"AutofixSastOverview"}),t.push({title:"IaC",id:"AutofixIacOverview"}),t},shouldShowRepoPathsFilter(){return this.$group.scm_type=="azure_devops"},fixableSastIssueGroupsMapForPage(){return this.tab=="AutofixIacOverview"?this.fixableIacIssueGroupsMap:this.fixableSastIssueGroupsMap},amountFixableSastIssuesForPage(){return this.tab=="AutofixIacOverview"?this.amountFixableIacIssues:this.amountFixableSastIssues},loadingAllSastIssuesForPage(){return this.tab=="AutofixIacOverview"?this.loadingAllIacIssues:this.loadingAllSastIssues},shouldHideLanguageFilter(){return this.tab=="AutofixIacOverview"},canManageAutofixSettings(){var t,e;return((t=this.$group)==null?void 0:t.scm_type)=="azure_devops"||((e=this.$group)==null?void 0:e.scm_type)=="gitlab"?!0:this.$groupUser.can_access_settings}},methods:{async fetchFixes(t=!1){const e={search:void 0,language_filter:void 0,target_path:void 0,repo_id:void 0,load_all:t};this.lockfileFilter!="all"&&(e.target_path=this.lockfileFilter),this.repoFilter!="all"&&(e.repo_id=this.repoFilter),this.languageFilter!="all"&&(e.language_filter=this.languageFilter),this.selectedRepoPath!="all"&&(e.filter_repo_owner=this.selectedRepoPath),this.selectedSeverity!="all"&&(e.filter_severity=this.selectedSeverity),this.searchTerm&&(e.search=this.searchTerm),this.groupedIssueFilter>0&&(e.grouped_issue_id=this.groupedIssueFilter),this.isLoading||this.$globalLoadingIndicator.show();try{const{grouped_fixes:i,amount_fixable_packages:o}=await P(e);this.fixablePackagesByPackageAndLockfile=i,this.amountFixablePackages=o}finally{this.$globalLoadingIndicator.hide()}},onFilterChanged({selectedLockfile:t,selectedRepoId:e,selectedLanguage:i,groupedIssueFilter:o,selectedRepoPath:s,selectedSeverity:a}){if(this.loadAllPackages=!1,this.lockfileFilter=t,this.repoFilter=e,this.languageFilter=i,this.groupedIssueFilter=o,this.selectedRepoPath=s,this.selectedSeverity=a,this.tab=="AutofixSastOverview"){this.fetchSastFixes();return}if(this.tab=="AutofixIacOverview"){this.fetchIacFixes();return}this.fetchFixes()},onSearchTermChanged(){if(this.loadAllPackages=!1,this.tab=="AutofixSastOverview"){this.fetchSastFixes();return}if(this.tab=="AutofixIacOverview"){this.fetchIacFixes();return}this.fetchFixes()},async fetchAllPackages(){this.loadingAllPackages=!0,await this.fetchFixes(!0),this.loadingAllPackages=!1},async loadAutoFixConfiguration(){try{await v({disable_toasts:!0}),this.hasActiveAutofixConfiguration=!0}catch{this.hasActiveAutofixConfiguration=!1}},async fetchIacFixes(t=!1){this.fetchSastFixes(t,!0)},async fetchAllIacIssues(){this.loadingAllIacIssues=!0,await this.fetchIacFixes(!0),this.loadingAllIacIssues=!1},async fetchSastFixes(t=!1,e=!1){const i={search:void 0,language_filter:void 0,target_path:void 0,repo_id:void 0,load_all:t};this.lockfileFilter!="all"&&(i.target_path=this.lockfileFilter),this.repoFilter!="all"&&(i.repo_id=this.repoFilter),this.languageFilter!="all"&&(i.language_filter=this.languageFilter),this.selectedRepoPath!="all"&&(i.filter_repo_owner=this.selectedRepoPath),this.selectedSeverity!="all"&&(i.filter_severity=this.selectedSeverity),this.searchTerm&&(i.search=this.searchTerm),this.groupedIssueFilter>0&&(i.grouped_issue_id=this.groupedIssueFilter),e&&(i.iac_only=1),this.isLoading||this.$globalLoadingIndicator.show();try{const{grouped_fixes:o,amount_fixable_issues:s}=await k(i);e?(this.fixableIacIssueGroupsMap=o,this.amountFixableIacIssues=s):(this.fixableSastIssueGroupsMap=o,this.amountFixableSastIssues=s)}finally{this.$globalLoadingIndicator.hide()}},async fetchAllSastIssues(){if(this.tab=="AutofixIacOverview"){await this.fetchAllIacIssues();return}this.loadingAllSastIssues=!0,await this.fetchSastFixes(!0),this.loadingAllSastIssues=!1},onTabChanged(){if(this.lockfileFilter="all",this.repoFilter="all",this.languageFilter="all",this.selectedRepoPath="all",this.selectedSeverity="all",this.searchTerm="",this.groupedIssueFilter=void 0,this.tab=="AutofixSastOverview"){this.fetchSastFixes();return}if(this.tab=="AutofixIacOverview"){this.fetchIacFixes();return}this.fetchFixes()},async loadRepoPaths(){this.shouldShowRepoPathsFilter&&(this.repoOwnerNames=await y())},async loadFixes(){await this.fetchAllSastIssues()}}},G={class:"flex gap-8px"},M=c("span",{class:"text--bold"},"Enable PR creation",-1),N=c("span",{class:"text--bold"},"Autofix Settings",-1),U={class:"page-content"};function V(t,e,i,o,s,a){const F=l("XPreloader"),m=l("BaseParagraph"),f=l("BasePill"),p=l("BaseButton"),b=l("BaseIcon"),I=l("XTabs"),A=l("PageHeader"),_=l("router-view");return s.isLoading?(h(),d(F,{key:0,class:"supercenter",theme:"transparent"})):(h(),w(T,{key:1},[r(A,{breadcrumbs:s.breadcrumbs,title:"Autofix"},{title:n(()=>[r(m,{color:"gray"},{default:n(()=>[O(C(t.$t("AUTOFIX.PAGE.SUBTITLE")),1)]),_:1})]),subTitle:n(()=>[c("div",G,[r(f,{title:t.$t("X_FIXABLE_PACKAGES",s.amountFixablePackages),variation:"green"},null,8,["title"]),r(f,{title:t.$t("X_SAST",s.amountFixableSastIssues),variation:"green"},null,8,["title"]),r(f,{title:t.$t("X_IAC_ISSUES",s.amountFixableIacIssues),variation:"green"},null,8,["title"])])]),rightContent:n(()=>[a.canManageAutofixSettings&&!s.hasActiveAutofixConfiguration?(h(),d(p,{key:0,size:"medium",variation:"primary",as:"link",to:"/settings/integrations/autofix"},{default:n(()=>[M]),_:1})):x("",!0),a.canManageAutofixSettings&&s.hasActiveAutofixConfiguration?(h(),d(p,{key:1,size:"medium",variation:"plain",as:"link",to:"/settings/integrations/autofix"},{default:n(()=>[r(b,{icon:"icon-settings",class:"h-14px"}),N]),_:1})):x("",!0)]),tabs:n(()=>[r(I,{tabs:a.tabs,modelValue:s.tab,"onUpdate:modelValue":[e[0]||(e[0]=g=>s.tab=g),a.onTabChanged],class:"page-tabs",useRouterLinks:!0},null,8,["tabs","modelValue","onUpdate:modelValue"])]),_:1},8,["breadcrumbs"]),c("div",U,[r(_,{searchTerm:s.searchTerm,"onUpdate:searchTerm":[e[1]||(e[1]=g=>s.searchTerm=g),a.onSearchTermChanged],onOnFilterChanged:a.onFilterChanged,repoOwnerNames:s.repoOwnerNames,shouldShowRepoPathsFilter:a.shouldShowRepoPathsFilter,fixablePackagesByPackageAndLockfile:s.fixablePackagesByPackageAndLockfile,amountFixablePackagesVisible:a.amountFixablePackagesVisible,amountFixablePackages:s.amountFixablePackages,loadingAllPackages:s.loadingAllPackages,groupedIssueFilter:s.groupedIssueFilter,repoFilter:s.repoFilter,emptystateTitle:a.emptystateTitle,emptystateDescription:a.emptystateDescription,onFetchAllPackages:a.fetchAllPackages,fixableSastIssueGroupsMap:a.fixableSastIssueGroupsMapForPage,amountFixableSastIssues:a.amountFixableSastIssuesForPage,isSearchFilteringActive:s.searchTerm.length>0,loadingAllSastIssues:a.loadingAllSastIssuesForPage,onFetchAllSastIssues:a.fetchAllSastIssues,hideLanguageFilter:a.shouldHideLanguageFilter},null,8,["searchTerm","onUpdate:searchTerm","onOnFilterChanged","repoOwnerNames","shouldShowRepoPathsFilter","fixablePackagesByPackageAndLockfile","amountFixablePackagesVisible","amountFixablePackages","loadingAllPackages","groupedIssueFilter","repoFilter","emptystateTitle","emptystateDescription","onFetchAllPackages","fixableSastIssueGroupsMap","amountFixableSastIssues","isSearchFilteringActive","loadingAllSastIssues","onFetchAllSastIssues","hideLanguageFilter"])])],64))}const D=S(R,[["render",V]]);export{D as default};
