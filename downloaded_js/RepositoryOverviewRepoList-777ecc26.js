import{u as A}from"./useInfiniteScroll-47c60c9e.js";import{_ as F,r as l,q as o,k as R,w as n,o as r,B as I,bt as O,N as x,ad as P,m as c,n as p,u as v,p as g,S as L,t as w,F as T,s as f,I as D,al as V,f as N,an as y,A as $,ao as U,as as H,am as M}from"./index-13ff96f4.js";import{R as W,b as Y}from"./blurRepositories-f0c9d93d.js";import{g as G,s as j}from"./tableSortingCache-ca369cac.js";import{R as q,L as z}from"./LoadingRepositoryOverviewRow-a49a41a6.js";import{G as Q}from"./GenericIllustration-4aca88e5.js";import{O as K}from"./OverviewEmptyState-c8440b9c.js";import{F as J}from"./FilterButton-bb5393a7.js";import{D as X,a as Z}from"./DataTable-e31a825a.js";import{a as ee}from"./DataTableCell-51c0104f.js";import{T as te,a as se}from"./TableListHeader-e50d01d1.js";import"./DataTableSeverityIndicator-48ffb8dc.js";import"./repositoryActionMenu-07f5f11b.js";import"./ActionMenu-3e4470bf.js";import"./RepostioryDomainCell-e75ba707.js";import"./BaseStatusLabel-0ccd2806.js";import"./lock-files-cdbb050f.js";import"./SupportedLockFilesModal-4d6e0a8a.js";import"./RepositoryDetailCheckFileEntry-e151c779.js";import"./FaultyLockfileModal-7f5493a7.js";import"./DataTableLastScanColumn-e155b78a.js";import"./dateFns-a344cb79.js";import"./index-b87db690.js";import"./freePlanLimitations-5f359256.js";const ie={components:{OverviewEmptyState:K,GenericIllustration:Q},methods:{handleEmptyStateAction(){if(this.isSelfScanAccount)return this.$router.push("/settings/integrations/localscan");this.$router.push("/settings/integrations/repositories")}},computed:{actionLabel(){return this.$groupUser.only_team_related_issues?"":this.isSelfScanAccount?this.$t("REPO_OVERVIEW.EMPTY_STATE.SELFSCAN.ACTION_LABEL"):this.$t("REPO_OVERVIEW.EMPTY_STATE.ACTION_LABEL")},title(){return this.isSelfScanAccount?this.$t("REPO_OVERVIEW.EMPTY_STATE.SELFSCAN.TITLE"):this.$t("REPO_OVERVIEW.EMPTY_STATE.TITLE")},description(){return this.isSelfScanAccount?this.$t("REPO_OVERVIEW.EMPTY_STATE.SELFSCAN.DESCRIPTION"):this.$t("REPO_OVERVIEW.EMPTY_STATE.DESCRIPTION")},isSelfScanAccount(){var e;return((e=this.$group)==null?void 0:e.scm_type)==="selfscan"}}};function oe(e,s,d,m,a,t){const u=l("GenericIllustration"),S=l("OverviewEmptyState");return o(),R(S,{title:t.title,description:t.description,actionLabel:t.actionLabel,variation:"empty",onOnAction:t.handleEmptyStateAction},{default:n(()=>[r(u)]),_:1},8,["title","description","actionLabel","onOnAction"])}const ae=F(ie,[["render",oe]]),ne={components:{BaseParagraph:I,BasePopover:O,BaseSelect:x,FilterButton:J},emits:["selectFilter"],data(){return{teamFilter:this.$route.query.filter_team_id??null,teams:[]}},async mounted(){await this.loadTeams()},computed:{filter(){var s;let e=[];if(this.teamFilter&&e.push((s=this.selectedTeamFilter)==null?void 0:s.name),e.length!==0)return e.join(", ")},hasFilter(){return!!this.teamFilter},teamSelectValues(){return this.teams.map(e=>({id:e.id,title:e.name}))},selectedTeamFilter(){return this.teams.find(e=>e.id==this.teamFilter)},sections(){const e=this.teams.map(s=>({label:s.name,onClick:()=>this.handleChangeTeam(s.id),active:this.teamFilter==s.id}));return this.teams.length===0&&e.push({label:"Create a team",onClick:()=>this.handleCreateTeam(),icon:"icon-add",active:!1}),[{title:"Teams filter",action:{label:"Clear filter",onClick:()=>this.handleClearFilter()},items:e}]}},methods:{emitFilter(){this.$emit("selectFilter",{teamFilter:this.teamFilter})},handleClearFilter(){this.teamFilter=null,this.emitFilter()},handleChangeTeam(e){const s=this.teamFilter==e;!e||e===""||s?this.teamFilter=null:this.teamFilter=e,this.emitFilter()},handleCreateTeam(){this.$router.push("/settings/teams")},async loadTeams(){const e=await P();this.teams=e.sort((s,d)=>{const m=s.name.toLowerCase(),a=d.name.toLowerCase();return m==a?0:m>a?1:-1})}}},re=p("i",{class:"icon icon-filter icon-12px"},null,-1),le={key:0},ce={class:"text-primary-aik-100"},de={class:"action-menu w-224px"},me={key:0,class:"action-menu__section-title"},pe=["disabled","onClick"],he={class:"action-menu__section-items"},ue=["onClick","disabled"];function _e(e,s,d,m,a,t){const u=l("i18n-t"),S=l("FilterButton"),k=l("BasePopover");return o(),R(k,{placement:"bottom-start"},{trigger:n(i=>[r(S,{onClick:i.toggle,class:L({"filter-button--active":t.hasFilter})},{default:n(()=>[re,t.filter?(o(),c("span",le,[r(u,{keypath:"QUEUE.QUICK_FILTER.LABEL"},{filter:n(()=>[p("span",ce,v(t.filter),1)]),_:1})])):g("",!0)]),_:2},1032,["onClick","class"])]),content:n(()=>[p("div",de,[(o(!0),c(T,null,w(t.sections,(i,C)=>(o(),c("div",{key:C,class:"action-menu__section"},[i.title?(o(),c("div",me,[p("p",null,v(i.title),1),i.action?(o(),c("button",{key:0,disabled:i.action.disabled,class:"button-brand button--as-link",onClick:i.action.onClick},v(i.action.label),9,pe)):g("",!0)])):g("",!0),p("ul",he,[(o(!0),c(T,null,w(i.items,(_,b)=>(o(),c("li",{key:b,class:L(["action-menu__section__item",[_.active&&"action-menu__section__item--active",_.destructive&&"action-menu__section__item--destructive"]])},[p("button",{onClick:E=>_.onClick(E),disabled:_.disabled,class:"action-menu__section__item-button"},[_.icon?(o(),c("i",{key:0,class:L(["icon icon-14px mr-12px",[_.icon]])},null,2)):g("",!0),f(" "+v(_.label),1)],8,ue)],2))),128))])]))),128))])]),_:1})}const fe=F(ne,[["render",_e]]),ge={mixins:[W],components:{InputSearch:D,RepositoryOverviewRow:q,RepositoryOverviewEmptyState:ae,DataTable:X,DataTableHeader:Z,DataTableRow:ee,LoadingRepositoryOverviewRow:z,TableList:te,TableListHeader:se,TeamFilter:fe,LoadingSpinner:V,BaseParagraph:I,BaseButton:N},data(){return{searchTerm:sessionStorage.getItem("reposoverview.scmrepos.search")||"",bookmarks:[],faultyLockfileFindings:[],sortBy:{column:"active,scm_repo_owner_name,scm_repo_name",direction:"desc"},filterTeamId:null,isLoading:!0,isLoadingInitialTableListState:!0}},setup(){const{records:e,isLoading:s,fetch:d,reset:m,refresh:a,watchElement:t}=A(M,50,u=>u,{stopPaginationBehaviour:"eager"});return{records:e,isFetchingRecords:s,fetchIntegrationRepos:d,resetIntegrationRepos:m,refreshIntegrationRepos:a,watchElement:t}},async mounted(){y.on("dependencyScanFinished",this.loadRepositories),y.on("activeScmReposChanged",this.loadReposAndBookmarks);const e=G("codeRepo");e.column&&(this.sortBy=e),this.isLoadingInitialTableListState=!1,await this.loadReposAndBookmarks(),this.isLoading=!1,await this.$nextTick(),this.watchElement(this.$refs.tableBottom,{threshold:0,rootMargin:"1000px"}),await this.detectNewRepositories()},beforeUnmount(){y.off("dependencyScanFinished",this.loadRepositories),y.off("activeScmReposChanged",this.loadReposAndBookmarks)},watch:{$teamContext(){this.loadRepositories()}},computed:{showFreemiumEmptyState(){return!this.isFetchingRecords&&$.isPaying()===!1},activeRepos(){return this.repositories.length===0&&this.isLoading?Array(10).map((e,s)=>({id:s})):this.repositories},showRepositoriesEmptyState(){return!this.isFetchingRecords&&this.repositories.length===0},repositories(){return Y(this.records??[])},filters(){return{search_term:this.searchTerm,sort_by_column:this.sortBy.column,sort_by_direction:this.sortBy.direction,filter_team_id:this.filterTeamId}}},methods:{async loadReposAndBookmarks(){await Promise.all([this.fetchIntegrationRepos(this.filters),this.loadBookmarks()])},async loadBookmarks(){this.bookmarks=await U("repo")},async loadRepositories(){await this.refreshIntegrationRepos(this.filters)},async handleChangeSearchTerm(){sessionStorage.setItem("reposoverview.scmrepos.search",this.searchTerm),await this.loadRepositories()},async detectNewRepositories(){await H({disable_toasts:!0})&&(y.emit("activeScmReposChanged"),await this.loadRepositories())},async sortByChanged(e){this.isLoading=!0,e&&Object.keys(e).length>0?this.sortBy=e:this.sortBy={column:"active,scm_repo_owner_name,scm_repo_name",direction:"desc"},j(this.sortBy,"codeRepo"),await this.resetIntegrationRepos(this.filters),this.isLoading=!1},async handleSelectTeamFilter(e){this.filterTeamId=e.teamFilter,this.$globalLoadingIndicator.show();try{await this.loadRepositories()}finally{this.$globalLoadingIndicator.hide()}},onRepoActiveStateChanged({repositoryId:e,active:s}){const d=this.records.findIndex(m=>m.id==e);this.records[d].active=s},onRepositoryUpdated(e){e&&this.onConfigurationUpdated(e)},onConfigurationUpdated({repositoryId:e,domain_name:s,sensitivity:d,internet_exposed:m,dev_dep_scanning_enabled:a}){const t=this.records.findIndex(u=>u.id==e);this.records[t].domain_name=s,this.records[t].sensitivity=d,this.records[t].internet_exposed=m,this.records[t].dev_dep_scanning_enabled=a},getLink(e){return e.is_blurred||!e.active?"":`/repositories/${e.id}`}}},Re={class:"flex justify-between mb-16px"},Se={class:"flex align-center gap-12px"},ye=p("i",{class:"icon icon-settings"},null,-1),Te={colspan:"7"},be={ref:"tableBottom"},ve={key:0,class:"data-table__bottom"};function we(e,s,d,m,a,t){const u=l("InputSearch"),S=l("TeamFilter"),k=l("BaseButton"),i=l("TableListHeader"),C=l("LoadingRepositoryOverviewRow"),_=l("RepositoryOverviewRow"),b=l("DataTableRow"),E=l("RepositoryOverviewEmptyState"),B=l("TableList");return o(),c(T,null,[p("div",Re,[p("div",Se,[r(u,{modelValue:a.searchTerm,"onUpdate:modelValue":[s[0]||(s[0]=h=>a.searchTerm=h),t.handleChangeSearchTerm],spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),r(S,{onSelectFilter:t.handleSelectTeamFilter},null,8,["onSelectFilter"])]),e.$groupUser.is_team_restricted?g("",!0):(o(),R(k,{key:0,size:"small",as:"link",to:"/settings/integrations/repositories"},{default:n(()=>[ye,f(" Manage Repos ")]),_:1}))]),(o(),R(B,{key:a.isLoadingInitialTableListState,useDataTableComponent:!0,onSort:t.sortByChanged,mdSort:a.sortBy.column,mdSortType:a.sortBy.direction},{header:n(()=>[r(i,{useDataTableHeaderComponent:"",width:"auto",sortBy:"scm_repo_owner_name,scm_repo_name"},{default:n(()=>[f("Repo name")]),_:1}),r(i,{useDataTableHeaderComponent:"",width:"200px",class:"wide-tablet_hidden"},{default:n(()=>[f("Domain")]),_:1}),r(i,{useDataTableHeaderComponent:"",width:"113px",alignment:"center",sortBy:"max_issue_severity",invertSorting:""},{default:n(()=>[f("Severity")]),_:1}),r(i,{class:"wide-tablet_hidden",useDataTableHeaderComponent:"",width:"100px"},{default:n(()=>[f("Language")]),_:1}),r(i,{class:"wide-tablet_hidden",useDataTableHeaderComponent:"",width:"109px",sortBy:"open_issues",invertSorting:""},{default:n(()=>[f("Open")]),_:1}),r(i,{class:"wide-tablet_hidden",useDataTableHeaderComponent:"",width:"109px",sortBy:"ignored_issues",invertSorting:""},{default:n(()=>[f("Ignored")]),_:1}),r(i,{useDataTableHeaderComponent:"",width:"115px"},{default:n(()=>[f("Last scan")]),_:1}),r(i,{useDataTableHeaderComponent:"",width:"48px",alignment:"center"})]),body:n(()=>[a.isLoading?(o(),c(T,{key:0},w(10,h=>r(C,{key:h})),64)):(o(!0),c(T,{key:1},w(t.activeRepos,h=>(o(),R(b,{key:h.id,clickable:!h.is_blurred,disabled:!h.active,href:t.getLink(h)},{default:n(()=>[r(_,{bookmarks:a.bookmarks,repository:h,scanningProgress:e.getScanProgress(h.id),onRepositoryUpdated:t.onRepositoryUpdated,onRepoActiveStateChanged:t.onRepoActiveStateChanged,onRepoDeletionStateChanged:t.loadRepositories},null,8,["bookmarks","repository","scanningProgress","onRepositoryUpdated","onRepoActiveStateChanged","onRepoDeletionStateChanged"])]),_:2},1032,["clickable","disabled","href"]))),128)),t.showRepositoriesEmptyState?(o(),R(b,{key:2},{default:n(()=>[p("td",Te,[r(E)])]),_:1})):g("",!0)]),_:1},8,["onSort","mdSort","mdSortType"])),p("div",be,[!a.isLoading&&!t.showRepositoriesEmptyState?(o(),c("div",ve)):g("",!0)],512)],64)}const Qe=F(ge,[["render",we]]);export{Qe as default};
