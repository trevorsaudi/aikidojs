import{_ as T,f as x,g as A,V as I,B as b,a3 as u,cc as P,a0 as y,r as c,m as d,o as i,w as t,n as a,k as B,p as _,F as w,q as l,s as n,u as L}from"./index-13ff96f4.js";import{e as V,f as v}from"./autofix-68b65188.js";import{P as D}from"./PageHeader-46c38a32.js";const S={components:{BaseButton:x,BaseLink:A,InputText:I,BaseParagraph:b,PageHeader:D},data(){return{isLoading:!0,isSaving:!1,externalDirectLink:null,personalAccessToken:"",personalAccessTokenInfo:null}},async mounted(){await Promise.allSettled([this.getPersonalAccessTokenInfo(),this.getAccountInfo()]),this.isLoading=!1},computed:{inputIsValid(){return!!this.personalAccessToken&&this.personalAccessToken.trim()!==""},personalAccessTokenDetails(){if(!this.personalAccessTokenInfo)return;const e=u.fromUnix(this.personalAccessTokenInfo.installed_at).format(u.US_FRIENDLY_DATE_WITH_TIME);return!this.personalAccessTokenInfo||this.personalAccessTokenInfo.last_updated_by_id<1?`Last updated at ${e}`:`Last updated by ${this.personalAccessTokenInfo.last_updated_by_name} at ${e}`}},methods:{async getAccountInfo(){const e=await P();e.scm_org_base_url?this.externalDirectLink=e.scm_org_base_url+"/-/user_settings/personal_access_tokens":this.externalDirectLink="https://www.gitlab.com/-/user_settings/personal_access_tokens"},async getPersonalAccessTokenInfo(){var e;try{this.personalAccessTokenInfo=await V()}catch(s){y.isAxiosError(s)&&s.response.status!==404&&this.$toast.error({title:"An error occurred",description:((e=s.response.data)==null?void 0:e.reason_phrase)??"An unknown error occured"})}},async handleUpdatePersonalAccessToken(){if(this.inputIsValid){this.isSaving=!0;try{await v(this.personalAccessToken),this.$toast.success({title:"Personal Token Updated",description:"The Personal Access Token for the Gitlab Autofix integration has been successfully updated"}),this.$router.replace("/settings/integrations/autofix")}finally{this.isSaving=!1}}}}},G={class:"page-content"},N={class:"flex flex-column gap-24px min-w-264px max-w-50p"},U={class:"flex flex-column gap-4px"},C={class:"flex w-full justify-between"},E=["href"],H=a("i",{class:"icon icon-openLink icon-12px text--normal"},null,-1),F={class:"flex"};function M(e,s,W,Y,o,r){const f=c("BaseLink"),p=c("BaseParagraph"),k=c("PageHeader"),h=c("InputText"),m=c("BaseButton");return l(),d(w,null,[i(k,{title:"Manage Gitlab Autofix Personal Access Token"},{subTitle:t(()=>[i(p,null,{default:t(()=>[n(" Setup instructions and information about the correct scope in Gitlab can be found "),i(f,{target:"_blank",href:"https://help.aikido.dev/doc/autofix-for-gitlab-cloud-with-personal-access-token/docSNPNAeWe6"},{default:t(()=>[n("here.")]),_:1})]),_:1})]),_:1}),a("div",G,[a("div",N,[a("div",U,[i(h,{name:"personal_access_token",modelValue:o.personalAccessToken,"onUpdate:modelValue":s[0]||(s[0]=g=>o.personalAccessToken=g)},{title:t(()=>[a("span",C,[n(" Your Personal Access Token "),o.externalDirectLink?(l(),d("a",{key:0,href:o.externalDirectLink,target:"_blank",class:"link flex gap-4px align-center mt-2px"},[n(" Generate Access Token here "),H],8,E)):_("",!0)])]),_:1},8,["modelValue"]),this.personalAccessTokenInfo?(l(),B(p,{key:0,color:"gray"},{default:t(()=>[n(L(r.personalAccessTokenDetails),1)]),_:1})):_("",!0)]),a("div",F,[i(m,{variation:"primary",onClick:r.handleUpdatePersonalAccessToken,disabled:!r.inputIsValid,"is-loading":o.isSaving},{default:t(()=>[n("Update Token")]),_:1},8,["onClick","disabled","is-loading"])])])])],64)}const R=T(S,[["render",M]]);export{R as default};
