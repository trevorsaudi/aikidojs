import{_ as w,A as $,d2 as V,cR as X,r as o,q as l,m as Y,o as h,w as a,aa as Z,k as d,p as f,F as q,e as J,n as m,ai as U,a2 as H,bk as L,S as T,s as G,u as S,B as K,f as Q}from"./index-13ff96f4.js";import{D as y}from"./DataTableCell-51c0104f.js";import{A as W}from"./ActionMenu-3e4470bf.js";import{a as ee,b as se,c as oe,U as te,d as re,u as ie,e as ne,g as ue,f as le,h as ae}from"./SidebarActionMenu-1bf6804b.js";import de from"./CreateTicketModal-c14deeb1.js";import{g as ce}from"./taskTrackerIcon-504ea566.js";import{b as Ie}from"./autofixable-c6560249.js";import{B as pe}from"./BaseStatusLabel-0ccd2806.js";import{D as he}from"./DataTableSeverityIndicator-48ffb8dc.js";const fe={props:{groupedIssue:{type:Object},filterRepoId:{type:[Number,String],default:void 0},filterImageId:{type:[Number,String],default:void 0},filterCloudId:{type:[Number,String],default:void 0},filterDomainId:{type:[Number,String],default:void 0},filterInstanceGroupId:{type:[Number,String],default:void 0}},components:{ActionMenu:W,IgnoreGroupedIssue:ee,SnoozeGroupedIssue:se,SolveIssue:oe,UnignoreIssueGroup:te,CreateTicketModal:de,UnsnoozeGroupedIssueModal:re},data(){return{showIgnoreGroupedIssueFlow:!1,showSnoozeGroupedIssueFlow:!1,showUnsnoozeGroupedIssueFlow:!1,showSolveGroupedIssueFlow:!1,showUnignoreGroupedIssueFlow:!1,showCreateTicketFlow:!1}},computed:{actions(){const t=[{visible:Ie(this.groupedIssue),label:"Autofix issue",onClick:()=>this.$router.push(this.autofixUrl),icon:"icon-shield_check",iconColor:"secondary"},{visible:this.showCreateTaskOption,label:"Add task",onClick:this.handleStartCreateTicketFlow,icon:this.taskTrackerIcon,iconColor:this.taskTrackerIcon=="icon-JIRA"?"blue":""},{visible:(this.groupedIssue.type==="leaked_secret"||this.groupedIssue.type==="malware")&&this.groupedIssue.status!=="closed",label:this.$t("ISSUE_ACTION_MENU.SOLVE"),onClick:this.handleStartSolveGroupedIssueFlow,icon:"icon-tick-circle",iconColor:"green"},{visible:(this.groupedIssue.type==="leaked_secret"||this.groupedIssue.type==="malware")&&this.groupedIssue.status==="closed",label:this.$t("ISSUE_ACTION_MENU.UNSOLVE"),onClick:this.handleUnsolveIssueGroup,icon:"icon-unsolve"},{visible:this.groupedIssue.status==="snoozed",label:this.$t("ISSUE_ACTION_MENU.UNSNOOZE"),onClick:this.handleStartUnsnoozeGroupedIssueFlow,icon:"icon-notification_inactive"},{visible:this.groupedIssue.status!=="closed"&&this.groupedIssue.status!=="ignored"&&this.groupedIssue.status!=="snoozed",label:this.$t("ISSUE_ACTION_MENU.SNOOZE"),onClick:this.handleStartSnoozeGroupedIssueFlow,icon:"icon-snooze"},{visible:this.groupedIssue.status==="snoozed",label:this.$t("ISSUE_ACTION_MENU.EXTEND_SNOOZE"),onClick:this.handleStartSnoozeGroupedIssueFlow,icon:"icon-snooze"},{visible:this.groupedIssue.status!="closed"&&this.groupedIssue.status!="ignored"&&this.groupedIssue.type!="license",label:this.$t("ISSUE_ACTION_MENU.IGNORE"),onClick:this.handleStartIgnoreGroupedIssueFlow,icon:"icon-hidden"},{visible:this.groupedIssue.status==="ignored",label:this.$t("ISSUE_ACTION_MENU.UNIGNORE"),onClick:this.handleStartUnignoreIssueGroupFlow,icon:"icon-shield_check"},{visible:!0,label:this.$t("ISSUE_ACTION_MENU.COPY"),onClick:this.handleCopyLink,icon:"icon-link"},{visible:this.groupedIssue.status==="open"&&this.$groupUser.can_change_issue_severity==1&&this.groupedIssue.type!="license",label:this.$t("ISSUE_ACTION_MENU.ADJUST_SEVERITY"),onClick:this.handleAdjustSeverity,icon:"icon-edit"},{visible:this.groupedIssue.type==="sast"&&this.$user.is_aikido_support,label:"Start traces scan",onClick:this.startTracesScan,icon:"icon-arrow-right",iconColor:"secondary"}];return[{title:this.$t("ISSUE_ACTION_MENU.TITLE"),items:t.filter(r=>r.visible!==!1)}]},showCreateTaskOption(){return this.groupedIssue.status==="open"},autofixUrl(){return this.filterRepoId?`/issues/fix?groupedIssue=${this.groupedIssue.id}&repo_id=${this.filterRepoId}`:`/issues/fix?groupedIssue=${this.groupedIssue.id}`},taskTrackerIcon:ce},methods:{handleStartIgnoreGroupedIssueFlow(){this.showIgnoreGroupedIssueFlow=!0},handleCloseIgnoreGroupedIssueFlow(){this.showIgnoreGroupedIssueFlow=!1},handleStartSnoozeGroupedIssueFlow(){this.showSnoozeGroupedIssueFlow=!0},handleCloseSnoozeGroupedIssueFlow(){this.showSnoozeGroupedIssueFlow=!1},handleStartUnsnoozeGroupedIssueFlow(){this.showUnsnoozeGroupedIssueFlow=!0},handleCloseUnsnoozeGroupedIssueFlow(){this.showUnsnoozeGroupedIssueFlow=!1},handleStartSolveGroupedIssueFlow(){this.showSolveGroupedIssueFlow=!0},handleCloseSolveGroupedIssueFlow(){this.showSolveGroupedIssueFlow=!1},handleStartUnignoreIssueGroupFlow(){this.showUnignoreGroupedIssueFlow=!0},handleCloseUnignoreIssueGroupFlow(){this.showUnignoreGroupedIssueFlow=!1},handleStartCreateTicketFlow(){if($.hasExpiredFullTrial()&&!this.$featureflags.force_enable_task_trackers)return this.$modal.show("UpgradeAccountModal");this.showCreateTicketFlow=!0},handleAdjustSeverity(){this.$modal.show("AdjustIssueGroupSeverityModal",{groupedIssue:this.groupedIssue,filterRepoId:this.filterRepoId,filterImageId:this.filterImageId,filterCloudId:this.filterCloudId,filterDomainId:this.filterDomainId,filterInstanceGroupId:this.filterInstanceGroupId})},handleCloseCreateTicketFlow(){this.showCreateTicketFlow=!1},handleCopyLink(){const t=`${V()}/issues/${this.groupedIssue.id}/detail`;window.isSecureContext&&navigator.clipboard.writeText(t).then(()=>{Toast.success({title:this.$t("ISSUE_ACTION_MENU.COPY.SUCCESS.TITLE"),description:this.$t("ISSUE_ACTION_MENU.COPY.SUCCESS.DESCRIPTION")})})},async handleUnsolveIssueGroup(){await ie(this.groupedIssue.id)},async startTracesScan(){const t=sessionStorage.getItem("aik.autotriage.prompt")||"",r=await this.$modal.show("BaseInputTextAreaModal",{width:800,title:"Additional Prompt for AutoTriage",buttonSubmitText:"Start AutoTriage",initialText:t,placeholder:"Additional Prompt..."});if(r.type!="saved")return;const e=r.value;sessionStorage.setItem("aik.autotriage.prompt",e);let n=parseInt(this.filterRepoId??-1,10);n=isNaN(n)?-1:n;const i=this.groupedIssue.status==="ignored";await X(n,-1,this.groupedIssue.id,e,i),this.$toast.success("Traces scan started")}}};function ge(t,r,e,n,i,s){const u=o("ActionMenu"),c=o("IgnoreGroupedIssue"),I=o("SnoozeGroupedIssue"),p=o("UnsnoozeGroupedIssueModal"),g=o("UnignoreIssueGroup"),_=o("SolveIssue"),b=o("CreateTicketModal");return l(),Y(q,null,[h(u,{sections:s.actions,placement:"bottom-end",useBaseIcon:""},{trigger:a(k=>[Z(t.$slots,"trigger",{toggle:k.toggle})]),_:3},8,["sections"]),h(c,{onCancel:s.handleCloseIgnoreGroupedIssueFlow,show:i.showIgnoreGroupedIssueFlow,groupedIssue:e.groupedIssue,filterRepoId:e.filterRepoId,filterImageId:e.filterImageId,filterCloudId:e.filterCloudId,filterDomainId:e.filterDomainId,filterInstanceGroupId:e.filterInstanceGroupId},null,8,["onCancel","show","groupedIssue","filterRepoId","filterImageId","filterCloudId","filterDomainId","filterInstanceGroupId"]),i.showSnoozeGroupedIssueFlow?(l(),d(I,{key:0,onCancel:s.handleCloseSnoozeGroupedIssueFlow,onSnoozed:s.handleCloseSnoozeGroupedIssueFlow,groupedIssue:e.groupedIssue,filterRepoId:e.filterRepoId,filterImageId:e.filterImageId,filterCloudId:e.filterCloudId,filterDomainId:e.filterDomainId,filterInstanceGroupId:e.filterInstanceGroupId},null,8,["onCancel","onSnoozed","groupedIssue","filterRepoId","filterImageId","filterCloudId","filterDomainId","filterInstanceGroupId"])):f("",!0),i.showUnsnoozeGroupedIssueFlow?(l(),d(p,{key:1,onCancel:s.handleCloseUnsnoozeGroupedIssueFlow,onSubmit:s.handleCloseUnsnoozeGroupedIssueFlow,groupedIssue:e.groupedIssue},null,8,["onCancel","onSubmit","groupedIssue"])):f("",!0),i.showUnignoreGroupedIssueFlow?(l(),d(g,{key:2,onCancel:s.handleCloseUnignoreIssueGroupFlow,"issue-group":e.groupedIssue},null,8,["onCancel","issue-group"])):f("",!0),i.showSolveGroupedIssueFlow?(l(),d(_,{key:3,onCancel:s.handleCloseSolveGroupedIssueFlow,onSolved:s.handleCloseSolveGroupedIssueFlow,groupedIssue:e.groupedIssue},null,8,["onCancel","onSolved","groupedIssue"])):f("",!0),i.showCreateTicketFlow?(l(),d(b,{key:4,onCreated:s.handleCloseCreateTicketFlow,onCancel:s.handleCloseCreateTicketFlow,issueGroupId:e.groupedIssue.id},null,8,["onCreated","onCancel","issueGroupId"])):f("",!0)],64)}const _e=w(fe,[["render",ge]]),me={components:{DataTableCell:y,GroupedIssueActionMenu:_e,BaseIconButton:J},props:{issueGroup:Object,filterRepoId:{type:[Number,String],default:void 0},filterImageId:{type:[Number,String],default:void 0},filterCloudId:{type:[Number,String],default:void 0},filterDomainId:{type:[Number,String],default:void 0},filterInstanceGroupId:{type:[Number,String],default:void 0}}};function Ce(t,r,e,n,i,s){const u=o("BaseIconButton"),c=o("GroupedIssueActionMenu"),I=o("DataTableCell");return l(),d(I,{spacing:"compact",alignment:"center",class:"data-table__cell--action"},{default:a(()=>[m("div",{class:"data-table__row__action-container",onClick:r[0]||(r[0]=U(()=>t.$refs.trigger.click(),["stop"]))},[h(c,{groupedIssue:e.issueGroup,filterRepoId:e.filterRepoId,filterImageId:e.filterImageId,filterCloudId:e.filterCloudId,filterDomainId:e.filterDomainId,filterInstanceGroupId:e.filterInstanceGroupId},{trigger:a(p=>[h(u,{icon:"icon-actions",class:"data-table__row__action",onClick:p.toggle,ref:"trigger"},null,8,["onClick"])]),_:1},8,["groupedIssue","filterRepoId","filterImageId","filterCloudId","filterDomainId","filterInstanceGroupId"])])]),_:1})}const xe=w(me,[["render",Ce]]),Ge={components:{XTooltip:H,IssueLocationIcon:ne,DataTableCell:y,BaseStatusLabel:pe,BaseBody:L},props:{issueGroup:Object},computed:{showOtherProjectsLabel(){return this.projectNames.length>1},projectNames(){return ue(this.issueGroup)},repositoryDetailPage(){var i,s,u,c,I,p,g,_,b,k,F,v,N,E,D,O,z,A,B,M,x,R;if(this.issueGroup.type==="cloud")return`/clouds/${(s=(i=this.issueGroup.issues)==null?void 0:i[0])==null?void 0:s.cloud_id}`;if(this.issueGroup.type==="surface_monitoring"){const C=(c=(u=this.issueGroup.issues)==null?void 0:u[0])==null?void 0:c.cloud_id;if(C>0)return`/clouds/${C}`;const j=(p=(I=this.issueGroup.issues)==null?void 0:I[0])==null?void 0:p.domain_id;if(j>0)return`/domain/${j}`;const P=(_=(g=this.issueGroup.issues)==null?void 0:g[0])==null?void 0:_.repo_id;if(P>0)return`/repositories/${P}`}if(this.issueGroup.type==="eol"&&((k=(b=this.issueGroup.issues)==null?void 0:b[0])==null?void 0:k.domain_id)>0)return`/domain/${(v=(F=this.issueGroup.issues)==null?void 0:F[0])==null?void 0:v.domain_id}`;const t=(E=(N=this.issueGroup.issues)==null?void 0:N[0])==null?void 0:E.cloud_repo_id;if(t)return`/container/${t}`;const r=(O=(D=this.issueGroup.issues)==null?void 0:D[0])==null?void 0:O.repo_id;if(r&&r>0)return`/repositories/${r}`;const e=(A=(z=this.issueGroup.issues)==null?void 0:z[0])==null?void 0:A.cloud_instance_group_id;if(e&&e>0)return`/clouds/${(M=(B=this.issueGroup.issues)==null?void 0:B[0])==null?void 0:M.cloud_id}/virtual-machines/${e}`;const n=(R=(x=this.issueGroup.issues)==null?void 0:x[0])==null?void 0:R.cloud_id;return n&&n>0?`/clouds/${n}`:""}}},Se={class:"ws-pre"},we=m("i",{class:"icon icon-12px icon-viewDetails valign-middle text-gray-100 hidden group-hover:block"},null,-1);function be(t,r,e,n,i,s){const u=o("IssueLocationIcon"),c=o("XTooltip"),I=o("BaseStatusLabel"),p=o("BaseBody"),g=o("router-link"),_=o("DataTableCell");return l(),d(_,null,{default:a(()=>[h(u,{groupedIssue:e.issueGroup},null,8,["groupedIssue"]),m("div",{class:T(["truncate-left flex align-center gap-4px flex-1",[s.showOtherProjectsLabel?"justify-between":"justify-end"]])},[s.showOtherProjectsLabel?(l(),d(I,{key:0,class:"direction-ltr",size:"compact"},{default:a(()=>[G(S(t.$t("X_OTHERS",s.projectNames.length-1))+" ",1),h(c,null,{default:a(()=>[m("span",Se,S(s.projectNames.slice(1).join(`
`)),1)]),_:1})]),_:1})):f("",!0),h(g,{class:"group flex align-center gap-4px",to:s.repositoryDetailPage,onClick:r[0]||(r[0]=U(()=>{},["stop"]))},{default:a(()=>[we,h(p,{truncate:!0},{default:a(()=>[G(S(s.projectNames[0])+"â€Ž",1)]),_:1})]),_:1},8,["to"])],2)]),_:1})}const Re=w(Ge,[["render",be]]),ke={components:{DataTableCell:y,BaseParagraph:K,BaseBody:L,BaseButton:Q},props:{issueGroup:Object},computed:{title(){let t="open";return this.$route.meta.status?t=this.$route.meta.status:this.issueGroup.enhanced_status=="closed"&&(t="closed"),le(this.issueGroup,t)},description(){return ae(this.issueGroup)},blurTitle(){return!!this.issueGroup.is_blurred}},methods:{handleUpgradeToPro(){return this.$modal.show("UpgradeAccountModal",{title:"Upgrade to view all issues",msg:"The free plan limits you to 15 visible issues and restricts the number of repos, clouds, and containers."})}}},Te=m("i",{class:"icon icon-pro"},null,-1);function Ue(t,r,e,n,i,s){const u=o("BaseBody"),c=o("BaseParagraph"),I=o("BaseButton"),p=o("DataTableCell");return l(),d(p,null,{default:a(()=>[m("div",{class:T(["flex flex-column gap-4px overflow-hidden",{"user-select-none":e.issueGroup.is_blurred}])},[h(u,{truncate:!0,class:T({"blur px-2px":s.blurTitle})},{default:a(()=>[G(S(s.title),1)]),_:1},8,["class"]),h(c,{color:"subdued",truncate:!0,class:T({"blur px-2px":e.issueGroup.is_blurred})},{default:a(()=>[G(S(s.description),1)]),_:1},8,["class"])],2),s.blurTitle?(l(),d(I,{key:0,size:"small",class:"show-on-hover mobile_visible feed__row__upgrade-button",onClick:U(s.handleUpgradeToPro,["prevent","stop"])},{default:a(()=>[Te,G("Upgrade ")]),_:1},8,["onClick"])):f("",!0)]),_:1})}const je=w(ke,[["render",Ue]]),ye={emits:["rowClicked"],components:{DataTableSeverityIndicator:he},props:{issueGroup:Object},computed:{priority(){return this.issueGroup.status==="ignored"&&this.issueGroup.aikido_priority===1?this.issueGroup.initial_priority:this.issueGroup.aikido_priority}}};function Fe(t,r,e,n,i,s){const u=o("DataTableSeverityIndicator");return l(),d(u,{priority:s.priority},null,8,["priority"])}const Pe=w(ye,[["render",Fe]]);export{je as I,Pe as a,Re as b,xe as c};
