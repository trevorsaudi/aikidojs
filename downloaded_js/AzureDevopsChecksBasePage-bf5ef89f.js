import{_,f as v,d as C,an as l,aV as h,cb as b,a0 as k,Z as T,r as s,k as R,m as B,o as i,w as r,n,F as A,q as u,s as x}from"./index-13ff96f4.js";import{P as y}from"./PageHeader-46c38a32.js";const z={components:{BaseButton:v,BasePill:C,PageHeader:y},data(){return{searchTerm:"",repositories:[],isLoading:!0,isFetchingRepositories:!0}},watch:{$teamContext(){this.getRepositories()}},async mounted(){l.on("azureDevopsChecksConfigurationUpdated",this.getRepositories),await this.getRepositories(),this.isLoading=!1},beforeUnmount(){l.off("azureDevopsChecksConfigurationUpdated",this.getRepositories)},provide(){return{repositories:h(()=>this.repositories),isFetchingRepositories:h(()=>this.isFetchingRepositories)}},computed:{breadcrumbs(){return[{label:"Settings",href:"/settings/integrations"},{label:"Azure DevOps Checks"}]},repositoriesWithConfiguration(){return this.repositories.filter(t=>!!t.configuration)}},methods:{async getRepositories(){this.isFetchingRepositories=!0;const t={searchTerm:this.searchTerm};try{const e=await b(t);this.repositories=e}catch(e){k.isAxiosError(e)&&e.response.status===404?this.$toast.error({title:"Integration not enabled",description:"You do not have this integration enabled."}):this.$toast.error({title:"Unable to load configurations",description:e.message??"An unknown error occured"}),this.$router.push("/settings/integrations")}finally{this.isFetchingRepositories=!1}},async handleUninstallIntegration(){(await this.$modal.show("UninstallAzureDevopsCiServiceModal")).type==="saved"&&(this.$toast.success({title:"Integration removed",description:"The Azure DevOps PR checks integration has been removed successfully"}),T.fetchAzureDevopsChecksIntegrationStatus(),this.$router.push("/settings/integrations"))}}},I={class:"flex align-center gap-8px"},P={class:"flex gap-16px"},U=n("span",{class:"text--bold"},"CI Scan History",-1),D={class:"page-content"};function w(t,e,E,S,a,o){const p=s("XPreloader"),d=s("BasePill"),c=s("BaseButton"),g=s("PageHeader"),m=s("router-view");return a.isLoading?(u(),R(p,{key:0,class:"supercenter",size:"medium"})):(u(),B(A,{key:1},[i(g,{breadcrumbs:o.breadcrumbs,title:"Azure DevOps Checks"},{subTitle:r(()=>[n("div",I,[i(d,{title:t.$t("SETTINGS.INTEGRATIONS.AZURE_DEVOPS.HEADER.CONFIGURATIONS_TITLE",o.repositoriesWithConfiguration.length),variation:"gray-fill"},null,8,["title"])])]),rightContent:r(()=>[n("div",P,[i(c,{variation:"plain",size:"medium",onClick:o.handleUninstallIntegration},{default:r(()=>[x("Uninstall")]),_:1},8,["onClick"]),i(c,{size:"medium",variation:"tertiary",as:"link",to:"/settings/integrations/ci/checks/scans"},{default:r(()=>[U]),_:1})])]),_:1},8,["breadcrumbs"]),n("div",D,[i(m,{searchTerm:a.searchTerm,"onUpdate:searchTerm":[e[0]||(e[0]=f=>a.searchTerm=f),o.getRepositories]},null,8,["searchTerm","onUpdate:searchTerm"])])],64))}const O=_(z,[["render",w]]);export{O as default};
