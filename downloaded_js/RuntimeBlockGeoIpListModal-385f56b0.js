import{_ as E,au as h,X as O,N as T,x as M,a2 as g,A as c,hc as S,em as f,an as k,r as l,q as R,k as _,w as n,n as a,o as d,s as r,u}from"./index-13ff96f4.js";import{I as C}from"./InputMultiSelect-21584437.js";import"./ActionMenu-3e4470bf.js";import"./InputCheckbox-81cb3ca6.js";const A={components:{BaseConfirmModal:h,InputMultiSelect:C,XPreloader:O,BaseSelect:T,BaseIcon:M,XTooltip:g},emits:["close"],props:{serviceId:{type:Number,required:!0}},data(){return{modalWidth:600,isLoadingLists:!1,selectedListIds:[],lists:[],disableSubmit:!1,blockingMode:"block",blockingModeOptions:[{id:"block",title:this.$t("RUNTIME_PROTECTION.FIREWALL.GEOIP.MODAL.SELECT_MODE.BLOCK")},{id:"allow",title:this.$t("RUNTIME_PROTECTION.FIREWALL.GEOIP.MODAL.SELECT_MODE.ALLOW")}]}},async mounted(){await this.init()},computed:{multiSelectWidth(){return this.modalWidth-72},innerSelectWidth(){return this.multiSelectWidth-60},maxSelectableItems(){return c.hasExpiredFullTrial()?1:-1},listOptions(){return c.hasExpiredFullTrial()?this.lists.map(t=>({...t,disabledTooltip:"Free accounts can only block up to 1 country",disabledAction:{handleAction:()=>{this.$modal.show("UpgradeAccountModal",{title:"Blocking multiple countries is available on all paid plans",msg:"Upgrade now to any paid plan to block more countries."})},text:"Upgrade Plan",variation:"orange"}})):this.lists}},methods:{async init(){await this.$nextTick(),await Promise.all([this.loadLists()])},async loadLists(){this.isLoadingLists=!0;const t=await S(this.serviceId);for(const e of t)this.lists.push({value:e.id,label:e.source==="geoip"?e.code.split(";")[0]:e.code}),e.subscribed&&this.selectedListIds.push(e.id);this.blockingMode=t.some(e=>e.subscription_type==="allow")?"allow":"block",this.isLoadingLists=!1},async submit(){this.disableSubmit=!0,await f({serviceId:this.serviceId,type:this.blockingMode,subscriptions:this.selectedListIds,source:"geoip"}),this.$toast.success(`Successfully updated ${this.blockingMode}ed countries, it might take up to a minute to take effect.`),k.emit("runtime.lists.ip.updated"),this.$emit("close")}}},N=a("hr",{class:"divider w-full mb-16px"},null,-1),P={class:"flex align-center gap-8px"},w=a("span",{class:"required"},"*",-1);function W(t,e,B,x,s,i){const p=l("XTooltip"),m=l("BaseIcon"),I=l("BaseSelect"),L=l("InputMultiSelect"),b=l("BaseConfirmModal");return R(),_(b,{title:t.$t("RUNTIME_PROTECTION.FIREWALL.GEOIP.MODAL.TITLE"),description:t.$t("RUNTIME_PROTECTION.FIREWALL.GEOIP.MODAL.DESC"),buttonSubmitText:t.$t("RUNTIME_PROTECTION.FIREWALL.GEOIP.MODAL.BTN"),disableSubmit:s.disableSubmit,onSubmit:i.submit,onClose:e[2]||(e[2]=o=>t.$emit("close")),onSecondaryButtonClicked:e[3]||(e[3]=o=>t.$emit("close")),width:s.modalWidth,allowBackgroundClose:!1},{default:n(()=>[a("div",null,[N,d(I,{modelValue:s.blockingMode,"onUpdate:modelValue":e[0]||(e[0]=o=>s.blockingMode=o),options:s.blockingModeOptions,required:!0,isLoading:s.isLoadingLists},{label:n(()=>[a("div",P,[a("span",null,[r(u(t.$t("RUNTIME_PROTECTION.FIREWALL.GEOIP.MODAL.SELECT_MODE"))+" ",1),w]),d(m,{icon:"icon-information",class:"text-primary-aik-140"},{default:n(()=>[d(p,{class:"ws-break-spaces"},{default:n(()=>[r(u(t.$t("RUNTIME_PROTECTION.FIREWALL.GEOIP.MODAL.SELECT_MODE.HOVER")),1)]),_:1})]),_:1})])]),_:1},8,["modelValue","options","isLoading"]),d(L,{class:"mt-16px mb-16px",options:i.listOptions,selectedItems:s.selectedListIds,"onUpdate:selectedItems":e[1]||(e[1]=o=>s.selectedListIds=o),label:t.$t("RUNTIME_PROTECTION.FIREWALL.GEOIP.MODAL.SELECT"),width:i.multiSelectWidth,truncateOptionsWidth:i.innerSelectWidth,enableCheckAll:!1,required:!0,"is-loading":s.isLoadingLists,maxSelectableItems:i.maxSelectableItems,descriptionClass:"w-full"},null,8,["options","selectedItems","label","width","truncateOptionsWidth","is-loading","maxSelectableItems"])])]),_:1},8,["title","description","buttonSubmitText","disableSubmit","onSubmit","width"])}const F=E(A,[["render",W]]);export{F as default};
