import{_ as O,M as D,f as N,B as M,H as w,V as b,X as I,dz as T,gh as V,gi as F,r as s,q as a,k as h,w as t,m as _,o as i,n as d,s as l,u as U,ai as A,p as m}from"./index-13ff96f4.js";import{B as L}from"./BaseForm-4c6fa06f.js";import{N as E,S as z,A as G}from"./AktoOpenapiSpecSelector-7b7ef30c.js";import{B as P}from"./ButtonMultiOption-12e505fb.js";import"./repoName-872812ed.js";import"./InputMultiSelect-21584437.js";import"./ActionMenu-3e4470bf.js";import"./InputCheckbox-81cb3ca6.js";import"./BaseRadioInput-a7ac3557.js";const q={components:{BaseModal:D,BaseButton:N,BaseParagraph:M,BaseHeading:w,InputText:b,BaseForm:L,XPreloader:I,NucleiTagSelector:E,SelectRepoOrCloudImage:z,ButtonMultiOption:P,AktoOpenapiSpecSelector:G},props:{domain:{type:Object,default:null}},emits:["close","saved"],data(){return{domainName:"",isSaving:!1,selectedTagGroups:[],connectOptions:[{id:"none",title:"None"},{id:"scm_repo",title:"Repository"},{id:"cloud_image",title:"Container"}],selectedConnectOption:"none",linkedRepositoryError:void 0,selectedSCMRepository:null,selectedCloudRepository:null,aktoSpecRuntimeServiceId:-1,aktoSpecCustomFileContent:null,aktoLastUpdatedAt:-1,loaded:!1}},async created(){if(this.domainName=this.domain.domain_name,this.selectedTagGroups=this.domain.tag_groups,this.domain.scm_repo_id>0&&(this.selectedSCMRepository=this.domain.scm_repo_id,this.selectedConnectOption="scm_repo"),this.domain.cloud_repo_id>0&&(this.selectedCloudRepository=this.domain.cloud_repo_id,this.selectedConnectOption="cloud_image"),this.domain.scan_type=="akto"){const o=await T(this.domain.domain_id);this.aktoSpecRuntimeServiceId=o.akto_runtime_service_id,this.aktoLastUpdatedAt=o.akto_settings_last_updated_at}this.loaded=!0},computed:{canLinkDomainToAsset(){return this.domain.scan_type=="owasp-zap"}},methods:{async handleEditDomain(o){if(this.isSaving=!0,this.selectedConnectOption!="none"&&!this.selectedSCMRepository&&!this.selectedCloudRepository){this.linkedRepositoryError="You must link the domain to either a code repository or container",this.isSaving=!1;return}try{this.domain.scan_type==="akto"||this.domain.scan_type==="akto_graphql"?await V(this.domain.domain_id,this.domainName,this.aktoSpecCustomFileContent,this.aktoSpecRuntimeServiceId):await F(this.domain.domain_id,this.domainName,this.selectedTagGroups,this.selectedSCMRepository,this.selectedCloudRepository),Toast.success({title:"Domain saved!",description:"The domain has been saved correctly. We'll start a scan to look for any vulnerabilities"}),this.$emit("saved")}finally{this.isSaving=!1}},handleClose(){this.$emit("close")},handleFocusDomain(){this.domainName.trim()==""&&(this.domainName="https://")},handleUnfocusDomain(){this.domainName.trim()=="https://"&&(this.domainName="")},handleTypingDomain(o){o.startsWith("https://https://")&&(o=o.replace("https://https://","https://")),this.domainName=o},handleSelectConnectOption(o){this.selectedConnectOption=o,this.selectedCloudRepository=null,this.selectedSCMRepository=null},handleSelectSCMRepoOrCloudRepo(o){this.linkedRepositoryError=void 0,o.kind==="scm_repo"?(this.selectedCloudRepository=null,this.selectedSCMRepository=o.repository.id):(this.selectedSCMRepository=null,this.selectedCloudRepository=o.repository.id)}}},H=d("div",{class:"flex flex-column gap-2px"},null,-1),W={key:0,class:"h-32px relative"},X={key:1,class:"flex flex-column gap-24px"},j={class:"flex flex-column gap-8px"},Q={class:"text--semi-bold"},Y=d("hr",{class:"divider w-full"},null,-1),J={class:"flex flex-column gap-8px"},K={key:0,class:"mt-12px py-12px px-16px flex gap-16px align-center bg-surface-orange-20 border-1 border-surface-orange-80 rounded-8px"},Z=d("hr",{class:"divider w-full"},null,-1),$={key:2,class:"flex flex-column gap-12px"};function ee(o,c,u,oe,e,n){const y=s("XPreloader"),C=s("BaseHeading"),r=s("BaseParagraph"),f=s("InputText"),g=s("BaseForm"),k=s("AktoOpenapiSpecSelector"),R=s("NucleiTagSelector"),v=s("ButtonMultiOption"),B=s("SelectRepoOrCloudImage"),S=s("BaseButton"),x=s("BaseModal");return a(),h(x,{width:650,onClose:n.handleClose,allowBackgroundClose:!1},{header:t(()=>[H]),content:t(()=>[e.loaded?(a(),_("div",X,[d("div",j,[i(C,{as:"h3"},{default:t(()=>[l("Configure settings for "),d("span",Q,U(u.domain.domain_name),1)]),_:1})]),Y,i(g,{id:"architecture",onSubmit:A(n.handleEditDomain,["prevent"])},{default:t(()=>[d("div",J,[i(r,{size:"medium",bold:""},{default:t(()=>[l(" What is the domain name?")]),_:1}),i(r,{size:"small",color:"subdued"},{default:t(()=>[l(" With this info Aikido can monitor for vulnerabilities with security headers, DNS, cookies, SSL, etc ")]),_:1}),i(f,{placeholder:"Domain name",modelValue:e.domainName,"onUpdate:modelValue":n.handleTypingDomain,name:"domainName",type:"url",clearable:!1,onFocus:n.handleFocusDomain,onBlur:n.handleUnfocusDomain},null,8,["modelValue","onUpdate:modelValue","onFocus","onBlur"]),u.domain.scan_type=="akto_graphql"?(a(),_("div",K,[d("div",null,[i(r,{color:"orange",semiBold:""},{default:t(()=>[l("Do NOT run GraphQL checks on production. Use staging only.")]),_:1})])])):m("",!0)])]),_:1},8,["onSubmit"]),Z,u.domain.scan_type=="akto"?(a(),h(k,{key:0,runtimeServiceId:e.aktoSpecRuntimeServiceId,"onUpdate:runtimeServiceId":c[0]||(c[0]=p=>e.aktoSpecRuntimeServiceId=p),customSpecFileContent:e.aktoSpecCustomFileContent,"onUpdate:customSpecFileContent":c[1]||(c[1]=p=>e.aktoSpecCustomFileContent=p),lastUpdatedAt:e.aktoLastUpdatedAt,isEdit:!0},null,8,["runtimeServiceId","customSpecFileContent","lastUpdatedAt"])):m("",!0),u.domain.scan_type=="nuclei"?(a(),h(R,{key:1,modelValue:e.selectedTagGroups,"onUpdate:modelValue":c[2]||(c[2]=p=>e.selectedTagGroups=p)},null,8,["modelValue"])):m("",!0),n.canLinkDomainToAsset?(a(),_("div",$,[i(r,{size:"medium",bold:""},{default:t(()=>[l("Link domain to an asset")]),_:1}),i(r,{size:"small",color:"subdued"},{default:t(()=>[l(" Link the domain to a code repository or cloud image so that we can group the issues accordingly. ")]),_:1}),i(v,{class:"issue-detail__card__questionaire__answer",options:e.connectOptions,modelValue:e.selectedConnectOption,"onUpdate:modelValue":n.handleSelectConnectOption},null,8,["options","modelValue","onUpdate:modelValue"]),e.selectedConnectOption!="none"?(a(),h(B,{key:0,class:"mt-8px",onSelectRepository:n.handleSelectSCMRepoOrCloudRepo,error:e.linkedRepositoryError,onlyShowRepo:e.selectedConnectOption=="scm_repo",onlyShowCloud:e.selectedConnectOption=="cloud_image",initialSelectedSCMRepository:e.selectedSCMRepository,initialSelectedCloudRepository:e.selectedCloudRepository,showAlreadyLinkedResources:!0},null,8,["onSelectRepository","error","onlyShowRepo","onlyShowCloud","initialSelectedSCMRepository","initialSelectedCloudRepository"])):m("",!0)])):m("",!0)])):(a(),_("div",W,[i(y,{class:"absolute-centered mt-12px",size:"medium"})]))]),footer:t(()=>[i(S,{variation:"tertiary",onClicked:n.handleClose,class:"ml-auto"},{default:t(()=>[l("Cancel")]),_:1},8,["onClicked"]),i(S,{variation:"primary",type:"submit",form:"architecture",isLoading:e.isSaving},{default:t(()=>[l("Finish")]),_:1},8,["isLoading"])]),_:1},8,["onClose"])}const pe=O(q,[["render",ee]]);export{pe as default};
