import{P}from"./PageHeader-46c38a32.js";import{B as I}from"./BaseCard-471d3203.js";import{O as x}from"./OverviewEmptyState-c8440b9c.js";import{G as B}from"./GenericIllustration-4aca88e5.js";import{_ as A,dl as C,c6 as S,Q as V,dt as D,aq as O,r as t,k as p,m as f,o,n as d,w as s,F as g,q as r,s as c,u as T,t as E}from"./index-13ff96f4.js";const z={components:{PageHeader:P,BaseCard:I,OverviewEmptyState:x,GenericIllustration:B},data(){return{loaded:!1,repository:{},paths:[""]}},async mounted(){await this.loadRepositoryDetails(),this.loaded=!0},computed:{repositoryId(){return this.$route.params.id},breadcrumbs(){return[{label:"Repositories",to:"/repositories"},{label:this.repository.scm_repo_name,to:`/repositories/${this.repositoryId}`},{label:"Split Repository"}]},isValid(){return this.paths.filter(n=>n.trim()!=="").length!=0}},methods:{async loadRepositoryDetails(){try{this.repository=await C(this.repositoryId)}catch(e){e instanceof S.AxiosError&&e.response.status===404&&this.$router.push({name:"notFound"})}},handleRemovePath(e){this.paths.splice(e,1)},handleAddPath(){this.paths.push("")},async splitRepo(){if(!this.isValid){this.$toast.error("Please fill at least one path");return}if(!await V({title:"Do you want to split this repo?",markupDescription:"This will create a new repository for each path and *deactivate* the original repository. Are you sure you want to proceed?",buttonSubmitText:"deactivate and split"}))return;const e=[];for(const n of this.paths){const u=await D({repo_id:this.repositoryId,path_to_scan:n});e.push(u)}await O(this.repositoryId),this.paths.length==1?this.$router.push(`/repositories/${e[0]}?startscan=true`):this.$router.push("/repositories"),this.$toast.success("Repository successfully splitted")},handleMessageAikido(){const e="Hi, I would like to request repository splitting for our organization.";window.Intercom("showNewMessage",e)}}},F={class:"page-content"},G={class:"flex flex-column gap-8px"},H=d("i",{class:"icon icon-add"},null,-1);function L(e,n,u,M,a,i){const w=t("XPreloader"),b=t("PageHeader"),k=t("GenericIllustration"),v=t("OverviewEmptyState"),h=t("BaseCard"),m=t("BaseParagraph"),R=t("InputText"),_=t("BaseButton");return a.loaded?(r(),f(g,{key:1},[o(b,{breadcrumbs:i.breadcrumbs,title:"Split Repository"},null,8,["breadcrumbs"]),d("div",F,[e.$featureflags.enable_repo_splitting?(r(),p(h,{key:1,title:"Let's split your repository",class:"flex-1"},{default:s(()=>[d("div",G,[o(m,{size:"medium",bold:""},{default:s(()=>[c("Define Split Points for "+T(a.repository.scm_repo_name),1)]),_:1}),o(m,{size:"small",color:"subdued"},{default:s(()=>[c("List the paths where you want to divide your repository. Add as many as needed.")]),_:1}),(r(!0),f(g,null,E(a.paths,(N,l)=>(r(),p(R,{class:"max-w-600px",key:l,placeholder:"/path/to/subdirectory",modelValue:a.paths[l],"onUpdate:modelValue":y=>a.paths[l]=y,clearable:a.paths.length>1,onClear:y=>i.handleRemovePath(l)},null,8,["modelValue","onUpdate:modelValue","clearable","onClear"]))),128)),o(_,{variation:"plain",size:"small",onClick:i.handleAddPath,class:"mt-8px"},{default:s(()=>[H,c(" Add another path ")]),_:1},8,["onClick"]),o(_,{onClick:i.splitRepo,class:"inline-block mt-56px"},{default:s(()=>[c(" Split Repository ")]),_:1},8,["onClick"])])]),_:1})):(r(),p(h,{key:0},{default:s(()=>[o(v,{title:"Repository splitting disabled for this workspace",description:"Do you want to split a repo? Chat with our Aikido team to get this feature up and running.",actionLabel:"Message Aikido Team",onOnAction:i.handleMessageAikido},{default:s(()=>[o(k)]),_:1},8,["onOnAction"])]),_:1}))])],64)):(r(),p(w,{key:0,class:"supercenter",theme:"transparent"}))}const j=A(z,[["render",L]]);export{j as default};
