import{_ as A,Y as w,a as I,q as l,m as h,p as g,eO as V,c as i,eB as M,eA as G,V as U,g as L,f as F,B as H,X as R,C as z,eP as D,A as j,eQ as X,eR as W,E as Y,cU as E,bW as q,aZ as Q,r as n,k as _,w as a,o,n as r,s as d,u as p,F as T}from"./index-13ff96f4.js";import{I as Z}from"./InputCheckbox-81cb3ca6.js";import{O as J}from"./OnboardingProgressIndicator-8fa4a42d.js";import{f as K}from"./focusModePreference-150f170e.js";const $={data(){return{isAuthenticated:w.isAuthenticated,isProductionEnv:I()==="production"}}},ee={key:0,class:"invisible",src:"https://www.aikido.dev/signup-succesful"};function te(e,s,c,v,t,m){return t.isAuthenticated&&t.isProductionEnv?(l(),h("iframe",ee)):g("",!0)}const ae=A($,[["render",te]]);async function se(){V({hubspotutk:i.get("hubspotutk")||null,utm_source:i.get("utm_source")||null,utm_campaign:i.get("utm_campaign")||null,utm_adgroup:i.get("utm_adgroup")||null,utm_term:i.get("utm_term")||null,utm_content:i.get("utm_content")||null,utm_medium:i.get("utm_medium")||null,matchtype:i.get("matchtype")||null,device:i.get("device")||null,gclid:i.get("gclid")||null,msclkid:i.get("msclkid")||null,li_fat_id:i.get("li_fat_id")||null,fbclid:i.get("fbclid")||null,partner:i.get("partner")||null,dd_anonymous_id:i.get("dd_anonymous_id")||null})}const ie={mixins:[K],props:{numberOfCompletedSteps:Number,numberOfSteps:Number,hideBackButton:{type:Boolean,default:!1},welcomeText:{type:String,default:""}},emits:["continue","back"],components:{OnboardingPage:M,OnboardingSection:G,OnboardingProgressIndicator:J,InputText:U,InputCheckbox:Z,BaseLink:L,BaseButton:F,GoogleTagManagerIframe:ae,BaseParagraph:H,XPreloader:R},data(){return{hasAgreedToTOS:!1,hasAgreedToEmailNotificationsCore:!0,hasAgreedToEmailNotificationsMarketing:!1,email:this.$user.email??"",emailError:void 0,showGroupSpecificEmailCheckbox:!1,showUserSpecificEmailCheckbox:!1,errorMessage:"",isLoading:!1}},async created(){const e=await z();e.group_based||(this.showGroupSpecificEmailCheckbox=!0),e.user_based||(this.showUserSpecificEmailCheckbox=!0)},async mounted(){if(this.syncAllTeamsForUserAcrossAccounts(),this.isLoading=!0,this.$user.accepted_tos_at>0){this.$emit("continue");return}this.isLoading=!1},computed:{userHasEmail(){return!!this.$user.email},emailIsValid(){return this.email.trim()!==""},inputIsValid(){return this.emailIsValid&&this.hasAgreedToTOS}},methods:{handleBack(){this.$emit("back")},async handleContinue(){var e;if(!this.emailIsValid){this.errorMessage="Please make sure to enter a valid email address";return}if(!this.hasAgreedToTOS){this.errorMessage="Please make sure to agree to the terms of service";return}this.setPreferredFocusMode("all_issues_mode");try{await D({email:this.email,accepted_tos:!0},{disable_toasts:!0})}catch(s){this.emailError=((e=s==null?void 0:s.response)==null?void 0:e.statusText)||"Invalid email address";return}await j.fetchProfile(),this.saveEmailPrefAndHubspot(),X(),W(),this.$emit("continue")},async saveEmailPrefAndHubspot(){await this.saveEmailPreferences(),await se()},async saveEmailPreferences(){const e={};this.showUserSpecificEmailCheckbox&&this.hasAgreedToEmailNotificationsMarketing&&(e.send_marketing_emails=1),this.showGroupSpecificEmailCheckbox&&this.hasAgreedToEmailNotificationsCore&&(e.send_new_criticals=1,e.send_weekly_digest=1),Object.keys(e).length!==0&&await Y(e)},async handleLogout(){E.track("Account Signed Out"),E.track("User Signed Out"),await w.logOut()},async syncAllTeamsForUserAcrossAccounts(){const e=await q(),s=[];for(const c of e)c.is_demo_group!=1&&s.push(Q({no_disable_buttons:!0,disable_toasts:!0,overwrite_group_header:c.id}));await Promise.allSettled(s)}}},oe={class:"absolute pin-l pin-t mt-16px ml-60px"},ne=r("img",{class:"",src:"https://cdn.aikido.dev/assets/logo-white.svg?v=2",width:"180"},null,-1),re={class:"onboarding__title mb-36px mt-64px text-white"},le=r("p",{class:"onboarding__paragraph onboarding__paragraph--size-large text-carbon-20"}," We need your email address in order to send notifications and digests for your vulnerabilities. You can adjust your notification settings anytime. ",-1),ce=r("h4",{class:"onboarding__title text-primary-aik-140 mb-8px"},"Notification & account details",-1),de=r("p",{class:"onboarding__paragraph onboarding__paragraph--size-medium text-carbon-60"},"We need your email address, in order to send notifications and digests for your vulnerabilities. You can adjust your notification settings anytime.",-1),ue={class:"mb-16px mt-32px gap-32px flex flex-column"},me={class:"flex flex-column gap-16px"},_e=r("span",{class:"text-surface-red-100 ml-2px"},"*",-1),ge={class:"mt-16px mb-16px"},pe={key:0,class:"onboarding__paragraph onboarding__paragraph--size-small text-surface-red-100"},he={class:"flex mt-auto gap-16px justify-end"};function fe(e,s,c,v,t,m){const f=n("BaseButton"),C=n("OnboardingProgressIndicator"),b=n("OnboardingSection"),S=n("XPreloader"),O=n("InputText"),x=n("BaseLink"),B=n("i18n-t"),k=n("BaseParagraph"),y=n("InputCheckbox"),N=n("GoogleTagManagerIframe"),P=n("OnboardingPage");return l(),_(P,null,{default:a(()=>[o(b,{"align-content":"bottom",theme:"dark",class:"onboarding__section__content relative"},{default:a(()=>[r("div",oe,[o(f,{onClicked:m.handleLogout,rounded:"",variation:"secondary"},{default:a(()=>[d("Logout")]),_:1},8,["onClicked"])]),ne,r("h1",re,[c.welcomeText?(l(),h(T,{key:0},[d(p(c.welcomeText),1)],64)):(l(),h(T,{key:1},[d("Last step, just details.")],64))]),le,o(C,{"number-of-completed-steps":c.numberOfCompletedSteps,"number-of-steps":c.numberOfSteps},null,8,["number-of-completed-steps","number-of-steps"])]),_:1}),t.isLoading?(l(),_(b,{key:0,"align-content":"top",theme:"light",class:"onboarding__section__content"},{default:a(()=>[o(S,{class:"absolute-centered",size:"medium"})]),_:1})):(l(),_(b,{key:1,"align-content":"top",theme:"light",class:"onboarding__section__content"},{default:a(()=>[ce,de,r("div",ue,[o(O,{modelValue:t.email,"onUpdate:modelValue":s[0]||(s[0]=u=>t.email=u),name:"email",class:"onboarding__input",placeholder:"your-email@email.com",readonly:m.userHasEmail,disabled:m.userHasEmail,title:"Email address",error:t.emailError,required:""},null,8,["modelValue","readonly","disabled","error"]),r("div",me,[o(y,{modelValue:t.hasAgreedToTOS,"onUpdate:modelValue":s[1]||(s[1]=u=>t.hasAgreedToTOS=u),name:"hasAgreedToTOS"},{default:a(()=>[o(k,{class:"inline-block"},{default:a(()=>[o(B,{keypath:"ONBOARDING_TOS_DESCRIPTION"},{tos:a(()=>[o(x,{href:"https://www.aikido.dev/aikido-security-bv-msa",inline:"",target:"_blank"},{default:a(()=>[d(p(e.$t("ONBOARDING_MSA")),1)]),_:1})]),privacy:a(()=>[o(x,{href:"https://www.aikido.dev/aikido-security-bv-dpa",inline:"",target:"_blank"},{default:a(()=>[d(p(e.$t("ONBOARDING_DATA_PROCESSING_AGREEMENT")),1)]),_:1})]),_:1})]),_:1}),_e]),_:1},8,["modelValue"]),t.showGroupSpecificEmailCheckbox?(l(),_(y,{key:0,modelValue:t.hasAgreedToEmailNotificationsCore,"onUpdate:modelValue":s[2]||(s[2]=u=>t.hasAgreedToEmailNotificationsCore=u),name:"hasAgreedToEmailNotificationsCore"},{default:a(()=>[o(k,null,{default:a(()=>[d("Email me about security alerts in my code.")]),_:1})]),_:1},8,["modelValue"])):g("",!0),t.showUserSpecificEmailCheckbox?(l(),_(y,{key:1,modelValue:t.hasAgreedToEmailNotificationsMarketing,"onUpdate:modelValue":s[3]||(s[3]=u=>t.hasAgreedToEmailNotificationsMarketing=u),name:"hasAgreedToEmailNotificationsMarketing"},{default:a(()=>[o(k,null,{default:a(()=>[d("Email me about product updates.")]),_:1})]),_:1},8,["modelValue"])):g("",!0),r("div",ge,[t.errorMessage?(l(),h("p",pe,p(t.errorMessage),1)):g("",!0)])])]),r("div",he,[c.hideBackButton?g("",!0):(l(),_(f,{key:0,onClicked:m.handleBack,variation:"plain",size:"large"},{default:a(()=>[d("Back")]),_:1},8,["onClicked"])),o(f,{onClicked:m.handleContinue,variation:"primary",size:"large"},{default:a(()=>[d("Finished!")]),_:1},8,["onClicked"])])]),_:1})),o(N)]),_:1})}const Ee=A(ie,[["render",fe]]);export{Ee as C};
