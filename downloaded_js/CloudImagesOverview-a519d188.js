import{_ as x,M as B,B as w,f as I,H as T,N as v,dM as M,dN as $,an as k,K as S,r as a,q as d,k as m,w as e,o,s,m as R,n as t,ai as P,p as O,F as L,dO as N,t as H,u as f,S as U}from"./index-13ff96f4.js";import{a as V,T as E}from"./TableListHeader-e50d01d1.js";import{b as A}from"./dateFns-a344cb79.js";import"./DataTable-e31a825a.js";import"./index-b87db690.js";const D={props:{cloudRepo:Object},emits:["canceled","confirmed"],components:{BaseModal:B,BaseParagraph:w,BaseButton:I,BaseHeading:T,BaseSelect:v},data(){return{selectedRepository:null,repositories:[],isLoading:!0}},async mounted(){this.handleGetRepositories()},computed:{codeRepositoryOptions(){return this.repositories.map(({id:c,scm_repo_name:r})=>({id:c,title:r}))}},methods:{handleCancel(){this.selectedRepository=null,this.$emit("canceled")},async handleConfirm(){this.validate()&&(await M(this.cloudRepo.cloud_id,this.cloudRepo.id,this.selectedRepository,{no_disable_buttons:!0}),$(this.cloudRepo.cloud_id,{no_disable_buttons:!0}),Toast.success({title:this.$t("NOTIFICATIONS.CLOUD_IMAGE_LINKED.TITLE"),description:"We succesfully linked the image to the code repo. We'll immediately check for any related issues."}),k.emit("cloudImageUpdated"),this.$emit("confirmed"))},async handleGetRepositories(){this.repositories=await S(),this.isLoading=!1},validate(){return this.selectedRepository?!0:(this.$toast.error("Please select a code repo"),!1)}}};function F(c,r,g,y,u,l){const _=a("BaseParagraph"),n=a("BaseHeading"),p=a("BaseSelect"),h=a("BaseButton"),b=a("BaseModal");return d(),m(b,{onClose:l.handleCancel},{header:e(()=>[o(_,{color:"gray"},{default:e(()=>[s("Link to code repo")]),_:1})]),content:e(()=>[o(n,{as:"h3"},{default:e(()=>[s("Link cloud image to code repo")]),_:1}),o(p,{label:"Code repo",options:l.codeRepositoryOptions,modelValue:u.selectedRepository,"onUpdate:modelValue":r[0]||(r[0]=C=>u.selectedRepository=C),"is-loading":u.isLoading,theme:"light"},null,8,["options","modelValue","is-loading"])]),footer:e(()=>[o(h,{onClicked:l.handleCancel,variation:"plain",class:"ml-auto"},{default:e(()=>[s("Cancel")]),_:1},8,["onClicked"]),o(h,{onClicked:l.handleConfirm},{default:e(()=>[s("Confirm")]),_:1},8,["onClicked"])]),_:1},8,["onClose"])}const j=x(D,[["render",F]]),G={props:{cloudRepo:Object},components:{BaseParagraph:w,LinkCloudImageToRepoModal:j},data(){return{showSelectRepoModal:!1}},methods:{handleLinkCloudImageToRepo(c){c.preventDefault(),this.showSelectRepoModal=!0},handleCloseModal(){this.showSelectRepoModal=!1},handleCloudImageLinked(){this.showSelectRepoModal=!1}}},K={class:"flex justify-between align-center"},W=t("span",{class:"flex align-center text-color-danger"},[t("i",{class:"icon icon-critical text-inherit mr-4px"}),s(" Unlinked ")],-1),X=t("span",{class:"link blue"},"Link to repo",-1),q=t("i",{class:"icon icon-link text-inherit ml-4px"},null,-1),z=[X,q];function J(c,r,g,y,u,l){const _=a("BaseParagraph"),n=a("LinkCloudImageToRepoModal");return d(),R(L,null,[t("div",K,[o(_,null,{default:e(()=>[W]),_:1}),o(_,null,{default:e(()=>[t("a",{href:"#",onClick:r[0]||(r[0]=P(p=>l.handleLinkCloudImageToRepo(p),["stop"])),class:"flex align-center text-blue-accent px-12px py-6px rounded-8px hover_bg-blue-ultra-light"},z)]),_:1})]),u.showSelectRepoModal?(d(),m(n,{key:0,onCanceled:l.handleCloseModal,onConfirmed:l.handleCloudImageLinked,cloudRepo:g.cloudRepo},null,8,["onCanceled","onConfirmed","cloudRepo"])):O("",!0)],64)}const Q=x(G,[["render",J]]),Y={data(){return{loaded:!1,images:[]}},created(){k.on("cloudImageUpdated",this.getCloudImages)},beforeUnmount(){k.off("cloudImageUpdated",this.getCloudImages)},async mounted(){await this.getCloudImages()},watch:{async"$route.params.id"(){this.$route.params.id&&await Promise.all([this.getCloudImages()])}},methods:{getElapsedTime(c){return A(c)},async getCloudImages(){this.images=await N(this.$route.params.id),this.loaded=!0}},components:{TableListHeader:V,TableList:E,BaseParagraph:w,LinkCodeRepo:Q}},Z={key:1,class:"flex flex-column mt-48px"},ee={class:"thead mobile_hidden"},oe={class:"tr"},te={class:"tbody"},se=t("div",{class:"td mobile_max-w-full mobile_w-full w-5p max-w-0 mobile_border-b-0 collapsing text-center"},[t("i",{class:"icon icon-docker text-carbon-60"})],-1),ae={class:"td mobile_max-w-full mobile_w-full w-30p max-w-0 mobile_border-b-0 collapsing"},le={class:"td mobile_max-w-full mobile_w-full w-10p max-w-0 mobile_border-b-0 collapsing"},ne={class:"td mobile_max-w-full mobile_w-full w-10p max-w-0 mobile_border-b-0 collapsing"};function ie(c,r,g,y,u,l){const _=a("XPreloader"),n=a("TableListHeader"),p=a("BaseParagraph"),h=a("LinkCodeRepo"),b=a("RouterLink"),C=a("TableList");return u.loaded?(d(),R("div",Z,[o(C,null,{default:e(()=>[t("div",ee,[t("div",oe,[o(n,null,{default:e(()=>[s("Type")]),_:1}),o(n,null,{default:e(()=>[s("Image name")]),_:1}),o(n,null,{default:e(()=>[s("Open issues")]),_:1}),o(n,null,{default:e(()=>[s("Linked repo")]),_:1}),o(n,null,{default:e(()=>[s("Last Activity")]),_:1})])]),t("div",te,[(d(!0),R(L,null,H(u.images,i=>(d(),m(b,{key:i.id,class:"tr mobile_flex mobile_flex-col clickable",to:`/container/${i.id}`},{default:e(()=>[se,t("div",ae,[o(p,{class:"truncate"},{default:e(()=>[s(f(i.cloud_repo_name),1)]),_:2},1024)]),t("div",le,[o(p,{class:"truncate"},{default:e(()=>[s(f(i.open_issue_count),1)]),_:2},1024)]),t("div",{class:U(["td mobile_max-w-full mobile_w-full w-30p max-w-0 mobile_border-b-0 collapsing",{"py-2px":!i.code_repo_name}])},[i.code_repo_name?(d(),m(p,{key:0,class:"truncate"},{default:e(()=>[s(f(i.code_repo_name),1)]),_:2},1024)):(d(),m(h,{key:1,cloudRepo:i},null,8,["cloudRepo"]))],2),t("div",ne,[o(p,{class:"truncate"},{default:e(()=>[s(f(this.getElapsedTime(i.created_at)),1)]),_:2},1024)])]),_:2},1032,["to"]))),128))])]),_:1})])):(d(),m(_,{key:0,class:"supercenter",theme:"transparent"}))}const _e=x(Y,[["render",ie]]);export{_e as default};
