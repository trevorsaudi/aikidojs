import{bF as _,an as r,aV as y,bO as g,bP as f,bQ as m}from"./index-13ff96f4.js";const e=_({});function S(o){var i,l;const{type:t,repositoryId:s,domainId:u,containerId:a,progress:c}=o,n=p(s,u,a);if(t==="progress"){const E=(i=e.value[n])==null?void 0:i.status,v=(l=e.value[n])==null?void 0:l.progress;if(E==="completed"&&c>=50||c<v&&v!==100)return;e.value={...e.value,[n]:{status:"scanning",progress:c}}}else t==="completed"?(e.value={...e.value,[n]:{status:"completed",progress:100}},r.emit("dastScanCompleted")):t==="failure"&&(e.value={...e.value,[n]:{status:"completed",progress:100}})}function d(o){var c,n;const{type:t,domain_id:s,progress:u}=o,a=p(-1,s);if(t==="progress_update"){const i=(c=e.value[a])==null?void 0:c.status,l=(n=e.value[a])==null?void 0:n.progress;if(i==="completed"&&u>=50||u<l&&l!==100)return;e.value={...e.value,[a]:{status:"scanning",progress:u}}}else t==="completed"?(e.value={...e.value,[a]:{status:"completed",progress:100}},r.emit("dastScanCompleted")):t==="failure"&&(e.value={...e.value,[a]:{status:"completed",progress:100}})}function p(o=-1,t=-1,s=-1){return`[repo:${o}][domain:${t}][cotainer:${s}]`}r.on("organisationChanged",()=>{e.value={}});function C(o,t){const s=p(o,t),u=y(()=>e.value[s]??null);return{removeListener:()=>{r.off(g,S),r.off(f,d),r.off(m,d)},addListener:()=>{r.on(g,S),r.on(f,d),r.on(m,d)},scanningProgress:u,registerScanStartedEvent:()=>{e.value={...e.value,[s]:{status:"scanning",progress:5}}},registerScanStoppedEvent:()=>{e.value={...e.value,[s]:{status:"stopped"}}}}}export{C as u};
