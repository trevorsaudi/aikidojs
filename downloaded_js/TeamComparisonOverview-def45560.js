import{_ as C,B as P,r as l,q as c,m,k as v,n as r,o as i,w as a,s as p,u as h,H as A,d as $,a1 as F,dv as E,X as M,p as k,F as b,t as R,S as L,c7 as z,fj as V,a_ as j}from"./index-13ff96f4.js";import{P as q}from"./PageHeader-46c38a32.js";import{r as X}from"./reports-ed4978a9.js";import{B as N}from"./BulletPoint-1404881f.js";import{P as H}from"./PieChart-d893d03a.js";import{M as G}from"./MiniStatsCard-7a2dcbd6.js";import{A as U}from"./ActionMenu-3e4470bf.js";import{F as W}from"./FilterButton-bb5393a7.js";import{O as Y}from"./OverviewEmptyState-c8440b9c.js";import{G as K}from"./GenericIllustration-4aca88e5.js";import"./transform-c376ec3f.js";import"./arc-12e4470a.js";const J=e=>new Promise(t=>setTimeout(t,e)),Q=async(e,t,o)=>{try{const n=await e();t(n)}catch(n){o(n)}};class Z{constructor(t){this.interval=t,this.queue=[],this.running=!1}async queueRequest(t){return new Promise(async(o,n)=>{if(this.queue.push({request:t,resolve:o,reject:n}),!this.running){for(this.running=!0;this.queue.length>0;){const{request:d,resolve:s,reject:u}=this.queue.shift();Q(d,s,u),await J(this.interval)}this.running=!1}})}}const ee=new Z(1e3),te={props:{countBySeverity:Object},components:{MiniStatsCard:G,PieChart:H,BaseParagraph:P,BulletPoint:N},computed:{totalCount(){return Object.values(this.countBySeverity).reduce((e,t)=>e+t,0)},criticalCount(){return this.countBySeverity.CRITICAL??0},highCount(){return this.countBySeverity.HIGH??0},mediumCount(){return this.countBySeverity.MEDIUM??0},lowCount(){return this.countBySeverity.LOW??0},chartValues(){return[{value:this.lowCount,key:"lowCount",color:"#00c07d"},{value:this.mediumCount,key:"mediumCount",color:"#0090ff"},{value:this.highCount,key:"highCount",color:"#ff9715"},{value:this.criticalCount,key:"criticalCount",color:"#ff4a3e"}]}}},se={class:"flex gap-16px"},oe={key:1,class:"icon icon-tick-circle text-surface-green-100 text-76px leading-76px"},ie={key:2,class:"flex gap-4px align-center max-w-250px"},ne={class:"flex flex-column flex-grow gap-4px"},re={class:"flex align-center gap-8px"},ae={class:"flex align-center gap-8px"},ce={class:"flex flex-column flex-grow gap-4px"},le={class:"flex align-center gap-8px"},de={class:"flex align-center gap-8px"},ue={key:3,class:"flex flex-wrap gap-8px align-center"};function _e(e,t,o,n,d,s){const u=l("PieChart"),_=l("BulletPoint"),f=l("BaseParagraph");return c(),m("div",se,[s.totalCount>0?(c(),v(u,{key:0,data:s.chartValues,thickness:8,class:"w-76px"},null,8,["data"])):(c(),m("i",oe)),s.totalCount>0?(c(),m("div",ie,[r("div",ne,[r("div",re,[i(_,{size:"medium",color:"#ff4a3e"}),i(f,{class:"ws-nowrap",size:"medium"},{default:a(()=>[p(h(e.$t("X_CRITICAL",this.criticalCount)),1)]),_:1})]),r("div",ae,[i(_,{size:"medium",color:"#ff9715"}),i(f,{class:"ws-nowrap",size:"medium"},{default:a(()=>[p(h(e.$t("X_HIGH",this.highCount)),1)]),_:1})])]),r("div",ce,[r("div",le,[i(_,{size:"medium",color:"#0090ff"}),i(f,{class:"ws-nowrap",size:"medium"},{default:a(()=>[p(h(e.$t("X_MEDIUM",this.mediumCount)),1)]),_:1})]),r("div",de,[i(_,{size:"medium",color:"#00c07d"}),i(f,{class:"ws-nowrap",size:"medium"},{default:a(()=>[p(h(e.$t("X_LOW",this.lowCount)),1)]),_:1})])])])):(c(),m("div",ue,[i(f,{color:"subdued",class:"ws-nowrap"},{default:a(()=>[p("All issues solved")]),_:1})]))])}const me=C(te,[["render",_e]]),pe={props:{team:Object,metrics:Object},emits:["loaded"],components:{BaseHeading:A,BasePill:$,LoadingSkeleton:F,TeamComparisonIssueTotals:me,BaseParagraph:P,ProgressBar:E,XPreloader:M},data(){return{isLoading:!0}},async mounted(){await this.loadMetrics(),this.isLoading=!1},computed:{showLoadingSpinner(){return this.isLoading||Object.keys(this.metrics??{}).length===0},reports(){var e;return(e=this.metrics)!=null&&e.reports?this.metrics.reports:{soc2:0,iso:0,cis:0,owasp:0}},repositoryCount(){return this.$t("X_REPOS",this.team.linked_repo_count)},cloudCount(){return this.$t("X_CLOUDS",this.team.linked_cloud_count)},memberCount(){return this.$t("X_TEAM_MEMBER",this.team.users.length)},solvedIssueCountVsLastMonth(){var e;return this.metrics?((e=this.metrics.issue_evolution_stats)==null?void 0:e.issues_resolved_vs_last_month)??0:0},createdIssueCountVsLastMonth(){var e;return this.metrics?((e=this.metrics.issue_evolution_stats)==null?void 0:e.issues_introduced_vs_last_month)??0:0}},methods:{async loadMetrics(){const e=await ee.queueRequest(()=>X(this.team.id));this.$emit("loaded",e)},getPercentage(e,t){return Math.round(e/t*100)},getLabelForReport(e){return e==="soc2"?"SOC2":e==="owasp"?"OWASP top 10":e==="cis"?"CIS Controls":"ISO 27001:2022"},getLinkToReport(e){let t="";e==="soc2"&&(t="/reports/soc2"),e==="owasp"&&(t="/reports/owasp"),e==="iso"&&(t="/reports/iso"),e==="cis"&&(t="/reports/cis");const o=new URLSearchParams({filter_team_id:this.team.id});return`${t}?${o.toString()}`}}},he={class:"team-comparison-card"},fe={class:"team-comparison-card__header"},ge=["href"],Se={class:"flex align-center gap-8px mt-2px"},ye=["href"],ve=["href"],Oe=["href"],be={class:"team-comparison-card__body"},Ce={class:"team-comparison-card__issue-evolution"},we={class:"flex flex-column gap-4px"},xe={class:"flex flex-column"},Te={class:"flex flex-column gap-4px"},ke={class:"flex flex-column"},Be={class:"team-comparison-card__reports"};function Ie(e,t,o,n,d,s){var B;const u=l("BaseHeading"),_=l("BasePill"),f=l("XPreloader"),S=l("TeamComparisonIssueTotals"),g=l("BaseParagraph"),w=l("RouterLink"),y=l("LoadingSkeleton"),x=l("ProgressBar");return c(),m("div",he,[r("div",fe,[r("a",{href:`/settings/teams/${o.team.id}`},[i(u,{as:"h4",class:"ws-no-wrap"},{default:a(()=>[p(h(o.team.name),1)]),_:1})],8,ge),r("div",Se,[r("a",{href:`/settings/teams/${o.team.id}`},[i(_,{title:s.memberCount,variation:"gray-fill"},null,8,["title"])],8,ye),r("a",{href:`/settings/teams/${o.team.id}?team_detail_tab=responsibilities`},[i(_,{title:s.repositoryCount,variation:"gray-fill"},null,8,["title"])],8,ve),r("a",{href:`/settings/teams/${o.team.id}?team_detail_tab=responsibilities`},[i(_,{title:s.cloudCount,variation:"gray-fill"},null,8,["title"])],8,Oe)])]),r("div",be,[s.showLoadingSpinner?(c(),v(f,{key:0,theme:"light",size:"medium",class:"supercenter"})):k("",!0),i(S,{class:"team-comparison-card__issue-counts","count-by-severity":((B=o.metrics)==null?void 0:B.open_issue_count_by_severity)??{}},null,8,["count-by-severity"]),r("div",Ce,[r("div",we,[i(g,{class:"team-comparison-card__issue-evolution__stat-count",color:"success"},{default:a(()=>[p(h(s.solvedIssueCountVsLastMonth),1)]),_:1}),r("div",xe,[i(g,{class:"text-center ws-nowrap",size:"medium",color:"success"},{default:a(()=>[p(h(e.$t("ISSUES_SOLVED",s.solvedIssueCountVsLastMonth)),1)]),_:1}),i(g,{class:"text-center",color:"subdued",size:"tiny"},{default:a(()=>[p("last 30 days")]),_:1})])]),r("div",Te,[i(g,{class:"team-comparison-card__issue-evolution__stat-count",color:"warning"},{default:a(()=>[p(h(s.createdIssueCountVsLastMonth),1)]),_:1}),r("div",ke,[i(g,{class:"text-center ws-nowrap",size:"medium",color:"warning"},{default:a(()=>[p(h(e.$t("ISSUES_INTRODUCED",s.createdIssueCountVsLastMonth)),1)]),_:1}),i(g,{class:"text-center",color:"subdued",size:"tiny"},{default:a(()=>[p("last 30 days")]),_:1})])])]),r("div",Be,[(c(!0),m(b,null,R(s.reports,(I,T)=>(c(),m(b,{key:T},[i(w,{to:s.getLinkToReport(T)},{default:a(()=>[i(g,{"semi-bold":""},{default:a(()=>[p(h(s.getLabelForReport(T)),1)]),_:2},1024)]),_:2},1032,["to"]),d.isLoading?(c(),v(y,{key:0})):(c(),v(x,{key:1,progress:s.getPercentage(I.total_complying_rule_count,I.total_rule_count),"progress-position":"right"},null,8,["progress"]))],64))),128))])])])}const Le=C(pe,[["render",Ie]]),O={iso_compliance:"desc",soc2_compliance:"desc",owasp_compliance:"desc",cis_compliance:"desc",open_critical_issues:"asc",net_new_solved_issues:"desc",net_new_introduced_issues:"asc",total_open_issue_count:"asc"},De={props:{selectedSortOption:String,selectedSortDirection:String},components:{FilterButton:W,ActionMenu:U},emits:["sort"],data(){},computed:{hasSelectedSortOption(){return!!this.selectedSortOption},sortOptionLabel(){return this.selectedSortOption?"Sorted by ":"Sort"},selectedOption(){return this.sortOptionLabelsById[this.selectedSortOption]??null},sortDirectionOptions(){return[{title:"Direction",items:[{label:"Good to bad",id:"good_to_bad",onClick:()=>this.handleSelectSortDirection("good_to_bad"),active:this.isSortingDirectionIndicatorActive("good_to_bad")},{label:"Bad to good",id:"bad_to_good",onClick:()=>this.handleSelectSortDirection("bad_to_good"),active:this.isSortingDirectionIndicatorActive("bad_to_good")}]}]},sortOptions(){return[{title:"Options",action:{label:"Clear",onClick:()=>this.$emit("sort",{by:null,direction:null})},items:[{label:"ISO compliance",id:"iso_compliance",onClick:()=>this.handleSelectSortOption("iso_compliance"),active:this.selectedSortOption==="iso_compliance"},{label:"SOC2 compliance",id:"soc2_compliance",onClick:()=>this.handleSelectSortOption("soc2_compliance"),active:this.selectedSortOption==="soc2_compliance"},{label:"CIS compliance",id:"cis_compliance",onClick:()=>this.handleSelectSortOption("cis_compliance"),active:this.selectedSortOption==="cis_compliance"},{label:"OWASP top 10 compliance",id:"owasp_compliance",onClick:()=>this.handleSelectSortOption("owasp_compliance"),active:this.selectedSortOption==="owasp_compliance"},{label:"Open issue count",id:"total_open_issue_count",onClick:()=>this.handleSelectSortOption("total_open_issue_count"),active:this.selectedSortOption==="total_open_issue_count"},{label:"Open critical issues",id:"open_critical_issues",onClick:()=>this.handleSelectSortOption("open_critical_issues"),active:this.selectedSortOption==="open_critical_issues"},{label:"Net new solved issues",id:"net_new_solved_issues",onClick:()=>this.handleSelectSortOption("net_new_solved_issues"),active:this.selectedSortOption==="net_new_solved_issues"},{label:"Net new introduced issues",id:"net_new_introduced_issues",onClick:()=>this.handleSelectSortOption("net_new_introduced_issues"),active:this.selectedSortOption==="net_new_introduced_issues"}]}]},sortOptionLabelsById(){return this.sortOptions[0].items.reduce((e,t)=>({[t.id]:t.label,...e}),{})},showSortDirectionFilter(){return!!this.selectedSortOption},sortDirectionFilterLabel(){const e=this.sortDirectionOptions[0].items.find(t=>t.active);return(e==null?void 0:e.id)==="bad_to_good"?"Sorted from bad to good":"Sorted from good to bad"}},methods:{handleSelectSortOption(e){if(e===this.selectedSortOption){this.$emit("sort",{by:null,direction:null});return}this.$emit("sort",{by:e,direction:this.getAdjustedDirectionForOption(e)})},handleSelectSortDirection(e){if(e==="good_to_bad"){let o=O[this.selectedSortOption]??"desc";return this.$emit("sort",{by:this.selectedSortOption,direction:o})}return O[this.selectedSortOption]==="desc"?this.$emit("sort",{by:this.selectedSortOption,direction:"asc"}):this.$emit("sort",{by:this.selectedSortOption,direction:"desc"})},isSortingDirectionIndicatorActive(e){const t=O[this.selectedSortOption];return e==="good_to_bad"?t===this.selectedSortDirection:t!==this.selectedSortDirection},getAdjustedDirectionForOption(e){const t=O[e];if(!this.selectedSortOption)return t;const o=O[this.selectedSortOption];return t===o?this.selectedSortDirection:this.selectedSortDirection==="desc"?"asc":"desc"}}},Pe={class:"flex align-center gap-8px"},Me={key:0},Re={class:"text-primary-aik-100"},Ae={key:1},$e=r("i",{class:"icon icon-caret_down icon-12px"},null,-1);function Fe(e,t,o,n,d,s){const u=l("i18n-t"),_=l("FilterButton"),f=l("ActionMenu");return c(),m("div",Pe,[i(f,{sections:s.sortOptions,placement:"bottom-start"},{trigger:a(S=>[i(_,{onClick:S.toggle,class:L({"filter-button--active":s.hasSelectedSortOption})},{default:a(()=>[s.hasSelectedSortOption?(c(),m("span",Me,[i(u,{keypath:"TEAM_COMPARISON.REPORT.SORT.SORT_BY"},{option:a(()=>[r("span",Re,h(s.selectedOption),1)]),_:1})])):(c(),m("span",Ae,h(s.sortOptionLabel),1)),$e]),_:2},1032,["onClick","class"])]),_:1},8,["sections"]),i(f,{sections:s.sortDirectionOptions,placement:"bottom-start"},z({_:2},[s.showSortDirectionFilter?{name:"trigger",fn:a(S=>[i(_,{onClick:S.toggle,class:L({"filter-button--active":s.hasSelectedSortOption})},{default:a(()=>[p(h(s.sortDirectionFilterLabel),1)]),_:2},1032,["onClick","class"])]),key:"0"}:void 0]),1032,["sections"])])}const Ee=C(De,[["render",Fe]]);function ze(e,t,o){if(!t)return e;const n=Ve(e,o);return t==="iso_compliance"?n(["reports","iso","total_complying_rule_count"]):t==="soc2_compliance"?n(["reports","soc2","total_complying_rule_count"]):t==="owasp_compliance"?n(["reports","owasp","total_complying_rule_count"]):t==="cis_compliance"?n(["reports","cis","total_complying_rule_count"]):t==="open_critical_issues"?n(["open_issue_count_by_severity","CRITICAL"]):t==="net_new_solved_issues"?n(["issue_evolution_stats","issues_resolved_vs_last_month"]):t==="net_new_introduced_issues"?n(["issue_evolution_stats","issues_introduced_vs_last_month"]):t==="total_open_issue_count"?je(e,o):e}function Ve(e,t){return o=>e.sort((n,d)=>{const s=D(o,n),u=D(o,d);return s===null||u===null?-1:t==="asc"?s-u:u-s})}function je(e,t){return e.sort((o,n)=>{const d=Object.values(o.open_issue_count_by_severity??{}).reduce((u,_)=>u+_,0),s=Object.values(n.open_issue_count_by_severity??{}).reduce((u,_)=>u+_,0);return t==="asc"?d-s:s-d})}function D(e,t){return e.reduce((o,n)=>o?o[n]??null:null,t)}const qe={components:{GenericIllustration:K,OverviewEmptyState:Y,TeamComparisonSort:Ee,XPreloader:M,PageHeader:q,TeamComparisonCard:Le},data(){return{isLoading:!0,teamsById:{},sortedTeams:[],metrics:{},sortBy:null,sortDirection:null}},async mounted(){await this.loadTeams(),this.isLoading=!1},computed:{breadcrumbs(){return[{label:"Reports",href:"/reports"},{label:"Team comparison"}]},hasTeams(){return!this.isLoading&&this.sortedTeams.length>0}},methods:{async loadTeams(){const e=await V();this.teamsById=e.reduce((t,o)=>({[o.id]:o,...t}),{}),this.metrics=e.reduce((t,o)=>({[o.id]:{team_id:o.id},...t}),{}),this.sortedTeams=e.sort((t,o)=>o.open_issue_count-t.open_issue_count),this.sortBy="total_open_issue_count",this.sortDirection="desc"},handleLoadMetrics(e,t){this.metrics[e]=t,this.sortBy!==null&&this.handleSortTeams({by:this.sortBy,direction:this.sortDirection})},handleSortTeams(e){this.sortBy=e.by,this.sortDirection=e.direction,e.by||(this.sortedTeams=this.teams,this.sortDirection="desc");const t=ze(Object.values(this.metrics),e.by,e.direction),o=[];for(const n of t)o.push(this.teamsById[n.team_id]);this.sortedTeams=o},handleAddTeam(){this.$router.push("/settings/teams")}}},Xe={class:"page-content"},Ne={key:0,class:"mb-24px"},He={class:"grid grid-cols-1 gap-24px"},Ge={key:1,class:"bg-white flex w-full bg-white border-carbon-20 overflow-hidden rounded-8px"};function Ue(e,t,o,n,d,s){const u=l("PageHeader"),_=l("XPreloader"),f=l("TeamComparisonSort"),S=l("TeamComparisonCard"),g=l("GenericIllustration"),w=l("OverviewEmptyState");return c(),m(b,null,[i(u,{breadcrumbs:s.breadcrumbs,title:"Team comparison report"},null,8,["breadcrumbs"]),r("div",Xe,[d.isLoading?(c(),v(_,{key:0,class:"absolute-centered",theme:"transparent"})):(c(),m(b,{key:1},[s.hasTeams?(c(),m("div",Ne,[i(f,{"selected-sort-option":d.sortBy,"selected-sort-direction":d.sortDirection,onSort:s.handleSortTeams},null,8,["selected-sort-option","selected-sort-direction","onSort"])])):k("",!0),r("div",He,[i(j,{name:"team-comparison-list"},{default:a(()=>[(c(!0),m(b,null,R(d.sortedTeams,y=>(c(),v(S,{key:y.id,team:d.teamsById[y.id],metrics:d.metrics[y.id],onLoaded:x=>s.handleLoadMetrics(y.id,x)},null,8,["team","metrics","onLoaded"]))),128))]),_:1})]),s.hasTeams?k("",!0):(c(),m("div",Ge,[i(w,{title:"No teams found",description:"It looks like you did not add or import any teams yet.",actionLabel:"Add team",variation:"empty",onOnAction:s.handleAddTeam},{default:a(()=>[i(g)]),_:1},8,["onOnAction"])]))],64))])],64)}const rt=C(qe,[["render",Ue]]);export{rt as default};
