import{_ as F,r as i,q as o,k as u,w as n,o as r,s as h,n as c,cr as C,u as I,S as k,d as O,f as R,B as M,I as U,a2 as V,cq as y,an as S,a3 as T,fp as q,cu as D,dV as N,cs as H,m as b,F as X,p,ah as z}from"./index-13ff96f4.js";import{u as j}from"./useInstanceGroupScanningProgress-7091a8e2.js";import{b as Y}from"./dateFns-a344cb79.js";import{P as K}from"./PageHeader-46c38a32.js";import{Q as W}from"./QueueTable-de6aabd1.js";import{Q as J}from"./QueueSidebar-47492277.js";import{A as E}from"./ActionMenu-3e4470bf.js";import{F as v}from"./FilterButton-bb5393a7.js";import{Q as Z}from"./QueueQuickFilter-70881bd4.js";import"./index-b87db690.js";import"./DataTableCell-51c0104f.js";import"./IssueGroupSeverityColumn-7631c77a.js";import"./SidebarActionMenu-1bf6804b.js";import"./CreateAutoFixProgressFlow-8111d22c.js";import"./RadioButtonList-1d4cdaad.js";import"./EnableIntegrationModal-48b01f56.js";import"./focusModePreference-150f170e.js";import"./TableListHeader-e50d01d1.js";import"./DataTable-e31a825a.js";import"./BaseRadioInput-a7ac3557.js";import"./BaseLabel-a1c0ca00.js";import"./AIText-891d4f7b.js";import"./InputCheckbox-81cb3ca6.js";import"./BreakSlashes-925eef0e.js";import"./UnignoreIssue-5dff8957.js";import"./CreateTicketModal-c14deeb1.js";import"./ManualInputSearchDropdown-6a7ece3e.js";import"./InputSearchDropdown-02988f6b.js";import"./repoName-872812ed.js";import"./taskTrackerNaming-55adac3e.js";import"./taskTrackerIcon-504ea566.js";import"./autofixable-c6560249.js";import"./autofixSastIssues-779ec5b4.js";import"./lock-files-cdbb050f.js";import"./BaseCodeBlock-cec75629.js";import"./string-814c5ffd.js";import"./ButtonMultiOption-12e505fb.js";import"./transform-c376ec3f.js";import"./linear-efb37b7f.js";import"./arc-12e4470a.js";import"./BaseForm-4c6fa06f.js";import"./XTabs-d492da26.js";import"./BaseCard-471d3203.js";import"./AccordionContainer-09dc0ed4.js";import"./trycatch-83445d5b.js";import"./licenses-6ab38515.js";import"./BaseStatusLabel-0ccd2806.js";import"./DataTableSeverityIndicator-48ffb8dc.js";import"./IssueGroupTypeColumn-03f014b0.js";import"./BracesIcon-0a8568f4.js";import"./BoxIcon-9908469f.js";import"./StackedAvatars-4925baeb.js";import"./languages-12749071.js";const $={components:{ActionMenu:E,FilterButton:v},emits:["refresh"],props:{instanceGroupId:[Number,String],cloudId:[Number,String]},data(){return{showIssuesExportModal:!1}},computed:{canExportSbom(){return!this.$groupUser.only_team_related_issues},actions(){return[{title:"Actions",items:[{label:"Refresh",onClick:()=>this.$emit("refresh"),icon:"icon-refresh"},{visible:this.canExportSbom,label:"Export Raw SBOM",onClick:this.handleSBOMExport,icon:"icon-download"}].filter(l=>l.visible!==!1)}]}},methods:{handleSBOMExport(){this.$modal.show("CloudInstanceGroupExportSbomModal",{instanceGroupId:this.instanceGroupId,cloudId:this.cloudId})}}},ee=c("i",{class:"icon icon-caret_down icon-12px"},null,-1);function te(e,l,_,g,s,t){const m=i("FilterButton"),a=i("ActionMenu");return o(),u(a,{sections:t.actions,placement:"bottom-end",useBaseIcon:!0},{trigger:n(d=>[r(m,{onClick:()=>d.toggle()},{default:n(()=>[h(" Actions "),ee]),_:2},1032,["onClick"])]),_:1},8,["sections"])}const se=F($,[["render",te]]),ie={components:{ActionMenu:E,FilterButton:v},props:{initialRelatedTypeFilter:String},data(){return{relatedTypeFilter:this.initialRelatedTypeFilter}},emits:["filterSelected"],computed:{label(){return this.relatedTypeFilter?this.$t("QUEUE.QUICK_FILTER.LABEL",{filter:this.$t(`QUEUE.FILTER.LABEL_SHORTHAND.${this.relatedTypeFilter}`)}):"All types"},actions(){return[{title:this.$t("QUEUE.TYPE_FILTER.TITLE"),action:{label:"Clear filter",onClick:()=>this.handleClearFilter()},items:[{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.OPEN_SOURCE_ISSUES"),onClick:()=>this.handleToggleTypeFilter("open_source"),icon:"icon-box",active:this.isActive("open_source")},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.EOL_ISSUES"),onClick:()=>this.handleToggleTypeFilter("eol"),icon:"icon-eol",active:this.isActive("eol")}]}]},hasFilter(){return!!this.relatedTypeFilter}},methods:{isActive(e){return this.relatedTypeFilter===e},handleClearFilter(){this.relatedTypeFilter=void 0,this.emitSelectedFilter()},handleToggleTypeFilter(e){this.relatedTypeFilter===e?this.relatedTypeFilter=void 0:this.relatedTypeFilter=e,this.emitSelectedFilter()},emitSelectedFilter(){this.$emit("filterSelected",{relatedType:this.relatedTypeFilter}),C({relatedTypeFilter:this.relatedTypeFilter})}}},re=c("i",{class:"icon icon-caret_down icon-12px"},null,-1);function ne(e,l,_,g,s,t){const m=i("FilterButton"),a=i("ActionMenu");return o(),u(a,{sections:t.actions,placement:"bottom-start",useBaseIcon:!0},{trigger:n(d=>[r(m,{onClick:d.toggle,class:k({"filter-button--active":t.hasFilter})},{default:n(()=>[h(I(t.label)+" ",1),re]),_:2},1032,["onClick","class"])]),_:1},8,["sections"])}const le=F(ie,[["render",ne]]),ae={components:{PageHeader:K,BasePill:O,BaseButton:R,BaseParagraph:M,InputSearch:U,QueueSidebar:J,QueueTable:W,QueueQuickFilter:Z,CloudInstanceGroupDetailPageActions:se,XTooltip:V,CloudInstanceIssueTypeFilter:le},data(){return{details:null,isLoadingDetails:!0,isLoadingIssues:!0,groupedIssues:[],searchTerm:y("search",""),quickFilter:y("filter",void 0),issueTypeFilter:y("type_filter","")}},setup(){const{addListener:e,removeListener:l,registerInstanceGroup:_,scanningProgress:g}=j();return{addListener:e,removeListener:l,registerInstanceGroup:_,scanningProgress:g}},async mounted(){await Promise.allSettled([this.loadDetails(),this.loadIssues()]),this.isLoadingIssues=!1,this.addListener(),this.registerInstanceGroup(this.details.external_id),S.on("virtualMachineScanCompleted",this.loadIssues)},beforeUnmount(){S.off("virtualMachineScanCompleted",this.getAllInstanceGroups),this.removeListener()},computed:{cloudId(){return this.$route.params.cloud_id},instanceGroupId(){return this.$route.params.instance_group_id},breadcrumbs(){return[{label:"Clouds"},{label:this.details.cloud_name,href:`/clouds/${this.cloudId}`},{label:"Virtual machines",href:`/clouds/${this.cloudId}/virtual-machines`},{label:this.details.name}]},title(){var e;return((e=this.details)==null?void 0:e.name)??"Virtual Machine"},subTitle(){return`${this.groupedIssues.length} issues`},nextScanTime(){var e;return(e=this.details)!=null&&e.next_scan_at?`Next scan on ${T.fromUnix(this.details.next_scan_at).format(T.SHORT_DATE_FORMAT)}`:null},lastScannedAt(){var e;return(e=this.details)!=null&&e.last_scanned_at?`Last scan ${Y(this.details.last_scanned_at)} ago`:"No scans just yet"},showEmptyState(){return this.isLoadingIssues?!1:this.groupedIssues.length==0},hasActiveFilter(){return!!(this.searchTerm||this.quickFilter||this.issueTypeFilter)},instanceOsVersion(){return!this.details.instance_os&&!this.details.instance_os_version?null:[this.details.instance_os,this.details.instance_os_version].filter(Boolean).join(" - ")},isScanning(){var e;return this.scanningProgress?((e=this.scanningProgress)==null?void 0:e.status)==="scanning":!1},scanningProgressValue(){var e;return(e=this.scanningProgress)==null?void 0:e.progress}},methods:{async loadDetails(){this.details=await q(this.cloudId,this.instanceGroupId),this.isLoadingDetails=!1},async loadIssues(){this.groupedIssues=await D({filter_instance_group_id:this.instanceGroupId,quick_filter:this.quickFilter,search_term:this.searchTerm,issue_type_filter:this.issueTypeFilter})},async handleStartScan(){await N(this.cloudId,this.instanceGroupId),this.$toast.success({title:"Scan started successfully",description:"A scan was successfully triggered for this virtual machine. We'll report back the results soon"})},async onQueueQuickFilterSelected(e){this.quickFilter=e.quickFilter,this.$globalLoadingIndicator.show();try{await this.loadIssues()}finally{this.$globalLoadingIndicator.hide()}},async onSearchTermChanged(){this.$globalLoadingIndicator.show();try{C({search:this.searchTerm}),await this.loadIssues()}finally{this.$globalLoadingIndicator.hide()}},async onItemSelected(e){H.replace({path:this.$route.path,query:{...this.$route.query,sidebarIssue:e.id}})},handleDownloadSbom(){this.$modal.show("CloudInstanceGroupExportSbomModal",{instanceGroupId:this.instanceGroupId,cloudId:this.cloudId})},async handleRefreshIssues(){this.$globalLoadingIndicator.show();try{await this.loadIssues()}finally{this.$globalLoadingIndicator.hide()}},async onIssueTypeFilterSelected(e){this.issueTypeFilter=e.relatedType,this.isLoadingIssues=!0,await this.loadIssues(),this.isLoadingIssues=!1},handleOpenEditCloudInstanceGroupPurposeModal(){this.$modal.show("EditCloudInstanceGroupPurposeModal",{cloudId:this.details.cloud_id,instanceGroup:this.details})}}},oe={class:"flex gap-8px"},ce={key:0,class:"loading-overlay"},ue=c("div",{class:"shimmer shimmer--purple shimmer--rtl"},null,-1),de=[ue],pe=c("i",{class:"icon icon-calender icon-12px valign-middle ml-8px"},null,-1),he={class:"page-content"},me={class:"flex align-center justify-between gap-16px mb-16px"},_e={class:"flex align-center gap-12px flex-1 w-full"};function ge(e,l,_,g,s,t){const m=i("XPreloader"),a=i("BasePill"),d=i("XTooltip"),w=i("BaseParagraph"),G=i("PageHeader"),x=i("InputSearch"),P=i("CloudInstanceIssueTypeFilter"),A=i("QueueQuickFilter"),L=i("CloudInstanceGroupDetailPageActions"),Q=i("QueueTable"),B=i("QueueSidebar");return s.isLoadingDetails?(o(),u(m,{key:0,class:"supercenter",theme:"transparent"})):(o(),b(X,{key:1},[r(G,{breadcrumbs:t.breadcrumbs,title:t.title},{subTitle:n(()=>[c("div",oe,[r(a,{title:t.subTitle,variation:"green"},null,8,["title"]),s.details.cloud_purpose=="mixed"?(o(),u(a,{key:0,title:s.details.environment,variation:"gray-fill",class:"cursor-pointer",onClick:t.handleOpenEditCloudInstanceGroupPurposeModal},null,8,["title","onClick"])):p("",!0),t.instanceOsVersion?(o(),u(a,{key:1,title:t.instanceOsVersion,variation:"gray-fill"},null,8,["title"])):p("",!0),r(a,{variation:"gray-fill",title:s.details.region},null,8,["title"]),r(a,{variation:"gray-fill",title:e.$t("X_VM_INSTANCES",s.details.instance_count)},{default:n(()=>[s.details.latest_instance_id?(o(),u(d,{key:0},{default:n(()=>[h(I(s.details.latest_instance_id),1)]),_:1})):p("",!0)]),_:1},8,["title"]),s.details.hard_drive_size_in_gb>0?(o(),u(a,{key:2,variation:"gray-fill",title:`Hard drive: ${s.details.hard_drive_size_in_gb}GB`},null,8,["title"])):p("",!0)])]),rightContent:n(()=>[c("button",{class:k(["button-brand button--primary button--rounded button--normal button--border button--with-progress",[t.isScanning&&"button--in-progress"]]),onClick:l[0]||(l[0]=(...f)=>t.handleStartScan&&t.handleStartScan(...f))},[t.isScanning?(o(),b("div",ce,[c("div",{class:"loading-bar",style:z({width:`${t.scanningProgressValue}%`})},de,4)])):p("",!0),h(" Start scan ")],2)]),footerRightContent:n(()=>[t.lastScannedAt?(o(),u(w,{key:0,color:"subdued"},{default:n(()=>[h(I(t.lastScannedAt)+" ",1),pe,r(d,null,{default:n(()=>[h(I(t.nextScanTime),1)]),_:1})]),_:1})):p("",!0)]),_:1},8,["breadcrumbs","title"]),c("div",he,[c("div",me,[c("div",_e,[r(x,{modelValue:s.searchTerm,"onUpdate:modelValue":[l[1]||(l[1]=f=>s.searchTerm=f),t.onSearchTermChanged],spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),r(P,{refreshQueryParams:!1,onFilterSelected:t.onIssueTypeFilterSelected,initialRelatedTypeFilter:s.issueTypeFilter},null,8,["onFilterSelected","initialRelatedTypeFilter"]),r(A,{onFilterSelected:t.onQueueQuickFilterSelected,hideCriticalOption:!0,hideNewOption:!0,hideLanguageFilter:!0,hideAttackSurfaceFilters:!0,"initial-filter":s.quickFilter,persistFilterToQueryParams:!0},null,8,["onFilterSelected","initial-filter"]),r(L,{class:"ml-auto",onRefresh:t.handleRefreshIssues,instanceGroupId:t.instanceGroupId,cloudId:t.cloudId},null,8,["onRefresh","instanceGroupId","cloudId"])])]),r(Q,{onItemClicked:t.onItemSelected,groupedIssues:s.groupedIssues,isLoading:s.isLoadingIssues,showEmptyState:t.showEmptyState,hasActiveFilter:t.hasActiveFilter,quickFilter:s.quickFilter,filterInstanceGroupId:parseInt(t.instanceGroupId)},null,8,["onItemClicked","groupedIssues","isLoading","showEmptyState","hasActiveFilter","quickFilter","filterInstanceGroupId"]),r(B,{groupedIssues:s.groupedIssues,filterInstanceGroupId:parseInt(t.instanceGroupId),showClosedOnly:s.quickFilter=="closed",showIgnoredOnly:s.quickFilter==="ignored",filterOutOfSla:s.quickFilter==="out_of_sla",filterDueSoon:s.quickFilter==="due_soon"},null,8,["groupedIssues","filterInstanceGroupId","showClosedOnly","showIgnoredOnly","filterOutOfSla","filterDueSoon"])])],64))}const gt=F(ae,[["render",ge]]);export{gt as default};
