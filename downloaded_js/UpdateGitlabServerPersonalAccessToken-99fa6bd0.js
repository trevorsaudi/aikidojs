import{u as k}from"./gitlabServer-f1adde30.js";import{_ as f,eB as b,eA as E,V as N,f as I,a3 as p,cc as O,r as i,k as A,w as r,q as u,o as n,n as s,u as a,s as o,m as R,p as x}from"./index-13ff96f4.js";import{O as C}from"./OnboardingProgressIndicator-8fa4a42d.js";const B={components:{OnboardingPage:b,OnboardingSection:E,OnboardingProgressIndicator:C,InputText:N,BaseButton:I},data(){return{accessToken:void 0,isUpdateingToken:!1,isLoading:!0,personalAccessToken:null,externalDirectLink:null}},async mounted(){var e;if(((e=this.$group)==null?void 0:e.scm_type)!="gitlab_server"){this.$toast.error("This page is only available for Gitlab Self-Managed workspaces."),this.$router.push("/settings");return}await this.getAccountInfo(),this.isLoading=!1},computed:{inputIsValid(){return!!this.accessToken&&this.accessToken.trim()!==""},personalAccessTokenDetails(){if(!this.personalAccessToken)return;const e=p.fromUnix(this.personalAccessToken.last_updated_at).format(p.US_FRIENDLY_DATE_WITH_TIME);return!this.personalAccessToken||this.personalAccessToken.last_updated_by_id<1?`Last updated at ${e}`:`Last updated by ${this.personalAccessToken.last_updated_by_name} at ${e}`}},methods:{async handleUpdate(){this.isUpdateingToken=!0;try{await k(this.accessToken),this.$toast.success("Your Gitlab Server's personal access token has been updated."),go("/settings/account"),this.isUpdateingToken=!1}catch(e){throw this.isUpdateingToken=!1,e}},async getAccountInfo(){const e=await O();this.personalAccessToken=e.personal_access_token??null,e.scm_org_base_url&&(this.externalDirectLink=e.scm_org_base_url+"/-/user_settings/personal_access_tokens")}}},S=s("img",{class:"",src:"https://cdn.aikido.dev/assets/logo-white.svg?v=2",width:"180"},null,-1),V={class:"onboarding__title mb-36px mt-64px text-white"},L={class:"onboarding__paragraph onboarding__paragraph--size-large text-carbon-20"},D={class:"onboarding__title text-primary-aik-140 mb-8px"},G={class:"onboarding__paragraph onboarding__paragraph--size-medium text-carbon-60"},y=s("br",null,null,-1),v=s("a",{class:"link",href:"https://help.aikido.dev/en/articles/7155491-how-to-connect-your-gitlab-self-managed-server-to-aikido",target:"_BLANK"},"read our guide",-1),w={class:"mb-16px mt-32px gap-32px flex flex-column"},U={class:"flex gap-12px flex-column"},P={class:"flex w-full justify-between"},$=["href"],M=s("i",{class:"icon icon-openLink icon-12px text--normal"},null,-1),z={class:"onboarding__title text-primary-aik-140"},j={class:"flex mt-auto gap-16px justify-end"};function K(e,l,Y,q,t,c){const g=i("OnboardingProgressIndicator"),d=i("OnboardingSection"),_=i("InputText"),m=i("BaseButton"),h=i("OnboardingPage");return u(),A(h,null,{default:r(()=>[n(d,{"align-content":"bottom",theme:"dark",class:"onboarding__section__content"},{default:r(()=>[S,s("h1",V,a(e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_SERVER.TITLE")),1),s("p",L,a(e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_SERVER.DESCRIPTION")),1),n(g,{"number-of-completed-steps":1,"number-of-steps":1})]),_:1}),n(d,{"is-loading":t.isLoading,"align-content":"top",theme:"light",class:"onboarding__section__content"},{default:r(()=>[s("h4",D,a(e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_SERVER.CONNECT.TITLE")),1),s("p",G,[o(a(e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_SERVER.CONNECT.DESCRIPTION"))+" ",1),y,o("To learn where you can find this information, "),v,o(". ")]),s("div",w,[n(_,{disabled:"",modelValue:e.$group.name,name:"organization_name",class:"onboarding__input",placeholder:"ACME Dev Team",title:e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_SERVER.CONNECT.ORGANIZATION_NAME.LABEL")},null,8,["modelValue","title"]),s("div",U,[n(_,{modelValue:t.accessToken,"onUpdate:modelValue":l[0]||(l[0]=T=>t.accessToken=T),name:"personal_access_token",class:"onboarding__input",placeholder:"accesstoken123"},{title:r(()=>[s("span",P,[o(a(e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_SERVER.CONNECT.ACCESS_TOKEN.LABEL"))+" ",1),t.externalDirectLink?(u(),R("a",{key:0,href:t.externalDirectLink,target:"_blank",class:"link flex gap-4px align-center mt-2px"},[o(" Generate Gitlab Self-Managed token here"),M],8,$)):x("",!0)])]),_:1},8,["modelValue"]),s("h5",z,a(c.personalAccessTokenDetails),1)])]),s("div",j,[n(m,{onClicked:c.handleUpdate,size:"large",disabled:!c.inputIsValid,"is-loading":t.isUpdateingToken},{default:r(()=>[o("Update")]),_:1},8,["onClicked","disabled","is-loading"])])]),_:1},8,["is-loading"])]),_:1})}const Z=f(B,[["render",K]]);export{Z as default};
