import{_ as M,H as V,f as x,B as F,M as R,N as H,z as P,x as O,bk as A,d as D,a2 as T,A as f,a3 as w,hl as U,an as j,r as m,q as r,k as d,w as s,o as a,m as S,u as h,p as N,n as u,s as c,U as L,aQ as E}from"./index-13ff96f4.js";const q={emits:["close"],components:{BaseHeading:V,BaseButton:x,BaseParagraph:F,BaseModal:R,BaseSelect:H,InputSwitch:P,BaseIcon:O,BaseBody:A,BasePill:D,XTooltip:T},props:{repositories:Array},data(){const e=this.getDefaultConfig();return{isSaving:!1,minimumSeverity:e.minimum_severity,enableDependencyScan:!!e.fail_on_dependency_scan,enableSastScan:!!e.fail_on_sast_scan,enableIacScan:!!e.fail_on_iac_scan,enableSecretsScan:!!e.fail_on_secrets_scan,enableMalwareScan:!!e.fail_on_malware_scan,enablePostInlineComments:!!e.post_inline_comments,postInlineCommentsMinimumSeverity:e.post_inline_comments_min_severity??"none"}},watch:{enableSecretsScan(){this.disableInlineCommentOption&&(this.postInlineCommentsMinimumSeverity="none")},enableSastScan(){this.disableInlineCommentOption&&(this.postInlineCommentsMinimumSeverity="none")},enableIacScan(){this.disableInlineCommentOption&&(this.postInlineCommentsMinimumSeverity="none")}},computed:{isPayingAccount(){return f.isPaying()},isEditingConfigurationForMultipleRepos(){return this.repositories.length>1},singleRepositoryHasConfiguration(){return this.isEditingConfigurationForMultipleRepos?!1:!!this.repositories[0].configuration},scmRepoName(){return this.isEditingConfigurationForMultipleRepos?null:this.repositories[0].scm_repo_name},modalTitle(){if(this.repositories.length>1)return null;const e=this.repositories[0].configuration;return!e||e.updated_by<1||this.scmRepoId!=e.scm_repo_id?null:`Updated on ${w.fromUnix(e.updated_at).format(w.US_FRIENDLY_SHORT_DATE)} by ${e.updated_by_name}`},minimumSeverityOptions(){return[{id:"critical",title:"Critical",disabled:this.minimumSeverity==="critical"},{id:"high",title:"High",disabled:this.minimumSeverity==="high"},{id:"medium",title:"Medium",disabled:this.minimumSeverity==="medium"},{id:"low",title:"Low",disabled:this.minimumSeverity==="low"}]},inlineCommentsMinimumSeverityOptions(){return[{id:"critical",title:"Critical Only"},{id:"high",title:"High and Above"},{id:"medium",title:"Medium and Above"},{id:"low",title:"Low and Above"},{id:"none",title:"No Comments"}]},disableInlineCommentOption(){return!this.enableSastScan&&!this.enableSecretsScan&&!this.enableIacScan}},methods:{handleClose(){this.$emit("close")},async handleSaveConfiguration(){if(!this.enableDependencyScan&&!this.enableSastScan&&!this.enableIacScan&&!this.enableMalwareScan){this.$toast.error({title:"Invalid Configuration",description:"You must enable at least one of the scans to enable scanning."});return}this.isSaving=!0;const e={scm_repo_ids:this.repositories.map(n=>n.id),minimum_severity:this.minimumSeverity,fail_on_dependency_scan:this.enableDependencyScan,fail_on_sast_scan:this.enableSastScan,fail_on_iac_scan:this.enableIacScan,fail_on_secrets_scan:this.enableSecretsScan,fail_on_malware_scan:this.enableMalwareScan,post_inline_comments_min_severity:this.postInlineCommentsMinimumSeverity};try{await U(e),j.emit("bitbucketChecksConfigurationUpdated"),this.handleClose()}finally{this.isSaving=!1}},getDefaultConfig(){const e=this.repositories.map(i=>i.configuration),n=e[0];return n?this.repositories.length===1?n??this.getFallbackConfig():e.every(i=>!!i&&i.minimum_severity===n.minimum_severity)?e.every(i=>!!i&&i.fail_on_dependency_scan===n.fail_on_dependency_scan)?e.every(i=>!!i&&i.fail_on_sast_scan===n.fail_on_sast_scan)?e.every(i=>!!i&&i.fail_on_iac_scan===n.fail_on_iac_scan)?e.every(i=>!!i&&i.post_inline_comments_min_severity===n.post_inline_comments_min_severity)?n:this.getFallbackConfig():this.getFallbackConfig():this.getFallbackConfig():this.getFallbackConfig():this.getFallbackConfig():this.getFallbackConfig()},getFallbackConfig(){return f.isPaying()?{minimum_severity:"critical",fail_on_dependency_scan:!0,fail_on_sast_scan:!0,fail_on_iac_scan:!0,fail_on_secrets_scan:!0,fail_on_malware_scan:!1,post_inline_comments_min_severity:"critical"}:{minimum_severity:"critical",fail_on_dependency_scan:!0,fail_on_sast_scan:!!f.isPaying(),fail_on_iac_scan:!!f.isPaying(),fail_on_secrets_scan:!!f.isPaying(),fail_on_malware_scan:!1,post_inline_comments_min_severity:"none"}},requestCiMalwareScan(){const e="Hi, I would like to request malware in CI scanning.";window.Intercom("showNewMessage",e)}}},X={key:0},Y={class:"flex flex-column gap-8px"},z=u("hr",{class:"divider w-full my-16px"},null,-1),G={class:"flex flex-column gap-16px"},Q={class:"flex justify-between align-center"},J={key:1,class:"flex align-center justify-between"},K={key:3,class:"flex align-center justify-between"},W={key:5,class:"flex align-center justify-between"},Z={key:7,class:"flex align-center justify-between"},$=u("hr",{class:"divider w-full"},null,-1),ee={class:"flex justify-between align-center gap-12px"},ne={class:"flex align-center ml-auto gap-8px"};function ie(e,n,b,k,t,l){const _=m("BaseParagraph"),i=m("BaseHeading"),v=m("BaseSelect"),p=m("InputSwitch"),g=m("BaseBody"),y=m("BasePill"),I=m("XTooltip"),C=m("BaseButton"),B=m("BaseModal");return r(),d(B,{width:530,onClose:l.handleClose,canClose:!0},{header:s(()=>[a(_,{color:"gray"},{default:s(()=>[l.modalTitle?(r(),S("span",X,h(l.modalTitle),1)):N("",!0)]),_:1})]),content:s(()=>[u("div",Y,[l.isEditingConfigurationForMultipleRepos?(r(),d(i,{key:0,as:"h3"},{default:s(()=>[c("Manage Configuration for "+h(b.repositories.length)+" repos",1)]),_:1})):(r(),d(i,{key:1,as:"h3"},{default:s(()=>[c("Manage configuration for "),u("strong",null,h(this.scmRepoName),1)]),_:1})),a(_,{color:"subdued",loose:""},{default:s(()=>[c("This configuration will be applied to selected repos.")]),_:1})]),z,u("div",G,[u("label",Q,[a(_,null,{default:s(()=>[c("Scan Failure For Minimum Severity")]),_:1}),a(v,{modelValue:t.minimumSeverity,"onUpdate:modelValue":n[0]||(n[0]=o=>t.minimumSeverity=o),options:l.minimumSeverityOptions,class:"min-w-116px"},null,8,["modelValue","options"])]),a(p,{modelValue:t.enableDependencyScan,"onUpdate:modelValue":n[1]||(n[1]=o=>t.enableDependencyScan=o),class:"justify-between",labelLeft:"Dependency Scan"},null,8,["modelValue"]),l.isPayingAccount?(r(),d(p,{key:0,modelValue:t.enableSastScan,"onUpdate:modelValue":n[2]||(n[2]=o=>t.enableSastScan=o),class:"justify-between",labelLeft:"SAST Scan"},null,8,["modelValue"])):(r(),S("div",J,[a(g,null,{default:s(()=>[c("SAST Scan")]),_:1}),a(y,{variation:"purple",title:"Upgrade"})])),l.isPayingAccount?(r(),d(p,{key:2,modelValue:t.enableIacScan,"onUpdate:modelValue":n[3]||(n[3]=o=>t.enableIacScan=o),class:"justify-between",labelLeft:"IaC Scan"},null,8,["modelValue"])):(r(),S("div",K,[a(g,null,{default:s(()=>[c("SAST Scan")]),_:1}),a(y,{variation:"purple",title:"Upgrade"})])),l.isPayingAccount?(r(),d(p,{key:4,modelValue:t.enableSecretsScan,"onUpdate:modelValue":n[4]||(n[4]=o=>t.enableSecretsScan=o),class:"justify-between",labelLeft:"Secrets Scan"},null,8,["modelValue"])):(r(),S("div",W,[a(g,null,{default:s(()=>[c("Secrets Scan")]),_:1}),a(y,{variation:"purple",title:"Upgrade"})])),e.$featureflags.enable_ci_malware_scan?(r(),d(p,{key:6,modelValue:t.enableMalwareScan,"onUpdate:modelValue":n[5]||(n[5]=o=>t.enableMalwareScan=o),class:"justify-between",labelLeft:"Malware Scan"},null,8,["modelValue"])):(r(),S("div",Z,[a(g,null,{default:s(()=>[c("Malware Scan")]),_:1}),a(y,{variation:"green",title:"Get in touch",class:"cursor-pointer",onClick:l.requestCiMalwareScan},null,8,["onClick"])])),$,u("span",ee,[a(_,null,{default:s(()=>[c("Add inline comments on the PR in BitBucket")]),_:1}),L(a(I,null,{default:s(()=>[c("SAST, IAC or Secrets scan must be enabled for inline commenting to work")]),_:1},512),[[E,l.disableInlineCommentOption]]),a(v,{modelValue:t.postInlineCommentsMinimumSeverity,"onUpdate:modelValue":n[6]||(n[6]=o=>t.postInlineCommentsMinimumSeverity=o),options:l.inlineCommentsMinimumSeverityOptions,disabled:l.disableInlineCommentOption,class:"min-w-116px"},null,8,["modelValue","options","disabled"])])])]),footer:s(()=>[u("div",ne,[a(C,{onClicked:l.handleClose,variation:"plain"},{default:s(()=>[c("Cancel")]),_:1},8,["onClicked"]),a(C,{onClicked:l.handleSaveConfiguration,variation:"primary","is-loading":t.isSaving},{default:s(()=>[c("Save Configuration")]),_:1},8,["onClicked","is-loading"])])]),_:1},8,["onClose"])}const te=M(q,[["render",ie]]);export{te as default};
