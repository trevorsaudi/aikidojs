import{_ as A,f as T,g as x,V as I,B as P,a3 as u,cc as v,a0 as y,Z as B,r,m as d,o as c,w as t,n as a,k as D,p as f,F as b,q as l,s as n,u as w}from"./index-13ff96f4.js";import{b as L,c as V}from"./autofix-68b65188.js";import{P as S}from"./PageHeader-46c38a32.js";const z={components:{BaseButton:T,BaseLink:x,InputText:I,BaseParagraph:P,PageHeader:S},data(){return{isLoading:!0,isSaving:!1,externalDirectLink:null,personalAccessToken:"",personalAccessTokenInfo:null}},async mounted(){await Promise.allSettled([this.getPersonalAccessTokenInfo(),this.getAccountInfo()]),this.isLoading=!1},computed:{inputIsValid(){return!!this.personalAccessToken&&this.personalAccessToken.trim()!==""},personalAccessTokenDetails(){if(!this.personalAccessTokenInfo)return;const e=u.fromUnix(this.personalAccessTokenInfo.installed_at).format(u.US_FRIENDLY_DATE_WITH_TIME);return!this.personalAccessTokenInfo||this.personalAccessTokenInfo.last_updated_by_id<1?`Last updated at ${e}`:`Last updated by ${this.personalAccessTokenInfo.last_updated_by_name} at ${e}`}},methods:{async getAccountInfo(){const e=await v();e.scm_org_base_url&&(this.externalDirectLink=e.scm_org_base_url+"/_usersSettings/tokens")},async getPersonalAccessTokenInfo(){var e;try{this.personalAccessTokenInfo=await L()}catch(s){y.isAxiosError(s)&&s.response.status!==404&&this.$toast.error({title:"An error occurred",description:((e=s.response.data)==null?void 0:e.reason_phrase)??"An unknown error occured"})}},async handleUpdatePersonalAccessToken(){if(this.inputIsValid){this.isSaving=!0;try{await V(this.personalAccessToken),await B.fetchAzureDevopsChecksIntegrationStatus(),this.$toast.success({title:"Personal Token Updated",description:"The Personal Access Token for the Azure DevOps Autofix integration has been successfully updated"}),this.$router.replace("/settings/integrations/autofix")}finally{this.isSaving=!1}}}}},U={class:"page-content"},C={class:"flex flex-column gap-24px min-w-264px max-w-50p"},E={class:"flex flex-column gap-4px"},N={class:"flex w-full justify-between"},H=["href"],F=a("i",{class:"icon icon-openLink icon-12px text--normal"},null,-1),M={class:"flex"};function O(e,s,Y,R,o,i){const _=r("BaseLink"),p=r("BaseParagraph"),k=r("PageHeader"),h=r("InputText"),m=r("BaseButton");return l(),d(b,null,[c(k,{title:"Manage Azure DevOps Autofix Personal Access Token"},{subTitle:t(()=>[c(p,null,{default:t(()=>[n(" Setup instructions and information about the correct scope in Azure DevOps can be found "),c(_,{target:"_blank",href:"https://help.aikido.dev/doc/autofix-for-azure-devops-with-personal-access-token/docRdxYcn1cg"},{default:t(()=>[n("here.")]),_:1})]),_:1})]),_:1}),a("div",U,[a("div",C,[a("div",E,[c(h,{name:"personal_access_token",modelValue:o.personalAccessToken,"onUpdate:modelValue":s[0]||(s[0]=g=>o.personalAccessToken=g)},{title:t(()=>[a("span",N,[n(" Your Personal Access Token "),o.externalDirectLink?(l(),d("a",{key:0,href:o.externalDirectLink,target:"_blank",class:"link flex gap-4px align-center mt-2px"},[n(" Generate Access Token here "),F],8,H)):f("",!0)])]),_:1},8,["modelValue"]),this.personalAccessTokenInfo?(l(),D(p,{key:0,color:"gray"},{default:t(()=>[n(w(i.personalAccessTokenDetails),1)]),_:1})):f("",!0)]),a("div",M,[c(m,{variation:"primary",onClick:i.handleUpdatePersonalAccessToken,disabled:!i.inputIsValid,"is-loading":o.isSaving},{default:t(()=>[n("Update Token")]),_:1},8,["onClick","disabled","is-loading"])])])])],64)}const G=A(z,[["render",O]]);export{G as default};
