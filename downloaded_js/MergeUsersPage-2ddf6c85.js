import{_ as B,er as P,es as G,et as z,eu as S,f as A,ev as U,ew as E,aE as y,d2 as v,ak as I,ex as H,ey as V,r as n,q as a,m as w,o as i,w as r,s as h,u as x,n as c,a as k,ez as N,k as b,p as m,F as O,eA as j,d as q,H as M,eB as $,x as D,Y as L,eC as Y,eD as W,eE as X,eF as K,eG as J,eH as Q,eI as C,eJ as R}from"./index-13ff96f4.js";const Z={mixins:[P],components:{GithubIcon:G,BitbucketIcon:z,GitlabIcon:S,BaseButton:A,GoogleIcon:U,MicrosoftIcon:E},data(){return{disableButtons:!1,selectedScm:null}},methods:{onBrowserTabVisible(){this.disableButtons=!1},initializeGithubLogin(){this.disableButtons=!0;let e="Iv1.e311c908c2211ac9";k()==="staging"?e="Iv1.17b6305b3fab26c8":k()==="production"&&(e="Iv1.e8567883a5054ae6");const t={state:y("github_user_auth"),client_id:e,redirect_uri:v()+"/callback/github/userAuth",scope:"read:user,user:email",response_type:"code"};this.startOauthFlow(`https://github.com/login/oauth/authorize?${I(t)}`)},initializeBitbucketLogin(){this.disableButtons=!0;const e={state:y("bitbucket_user_auth"),redirect_uri:v()+"/callback/bitbucket/userAuth",response_type:"code",client_id:"gcnVXNvbWg7WVnr4Bv"};k()==="staging"?e.client_id="Q5UwFFRFvUDjfw8nSK":k()==="production"&&(e.client_id="EzeWPxJr5Te2gYzKXh"),this.startOauthFlow(`https://bitbucket.org/site/oauth2/authorize?${I(e)}`)},initializeGitlabLogin(){this.disableButtons=!0;const e={state:y("gitlab_user_auth"),redirect_uri:v()+"/callback/gitlab/userAuth",response_type:"code",client_id:"139756193242b7f33a6e3df6cfaa0df12ef5ed6bd3bf8137c012aefe0aa4ee73",scope:"read_user"};k()==="production"&&(e.client_id="d8dae497ae8bea8697dfe4f49bd9322de0a8483be9db5a52132a8a7bd731b71e"),this.startOauthFlow(`https://gitlab.com/oauth/authorize?${I(e)}`)},async initializeGoogleLogin(){this.disableButtons=!0;const e=y("google_user_auth"),t=await H(e);this.startOauthFlow(t.url)},async initializeAzureadLogin(){this.disableButtons=!0;const e=y("azuread_user_auth"),t=await V(e);this.startOauthFlow(t.url)},startOauthFlow(e){sessionStorage.setItem("auth.mergelogins","true"),window.location=e}}},ee={class:"flex flex-column gap-16px w-full"},te={class:"onboarding__login__buttons"},oe={class:"onboarding__login__buttons"};function ie(e,t,o,T,s,u){const f=n("GithubIcon"),l=n("BaseButton"),_=n("BitbucketIcon"),g=n("GitlabIcon"),d=n("GoogleIcon"),p=n("MicrosoftIcon");return a(),w("div",ee,[i(l,{onClicked:u.initializeGithubLogin,variation:"primary","full-width":"",disabled:s.disableButtons},{default:r(()=>[i(f,{width:20}),h(" "+x(e.$t("USE_GITHUB_ACCOUNT")),1)]),_:1},8,["onClicked","disabled"]),c("div",te,[i(l,{onClicked:u.initializeBitbucketLogin,variation:"plain","full-width":"",disabled:s.disableButtons},{default:r(()=>[i(_,{width:20}),h(" "+x(e.$t("USE_BITBUCKET_ACCOUNT")),1)]),_:1},8,["onClicked","disabled"]),i(l,{onClicked:u.initializeGitlabLogin,variation:"plain","full-width":"",disabled:s.disableButtons},{default:r(()=>[i(g,{width:18}),h(" "+x(e.$t("USE_GITLAB_ACCOUNT")),1)]),_:1},8,["onClicked","disabled"])]),c("div",oe,[i(l,{onClicked:u.initializeGoogleLogin,variation:"plain","full-width":"",disabled:s.disableButtons},{default:r(()=>[i(d,{width:20}),h(" Google Login ")]),_:1},8,["onClicked","disabled"]),i(l,{onClicked:u.initializeAzureadLogin,variation:"plain","full-width":"",disabled:s.disableButtons},{default:r(()=>[i(p,{width:17}),h(" Microsoft Login ")]),_:1},8,["onClicked","disabled"])])])}const F=B(Z,[["render",ie]]),ne={components:{GithubIcon:G,BitbucketIcon:z,GitlabIcon:S,GoogleIcon:U,Office365Icon:N},props:{authType:{type:String,required:!0},color:{type:String,default:"#141031"},width:{type:String,default:"20px"}}};function se(e,t,o,T,s,u){const f=n("GithubIcon"),l=n("BitbucketIcon"),_=n("GitlabIcon"),g=n("GoogleIcon"),d=n("Office365Icon");return a(),w(O,null,[o.authType=="github"?(a(),b(f,{key:0,width:o.width,color:o.color},null,8,["width","color"])):m("",!0),o.authType=="bitbucket"?(a(),b(l,{key:1,width:o.width,color:o.color},null,8,["width","color"])):m("",!0),o.authType=="gitlab"?(a(),b(_,{key:2,width:o.width,color:o.color},null,8,["width","color"])):m("",!0),o.authType=="google"?(a(),b(g,{key:3,width:o.width,color:o.color},null,8,["width","color"])):m("",!0),o.authType=="office365"?(a(),b(d,{key:4,width:o.width,color:o.color},null,8,["width","color"])):m("",!0)],64)}const ae=B(ne,[["render",se]]),ce={emits:["logoutClicked"],components:{OnboardingSection:j,AuthButtons:F,BaseButton:A,BasePill:q,BaseHeading:M,AuthIcon:ae},props:{user:{type:Object,default:null},emptystateTitle:{type:String,default:"Select account"}}},le={class:"card p-64px rounded-24px w-600px justify-center flex"},ue={class:"onboarding__login__container"},re={class:"pill__label"},de=c("span",{class:"text--bold"},"Log Out",-1);function he(e,t,o,T,s,u){const f=n("BaseHeading"),l=n("AuthButtons"),_=n("AuthIcon"),g=n("BasePill"),d=n("BaseButton");return a(),w("div",le,[c("div",ue,[i(f,{color:"black",as:"h2",class:"text-center"},{default:r(()=>{var p;return[h(x(((p=o.user)==null?void 0:p.full_name)||o.emptystateTitle),1)]}),_:1}),o.user?(a(),w(O,{key:1},[i(g,{variation:"green",class:"mb-40px mt-8px"},{default:r(()=>[i(_,{authType:o.user.auth_type,color:"#00734b",width:"16px"},null,8,["authType"]),c("p",re,x(e.$t(`AUTH_TYPE_${o.user.auth_type}`)),1)]),_:1}),i(d,{onClicked:t[0]||(t[0]=p=>e.$emit("logoutClicked")),variation:"tertiary",fullWidth:""},{default:r(()=>[i(_,{authType:o.user.auth_type},null,8,["authType"]),de]),_:1})],64)):(a(),b(l,{key:0,class:"mt-56px",specifiedLoginType:e.$route.query.loginType,ssoLoginType:e.$route.query.ssoLoginType},null,8,["specifiedLoginType","ssoLoginType"]))])])}const _e=B(ce,[["render",he]]),ge={components:{OnboardingPage:$,AuthButtons:F,BaseButton:A,MergeUsersLoginSection:_e,BaseHeading:M,BaseIcon:D},data(){return{authType:null,code:null,user1:null,user2:null,loaded:!1}},async created(){if(L.isAuthenticated){await L.logOut(!1),window.location.reload();return}await this.init()},methods:{async init(){if(await this.fetchCurrentAccountMergeState(),this.user1&&this.user2){this.loaded=!0;return}const{code:e,authType:t}=this.$route.query;(e||t)&&(this.code=e,this.authType=t),this.code?await this.finalizeLoginForCode():!this.user1&&!this.user2&&await L.logOut(!1),this.loaded=!0},async fetchCurrentAccountMergeState(){const{user1:e,user2:t}=await Y();this.user1=e,this.user2=t},async finalizeLoginForCode(){let e=!0,t=!1;this.user1&&(e=!1,t=!0);try{this.authType==="github"&&await W({code:this.code,is_user_merge_1:e,is_user_merge_2:t}),this.authType==="bitbucket"&&await X({code:this.code,is_user_merge_1:e,is_user_merge_2:t}),this.authType==="gitlab"&&await K({code:this.code,is_user_merge_1:e,is_user_merge_2:t}),this.authType==="google"&&await J({code:this.code,is_user_merge_1:e,is_user_merge_2:t}),this.authType==="office365"&&await Q({code:this.code,is_user_merge_1:e,is_user_merge_2:t})}finally{this.$router.replace({path:this.$route.path,query:{code:void 0,authType:void 0}})}},async logout(e){e==="user1"?await C(!0,!1):e==="user2"&&await C(!1,!0),this.init()},async mergeUserAccounts(){await R(),C(!0,!0,{no_disable_buttons:!0}),await this.$modal.show("InfoModal",{headerText:"Accounts Linked",title:"Account Linking Complete",description:"All set! Your two accounts are now linked. You can seamlessly switch between workspaces from the workspace dropdown menu. Feel free to log in with *any of the credentials* you've used.",buttonSubmitText:"Proceed to Login",useDescriptionMarkup:!0,canClose:!1}),go("/login")}}},fe={key:1,class:"gap-24px flex flex-column px-32px pt-8px pb-32px bg-carbon-100 min-h-screen"},pe={class:"flex justify-between align-center mt-16px"},be=c("a",{href:"https://www.aikido.dev"},[c("img",{src:"https://cdn.aikido.dev/assets/logo-white.svg?v=2",width:"88"})],-1),me={class:"flex flex-column align-center text-center mb-64px"},we=c("div",{class:"text-carbon-40 text--semi text-20px leading-32px w-448px"}," Link up to two accounts for seamless integration and swift switching ",-1),ye=c("div",{class:"text-carbon-40 text-14px w-448px mt-12px -mb-24px"}," (Accounts should have the same email addresses) ",-1),ke={class:"flex gap-40px justify-center align-center"},xe={key:0,class:"flex flex-column"},Be={key:0,class:"flex align-center mx-auto mt-56px"};function Te(e,t,o,T,s,u){const f=n("XPreloader"),l=n("BaseButton"),_=n("BaseHeading"),g=n("MergeUsersLoginSection"),d=n("BaseIcon");return s.loaded?(a(),w("div",fe,[c("div",pe,[be,i(l,{variation:"secondary",as:"link",to:"/login"},{default:r(()=>[h("Back to Aikido")]),_:1})]),c("div",me,[i(_,{as:"h1",class:"onboarding__title flex justify-between mb-4px text-44px",color:"white"},{default:r(()=>[h(" Set Up Account Links ")]),_:1}),we,ye]),c("div",ke,[i(g,{user:s.user1,onLogoutClicked:t[0]||(t[0]=p=>u.logout("user1")),emptystateTitle:"Select account 1"},null,8,["user"]),c("div",null,[s.user1&&s.user2?(a(),w("div",xe,[i(d,{icon:"icon-arrow-right",class:"text-carbon-40"}),i(d,{icon:"icon-arrow-left",class:"text-carbon-40"})])):m("",!0)]),i(g,{user:s.user2,onLogoutClicked:t[1]||(t[1]=p=>u.logout("user2")),emptystateTitle:"Select account 2"},null,8,["user"])]),s.user1&&s.user2?(a(),w("div",Be,[i(l,{variation:"primary",onClick:u.mergeUserAccounts},{default:r(()=>[h("Link Accounts "),i(d,{icon:"icon-link"})]),_:1},8,["onClick"])])):m("",!0)])):(a(),b(f,{key:0,class:"supercenter"}))}const Ie=B(ge,[["render",Te]]);export{Ie as default};
