import{_ as C,eZ as d,eX as E,Y as G,b_ as m,b$ as O,r as o,m as S,k as i,p as c,w as N,F as R,q as a,o as _}from"./index-13ff96f4.js";import{C as h}from"./ConnectGroup-e27591ad.js";import{C as A}from"./ConnectGitlabServerInstance-9e3cb948.js";import{O as I}from"./OnboardingEmptyState-28bd43c0.js";import"./OnboardingProgressIndicator-8fa4a42d.js";import"./gitlabServer-f1adde30.js";const f={components:{ConnectGroup:h,ConnectGitlabServerInstance:A,OnboardingEmptyState:I},data(){return{showConnectServer:!0,showSelectGroup:!1,accessibleGroups:[],isLoading:!0,accessToken:void 0,serverUrl:void 0}},computed:{groupOptions(){return this.accessibleGroups.map(e=>({id:e.id,title:e.full_name,description:e.description}))}},methods:{handleContinue({url:e,token:t,groups:r}){this.accessToken=t,this.serverUrl=e,this.accessibleGroups=r,this.showConnectServer=!1,this.showSelectGroup=!0},handleBack(){this.showConnectServer=!0,this.showSelectGroup=!1},async handleCreateGroup({selectedGroup:e}){const{sys_group_id:t,status:r}=await d({access_token:this.accessToken,server_url:this.serverUrl,gitlab_group_id:e});if(r=="already_exists")if(await E({overwrite_group_header:t}))Toast.info({title:"This workspace already exists in Aikido. Trying to continue using the existing token."});else{Toast.error("This workspace already exists in Aikido. You need an invite to access it.");return}await G.setGroupContext(t),m(),O(),go("/onboarding/gitlab-server/connect-repositories")},async handleCreateSample(){go("/onboarding/demo")}}};function k(e,t,r,l,s,n){const p=o("ConnectGitlabServerInstance"),u=o("OnboardingEmptyState"),T=o("ConnectGroup");return a(),S(R,null,[s.showConnectServer?(a(),i(p,{key:0,"number-of-completed-steps":1,"number-of-steps":5,"initial-server-url":s.serverUrl,"initial-access-token":s.accessToken,onContinue:n.handleContinue,onBack:t[0]||(t[0]=B=>e.$router.go(-1))},null,8,["initial-server-url","initial-access-token","onContinue"])):c("",!0),s.showSelectGroup?(a(),i(T,{key:1,title:e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_GROUP.TITLE"),description:e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_GROUP.DESCRIPTION"),"select-title":e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_GROUP.SELECT.TITLE"),"select-description":e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_GROUP.SELECT.DESCRIPTION"),groups:n.groupOptions,"is-loading":!1,"number-of-steps":5,"number-of-completed-steps":2,onContinue:n.handleCreateGroup,onBack:n.handleBack,icon:"icon-Gitlab"},{emptyState:N(()=>[_(u,{title:e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_GROUP.EMPTY_STATE.TITLE"),description:e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_GROUP.EMPTY_STATE.DESCRIPTION"),"primary-cta":e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_GROUP.EMPTY_STATE.PRIMARY_CTA"),"secondary-cta":e.$t("ONBOARDING.GITLAB_SERVER.CONNECT_GROUP.EMPTY_STATE.SECONDARY_CTA"),onUseSample:n.handleCreateSample,onUseDifferentAccount:n.handleBack},null,8,["title","description","primary-cta","secondary-cta","onUseSample","onUseDifferentAccount"])]),_:1},8,["title","description","select-title","select-description","groups","onContinue","onBack"])):c("",!0)],64)}const w=C(f,[["render",k]]);export{w as default};
