import{_ as w,X as b,H as C,B as v,V as S,f as I,a3 as p,aM as B,aN as A,Q as f,aO as R,aP as M,r,k as h,m,o as e,n as i,w as t,p as _,F as L,q as c,s as n,u as k}from"./index-13ff96f4.js";import{P as D}from"./PageHeader-46c38a32.js";import{C as P}from"./ContinuousIntegrationCopyTokenModal-b6dba601.js";import{S as z}from"./SelfScanVersion-a1a382ab.js";const H={components:{XPreloader:b,PageHeader:D,BaseHeading:C,BaseParagraph:v,InputText:S,ContinuousIntegrationCopyTokenModal:P,BaseButton:I},data(){return{loaded:!1,showTokenModal:!1,token:void 0,tokenUpdatedAt:void 0,tokenCreatedBy:void 0,selfscan_version:z}},async mounted(){var a;try{this.isSelfScanAccount||(Toast.error({title:this.$t("ERROR"),description:`This page is not available for your account type (${(a=this.$group)==null?void 0:a.scm_type})`}),go("/settings")),await this.handleFetchToken()}finally{this.loaded=!0}},computed:{breadcrumbs(){return[{label:"Settings",href:"/settings"},{label:"Local Scanning Setup"}]},isIntegrationActive(){return this.loaded&&this.token},redactedToken(){return`********************${this.token.slice(-4)}`},isSelfScanAccount(){var a;return!!(((a=this.$group)==null?void 0:a.scm_type)==="selfscan"||this.$featureflags.allow_selfscan_repos_scm_account)},formattedTokenUpdatedAtTimestamp(){return this.tokenUpdatedAt?p.fromUnix(this.tokenUpdatedAt).format(p.US_FRIENDLY_DATE_WITH_TIME):null}},methods:{handleCopyToken(){window.isSecureContext&&navigator.clipboard.writeText(this.token)},async handleAddIntegration(){const a=await B();this.token=a.token,this.showTokenModal=!0},async handleFetchToken(){this.isLoading=!0;try{const a=await A({disable_toasts:!0});this.token=a.token,this.tokenUpdatedAt=a.updated_at,this.tokenCreatedBy=a.created_by_name}finally{this.isLoading=!1}},async handleRotateToken(){if(await f({headerText:"Rotate token",description:"Do you want to rotate the CI auth token? This will invalidate the current token and you will need to update it in your CI configuration.",buttonSubmitText:"Yes, rotate"})){this.isLoading=!0;try{const a=await R();this.token=a.token,this.showTokenModal=!0}finally{this.isLoading=!1}}},async handleRevokeToken(){if(await f({headerText:"Revoke token",description:"Do you want to revoke the CI auth token?",buttonSubmitText:"Yes, revoke"})){this.isLoading=!1;try{await M(),this.token=void 0}finally{this.isLoading=!1}}},async handleCloseTokenModal(){this.showTokenModal=!1,this.token="***",await this.handleFetchToken()}}},U={class:"page-content flex flex-column gap-32px"},E={class:"mb-16px"},F={class:"mb-16px"},N={key:1,class:"flex flex-column gap-8px"},V={class:"flex align-center gap-8px"},X=i("i",{class:"icon icon-refresh icon-12px"},null,-1),O=i("span",{class:"text--semi"},"Rotate token",-1),W=i("span",{class:"text--semi"},"Revoke token",-1);function G(a,Y,q,J,l,o){const g=r("XPreloader"),y=r("PageHeader"),u=r("BaseHeading"),d=r("BaseParagraph"),s=r("BaseButton"),x=r("InputText"),T=r("ContinuousIntegrationCopyTokenModal");return l.loaded?o.isSelfScanAccount?(c(),m(L,{key:1},[e(y,{title:"Local Scanning Setup",breadcrumbs:o.breadcrumbs},null,8,["breadcrumbs"]),i("div",U,[i("section",E,[e(u,{as:"h4"},{default:t(()=>[n("1. Download binary (version "+k(l.selfscan_version)+")",1)]),_:1}),e(d,{class:"mt-16px mb-16px",color:"gray"},{default:t(()=>[n(" These binaries contain our scanners intended to be run locally or in your CI/CD system. We support SAST/SCA/IaC scanning using Docker or binaries for Linux, Windows and Mac. ")]),_:1}),e(s,{class:"float-left mr-12px mb-12px",as:"outside-link",href:`https://aikido-local-scanner.s3.eu-west-1.amazonaws.com/v${this.selfscan_version}/linux_X86_64/aikido-local-scanner.zip`,variation:"secondary"},{default:t(()=>[n("Download for Linux x86_64")]),_:1},8,["href"]),e(s,{class:"float-left mr-12px mb-12px",as:"outside-link",href:`https://aikido-local-scanner.s3.eu-west-1.amazonaws.com/v${this.selfscan_version}/darwin_ARM64/aikido-local-scanner.zip`,variation:"secondary"},{default:t(()=>[n("Download for MacOS arm64")]),_:1},8,["href"]),e(s,{class:"float-left mr-12px mb-12px",as:"outside-link",href:`https://aikido-local-scanner.s3.eu-west-1.amazonaws.com/v${this.selfscan_version}/windows_X86_64/aikido-local-scanner.zip`,variation:"secondary"},{default:t(()=>[n("Download for Windows x86_64")]),_:1},8,["href"]),e(s,{class:"float-left mr-12px mb-12px",as:"outside-link",href:"https://hub.docker.com/r/aikidosecurity/local-scanner",variation:"secondary",target:"_blank"},{default:t(()=>[n("Docker Hub")]),_:1}),e(s,{class:"float-left mr-12px mb-12px",as:"outside-link",href:"https://gallery.ecr.aws/z1o3v2w5/aikidosecurity/local-scanner",variation:"secondary",target:"_blank"},{default:t(()=>[n("Elastic Container Registry")]),_:1})]),i("section",F,[e(u,{as:"h4"},{default:t(()=>[n("2. Token Generation")]),_:1}),e(d,{class:"mt-16px mb-16px",color:"gray"},{default:t(()=>[n(" Use this generated token when running the Local Scan binary and sync your scan results with your Aikido workspace. ")]),_:1}),o.isIntegrationActive?(c(),m("div",N,[i("div",V,[e(x,{name:"token",modelValue:o.redactedToken,disabled:!0,ref:"input",class:"truncate flex-1 max-w-400px",inputClass:"bg-white"},null,8,["modelValue"]),e(s,{size:"small",variation:"primary",onClicked:o.handleRotateToken},{default:t(()=>[X,O]),_:1},8,["onClicked"]),e(s,{size:"small",variation:"plain",onClicked:o.handleRevokeToken},{default:t(()=>[W]),_:1},8,["onClicked"])]),e(d,{size:"tiny"},{default:t(()=>[n("Token generated on "+k(o.formattedTokenUpdatedAtTimestamp)+" by "+k(l.tokenCreatedBy),1)]),_:1})])):(c(),h(s,{key:0,size:"small",variation:"secondary",onClicked:o.handleAddIntegration},{default:t(()=>[n(" Generate Token ")]),_:1},8,["onClicked"]))]),i("section",null,[e(u,{as:"h4"},{default:t(()=>[n("3. Setup instructions")]),_:1}),e(d,{class:"mt-16px mb-16px",color:"gray"},{default:t(()=>[n(" Check out the step-by-step guide to complete your Local Scanning setup. ")]),_:1}),e(s,{as:"outside-link",href:"https://help.aikido.dev/category/aikido-local-scan-setup/sg4xF4OsJciW",variation:"primary",target:"_blank"},{default:t(()=>[n("Go to setup instructions")]),_:1})]),l.showTokenModal?(c(),h(T,{key:0,token:l.token,onClose:o.handleCloseTokenModal},null,8,["token","onClose"])):_("",!0)])],64)):_("",!0):(c(),h(g,{key:0,class:"supercenter",theme:"transparent"}))}const $=w(H,[["render",G]]);export{$ as default};
