import{A as n}from"./ActionMenu-3e4470bf.js";import{_ as c,A as l,ar as s,an as t,ap as d,aq as h,bp as p,bq as u,br as m,r as y,q as R,k as v,w as _,aa as T}from"./index-13ff96f4.js";const A={emits:["repositoryUpdated"],props:{repository:{type:Object},repoBookmarks:{type:Array}},components:{ActionMenu:n},computed:{isRepoBookmarked(){return!!this.repoBookmarks.find(i=>i.type=="repo"&&i.type_id==this.repository.id)},actions(){const e=[{visible:this.shouldShowStartScanAction,label:this.$t("REPOSITORY_ACTION_MENU.START_SCAN"),onClick:this.handleStartScan,icon:"icon-arrow-right",iconColor:"green"},{visible:this.repository.active&&this.isRepoBookmarked,label:this.$t("REPOSITORY_ACTION_MENU.REMOVE_FROM_BOOKMARKS"),onClick:this.handleRemoveFromFavorites,icon:"icon-bookmark",iconColor:"purple-light"},{visible:this.repository.active&&!this.isRepoBookmarked,label:this.$t("REPOSITORY_ACTION_MENU.ADD_TO_BOOKMARKS"),onClick:this.handleAddToFavorites,icon:"icon-bookmark",iconColor:"purple"},{visible:!0,label:this.$t("REPOSITORY_ACTION_MENU.CONFIGURE_ARCHITECTURE"),onClick:this.handleConfigureArchitecture,icon:"icon-settings"},{visible:this.repository.active&&!this.$groupUser.only_team_related_issues,label:this.$t("REPOSITORY_ACTION_MENU.DEACTIVATE_REPO"),onClick:this.handleDeactivateRepo,destructive:!0},{visible:!this.repository.active,label:this.$t("REPOSITORY_ACTION_MENU.ACTIVATE_REPO"),onClick:this.handleActivateRepo,icon:"icon-shield_check"},{visible:this.shouldShowDeleteRepoAction,label:this.$t("REPOSITORY_ACTION_MENU.DELETE_REPO"),onClick:this.handleDeleteRepo,destructive:!0,icon:"icon-delete",iconColor:"red",useBaseIcon:!0}];return[{title:this.$t("REPOSITORY_ACTION_MENU.TITLE"),items:e.filter(i=>i.visible)}]},disableAction(){return this.actions[0].items.length===0},shouldShowStartScanAction(){return!(!this.repository.active||this.repository.scm_type==="selfscan")},shouldShowDeleteRepoAction(){return!(this.repository.active||this.repository.scm_type!=="selfscan")}},methods:{async handleStartScan(){if(l.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");await s(this.repository.id,{no_disable_buttons:!0}),t.emit("dependencyScanStarted",this.repository.id)},async handleActivateRepo(){await d(this.repository.id),this.$emit("repoActiveStateChanged",{repositoryId:this.repository.id,active:1}),t.emit("activeScmReposChanged"),await s(this.repository.id,{no_disable_buttons:!0}),t.emit("dependencyScanStarted",this.repository.id)},async handleDeactivateRepo(){if(!this.$groupUser.admin){await this.$modal.show("AdminOnlyModal",{action:"Deactivating repositories"});return}(await this.$modal.show("InfoModal",{headerText:"Deactivate repo",title:"Do you want to deactivate this repository?",description:"this will delete all the issues, manual ignores and snoozes",showCancelButton:!0,buttonCancelText:"Cancel",buttonSubmitText:"Deactivate",destructive:!0})).type=="saved"&&(await h(this.repository.id),this.$emit("repoActiveStateChanged",{repositoryId:this.repository.id,active:0}),t.emit("activeScmReposChanged"))},async handleAddToFavorites(){await p("repo",this.repository.id),t.emit("activeScmReposChanged"),Toast.success({title:this.$t("NOTIFICATIONS.FAVORITE_STATUS.TITLE"),description:"This repo will now be shown at the top of the Repos section in the left navigation bar."})},async handleRemoveFromFavorites(){await u("repo",this.repository.id),t.emit("activeScmReposChanged")},async handleConfigureArchitecture(){const e=await this.$modal.show("RepositoryArchitectureConfigurationModal",{repository:this.repository});e.type=="saved"&&this.$emit("repositoryUpdated",e.value)},async handleDeleteRepo(){(await this.$modal.show("InfoModal",{headerText:"Delete repo",title:"Are you sure you want to delete this repository?",description:"This will delete the repository and all related issues.",showCancelButton:!0,buttonCancelText:"Cancel",buttonSubmitText:"Delete",destructive:!0})).type=="saved"&&(await m(this.repository.id),this.$emit("repoDeletionStateChanged"))}}};function C(e,i,S,O,b,o){const r=y("ActionMenu");return R(),v(r,{sections:o.actions,placement:"bottom-end"},{trigger:_(a=>[T(e.$slots,"trigger",{toggle:a.toggle,disabled:o.disableAction})]),_:3},8,["sections"])}const w=c(A,[["render",C]]);export{w as R};
