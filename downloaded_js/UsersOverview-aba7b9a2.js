import{_ as k,a2 as D,r as o,q as n,m as y,k as u,S as w,p as b,w as s,s as d,u as p,J as R,B as E,d as F,a6 as W,a7 as C,Q as X,a8 as j,a9 as Y,a3 as x,o as t,t as M,n as f,F as A,aa as G,ab as q,f as J,ac as Q,I as K,L as Z,ad as ee,ae as te,A as se,af as ae}from"./index-13ff96f4.js";import{D as ie,a as ne}from"./DataTable-e31a825a.js";import{a as L,D as $}from"./DataTableCell-51c0104f.js";import{D as P}from"./DataTableActionsCell-bde7169b.js";import{D as le}from"./DataTableCellSelectable-71ffdbc4.js";import{I as oe}from"./InputCheckbox-81cb3ca6.js";import{S as re}from"./SettingsEmptyState-8e8644cd.js";import{E as ce}from"./EmptyUsersIllustration-1a5638d0.js";import"./ActionMenu-3e4470bf.js";const de="https://cdn.aikido.dev/assets/icons/google.svg",ue="https://cdn.aikido.dev/assets/icons/microsoft.svg",he={components:{XTooltip:D},props:{authType:{type:String,required:!0,validator(e){return["github","bitbucket","gitlab","google","office365","saml"].includes(e)}},onboardedViaSecret:{type:Boolean,default:!1}},computed:{tooltip(){return["github","bitbucket","gitlab"].includes(this.authType)&&this.onboardedViaSecret?`This ${this.$t("SCM_TYPE_"+this.authType)} account is not part of the organization. Offboarding will not be automated.`:""}}},me={class:"flex text-carbon-60"},_e={key:0,src:de,class:"flex",width:"14",height:"14"},pe={key:1,src:ue,class:"flex",width:"14",height:"14"};function fe(e,i,l,m,h,a){const g=o("BaseIcon"),c=o("XTooltip");return n(),y("span",me,[l.authType=="google"?(n(),y("img",_e)):l.authType=="office365"?(n(),y("img",pe)):l.authType=="github"?(n(),u(g,{key:2,icon:"icon-github",class:w(["flex leading-none",{"text-primary-aik-100":a.tooltip}]),size:"14"},null,8,["class"])):l.authType=="bitbucket"?(n(),u(g,{key:3,icon:"icon-bitbucket",class:w(["flex leading-none",{"text-primary-aik-100":a.tooltip}]),size:"14"},null,8,["class"])):l.authType=="gitlab"?(n(),u(g,{key:4,icon:"icon-Gitlab",class:w(["flex leading-none h-14px",{"text-primary-aik-100":a.tooltip}]),size:"14"},null,8,["class"])):l.authType=="saml"?(n(),u(g,{key:5,icon:"icon-secrets",class:w(["flex leading-none h-14px",{"text-primary-aik-100":a.tooltip}]),size:"14"},null,8,["class"])):b("",!0),a.tooltip?(n(),u(c,{key:6},{default:s(()=>[d(p(a.tooltip),1)]),_:1})):b("",!0)])}const ge=k(he,[["render",fe]]),Ue={props:{users:Array,teams:Array,selectedUserIds:Array},emits:["loaded","update:selectedUserIds"],components:{AvatarImage:R,DataTable:ie,DataTableHeader:ne,DataTableRow:L,DataTableCell:$,BaseParagraph:E,DataTableCellSelectable:le,InputCheckbox:oe,DataTableActionsCell:P,XTooltip:D,BasePill:F,RouterLink:W,LoginTypeIcon:ge},computed:{hasSelectedUsers(){return this.selectedUserIds.length>0},userSelectionMode(){return this.selectedUserIds.length>0?"edit":"display"},allUsersSelected(){return this.selectedUserIds.length>0&&this.selectedUserIds.length===this.users.length},usersWithTeams(){const e={};for(const l of this.teams)for(const m of l.users)e[m.id]=[...e[m.id]??[],l.name];let i=[];for(const l of this.users)i.push({...l,teams:e[l.id]??[]});return i}},methods:{handleSelectUserId(e,i){return e?this.$emit("update:selectedUserIds",[...this.selectedUserIds,i]):this.$emit("update:selectedUserIds",this.selectedUserIds.filter(l=>l!==i))},handleToggleSelectAllUsers(e){if(e){const i=this.users.map(l=>l.id);return this.$emit("update:selectedUserIds",i)}this.$emit("update:selectedUserIds",[])},canDoActions(e){return e.id!=this.$user.id},getActionsForUser(e){return[{title:"Actions",items:[{visible:!0,label:"Change role",onClick:()=>this.changeUserRole(e),icon:"icon-edit"},{visible:e.active==1,label:"Disable user",onClick:()=>this.deactivateUser(e),destructive:!0},{visible:this.canReactivateUser(e),label:"Reactivate user",icon:"icon-user_add",onClick:()=>this.reactivateUser(e)}].filter(i=>i.visible)}]},async changeUserRole(e){(await this.$modal.show("UserRoleModal",{user:e})).type=="saved"&&this.$emit("reloadUsers")},getUserRole(e){return e.admin?this.$t("ADMIN"):e.is_team_restricted?"Team Only":this.$t("DEFAULT")},showOtherTeamsLabelForUser(e){return e.teams.length>1},async deactivateUser(e){if(["github","gitlab","bitbucket"].includes(this.$group.scm_type)&&e.onboarded_via_secret==0&&e.auth_type!="saml"){(await this.$modal.show("DisableUserInfoModal",{help_url_info:{text:`More on ${this.$t("SCM_TYPE_"+this.$group.scm_type)} authentication access`,url:this.getHelpArticleUrl()}})).type=="saved"&&(await C(e.id),this.$emit("reloadUsers"));return}let l=`All Aikido access to ${this.$group.name} will be revoked for ${e.full_name}. Do you want to continue?`;e.auth_type=="saml"&&(l="Make sure to disable this user in your SAML identity provider as well."),await X({headerText:"Disable user",title:`Disable ${e.full_name}`,markupDescription:l,buttonSubmitText:"Disable user"})&&(await C(e.id),this.$emit("reloadUsers"))},async reactivateUser(e){await j({headerText:"Reactivate user",title:`Reactivate ${e.full_name}`,description:`Aikido access for ${e.full_name} will be granted. Are you sure you want to continue?`,buttonSubmitText:"Reactivate user"})&&(await Y(e.id),this.$emit("reloadUsers"))},getUserLastLogin(e){return e.last_login_timestamp<=0?"-":x.fromUnix(e.last_login_timestamp).format(x.YMD_HM)},getHelpArticleUrl(){switch(this.$group.scm_type){case"github":return"https://help.aikido.dev/en/articles/8985506-authentication-and-user-management-via-github";case"gitlab":return"https://help.aikido.dev/en/articles/8985589-authentication-and-user-management-via-gitlab-cloud";case"bitbucket":return"https://help.aikido.dev/doc/bitbucket-cloud-integration-for-authentication-and-user-management/docjO9H8qzL1"}return""},canReactivateUser(e){return e.active==1?!1:!!(["gitlab_server","azure_devops","selfscan"].includes(this.$group.scm_type)||e.onboarded_via_secret==1)}}},ve={class:"flex w-full justify-between align-center"},be={class:"flex flex-column gap-2px"},ye={key:0},Ie={class:"flex flex-1 gap-4px align-center justify-between"},Te={key:2},we={class:"ws-pre"};function ke(e,i,l,m,h,a){const g=o("InputCheckbox"),c=o("DataTableHeader"),I=o("AvatarImage"),T=o("DataTableCellSelectable"),U=o("BaseParagraph"),v=o("BasePill"),S=o("LoginTypeIcon"),_=o("DataTableCell"),B=o("RouterLink"),V=o("XTooltip"),O=o("DataTableActionsCell"),N=o("DataTableRow"),z=o("DataTable");return n(),u(z,null,{header:s(()=>[t(c,{width:"48px",alignment:"center",spacing:"compact"},{default:s(()=>[t(g,{"semi-checked":a.hasSelectedUsers,modelValue:a.allUsersSelected,"onUpdate:modelValue":a.handleToggleSelectAllUsers},null,8,["semi-checked","modelValue","onUpdate:modelValue"])]),_:1}),t(c,{width:"auto"},{default:s(()=>[d("User")]),_:1}),t(c,{width:"30%"},{default:s(()=>[d("Teams")]),_:1}),t(c,{width:"200px"},{default:s(()=>[d("Role")]),_:1}),t(c,{width:"200px",class:"desktop-small_hidden"},{default:s(()=>[d("Last Login")]),_:1}),t(c,{width:"48px",alignment:"center"})]),body:s(()=>[(n(!0),y(A,null,M(a.usersWithTeams,r=>(n(),u(N,{key:r.id,disabled:!r.active},{default:s(()=>[t(T,{mode:a.userSelectionMode,selected:l.selectedUserIds.includes(r.id),onSelect:H=>a.handleSelectUserId(H,r.id)},{default:s(()=>[t(I,{class:"size-32 inline-block rounded-10",name:r.full_name,src:r.avatar},null,8,["name","src"])]),_:2},1032,["mode","selected","onSelect"]),t(_,null,{default:s(()=>[f("div",ve,[f("div",be,[t(U,null,{default:s(()=>[d(p(r.full_name),1)]),_:2},1024),r.email?(n(),u(U,{key:0,color:"gray"},{default:s(()=>[d(p(r.email),1)]),_:2},1024)):b("",!0)]),r.active?(n(),u(S,{key:1,authType:r.auth_type,onboardedViaSecret:r.onboarded_via_secret},null,8,["authType","onboardedViaSecret"])):(n(),y("div",ye,[t(v,{variation:"gray-fill",title:e.$t("INACTIVE")},null,8,["title"])]))])]),_:2},1024),t(_,null,{default:s(()=>[f("div",Ie,[r.teams.length>0?(n(),u(U,{key:0,truncate:""},{default:s(()=>[d(p(r.teams[0]),1)]),_:2},1024)):(n(),u(B,{key:1,to:"/settings/teams"},{default:s(()=>[t(U,{class:"cursor-pointer",color:"subdued"},{default:s(()=>[d("No team assigned")]),_:1})]),_:1})),a.showOtherTeamsLabelForUser(r)?(n(),y("div",Te,[t(v,{variation:"gray-fill",title:e.$t("X_OTHERS",r.teams.length-1)},null,8,["title"]),t(V,null,{default:s(()=>[f("span",we,p(r.teams.slice(1).join(`
`)),1)]),_:2},1024)])):b("",!0)])]),_:2},1024),t(_,null,{default:s(()=>[t(U,null,{default:s(()=>[d(p(a.getUserRole(r))+p(r.read_only?" (read-only)":""),1)]),_:2},1024)]),_:2},1024),t(_,{class:"desktop-small_hidden"},{default:s(()=>[t(U,null,{default:s(()=>[d(p(a.getUserLastLogin(r)),1)]),_:2},1024)]),_:2},1024),a.canDoActions(r)?(n(),u(O,{key:1,sections:a.getActionsForUser(r),"always-visible":""},null,8,["sections"])):(n(),u(_,{key:0}))]),_:2},1032,["disabled"]))),128)),G(e.$slots,"extraUserRows")]),_:3})}const Se=k(Ue,[["render",ke]]),Ae={emits:["userInviteRevoked"],props:{userInvites:Array},components:{AvatarImage:R,DataTableRow:L,DataTableCell:$,BaseParagraph:E,DataTableActionsCell:P},methods:{getActionsForUserInvite(e){return[{title:"Actions",items:[{label:"Revoke invite",onClick:()=>this.revokeUserInvite(e.email),icon:"icon-close"}]}]},async revokeUserInvite(e){await q(e),this.$toast.success({title:this.$t("SUCCESS"),description:"User invite successfully revoked"}),this.$emit("userInviteRevoked")}}},Ce={class:"flex flex-column gap-2px"};function xe(e,i,l,m,h,a){const g=o("AvatarImage"),c=o("DataTableCell"),I=o("BaseParagraph"),T=o("DataTableActionsCell"),U=o("DataTableRow");return n(!0),y(A,null,M(l.userInvites,v=>(n(),u(U,{key:"user_invite_"+v.id,disabled:!0},{default:s(()=>[t(c,{spacing:"compact",alignment:"center"},{default:s(()=>[t(g,{class:"size-32 inline-block rounded-10",name:v.email},null,8,["name"])]),_:2},1024),t(c,null,{default:s(()=>[f("div",Ce,[t(I,null,{default:s(()=>[d(p(v.email),1)]),_:2},1024),t(I,null,{default:s(()=>[d("Pending invite")]),_:1})])]),_:2},1024),t(c),t(c,null,{default:s(()=>[t(I,null,{default:s(()=>[d(p(e.$t("ROLE_"+v.role)),1)]),_:2},1024)]),_:2},1024),t(c,{class:"desktop-small_hidden"}),t(T,{sections:a.getActionsForUserInvite(v),"always-visible":""},null,8,["sections"])]),_:2},1024))),128)}const De=k(Ae,[["render",xe]]),Re={components:{UserList:Se,InvitedUserRows:De,BaseButton:J,UserInviteModal:Q,SettingsEmptyState:re,EmptyUsersIllustration:ce,InputSearch:K},data(){return{loaded:!1,users:[],teams:[],pendingUserInvites:[],showUserInviteModal:!1,selectedUserIds:[],showArchivedUsers:!1,search:""}},async mounted(){await Promise.all([this.loadUsers(),this.loadTeams(),this.loadPendingUserInvites()]),this.loaded=!0},watch:{$teamContext(){this.loadUsers()}},computed:{showEmptyState(){return this.$groupUser.admin?this.loaded&&this.users.length<=2:!1},visibleUsers(){const e=this.users.filter(m=>!!m.active);let i=e;if(this.showArchivedUsers&&(i=[...e,...this.archivedUsers]),!this.search)return i;const l=this.search.toLowerCase();return i.filter(m=>m.email&&m.email.toLowerCase().includes(l)?!0:m.full_name.toLowerCase().includes(l))},archivedUsers(){return this.users.filter(e=>!e.active)},toggleShowArchiveText(){return this.showArchivedUsers?this.$t("HIDE_ARCHIVED"):this.$t("SHOW_X_ARCHIVED",this.archivedUsers.length)},visiblePendingUserInvites(){if(!this.search)return this.pendingUserInvites;const e=this.search.toLowerCase();return this.pendingUserInvites.filter(i=>i.email.toLowerCase().includes(e))},canChangeAutoOnboardingSettings(){return this.$groupUser.admin?["github","gitlab","bitbucket"].includes(this.$group.scm_type):!1},shouldShowUsersSettings(){return!!this.$groupUser.admin}},methods:{async loadUsers(){this.users=await Z()},async loadTeams(){this.teams=await ee()},async loadPendingUserInvites(){this.pendingUserInvites=await te()},handleShowCreateTeamModal(){this.$modal.show("CreateTeamModal",{userIds:this.selectedUserIds})},async reloadUsers(){this.loaded=!1,await Promise.all([this.loadUsers(),this.loadPendingUserInvites()]),this.loaded=!0},handleShowUserInviteModal(){if(se.data.group.is_demo_group===1)return this.$modal.show("AddWorkspaceRedirectModal");this.showUserInviteModal=!0},handleShowUsersSettingsModal(){this.$modal.show("UsersSettingsModal",{showAutoJoinSetting:this.canChangeAutoOnboardingSettings})}}},Ee={class:"mb-16px flex justify-between align-center gap-8px flex-1"},Me={class:"flex justify-between align-center gap-8px"},Le={key:0,class:"overflow-hidden"},$e=f("i",{class:"icon icon-settings"},null,-1),Pe=f("i",{class:"icon icon-user_add"},null,-1),Be=f("i",{class:"icon icon-user"},null,-1),Ve={key:1,class:"mt-24px"};function Oe(e,i,l,m,h,a){const g=o("InputSearch"),c=o("BaseButton"),I=o("InvitedUserRows"),T=o("UserList"),U=o("EmptyUsersIllustration"),v=o("SettingsEmptyState"),S=o("UserInviteModal");return n(),y(A,null,[f("div",Ee,[f("div",null,[t(g,{spacing:"compact",modelValue:h.search,"onUpdate:modelValue":i[0]||(i[0]=_=>h.search=_)},null,8,["modelValue"])]),f("div",Me,[t(ae,{name:"expand-horizontal-"},{default:s(()=>[h.selectedUserIds.length>0?(n(),y("div",Le,[t(c,{variation:"blue",size:"small",onClick:a.handleShowCreateTeamModal},{default:s(()=>[d("Create team")]),_:1},8,["onClick"])])):b("",!0)]),_:1}),a.shouldShowUsersSettings?(n(),u(c,{key:0,size:"small",variation:"filter",onClick:a.handleShowUsersSettingsModal,class:"text--semi-bold"},{default:s(()=>[$e,d(" Settings ")]),_:1},8,["onClick"])):b("",!0),e.$groupUser.admin?(n(),u(c,{key:1,size:"small",onClick:a.handleShowUserInviteModal},{default:s(()=>[Pe,d(" "+p(e.$t("ADD")),1)]),_:1},8,["onClick"])):b("",!0)])]),t(T,{onLoaded:i[1]||(i[1]=_=>h.loaded=!0),users:a.visibleUsers,teams:h.teams,"selected-user-ids":h.selectedUserIds,"onUpdate:selectedUserIds":i[2]||(i[2]=_=>h.selectedUserIds=_),onReloadUsers:a.reloadUsers},{extraUserRows:s(()=>[t(I,{userInvites:a.visiblePendingUserInvites,onUserInviteRevoked:a.loadPendingUserInvites},null,8,["userInvites","onUserInviteRevoked"])]),_:1},8,["users","teams","selected-user-ids","onReloadUsers"]),a.archivedUsers.length>0?(n(),u(c,{key:0,class:"mt-8px",variation:"tertiary",onClick:i[3]||(i[3]=_=>h.showArchivedUsers=!h.showArchivedUsers)},{default:s(()=>[Be,d(" "+p(a.toggleShowArchiveText),1)]),_:1})):b("",!0),a.showEmptyState?(n(),y("div",Ve,[t(v,{title:e.$t("SETTINGS.USERS.OVERVIEW.EMPTY_STATE_TITLE"),description:e.$t("SETTINGS.USERS.OVERVIEW.EMPTY_STATE_DESCRIPTION"),actionLabel:e.$t("SETTINGS.USERS.OVERVIEW.EMPTY_STATE_ACTION_LABEL"),onAction:a.handleShowUserInviteModal},{default:s(()=>[t(U)]),_:1},8,["title","description","actionLabel","onAction"])])):b("",!0),h.showUserInviteModal?(n(),u(S,{key:2,showModal:h.showUserInviteModal,"onUpdate:showModal":i[4]||(i[4]=_=>h.showUserInviteModal=_),onNewUserInvited:a.loadPendingUserInvites},null,8,["showModal","onNewUserInvited"])):b("",!0)],64)}const qe=k(Re,[["render",Oe]]);export{qe as default};
