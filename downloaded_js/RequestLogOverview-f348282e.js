import{_ as C,B as I,a2 as E,r as o,q as s,k as T,w as l,o as e,s as c,u as v,a1 as P,bt as N,N as U,dJ as $,m as h,n as m,p as L,S as F,t as k,F as y,al as V,I as H,dz as K,aw as W,dK as G}from"./index-13ff96f4.js";import{u as j}from"./useInfiniteScroll-47c60c9e.js";import{D as z,a as X}from"./DataTable-e31a825a.js";import{b as J}from"./dateFns-a344cb79.js";import{a as D,D as O}from"./DataTableCell-51c0104f.js";import{F as q}from"./FilterButton-bb5393a7.js";import{A as Q}from"./ActionMenu-3e4470bf.js";import{I as Y}from"./InputFilterDropdown-674351d9.js";import{B as Z}from"./BaseCallout-aea0aba4.js";import"./index-b87db690.js";const ee={props:{requestLog:Object,openModal:Boolean},components:{BaseParagraph:I,DataTableRow:D,DataTableCell:O,XTooltip:E},mounted(){this.openModal&&(this.handleShowDetails(),this.$emit("update:openModal",!1))},computed:{formattedTimestamp(){return J(this.requestLog.timestamp)},formattedRequestDuration(){return this.requestLog.status_code<1?"Time Out":`${this.requestLog.request_duration} ms`},statusCodeText(){return this.requestLog.status_code<1?"Time Out":this.requestLog.status_code}},methods:{handleShowDetails(){this.$modal.show("RequestLogDetailsModal",{requestLog:this.requestLog})}}};function te(t,a,d,f,r,n){const i=o("BaseParagraph"),u=o("DataTableCell"),g=o("XTooltip"),_=o("DataTableRow");return s(),T(_,{clickable:"",onClick:n.handleShowDetails},{default:l(()=>[e(u,null,{default:l(()=>[e(i,null,{default:l(()=>[c(v(d.requestLog.method),1)]),_:1})]),_:1}),e(u,null,{default:l(()=>[e(i,{truncate:""},{default:l(()=>[c(v(d.requestLog.url),1),e(g,null,{default:l(()=>[c(v(d.requestLog.url),1)]),_:1})]),_:1})]),_:1}),e(u,null,{default:l(()=>[e(i,null,{default:l(()=>[c(v(n.statusCodeText),1)]),_:1})]),_:1}),e(u,null,{default:l(()=>[e(i,{truncate:""},{default:l(()=>[c(v(d.requestLog.attack_type_title),1)]),_:1})]),_:1}),e(u,null,{default:l(()=>[e(i,null,{default:l(()=>[c(v(n.formattedRequestDuration),1)]),_:1})]),_:1}),e(u,null,{default:l(()=>[e(i,null,{default:l(()=>[c(v(n.formattedTimestamp)+" ago",1)]),_:1})]),_:1})]),_:1},8,["onClick"])}const ae=C(ee,[["render",te]]),le={props:{requestLog:Object},components:{DataTableCell:O,DataTableRow:D,LoadingSkeleton:P}};function oe(t,a,d,f,r,n){const i=o("LoadingSkeleton"),u=o("DataTableCell"),g=o("DataTableRow");return s(),T(g,null,{default:l(()=>[e(u,null,{default:l(()=>[e(i,{height:"16px"})]),_:1}),e(u,null,{default:l(()=>[e(i,{height:"16px"})]),_:1}),e(u,null,{default:l(()=>[e(i,{height:"16px"})]),_:1}),e(u,null,{default:l(()=>[e(i,{height:"16px"})]),_:1}),e(u,null,{default:l(()=>[e(i,{height:"16px"})]),_:1})]),_:1})}const ne=C(le,[["render",oe]]),se={components:{BaseParagraph:I,BasePopover:N,BaseSelect:U,FilterButton:q},props:{domainId:[Number,String]},emits:["selectFilter"],data(){return{attackTypeFilter:null,attackTypes:[]}},async mounted(){await this.loadAttackTypes()},computed:{filter(){var a;let t=[];if(this.attackTypeFilter&&t.push((a=this.selectedAttackTypeFilter)==null?void 0:a.name),t.length!==0)return t.join(", ")},hasFilter(){return!!this.attackTypeFilter},selectedAttackTypeFilter(){return this.attackTypes.find(t=>t.id==this.attackTypeFilter)},sections(){const t=this.attackTypes.map(a=>({label:a.name,onClick:()=>this.handleChangeAttackType(a.id),active:this.attackTypeFilter==a.id}));return[{title:"Attack type filter",action:{label:"Clear filter",onClick:()=>this.handleClearFilter()},items:t}]}},methods:{emitFilter(){this.$emit("selectFilter",{attackTypeFilter:this.attackTypeFilter})},handleClearFilter(){this.attackTypeFilter=null,this.emitFilter()},handleChangeAttackType(t){const a=this.attackTypeFilter==t;!t||t===""||a?this.attackTypeFilter=null:this.attackTypeFilter=t,this.emitFilter()},async loadAttackTypes(){const t=await $({domainId:this.domainId});this.attackTypes=t.attackTypes.sort((a,d)=>(""+a.name).localeCompare(d.name))}}},ie=m("i",{class:"icon icon-filter icon-12px"},null,-1),re={key:0},ue={class:"text-primary-aik-100"},de={class:"action-menu w-280px"},ce={key:0,class:"action-menu__section-title"},pe=["disabled","onClick"],he={class:"action-menu__section-items"},me=["onClick","disabled"];function _e(t,a,d,f,r,n){const i=o("i18n-t"),u=o("FilterButton"),g=o("BasePopover");return s(),T(g,{placement:"bottom-start"},{trigger:l(_=>[e(u,{onClick:_.toggle,class:F({"filter-button--active":n.hasFilter})},{default:l(()=>[ie,n.filter?(s(),h("span",re,[e(i,{keypath:"REQUEST_LOG_OVERVIEW.ATTACK_TYPE.LABEL"},{filter:l(()=>[m("span",ue,v(n.filter),1)]),_:1})])):L("",!0)]),_:2},1032,["onClick","class"])]),content:l(()=>[m("div",de,[(s(!0),h(y,null,k(n.sections,(_,A)=>(s(),h("div",{key:A,class:"action-menu__section"},[_.title?(s(),h("div",ce,[m("p",null,v(_.title),1),_.action?(s(),h("button",{key:0,disabled:_.action.disabled,class:"button-brand button--as-link",onClick:_.action.onClick},v(_.action.label),9,pe)):L("",!0)])):L("",!0),m("ul",he,[(s(!0),h(y,null,k(_.items,(p,w)=>(s(),h("li",{key:w,class:F(["action-menu__section__item",[p.active&&"action-menu__section__item--active",p.destructive&&"action-menu__section__item--destructive"]])},[m("button",{onClick:S=>p.onClick(S),disabled:p.disabled,class:"action-menu__section__item-button"},[p.icon?(s(),h("i",{key:0,class:F(["icon icon-14px mr-12px",[p.icon]])},null,2)):L("",!0),c(" "+v(p.label),1)],8,me)],2))),128))])]))),128))])]),_:1})}const be=C(se,[["render",_e]]),ve={components:{ActionMenu:Q,FilterButton:q},emits:["refresh"],props:{domain:Object},computed:{canExportOpenApiSpec(){return!this.$groupUser.only_team_related_issues},actions(){var a;const t=[];return((a=this.domain)==null?void 0:a.scan_type)==="akto"&&t.push({visible:this.canExportOpenApiSpec,label:"Download OpenAPI spec",onClick:this.handleDownloadOpenapiSpec,icon:"icon-download"}),[{title:"Actions",items:t.filter(d=>d.visible!==!1)}]},showActionMenu(){return this.actions.some(t=>t.items.length>0)}},methods:{handleDownloadOpenapiSpec(){console.log(this.domain),this.$modal.show("DownloadOpenApiSpecModal",{domainId:this.domain.domain_id})}}},ge=m("i",{class:"icon icon-caret_down icon-12px"},null,-1);function fe(t,a,d,f,r,n){const i=o("FilterButton"),u=o("ActionMenu");return s(),T(u,{sections:n.actions,placement:"bottom-end",useBaseIcon:!0},{trigger:l(g=>[n.showActionMenu?(s(),T(i,{key:0,onClick:()=>g.toggle()},{default:l(()=>[c(" Actions "),ge]),_:2},1032,["onClick"])):L("",!0)]),_:1},8,["sections"])}const Te=C(ve,[["render",fe]]),Le={props:{shouldShowReAuthBanner:{type:Boolean,default:!1},shouldShowWhiteListIpBanner:{type:Boolean,default:!1}},components:{AttackTypeFilter:be,BaseParagraph:I,DataTable:z,DataTableHeader:X,LoadingSpinner:V,RequestLogOverviewActions:Te,RequestLogOverviewTableRow:ae,RequestLogOverviewTableRowLoading:ne,InputSearch:H,BaseCallout:Z,InputFilterDropdown:Y},data(){return{isLoading:!0,domain:null,filter:{},searchTerm:"",selectedMethod:"all",methodOptions:[{value:"all",label:"All Methods",default:!0},{value:"GET",label:"GET"},{value:"POST",label:"POST"},{value:"PUT",label:"PUT"},{value:"PATCH",label:"PATCH"},{value:"DELETE",label:"DELETE"},{value:"HEAD",label:"HEAD"},{value:"OPTIONS",label:"OPTIONS"}],selectedStatusCode:"all",statusCodeOptions:[{value:"all",label:"All Status Codes",default:!0},{value:100,label:"100 - Continue"},{value:101,label:"101 - Switching Protocols"},{value:102,label:"102 - Processing"},{value:103,label:"103 - Early Hints"},{value:200,label:"200 - OK"},{value:201,label:"201 - Created"},{value:202,label:"202 - Accepted"},{value:203,label:"203 - Non-Authoritative Information"},{value:204,label:"204 - No Content"},{value:205,label:"205 - Reset Content"},{value:206,label:"206 - Partial Content"},{value:207,label:"207 - Multi-Status"},{value:208,label:"208 - Already Reported"},{value:226,label:"226 - IM Used"},{value:300,label:"300 - Multiple Choices"},{value:301,label:"301 - Moved Permanently"},{value:302,label:"302 - Found"},{value:303,label:"303 - See Other"},{value:304,label:"304 - Not Modified"},{value:305,label:"305 - Use Proxy"},{value:306,label:"306 - Switch Proxy"},{value:307,label:"307 - Temporary Redirect"},{value:308,label:"308 - Permanent Redirect"},{value:400,label:"400 - Bad Request"},{value:401,label:"401 - Unauthorized"},{value:402,label:"402 - Payment Required"},{value:403,label:"403 - Forbidden"},{value:404,label:"404 - Not Found"},{value:405,label:"405 - Method Not Allowed"},{value:406,label:"406 - Not Acceptable"},{value:407,label:"407 - Proxy Authentication Required"},{value:408,label:"408 - Request Timeout"},{value:409,label:"409 - Conflict"},{value:410,label:"410 - Gone"},{value:411,label:"411 - Length Required"},{value:412,label:"412 - Precondition Failed"},{value:413,label:"413 - Payload Too Large"},{value:414,label:"414 - URI Too Long"},{value:415,label:"415 - Unsupported Media Type"},{value:416,label:"416 - Range Not Satisfiable"},{value:417,label:"417 - Expectation Failed"},{value:418,label:"418 - I'm a teapot"},{value:421,label:"421 - Misdirected Request"},{value:422,label:"422 - Unprocessable Entity"},{value:423,label:"423 - Locked"},{value:424,label:"424 - Failed Dependency"},{value:425,label:"425 - Too Early"},{value:426,label:"426 - Upgrade Required"},{value:428,label:"428 - Precondition Required"},{value:429,label:"429 - Too Many Requests"},{value:431,label:"431 - Request Header Fields Too Large"},{value:451,label:"451 - Unavailable For Legal Reasons"},{value:500,label:"500 - Internal Server Error"},{value:501,label:"501 - Not Implemented"},{value:502,label:"502 - Bad Gateway"},{value:503,label:"503 - Service Unavailable"},{value:504,label:"504 - Gateway Timeout"},{value:505,label:"505 - HTTP Version Not Supported"},{value:506,label:"506 - Variant Also Negotiates"},{value:507,label:"507 - Insufficient Storage"},{value:508,label:"508 - Loop Detected"},{value:510,label:"510 - Not Extended"},{value:511,label:"511 - Network Authentication Required"}],openLogModal:!1}},setup(){const{records:t,fetch:a,reset:d,watchElement:f,hasFetchedAllRecords:r}=j(G,30,n=>n.requestLogs);return{requestLogs:t,resetRequestLogs:d,fetchRequestLogs:a,watchElement:f,hasFetchedAllLogs:r}},async mounted(){const{guid:t}=this.$route.query;t&&(this.searchTerm=t),await Promise.allSettled([this.getRequestLogs(),this.getDomain()]),t&&this.requestLogs.length===1&&(this.openLogModal=!0),this.isLoading=!1,await this.$nextTick(),this.watchElement(this.$refs.tableBottom,{threshold:0,rootMargin:"400px"})},computed:{domainId(){return this.$route.params.domainId}},methods:{async getRequestLogs(){await this.fetchRequestLogs({domainId:this.domainId,...this.filter,search:this.searchTerm,method:this.selectedMethod,statusCode:this.selectedStatusCode})},async getDomain(){this.domain=await K(this.domainId)},handleChangeFilters(t){this.filter={...this.filter,...t},this.resetRequestLogs({domainId:this.domainId,...this.filter,search:this.searchTerm,method:this.selectedMethod,statusCode:this.selectedStatusCode})},onSearchChanged:W(function(){this.handleChangeFilters()},400)}},ye={key:0,class:"mb-24px"},Ce={key:1,class:"mb-24px"},ke={class:"flex flex-column gap-16px"},Ae={class:"flex gap-8px"},we={class:"ml-auto"},Se={ref:"tableBottom"},Fe={class:"data-table__bottom"},Ie=m("hr",null,null,-1),Re={key:0,class:"flex align-center gap-8px"},De=m("hr",null,null,-1);function Oe(t,a,d,f,r,n){const i=o("BaseCallout"),u=o("InputSearch"),g=o("InputFilterDropdown"),_=o("AttackTypeFilter"),A=o("RequestLogOverviewActions"),p=o("DataTableHeader"),w=o("RequestLogOverviewTableRowLoading"),S=o("RequestLogOverviewTableRow"),M=o("DataTable"),x=o("LoadingSpinner"),R=o("BaseParagraph");return s(),h(y,null,[d.shouldShowWhiteListIpBanner?(s(),h("div",ye,[e(i,{title:t.$t("DOMAIN.AKTO.CALLOUT.WHITELIST_IP.TITLE"),description:t.$t("DOMAIN.AKTO.CALLOUT.WHITELIST_IP.DESC"),actionLabel:t.$t("DOMAIN.AKTO.CALLOUT.WHITELIST_IP.ACTION"),onAction:a[0]||(a[0]=b=>t.$emit("whitelistIp")),variation:"danger"},null,8,["title","description","actionLabel"])])):d.shouldShowReAuthBanner?(s(),h("div",Ce,[e(i,{title:t.$t("DOMAIN.AKTO.CALLOUT.TITLE"),description:t.$t("DOMAIN.AKTO.CALLOUT.DESC"),actionLabel:t.$t("DOMAIN.AKTO.CALLOUT.ACTION"),onAction:a[1]||(a[1]=b=>t.$emit("authenticate")),variation:"danger"},null,8,["title","description","actionLabel"])])):L("",!0),m("div",ke,[m("div",Ae,[e(u,{modelValue:r.searchTerm,"onUpdate:modelValue":[a[2]||(a[2]=b=>r.searchTerm=b),n.onSearchChanged],spacing:"compact",disableDebounce:!0},null,8,["modelValue","onUpdate:modelValue"]),e(g,{modelValue:r.selectedMethod,"onUpdate:modelValue":[a[3]||(a[3]=b=>r.selectedMethod=b),a[4]||(a[4]=()=>n.handleChangeFilters())],options:r.methodOptions},null,8,["modelValue","options"]),e(g,{modelValue:r.selectedStatusCode,"onUpdate:modelValue":[a[5]||(a[5]=b=>r.selectedStatusCode=b),a[6]||(a[6]=()=>n.handleChangeFilters())],options:r.statusCodeOptions,dropDownMaxHeight:300},null,8,["modelValue","options"]),e(_,{"domain-id":n.domainId,onSelectFilter:n.handleChangeFilters},null,8,["domain-id","onSelectFilter"]),m("div",we,[e(A,{domain:r.domain},null,8,["domain"])])]),e(M,null,{header:l(()=>[e(p,{width:"100px"},{default:l(()=>[c("Method")]),_:1}),e(p,{width:"auto"},{default:l(()=>[c("URL")]),_:1}),e(p,{width:"100px"},{default:l(()=>[c("Status")]),_:1}),e(p,{width:"325px"},{default:l(()=>[c("Attack")]),_:1}),e(p,{width:"100px"},{default:l(()=>[c("Duration")]),_:1}),e(p,{width:"200px"},{default:l(()=>[c("Timestamp")]),_:1})]),body:l(()=>[r.isLoading?(s(),h(y,{key:0},k(5,b=>e(w,{key:b})),64)):(s(!0),h(y,{key:1},k(f.requestLogs,b=>(s(),T(S,{key:b.id,"request-log":b,openModal:r.openLogModal,"onUpdate:openModal":a[7]||(a[7]=B=>r.openLogModal=B)},null,8,["request-log","openModal"]))),128))]),_:1}),m("div",Se,[m("div",Fe,[Ie,f.hasFetchedAllLogs?(s(),T(R,{key:1,color:"gray"},{default:l(()=>[c("We have no more logs to show")]),_:1})):(s(),h("div",Re,[e(x,{color:"#6551F3",backgroundColor:"#E0DCFD"}),e(R,{color:"gray"},{default:l(()=>[c("Hang on, we're fetching more logs for you")]),_:1})])),De])],512)])],64)}const He=C(Le,[["render",Oe]]);export{He as default};
