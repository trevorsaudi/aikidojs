import{_ as v,M as P,f as T,B as M,H as k,dX as S,an as g,r as n,q as d,k as C,w as t,o,s as c,u as p,n as a,p as f,m as b,aa as x,F as B,aV as A,bt as y,N as F,S as U,ai as N,I,dW as O,aR as V,t as $}from"./index-13ff96f4.js";import{T as D,a as H}from"./TableListHeader-e50d01d1.js";import{R as z}from"./RuleComplianceStatus-87ae0def.js";import{A as j}from"./ActionMenu-3e4470bf.js";import{F as W}from"./FilterButton-bb5393a7.js";import"./DataTable-e31a825a.js";const q={props:{show:Boolean},components:{BaseModal:P,BaseButton:T,BaseParagraph:M,BaseHeading:k},emits:["cancel","confirm"],inject:["cloudRule"],methods:{handleCancel(){this.$emit("cancel")},async handleConfirm(){await S(this.cloudRule.ignored_by_id),this.$emit("confirm"),g.emit("issueUpdated"),Toast.success({title:this.$t("NOTIFICATIONS.RULE_ENABLE.TITLE"),description:"We successfulle re-enabled this cloud rule and its issues for you"})}}},G={class:"flex flex-column gap-12px"},Q=["innerHTML"];function X(e,s,u,E,_,l){const r=n("BaseParagraph"),m=n("BaseHeading"),i=n("BaseButton"),R=n("BaseModal");return u.show?(d(),C(R,{key:0,width:600,onClose:l.handleCancel},{header:t(()=>[o(r,{color:"gray"},{default:t(()=>[c(p(e.$t("ENABLE_CLOUD_RULE_MODAL.TITLE")),1)]),_:1})]),content:t(()=>[a("div",G,[o(m,{as:"h3"},{default:t(()=>[a("span",{innerHTML:e.$t("ENABLE_CLOUD_RULE_MODAL.DESCRIPTION",{checkName:l.cloudRule.title})},null,8,Q)]),_:1}),o(r,{size:"medium",loose:""},{default:t(()=>[c(p(e.$t("ENABLE_CLOUD_RULE_MODAL.DESCRIPTION_META",{issueCount:e.issueGroup.issues.length})),1)]),_:1})])]),footer:t(()=>[o(i,{onClicked:l.handleCancel,variation:"plain",class:"ml-auto"},{default:t(()=>[c(p(e.$t("ENABLE_CLOUD_RULE_MODAL.CANCEL")),1)]),_:1},8,["onClicked"]),o(i,{onClicked:l.handleConfirm},{default:t(()=>[c(p(e.$t("ENABLE_CLOUD_RULE_MODAL.NEXT")),1)]),_:1},8,["onClicked"])]),_:1},8,["onClose"])):f("",!0)}const K=v(q,[["render",X]]),J={components:{ActionMenu:j,ReEnableCloudRuleModal:K},data(){return{showReEnableCloudRuleModal:!1}},computed:{actions(){return[{title:this.$t("RULE_COMPLIANCE_ACTION_MENU.TITLE"),items:[{label:this.$t("RULE_COMPLIANCE_ACTION_MENU.RE_ENABLE"),onClick:this.handleShowReEnableRuleModal,icon:"icon-shield_check"}]}]}},methods:{handleShowReEnableRuleModal(){this.showReEnableCloudRuleModal=!0},handleCloseReEnableRuleModal(){this.showReEnableCloudRuleModal=!1}}};function Y(e,s,u,E,_,l){const r=n("ActionMenu"),m=n("ReEnableCloudRuleModal");return d(),b(B,null,[o(r,{sections:l.actions,placement:"bottom-end"},{trigger:t(i=>[x(e.$slots,"trigger",{toggle:i.toggle})]),_:3},8,["sections"]),o(m,{show:_.showReEnableCloudRuleModal,onCancel:l.handleCloseReEnableRuleModal,onConfirm:l.handleCloseReEnableRuleModal},null,8,["show","onCancel","onConfirm"])],64)}const Z=v(J,[["render",Y]]),ee={props:{cloudRule:Object,isActionMenuVisible:{type:Boolean,required:!0}},components:{BaseParagraph:M,CheckComplianceStatus:z,RuleComplianceActionMenu:Z},data(){return{}},provide(){return{cloudRule:A(()=>this.cloudRule)}},inject:["hasCloudsConnected"],computed:{shortCloudRuleCode(){return this.cloudRule.code.replace("aik_cloud_","")}}},le={class:"tr mobile_flex mobile_flex-col"},te={class:"td mobile_max-w-full mobile_w-full w-8p max-w-0 mobile_border-b-0 truncate"},oe={class:"td mobile_max-w-full mobile_w-full w-28p max-w-0 mobile_border-b-0 collapsing"},se={class:"td mobile_max-w-full mobile_w-full w-40p max-w-0 mobile_border-b-0 collapsing"},ne={key:1,class:"td compact mobile_max-w-full mobile_w-full w-1p"},ae=["onClick"],ie=a("i",{class:"icon icon-actions"},null,-1),de=[ie];function ce(e,s,u,E,_,l){const r=n("BaseParagraph"),m=n("CheckComplianceStatus"),i=n("RuleComplianceActionMenu");return d(),b("div",le,[a("div",te,[o(r,null,{default:t(()=>[c(p(l.shortCloudRuleCode),1)]),_:1})]),a("div",oe,[o(r,null,{default:t(()=>[c(p(u.cloudRule.title),1)]),_:1})]),a("div",se,[o(r,{loose:!0},{default:t(()=>[c(p(u.cloudRule.description),1)]),_:1})]),l.hasCloudsConnected?(d(),C(m,{key:0,class:"td mobile_max-w-full mobile_w-full w-12p max-w-0 mobile_border-b-0 collapsing truncate",status:u.cloudRule.compliance_status},null,8,["status"])):f("",!0),l.hasCloudsConnected&&u.isActionMenuVisible?(d(),b("div",ne,[u.cloudRule.isActionPossible?(d(),C(i,{key:0},{trigger:t(R=>[a("button",{onClick:R.toggle,class:"icon-button"},de,8,ae)]),_:1})):f("",!0)])):f("",!0)])}const re=v(ee,[["render",ce]]),ue={components:{BasePopover:y,BaseParagraph:M,BaseSelect:F,FilterButton:W},emits:["filterSelected"],data(){return{cloudProviders:[{id:"aws",title:"AWS"},{id:"gcp",title:"GCP"},{id:"azure",title:"Azure"},{id:"digocean",title:"DigitalOcean"}],selectedCloudProvider:null}},computed:{hasFilter(){return!!this.selectedCloudProvider},filter(){return this.selectedCloudProvider?this.cloudProviders.find(e=>e.id===this.selectedCloudProvider).title:null}},methods:{handleClearFilters(){this.selectedCloudProvider=null,this.emitFilterSelected()},handleChangeCloudProvider(e){this.selectedCloudProvider=e,this.emitFilterSelected()},emitFilterSelected(){this.$emit("filterSelected",{cloudProvider:this.selectedCloudProvider})}}},_e=a("i",{class:"icon icon-filter icon-12px"},null,-1),me={key:0},he={class:"text-primary-aik-100"},Ce={class:"flex flex-column gap-16px w-279px py-16px px-24px"},pe={class:"flex justify-between align-center"},fe={class:"grid gap-16px align-center",style:{"grid-template-columns":"1fr 1fr"}};function Re(e,s,u,E,_,l){const r=n("i18n-t"),m=n("FilterButton"),i=n("BaseParagraph"),R=n("BaseSelect"),w=n("BasePopover");return d(),C(w,{placement:"bottom-start"},{trigger:t(h=>[o(m,{onClick:h.toggle,class:U({"filter-button--active":l.hasFilter})},{default:t(()=>[_e,l.filter?(d(),b("span",me,[o(r,{keypath:"QUEUE.QUICK_FILTER.LABEL"},{filter:t(()=>[a("span",he,p(l.filter),1)]),_:1})])):f("",!0)]),_:2},1032,["onClick","class"])]),content:t(h=>[a("div",Ce,[a("div",pe,[o(i,{size:"small",color:"gray",bold:""},{default:t(()=>[c("Filter By")]),_:1}),a("button",{class:"button-brand button--as-link",onClick:s[0]||(s[0]=(...L)=>l.handleClearFilters&&l.handleClearFilters(...L))},"Clear all filters")]),a("div",fe,[o(i,{size:"small"},{default:t(()=>[c("Cloud provider")]),_:1}),o(R,{modelValue:_.selectedCloudProvider,"onUpdate:modelValue":L=>{l.handleChangeCloudProvider(L),h.close()},options:_.cloudProviders,onClick:s[1]||(s[1]=N(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","options"])])])]),_:1})}const be=v(ue,[["render",Re]]),ge={components:{TableList:D,TableListHeader:H,RuleComplianceOverviewRow:re,RuleComplianceFilter:be,InputSearch:I},data(){return{loaded:!1,cloudRules:[],clouds:[],searchTerm:"",selectedCloudProvider:null}},computed:{cloudId(){return this.$route.params.id},hasCloudsConnected(){return this.clouds.length>0},isActionMenuVisible(){if(!this.hasCloudsConnected)return!1;for(const e of this.visibleCloudRules)if(e.isActionPossible)return!0;return!1},isCloudDetailPage(){return!!this.cloudId},visibleCloudRules(){let e=this.cloudRules;return this.selectedCloudProvider&&(e=e.filter(s=>s.code.includes(this.selectedCloudProvider))),this.searchTerm&&(e=e.filter(s=>s.title.toLowerCase().includes(this.searchTerm.toLowerCase())||s.description.toLowerCase().includes(this.searchTerm.toLowerCase()))),e.map(s=>({...s,isActionPossible:s.compliance_status==="disabled"&&s.ignored_by==="rule"}))}},provide(){return{hasCloudsConnected:A(()=>this.hasCloudsConnected)}},async mounted(){await Promise.all([this.loadCloudRules(),this.loadClouds()])},created(){g.on("issueUpdated",this.loadCloudRules),g.on("cloudScanFinished",this.loadCloudRules)},beforeUnmount(){g.off("issueUpdated",this.loadCloudRules),g.off("cloudScanFinished",this.loadCloudRules)},methods:{async loadCloudRules(){this.cloudRules=await O(this.cloudId)},async loadClouds(){this.clouds=await V()},handleFilterSelected({cloudProvider:e}){this.selectedCloudProvider=e},handleChangeSearchTerm(e){this.searchTerm=e}}},ve={class:"flex align-center gap-8px mb-16px"},Ee={class:"thead mobile_hidden"},we={class:"tr"},Le={class:"tbody"};function Be(e,s,u,E,_,l){const r=n("InputSearch"),m=n("RuleComplianceFilter"),i=n("TableListHeader"),R=n("RuleComplianceOverviewRow"),w=n("TableList");return d(),b(B,null,[a("div",ve,[o(r,{modelValue:_.searchTerm,"onUpdate:modelValue":[s[0]||(s[0]=h=>_.searchTerm=h),l.handleChangeSearchTerm],spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),l.isCloudDetailPage?f("",!0):(d(),C(m,{key:0,onFilterSelected:l.handleFilterSelected},null,8,["onFilterSelected"]))]),o(w,null,{default:t(()=>[a("div",Ee,[a("div",we,[o(i,null,{default:t(()=>[c("Rule code")]),_:1}),o(i,null,{default:t(()=>[c("Title")]),_:1}),o(i,null,{default:t(()=>[c("Description")]),_:1}),l.hasCloudsConnected?(d(),C(i,{key:0},{default:t(()=>[c("Compliance")]),_:1})):f("",!0),l.isActionMenuVisible?(d(),C(i,{key:1})):f("",!0)])]),a("div",Le,[(d(!0),b(B,null,$(l.visibleCloudRules,h=>(d(),C(R,{key:h.code,cloudRule:h,isActionMenuVisible:l.isActionMenuVisible},null,8,["cloudRule","isActionMenuVisible"]))),128))])]),_:1})],64)}const xe=v(ge,[["render",Be]]);export{xe as default};
