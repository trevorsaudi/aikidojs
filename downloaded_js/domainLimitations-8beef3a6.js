import{_ as h,an as r,Q as p,bR as _,A as i,bS as S,bT as g,r as c,q as l,m as y,o as f,w,aa as q,k as A,p as F,F as D}from"./index-13ff96f4.js";import{A as M}from"./ActionMenu-3e4470bf.js";import{S as b}from"./ScanFrequencySettingModal-9f206eb5.js";import{u as k}from"./useDastScanningProgress-93621d89.js";const E={props:{domain:Object},emits:["domainUpdated"],components:{ActionMenu:M,ScanFrequencySettingModal:b},setup(e){var o,n;const{registerScanStartedEvent:t,registerScanStoppedEvent:a}=k(((o=e.domain)==null?void 0:o.scm_repo_id)??-1,((n=e.domain)==null?void 0:n.domain_id)??-1);return{registerScanStartedEvent:t,registerScanStoppedEvent:a}},data(){return{showScanFrequencySettingModal:!1}},computed:{actions(){return[{title:"Domain action menu",items:[{label:"Start scan",onClick:this.handleStartScan,icon:"icon-arrow-right",iconColor:"green"},{label:"Edit configuration",onClick:this.handleShowEditArchitectureModal,icon:"icon-settings",hidden:!!this.$groupUser.is_team_restricted},{hidden:!["nuclei","akto","akto_graphql"].includes(this.domain.scan_type)||!!this.$groupUser.is_team_restricted,label:"Edit scan frequency",onClick:this.handleShowEditScanFrequencyModal,icon:"icon-clock",useBaseIcon:!0},{hidden:!this.showAuthenticateDomainOption,label:"Authenticate domain",icon:"icon-secrets",onClick:this.showEditDomainAuthenticationConfigModal},{label:"Delete",onClick:this.deleteDomain,destructive:!0,hidden:!!this.$groupUser.is_team_restricted}]}]},repository(){return!this.domain.scm_repo_id||this.domain.scm_repo_id<1?null:{id:this.domain.scm_repo_id,scm_repo_name:this.domain.scm_repo_name}},dockerImage(){return!this.domain.cloud_repo_id||this.domain.cloud_repo_id<1?null:{id:this.domain.cloud_repo_id,scm_repo_name:this.domain.cloud_repo_name}},showAuthenticateDomainOption(){return this.$groupUser.is_team_restricted?!1:this.domain.scan_type!="nuclei"},scanFrequencyOptions(){const e=[];return this.domain.scan_type=="nuclei"?e.push({id:"twice_a_week",title:"Twice Per Week",tag:"recommended"}):e.push({id:"daily",title:"Daily",tag:"recommended"}),e.push({id:"weekly",title:"Weekly"}),e.push({id:"monthly",title:"Monthly"}),e.push({id:"on_demand",title:"Only on demand"}),e}},methods:{async handleShowEditArchitectureModal(){let e={};e=await this.$modal.show("IndependentDomainEditModal",{domain:this.domain}),e.type=="saved"&&r.emit("repositoryArchitectureConfigurationUpdated")},async deleteDomain(){await p({headerText:"Delete domain",description:"Do you want to delete domain "+this.domain.domain_name+"? This will also delete all related issues.",buttonSubmitText:"Yes, delete"})&&(await _(this.domain.domain_id),Toast.success("Domain successfully deleted"),r.emit("repositoryArchitectureConfigurationUpdated"))},async handleStartScan(){if(i.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");this.domain.id;try{this.registerScanStartedEvent(),await S(this.domain.domain_id),Toast.success({title:"Scan started",description:"A scan for the domain has been started successfully, we'll report back soon."})}catch(e){throw this.registerScanStoppedEvent(),e}},showEditDomainAuthenticationConfigModal(){if(!i.isPayingProAndNotTrial()&&!this.$featureflags.authenticated_dast)return this.$modal.show("UpgradeAccountModal",{title:"Authenticated DAST is only available on Pro and Scale plans.",msg:"Upgrade now to a Pro or Scale plan to use authenticated DAST scanning."});this.$modal.show("EditDomainAuthenticationConfigModal",{domain:this.domain})},handleShowEditScanFrequencyModal(){this.showScanFrequencySettingModal=!0},async handleEditScanFrequency(e){await g(this.domain.domain_id,e),this.showScanFrequencySettingModal=!1,r.emit("domainScanFrequencyUpdated"),Toast.success({title:"Scan frequency updated",description:"This domain will now be scanned using the new frequency"})}}};function C(e,t,a,o,n,s){const u=c("ActionMenu"),m=c("ScanFrequencySettingModal");return l(),y(D,null,[f(u,{sections:s.actions,placement:"bottom-end"},{trigger:w(d=>[q(e.$slots,"trigger",{toggle:d.toggle})]),_:3},8,["sections"]),n.showScanFrequencySettingModal?(l(),A(m,{key:0,scanFrequencyOptions:s.scanFrequencyOptions,initialScanFrequency:a.domain.scan_frequency,onClose:t[0]||(t[0]=d=>n.showScanFrequencySettingModal=!1),onSubmit:s.handleEditScanFrequency},null,8,["scanFrequencyOptions","initialScanFrequency","onSubmit"])):F("",!0)],64)}const $=h(E,[["render",C]]),x=e=>{if(!i.isPayingAndNoProTrial()||i.data.featureflags.enable_higher_domain_limit)return!1;const t=T();return!(t===null||e<t)},T=()=>{switch(i.data.group.plan){case"standard":return 10;default:return null}};export{$ as D,x as h};
