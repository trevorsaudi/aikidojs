import{_ as v,H as x,g as B,V as b,f as C,B as w,bM as k,r as a,m as I,o as t,n as s,w as o,F as P,q as A,s as n}from"./index-13ff96f4.js";import{P as S}from"./PageHeader-46c38a32.js";import{U as j}from"./UploadJsonFileInput-be53818c.js";const R={components:{PageHeader:S,BaseHeading:x,BaseLink:B,InputText:b,BaseButton:C,BaseParagraph:w,UploadJsonFileInput:j},data(){return{projectId:"",serviceAccountKey:"",isSaving:!1}},computed:{isFormValid(){return!(this.projectId.trim()===""||this.serviceAccountKey.trim()==="")},isSubmitButtonDisabled(){return!this.isFormValid},docsUrl(){return"https://help.aikido.dev/en/articles/8019780-container-scanning-for-gcp-artifact-registry-with-the-aikido-scanner"}},methods:{handleCancel(){this.$router.back()},handleKeyDown(){this.isFormValid&&this.handleSubmit()},async handleSubmit(){this.isSaving=!0;const e=await this.createRegistry();if(e.status==="success")return e;const{cloud_id:i,account_id:l}=e;(await this.$modal.show("DisableGcpContainerAnalysisModal",{cloudId:i,accountId:l})).type==="saved"&&await this.createRegistry()},async createRegistry(){this.isSaving=!0;try{const e=await k({projectId:this.projectId,serviceAccountKey:this.serviceAccountKey});return e.status!=="success"||(Toast.success({title:"Container registry connected",description:"We will scan this registry and show the repositories we found on the settings page"}),this.$router.push("/settings/container-image-registry")),e}finally{this.isSaving=!1}}}},V={class:"page-content bg-white"},K={class:"flex flex-column gap-32px"},F={class:"flex flex-column gap-8px"},H={class:"flex flex-column gap-32px"},U={class:"flex flex-column gap-24px"},G=s("hr",{class:"divider my-24px"},null,-1),D={class:"flex flex-end gap-16px mt-12px justify-end"};function L(e,i,l,m,c,r){const h=a("PageHeader"),g=a("BaseHeading"),u=a("BaseParagraph"),f=a("BaseLink"),_=a("InputText"),y=a("UploadJsonFileInput"),p=a("BaseButton");return A(),I(P,null,[t(h,{breadcrumbs:e.breadcrumbs,title:"Container image registry connection"},null,8,["breadcrumbs"]),s("div",V,[s("div",K,[s("div",F,[t(g,{as:"h3"},{default:o(()=>[n("Connect GCP Artifact Registry service")]),_:1}),t(u,{size:"medium",loose:""},{default:o(()=>[n(' Create a Service Account with the role "Artifact Registry Reader" and generate an access key for Aikido. ')]),_:1}),t(u,{size:"medium",loose:""},{default:o(()=>[n(" Read our documentation on "),t(f,{href:r.docsUrl,target:"_blank"},{default:o(()=>[n("How to connect your GCP Artifact Registry")]),_:1},8,["href"]),n(". ")]),_:1})]),s("div",H,[s("div",U,[t(_,{title:"GCP Project id",placeholder:"my-gcp-project",modelValue:c.projectId,"onUpdate:modelValue":i[0]||(i[0]=d=>c.projectId=d),modelModifiers:{trim:!0},name:"projectId",onEnterKeyPress:r.handleKeyDown,required:!0},null,8,["modelValue","onEnterKeyPress"]),t(y,{onUpload:i[1]||(i[1]=d=>this.serviceAccountKey=d)})])])]),s("div",null,[G,s("div",D,[t(p,{variation:"plain",onClicked:r.handleCancel},{default:o(()=>[n("Cancel")]),_:1},8,["onClicked"]),t(p,{disabled:r.isSubmitButtonDisabled,onClicked:r.handleSubmit,isLoading:c.isSaving},{default:o(()=>[n("Save")]),_:1},8,["disabled","onClicked","isLoading"])])])])],64)}const M=v(R,[["render",L]]);export{M as default};
