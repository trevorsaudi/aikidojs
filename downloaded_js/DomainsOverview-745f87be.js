import{_ as C,B as E,a6 as O,e as P,a2 as M,d as V,i as $,r as n,q as l,k as p,w as t,o as e,n as m,s as d,u as h,p as D,m as w,ah as U,ai as x,a1 as Y,t as B,F as N,f as j,g as q,I as z,an as c,bN as F,A as H}from"./index-13ff96f4.js";import{D as W,a as X}from"./DataTable-e31a825a.js";import{D as R,a as I}from"./DataTableCell-51c0104f.js";import{G as Q}from"./GenericIllustration-4aca88e5.js";import{O as J}from"./OverviewEmptyState-c8440b9c.js";import{B as K}from"./BaseStatusLabel-0ccd2806.js";import{D as Z,h as ee}from"./domainLimitations-8beef3a6.js";import{u as G}from"./useDastScanningProgress-93621d89.js";import{D as te}from"./DataTableLastScanColumn-e155b78a.js";import"./ActionMenu-3e4470bf.js";import"./ScanFrequencySettingModal-9f206eb5.js";import"./BaseRadioInput-a7ac3557.js";import"./dateFns-a344cb79.js";import"./index-b87db690.js";const ne={props:{domain:Object},components:{DataTableCell:R,DataTableRow:I,BaseParagraph:E,RouterLink:O,BaseIconButton:P,DomainsActionMenu:Z,BaseStatusLabel:K,XTooltip:M,BasePill:V,DataTableLastScanColumn:te},setup(a){var s;const{scanningProgress:i}=G(-1,((s=a.domain)==null?void 0:s.domain_id)??-1);return{scanningProgress:i}},computed:{location(){return this.domain.scm_repo_name?this.domain.scm_repo_name:this.domain.cloud_repo_name?this.domain.cloud_repo_name:"None"},locationUrl(){return this.domain.scm_repo_id>0?`/repositories/${this.domain.scm_repo_id}?type=surface_monitoring`:this.domain.cloud_repo_id>0?`/container/${this.domain.cloud_repo_id}?type=surface_monitoring`:`/domain/${this.domain.domain_id}`},domainNames(){return this.domain.domain_name.split(",")},domainName(){return this.domainNames[0]??""},otherDomainNames(){return this.domainNames.length===1?!1:this.domainNames.slice(1)},sensitivity(){return this.domain.internet_exposed?$.global.te(`SENSITIVITY_${this.domain.sensitivity}`)?this.$t(`SENSITIVITY_${this.domain.sensitivity}`):this.domain.sensitivity:"N/A"},href(){return this.domain.domain_id>0?`/domain/${this.domain.domain_id}`:this.locationUrl},isDomainAuthenticated(){return this.domain.auth_config_id>0},scanType(){return this.domain.scan_type=="nuclei"?"Hosted":this.domain.scan_type=="akto"?"REST API":this.domain.scan_type=="akto_graphql"?"GraphQL":"Front-End"},isScanning(){var a;return((a=this.scanningProgress)==null?void 0:a.status)==="scanning"},scanningProgressValue(){var a;return(a=this.scanningProgress)==null?void 0:a.progress}}},ae={class:"flex flex-1 align-center gap-4px justify-between overflow-hidden"},oe={class:"ws-pre"},ie={key:0,class:"icon icon-12px icon-viewDetails text-gray-100 hidden group-hover:block"},se={key:0},re=m("div",{class:"text--semi"},"Aikido will scan for known flaws in these technology stacks:",-1),le=m("div",{class:"shimmer shimmer--blue"},null,-1),de=[le];function ce(a,i,s,A,T,o){const _=n("XTooltip"),u=n("BaseParagraph"),f=n("BaseStatusLabel"),r=n("DataTableCell"),y=n("RouterLink"),v=n("BasePill"),b=n("DataTableLastScanColumn"),S=n("BaseIconButton"),k=n("DomainsActionMenu"),L=n("DataTableRow");return l(),p(L,{clickable:!0,href:o.href},{default:t(()=>[e(r,null,{default:t(()=>[m("div",ae,[e(u,{truncate:""},{default:t(()=>[d(h(o.domainName)+" ",1),e(_,null,{default:t(()=>[d(h(o.domainName),1)]),_:1})]),_:1}),o.otherDomainNames?(l(),p(f,{key:0,class:"direction-ltr",size:"compact"},{default:t(()=>[d(h(a.$t("X_OTHERS",o.otherDomainNames.length))+" ",1),e(_,null,{default:t(()=>[m("span",oe,h(o.otherDomainNames.join(`
`)),1)]),_:1})]),_:1})):D("",!0),o.isDomainAuthenticated?(l(),p(f,{key:1,class:"direction-ltr",size:"compact"},{default:t(()=>[d(" Authenticated ")]),_:1})):D("",!0)])]),_:1}),e(r,null,{default:t(()=>[e(y,{to:o.locationUrl,class:"group flex align-center gap-4px overflow-hidden"},{default:t(()=>[e(u,{truncate:""},{default:t(()=>[d(h(o.location),1)]),_:1}),s.domain.domain_id<1?(l(),w("i",ie)):D("",!0)]),_:1},8,["to"])]),_:1}),e(r,{class:"tablet_hidden"},{default:t(()=>[e(u,null,{default:t(()=>[d(h(o.sensitivity),1)]),_:1})]),_:1}),e(r,{class:"tablet_hidden"},{default:t(()=>[e(u,{class:"flex align-center justify-between w-full"},{default:t(()=>[m("span",null,h(o.scanType),1),m("span",null,[s.domain.scan_type=="nuclei"?(l(),p(v,{key:0,variation:"gray-fill",class:"cursor-default"},{default:t(()=>[m("span",null,[d(h(s.domain.tag_groups[0])+" ",1),s.domain.tag_groups.length>1?(l(),w("span",se,"+"+h(s.domain.tag_groups.length-1),1)):D("",!0)]),e(_,{class:"ws-pre"},{default:t(()=>[re,d("• "+h(s.domain.tag_groups.join(`
• `)),1)]),_:1})]),_:1})):D("",!0)])]),_:1})]),_:1}),e(r,{class:"wide-tablet_hidden"},{default:t(()=>[o.isScanning?(l(),w("div",{key:0,class:"loading-bar",style:U({width:`${o.scanningProgressValue}%`})},de,4)):(l(),p(b,{key:1,"last-scanned-at":s.domain.last_scanned_at},null,8,["last-scanned-at"]))]),_:1}),e(r,{spacing:"compact",alignment:"center"},{default:t(()=>[m("div",{class:"data-table__row__action-container increase--popover-trigger",onClick:i[1]||(i[1]=x(()=>a.$refs.trigger.click(),["prevent"]))},[e(k,{domain:s.domain},{trigger:t(g=>[e(S,{onClick:i[0]||(i[0]=x(()=>{},["prevent"])),icon:"icon-actions",onClicked:g.toggle,class:"data-table__row__action",ref:"trigger"},null,8,["onClicked"])]),_:1},8,["domain"])])]),_:1})]),_:1},8,["href"])}const me=C(ne,[["render",ce]]),ue={components:{DataTableRow:I,DataTableCell:R,LoadingSkeleton:Y}};function _e(a,i,s,A,T,o){const _=n("LoadingSkeleton"),u=n("DataTableCell"),f=n("DataTableRow");return l(),w(N,null,B(5,r=>e(f,{key:r},{default:t(()=>[e(u,null,{default:t(()=>[e(_,{height:"16px"})]),_:1}),e(u,null,{default:t(()=>[e(_,{height:"16px"})]),_:1}),e(u,null,{default:t(()=>[e(_,{height:"16px"})]),_:1}),e(u,null,{default:t(()=>[e(_,{height:"16px"})]),_:1}),e(u,null,{default:t(()=>[e(_,{height:"16px"})]),_:1})]),_:2},1024)),64)}const he=C(ue,[["render",_e]]),pe={components:{BaseParagraph:E,BaseButton:j,DataTable:W,DataTableHeader:X,DataTableRow:I,DomainsOverviewRow:me,DomainsOverviewRowLoading:he,OverviewEmptyState:J,GenericIllustration:Q,BaseLink:q,InputSearch:z},data(){return{domains:[],isLoading:!0,search:""}},setup(){const{addListener:a,removeListener:i}=G();return{addScanEventListener:a,removeScanEventListener:i}},async mounted(){c.on("repositoryArchitectureConfigurationUpdated",this.handleGetDomains),c.on("domainScanFrequencyUpdated",this.handleGetDomains),c.on("domainAuthenticationConfigured",this.handleGetDomains),c.on("domainAuthenticationDeleted",this.handleGetDomains),c.on("dastScanCompleted",this.handleGetDomains),this.addScanEventListener(),c.on("domainAdded",this.handleGetDomains),this.$route.query.add_domain&&this.handleConnectDomain(),await this.handleGetDomains(),this.isLoading=!1},unmounted(){c.off("repositoryArchitectureConfigurationUpdated",this.handleGetDomains),c.off("domainScanFrequencyUpdated",this.handleGetDomains),c.off("domainAuthenticationConfigured",this.handleGetDomains),c.off("domainAuthenticationDeleted",this.handleGetDomains),c.off("dastScanCompleted",this.handleGetDomains),this.removeScanEventListener(),c.off("domainAdded",this.handleGetDomains)},computed:{showEmptyState(){return!this.isLoading&&this.domains.length===0},visibleDomains(){if(!this.search)return this.domains;const a=this.search.toLowerCase();return this.domains.filter(i=>i.domain_name.toLowerCase().includes(a))}},methods:{async handleGetDomains(){this.domains=await F()},async handleConnectDomain(){if(!this.$groupUser.can_manage_domains){this.$modal.show("InfoModal",{headerText:"Connect Domain",title:"You do not have permission to connect a new domain",description:"Contact your admin to connect a new domain.",buttonSubmitText:"Got It!"});return}if(H.data.group.is_demo_group===1)return this.$modal.show("AddWorkspaceRedirectModal");if(ee(this.domains.length))return this.$modal.show("ResourceLimitReachedModal",{resourcesName:"domains"});const a=await this.$modal.show("DomainScanTypeSelectionModal");if(a.type!="saved")return;const i=a.value;(await this.$modal.show("RepositoryArchitectureConfigurationModal",{enforceInternetConnected:!0,scanType:i})).type=="saved"&&c.emit("domainAdded")},async openInfoModal(){await this.$modal.show("StaticIPInfoModal")}}},fe={class:"flex flex-column gap-16px"},ge={class:"flex"},De=m("i",{class:"icon icon-information mr-8px"},null,-1),we=m("p",{class:"text-underline"},"Aikido static IPs",-1),Te=m("i",{class:"icon icon-add"},null,-1),ye={colspan:"5"};function ve(a,i,s,A,T,o){const _=n("InputSearch"),u=n("BaseLink"),f=n("BaseButton"),r=n("DataTableHeader"),y=n("DomainsOverviewRowLoading"),v=n("GenericIllustration"),b=n("OverviewEmptyState"),S=n("DataTableRow"),k=n("DomainsOverviewRow"),L=n("DataTable");return l(),w("div",fe,[m("div",ge,[e(_,{modelValue:T.search,"onUpdate:modelValue":i[0]||(i[0]=g=>T.search=g),spacing:"compact",disableDebounce:!0},null,8,["modelValue"]),e(u,{size:"small",onClick:o.openInfoModal,class:"ml-auto mr-16px plain-button flex align-center text--normal text-carbon-60"},{default:t(()=>[De,we]),_:1},8,["onClick"]),e(f,{as:"'button'",size:"small",onClick:o.handleConnectDomain},{default:t(()=>[Te,d(" Add domain ")]),_:1},8,["onClick"])]),e(L,null,{header:t(()=>[e(r,{width:"auto"},{default:t(()=>[d("Domain name")]),_:1}),e(r,{width:"auto"},{default:t(()=>[d("Location")]),_:1}),e(r,{width:"130px",class:"tablet_hidden"},{default:t(()=>[d("Sensitivity")]),_:1}),e(r,{width:"200px",class:"tablet_hidden"},{default:t(()=>[d("Type")]),_:1}),e(r,{width:"115px",class:"wide-tablet_hidden"},{default:t(()=>[d("Last scan")]),_:1}),e(r,{width:"48px",alignment:"center"})]),body:t(()=>[T.isLoading?(l(),p(y,{key:0})):o.showEmptyState?(l(),p(S,{key:1},{default:t(()=>[m("td",ye,[e(b,{title:a.$t("DOMAIN_SETTINGS_OVERVIEW.EMPTY_STATE.TITLE"),description:a.$t("DOMAIN_SETTINGS_OVERVIEW.EMPTY_STATE.DESCRIPTION"),actionLabel:a.$t("DOMAIN_SETTINGS_OVERVIEW.EMPTY_STATE.ACTION_LABEL"),variation:"empty",onOnAction:o.handleConnectDomain},{default:t(()=>[e(v)]),_:1},8,["title","description","actionLabel","onOnAction"])])]),_:1})):D("",!0),(l(!0),w(N,null,B(o.visibleDomains,g=>(l(),p(k,{domain:g,key:g.id},null,8,["domain"]))),128))]),_:1})])}const Pe=C(pe,[["render",ve]]);export{Pe as default};
