import{_ as f,r as a,q as n,k as u,f as T,X as w,B as x,a2 as V,an as p,a3 as h,A as k,dj as A,m as O,o as i,w as o,n as v,F as P,ar as $,s as d,p as _,u as b}from"./index-13ff96f4.js";import{P as E}from"./PageHeader-46c38a32.js";import{X}from"./XTabs-d492da26.js";import{c as H}from"./trycatch-83445d5b.js";import{b as I}from"./dateFns-a344cb79.js";import{g as N}from"./scans-7651948f.js";import"./index-b87db690.js";const M={components:{XTabs:X},emits:["update:modelValue"],props:{modelValue:String},data(){return{isBookmarked:!1,tabs:[{title:this.$t("REPOSITORIES"),id:"repositoryOverviewRepoList"},{title:this.$t("CHECKS"),id:"repositoryOverviewChecks"}]}}};function U(e,r,m,S,s,t){const l=a("XTabs");return n(),u(l,{useRouterLinks:!0,class:"page-tabs",tabs:s.tabs,modelValue:m.modelValue,"onUpdate:modelValue":r[0]||(r[0]=c=>e.$emit("update:modelValue",c))},null,8,["tabs","modelValue"])}const D=f(M,[["render",U]]),F={components:{PageHeader:E,BaseButton:T,XPreloader:w,RepositoryOverviewTabs:D,BaseParagraph:x,XTooltip:V},data(){return{repositories:[],loaded:!1,tab:this.$route.name,meta:null,disableScanAllButton:!1}},async created(){p.on("activeScmReposChanged",this.loadRepositories),await this.loadRepositories(),this.loadCloudMeta(),this.loaded=!0},beforeUnmount(){p.off("activeScmReposChanged",this.loadRepositories)},watch:{$teamContext(){this.loadRepositories()},"$route.name"(){this.tab=this.$route.name}},computed:{breadcrumbs(){let e=[{label:this.$t("REPOSITORIES")}];return this.tab==="repositoryOverviewChecks"&&e.push({label:this.$t("CHECKS")}),e},lastScan(){var e;return(e=this.meta)!=null&&e.last_scanned_at?`Last scan ${I(this.meta.last_scanned_at)} ago`:"No scans just yet"},nextScanTime(){var e;return(e=this.meta)!=null&&e.next_scan_at?`Next scan on ${h.fromUnix(this.meta.next_scan_at).format(h.SHORT_DATE_FORMAT)}`:null},activeRepositoriesCount(){return this.repositories.filter(e=>!!e.active).length},subtitle(){return`${this.activeRepositoriesCount} active repos`},shouldShowStartScanButton(){var e;return((e=this.$group)==null?void 0:e.scm_type)!=="selfscan"}},methods:{async handleStartAllScans(){if(k.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");this.disableScanAllButton=!0;for(const e of this.repositories)e.active&&await H({statusCode:404,errMessage:"The provided scm_integration_repo_id does not belong to an active repository"},async()=>{await $(e.id,{no_disable_buttons:!0})});this.disableScanAllButton=!1},async loadRepositories(){this.repositories=await A()},async loadCloudMeta(){this.meta=await N("repo")}}},L=v("i",{class:"icon icon-calender icon-12px valign-middle ml-8px"},null,-1),j={class:"page-content"};function K(e,r,m,S,s,t){const l=a("BaseButton"),c=a("RepositoryOverviewTabs"),g=a("XTooltip"),R=a("BaseParagraph"),y=a("PageHeader"),C=a("router-view");return n(),O(P,null,[i(y,{breadcrumbs:t.breadcrumbs,title:"Repositories",subtitle:t.subtitle},{rightContent:o(()=>[t.shouldShowStartScanButton?(n(),u(l,{key:0,disabled:t.activeRepositoriesCount===0||s.disableScanAllButton,onClicked:t.handleStartAllScans,variation:"primary",border:!0},{default:o(()=>[d(" Start scan ")]),_:1},8,["disabled","onClicked"])):_("",!0)]),tabs:o(()=>[i(c,{modelValue:s.tab,"onUpdate:modelValue":r[0]||(r[0]=B=>s.tab=B)},null,8,["modelValue"])]),footerRightContent:o(()=>[s.meta?(n(),u(R,{key:0,color:"subdued"},{default:o(()=>[d(b(t.lastScan)+" ",1),L,i(g,null,{default:o(()=>[d(b(t.nextScanTime),1)]),_:1})]),_:1})):_("",!0)]),_:1},8,["breadcrumbs","subtitle"]),v("div",j,[i(C)])],64)}const Z=f(F,[["render",K]]);export{Z as default};
