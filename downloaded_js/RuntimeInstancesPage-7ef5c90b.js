import{_ as S,r as n,q as u,k as h,w as t,o as e,n as i,a1 as F,m as y,t as C,F as D,x as U,B as X,a2 as M,d as z,f as $,I as H,z as j,e3 as q,e0 as W,s as l,p as b,u as _}from"./index-13ff96f4.js";import{a as B,D as V}from"./DataTableCell-51c0104f.js";import{a as L,D as G}from"./DataTable-e31a825a.js";import{a as k,d as J}from"./dateFns-a344cb79.js";import{O as K}from"./OverviewEmptyState-c8440b9c.js";import{R as Q}from"./RuntimeIllustration-4912df3a.js";import{_ as Y}from"./ripples-df807ff5.js";import{R as Z}from"./RuntimeNoTokenCallout-f395432e.js";import{X as ee}from"./XPagination-8f16f099.js";import"./index-b87db690.js";import"./BaseCallout-aea0aba4.js";const te={emits:["viewInstructions"],components:{RuntimeIllustration:Q,OverviewEmptyState:K},computed:{title(){return"No instances found"},description(){return"Waiting for instances to send events..."},actionLabel(){return"View install instructions"}}},ae=i("div",{class:"mt-12px -mb-16px"},[i("img",{src:Y,width:"30"})],-1);function ne(s,r,T,P,c,o){const d=n("RuntimeIllustration"),p=n("OverviewEmptyState");return u(),h(p,{title:o.title,description:o.description,actionLabel:o.actionLabel,variation:"empty",onOnAction:r[0]||(r[0]=g=>s.$emit("viewInstructions"))},{subdescription:t(()=>[ae]),default:t(()=>[e(d)]),_:1},8,["title","description","actionLabel"])}const se=S(te,[["render",ne]]),oe={components:{DataTableHeader:L,DataTableRow:B,DataTableCell:V,LoadingSkeleton:F}};function le(s,r,T,P,c,o){const d=n("LoadingSkeleton"),p=n("DataTableCell"),g=n("DataTableRow");return u(),y(D,null,C(6,m=>e(g,{key:m},{default:t(()=>[e(p,null,{default:t(()=>[e(d,{height:"22px"})]),_:1}),e(p,null,{default:t(()=>[e(d,{height:"22px"})]),_:1}),e(p,null,{default:t(()=>[e(d,{height:"22px"})]),_:1}),e(p,null,{default:t(()=>[e(d,{height:"22px"})]),_:1}),e(p,null,{default:t(()=>[e(d,{height:"22px"})]),_:1})]),_:2},1024)),64)}const ie=S(oe,[["render",le]]),re={components:{RuntimeInstanceRowSkeleton:ie,BaseIcon:U,BaseParagraph:X,XTooltip:M,RuntimeInstancesEmptyState:se,RuntimeNoTokenCallout:Z,BasePill:z,DataTable:G,DataTableCell:V,DataTableHeader:L,BaseButton:$,InputSearch:H,DataTableRow:B,XPagination:ee,InputSwitch:j},data(){return{service:null,initialLoading:!0,loading:!0,instances:[],totalInstances:0,page:0,perPage:50,search:"",includeOfflineInstances:!1}},computed:{serviceId(){return this.$route.params.serviceId},shouldShowEmptyState(){return!this.loading&&this.instances.length===0},enrichedInstances(){return this.instances.map(s=>({...s,status:this.getStatus(s),last_seen_at_relative:k(s.last_seen_at)}))}},async mounted(){if(await Promise.all([this.loadInstances(),this.loadService()]),!this.service){this.$router.push("/runtime/services");return}this.$breadcrumbs.show({breadcrumbs:[{label:this.$t("RUNTIME_PROTECTION"),href:"/runtime"},{label:this.service.name}]}),this.loading=!1},methods:{getFormattedLastScannedAtTimestampForTables:k,async loadInstances(){const{instances:s,total_count:r}=await q({serviceId:this.serviceId,page:this.page,per_page:this.perPage,search:this.search,include_offline:this.includeOfflineInstances});this.instances=s,this.totalInstances=r,this.initialLoading=!1},async loadService(){this.service=await W(this.serviceId)},handleChangePage(s){this.page=s,this.loadInstances()},async handleViewInstructions(){this.serviceId&&await this.$modal.show("RuntimeInstallInstructionsModal",{serviceId:this.serviceId})},getStatus(s){const r=J();return s.last_seen_at<r-24*60*60?{label:"Offline",color:"gray-fill"}:s.dry_mode?{label:"Detection only",color:"orange"}:{label:"Blocking",type:"protected",color:"green"}},openProtectionTypeInfoModal(){this.$modal.show("RuntimeAdvancedProtectionInfoModal")},onFilterChange(){this.page=0,this.loadInstances()}}},ce={class:"flex flex-column gap-16px"},ue={class:"flex mb-16px align-center gap-8px"},de=i("span",{class:"input-switch__label input-switch__label--right sidebar-open_hide-width max-w-150px ws-nowrap"},[i("span",null,"Include Offline Instances")],-1),pe={class:"flex gap-6px align-center"},_e={class:"flex flex-column gap-8px"},me={class:"pill__label flex align-center gap-4px"},he={class:"pill__label flex align-center gap-4px"},fe={colspan:"5"};function ge(s,r,T,P,c,o){const d=n("RuntimeNoTokenCallout"),p=n("InputSearch"),g=n("InputSwitch"),m=n("DataTableHeader"),O=n("RuntimeInstanceRowSkeleton"),v=n("XTooltip"),I=n("BaseParagraph"),f=n("DataTableCell"),w=n("BaseIcon"),x=n("BasePill"),R=n("DataTableRow"),E=n("RuntimeInstancesEmptyState"),N=n("DataTable"),A=n("XPagination");return u(),y("div",ce,[i("div",null,[e(d,{serviceId:o.serviceId},null,8,["serviceId"]),i("div",ue,[e(p,{modelValue:c.search,"onUpdate:modelValue":[r[0]||(r[0]=a=>c.search=a),o.onFilterChange],spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),e(g,{class:"ml-8px",modelValue:c.includeOfflineInstances,"onUpdate:modelValue":[r[1]||(r[1]=a=>c.includeOfflineInstances=a),o.onFilterChange]},{default:t(()=>[de]),_:1},8,["modelValue","onUpdate:modelValue"])]),e(N,null,{header:t(()=>[e(m,{width:"auto"},{default:t(()=>[l("Instance")]),_:1}),e(m,{width:"150px"},{default:t(()=>[l("IP Address")]),_:1}),e(m,{width:"200px"},{default:t(()=>[l("Aikido Agent Version")]),_:1}),e(m,{width:"150px"},{default:t(()=>[l("Last Seen")]),_:1}),e(m,{width:"200px"},{default:t(()=>[l("Status")]),_:1})]),body:t(()=>[c.initialLoading?(u(),h(O,{key:0})):b("",!0),(u(!0),y(D,null,C(o.enrichedInstances,a=>(u(),h(R,{key:a.id,class:"text-blue-dark"},{default:t(()=>[e(f,null,{default:t(()=>[e(I,{class:"truncate"},{default:t(()=>[i("span",null,_(a.hostname),1),e(v,null,{default:t(()=>[l(_(a.hostname),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(f,null,{default:t(()=>[e(I,{class:"truncate"},{default:t(()=>[l(_(a.ip_address),1)]),_:2},1024),e(v,null,{default:t(()=>[l(_(a.ip_address),1)]),_:2},1024)]),_:2},1024),e(f,null,{default:t(()=>[i("div",pe,[e(I,null,{default:t(()=>[l(_(a.version),1)]),_:2},1024),i("div",null,[e(w,{icon:"icon-information",size:14,class:"text-carbon-60 flex align-center"}),e(v,null,{default:t(()=>[l(_(a.os.name)+" "+_(a.os.version),1)]),_:2},1024)])])]),_:2},1024),e(f,null,{default:t(()=>[e(I,null,{default:t(()=>[l(_(a.last_seen_at_relative),1)]),_:2},1024)]),_:2},1024),e(f,null,{default:t(()=>[i("div",_e,[a.status.type=="protected"&&a.node.prevented_prototype_pollution&&a.lang==="js"?(u(),h(x,{key:0,variation:a.status.color,class:"cursor-pointer",onClick:o.openProtectionTypeInfoModal},{default:t(()=>[i("p",me,[l("Advanced Protection "),e(w,{class:"text--normal flex",icon:"icon-information",size:12})])]),_:2},1032,["variation","onClick"])):a.status.type=="protected"&&a.lang==="js"?(u(),h(x,{key:1,variation:a.status.color,class:"cursor-pointer",onClick:o.openProtectionTypeInfoModal},{default:t(()=>[i("p",he,[l("Standard Protection "),e(w,{class:"text--normal flex",icon:"icon-information",size:12})])]),_:2},1032,["variation","onClick"])):a.status?(u(),h(x,{key:2,title:a.status.label,variation:a.status.color},null,8,["title","variation"])):b("",!0)])]),_:2},1024)]),_:2},1024))),128)),o.shouldShowEmptyState?(u(),h(R,{key:1},{default:t(()=>[i("td",fe,[e(E,{onViewInstructions:o.handleViewInstructions},null,8,["onViewInstructions"])])]),_:1})):b("",!0)]),_:1}),e(A,{page:c.page,"onUpdate:page":o.handleChangePage,perPage:c.perPage,currentPageCount:c.instances.length,total:c.totalInstances},null,8,["page","onUpdate:page","perPage","currentPageCount","total"])])])}const Ce=S(re,[["render",ge]]);export{Ce as default};
