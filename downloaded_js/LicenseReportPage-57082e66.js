import{g as ie}from"./scans-7651948f.js";import{d as X}from"./export-427c6d83.js";import{P as ne}from"./PageHeader-46c38a32.js";import{X as le}from"./XTabs-d492da26.js";import{_ as b,f as M,H as D,M as $,B as P,an as F,r as a,q as c,k as L,w as i,o as n,s as d,n as r,u as k,e as J,m as f,ai as A,p as C,F as w,t as T,S as x,aa as oe,a2 as Q,x as ae,a1 as re,N as q,bt as ce,K as de,a$ as ue,dn as pe,au as he,cF as ge,I as me,A as N,a3 as z}from"./index-13ff96f4.js";import{r as O,g as _e,c as G,l as fe,a as Le,b as ke}from"./licenses-6ab38515.js";import{T as Y,a as Z}from"./TableListHeader-e50d01d1.js";import{B as ye}from"./BoxIcon-9908469f.js";import{A as j}from"./ActionMenu-3e4470bf.js";import{L as K,a as H}from"./licenses-81c77780.js";import{D as Ce,a as ee}from"./DataTable-e31a825a.js";import{a as Se,D as Re}from"./DataTableCell-51c0104f.js";import{X as ve}from"./XPagination-8f16f099.js";import{F as te}from"./FilterButton-bb5393a7.js";import{I as se}from"./InputMultiSelect-21584437.js";import{L as W}from"./languages-12749071.js";import{A as we}from"./lock-files-cdbb050f.js";import{g as be}from"./repoName-872812ed.js";import{I as Te}from"./InputCheckbox-81cb3ca6.js";import{B as xe}from"./BaseForm-4c6fa06f.js";import{T as Ae}from"./TableListActionMenu-8ca3c15b.js";import{b as Be}from"./dateFns-a344cb79.js";import"./index-b87db690.js";const Ie={components:{BaseButton:M,BaseHeading:D,BaseModal:$,BaseParagraph:P},emits:["close"],props:{license:Object},mounted(){document.addEventListener("keydown",this.enterHandler)},beforeUnmount(){document.removeEventListener("keydown",this.enterHandler)},methods:{async handleSubmit(){for(let e of this.license.repos)await O({repo_id:e.id,package_name:this.license.package_name,language:this.license.language});for(let e of this.license.images)await O({image_id:e.id,package_name:this.license.package_name,language:this.license.language});F.emit("licenseUpdated"),Toast.success({title:"License marked as internal",description:"This license has correctly been marked as an internal package"}),this.$emit("close")},enterHandler(e){e.key=="Enter"&&this.handleSubmit()}}},Fe={class:"flex flex-column gap-16px"};function Pe(e,t,o,p,l,s){const u=a("BaseParagraph"),y=a("BaseHeading"),h=a("BaseButton"),m=a("BaseModal");return c(),L(m,{onClose:t[1]||(t[1]=R=>e.$emit("close"))},{header:i(()=>[n(u,{color:"gray",size:"small"},{default:i(()=>[d("Mark as internal")]),_:1})]),content:i(()=>[r("div",Fe,[n(y,{as:"h3"},{default:i(()=>[d(" Are you sure you want to mark "+k(o.license.package_name)+" as an internal package? ",1)]),_:1}),n(u,{size:"medium"},{default:i(()=>[d("Aikido will no longer show this license as a risk.")]),_:1})])]),footer:i(()=>[n(h,{variation:"tertiary",onClicked:t[0]||(t[0]=R=>e.$emit("close")),class:"ml-auto"},{default:i(()=>[d("Cancel")]),_:1}),n(h,{variation:"primary",onClicked:s.handleSubmit},{default:i(()=>[d("Mark as internal package")]),_:1},8,["onClicked"])]),_:1})}const Me=b(Ie,[["render",Pe]]),Oe={components:{ActionMenu:j,MarkAsInternalLicenseModal:Me,BaseIconButton:J},props:{license:Object},data(){return{showMarkAsInternalLicenseModal:!1,sections:[{title:"Actions",items:[{label:"Mark as Internal Package",onClick:this.handleOpenMarkAsInternalLicenseModal,icon:"icon-shield_check",iconColor:"green"},{label:"Change Risk Level",onClick:this.handleOpenContestLicenseScoringModal,icon:"icon-edit"}]}]}},methods:{handleOpenContestLicenseScoringModal(){this.$modal.show("ContestLicenseScoringModal",{packageName:this.license.package_name})},handleOpenMarkAsInternalLicenseModal(){this.showMarkAsInternalLicenseModal=!0}}};function De(e,t,o,p,l,s){const u=a("BaseIconButton"),y=a("ActionMenu"),h=a("MarkAsInternalLicenseModal");return c(),f(w,null,[r("div",{class:"td-action-container",onClick:t[0]||(t[0]=A(()=>e.$refs.trigger.click(),["stop"]))},[n(y,{sections:l.sections,placement:"bottom-end"},{trigger:i(m=>[n(u,{icon:"icon-actions",class:"td-action-container__action",onClick:m.toggle,ref:"trigger"},null,8,["onClick"])]),_:1},8,["sections"])]),l.showMarkAsInternalLicenseModal?(c(),L(h,{key:0,license:o.license,onClose:t[1]||(t[1]=m=>l.showMarkAsInternalLicenseModal=!1)},null,8,["license"])):C("",!0)],64)}const Ue=b(Oe,[["render",De]]),Ee={components:{BaseParagraph:P,BaseHeading:D,BaseButton:M,BaseModal:$,DataTable:Ce,DataTableHeader:ee,DataTableRow:Se,DataTableCell:Re},emits:["close"],props:{packageName:String},data(){return{locations:[],loaded:!1}},async created(){this.locations=await _e(this.packageName),this.loaded=!0},computed:{licenseRepoLocations(){return this.locations.license_repo_locations},licenseImageLocations(){return this.locations.license_image_locations}},methods:{closeModal(){this.$emit("close")}}},Ve={key:0,class:"text-center"},Ne={key:1,class:"flex flex-column gap-16px"},He={colspan:"2"},$e={colspan:"2"};function qe(e,t,o,p,l,s){const u=a("BaseParagraph"),y=a("BaseHeading"),h=a("XPreloader"),m=a("DataTableHeader"),R=a("DataTable"),_=a("DataTableRow"),v=a("BaseLink"),g=a("DataTableCell"),U=a("BaseButton"),E=a("BaseModal");return c(),L(E,{width:800,onClose:s.closeModal},{header:i(()=>[n(u,{color:"gray"},{default:i(()=>[d("License reports")]),_:1})]),content:i(()=>[n(y,{as:"h3"},{default:i(()=>[d("License locations")]),_:1}),l.loaded?(c(),f("div",Ne,[n(R,null,{header:i(()=>[n(m,{width:"200px"},{default:i(()=>[d("Location")]),_:1}),n(m,{width:"auto"},{default:i(()=>[d("Path")]),_:1})]),_:1}),Object.keys(s.licenseRepoLocations).length>0?(c(),L(R,{key:0,class:"data-table--no-header"},{header:i(()=>[n(m,{width:"200px"}),n(m,{width:"auto"})]),body:i(()=>[n(_,{class:"data-table__row--section-header"},{default:i(()=>[r("td",He,[n(u,null,{default:i(()=>[d("Repositories")]),_:1})])]),_:1}),(c(!0),f(w,null,T(s.licenseRepoLocations,(B,I)=>(c(),L(_,{key:I},{default:i(()=>[n(g,null,{default:i(()=>[n(v,{class:"text--normal underline text-blue-dark",href:`/repositories/${I}`,target:"_blank"},{default:i(()=>[d(k(B[0].repo_name),1)]),_:2},1032,["href"])]),_:2},1024),n(g,null,{default:i(()=>[r("div",null,[(c(!0),f(w,null,T(B,(S,V)=>(c(),L(u,{key:`path_${V}`},{default:i(()=>[d(k(S.path),1)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024))),128))]),_:1})):C("",!0),Object.keys(s.licenseImageLocations).length>0?(c(),L(R,{key:1,class:"data-table--no-header"},{header:i(()=>[n(m,{width:"200px"}),n(m,{width:"auto"})]),body:i(()=>[n(_,{class:"data-table__row--section-header"},{default:i(()=>[r("td",$e,[n(u,null,{default:i(()=>[d("Container images")]),_:1})])]),_:1}),(c(!0),f(w,null,T(s.licenseImageLocations,(B,I)=>(c(),L(_,{key:I},{default:i(()=>[n(g,null,{default:i(()=>[n(v,{class:"text--normal underline text-blue-dark",href:`/container/${I}`,target:"_blank"},{default:i(()=>[d(k(B[0].image_name),1)]),_:2},1032,["href"])]),_:2},1024),n(g,null,{default:i(()=>[r("div",null,[(c(!0),f(w,null,T(B,(S,V)=>(c(),L(u,{key:`path_${V}`},{default:i(()=>[d(k(S.path),1)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024))),128))]),_:1})):C("",!0)])):(c(),f("div",Ve,[n(h,{size:"medium"})]))]),footer:i(()=>[n(U,{onClicked:s.closeModal,size:"small",variation:"tertiary",class:"ml-auto"},{default:i(()=>[d("Close")]),_:1},8,["onClicked"])]),_:1},8,["onClose"])}const je=b(Ee,[["render",qe]]),Xe={props:{selected:{type:Boolean,Required:!0},disabled:{type:Boolean,default:!1},hideCheckBox:{type:Boolean,default:!1},useScopedGroupHover:{type:Boolean,default:!1}},computed:{inputClass(){return{"cursor-not-allowed":this.disabled,"checkbox--checked":this.selected,"checkbox--unchecked":!this.selected}},slotClass(){return{[this.useScopedGroupHover?"scoped-group_hover_opacity-0":"group_hover_opacity-0"]:!this.selected&&!this.hideCheckBox,"opacity-0":this.selected&&!this.hideCheckBox}},checkboxClass(){const e=this.useScopedGroupHover?"scoped-group_hover_opacity-100":"group_hover_opacity-100";return{"opacity-0":!this.selected,[e]:!0}}},methods:{onSelect(){this.disabled||setTimeout(()=>{const e=!this.selected;this.$emit("select",e)},1)}}},ze={class:"w-full relative"},Ge=["checked","disabled"];function Ke(e,t,o,p,l,s){return c(),f("div",{class:x(["td mobile_max-w-full mobile_w-full w-48px max-w-0 mobile_border-b-0 cursor-pointer",{"scoped-group":o.useScopedGroupHover}]),onClick:t[2]||(t[2]=(...u)=>s.onSelect&&s.onSelect(...u))},[r("div",ze,[r("div",{class:x(["absolute-centered transition-opacity",s.slotClass])},[oe(e.$slots,"default")],2),o.hideCheckBox?C("",!0):(c(),f("div",{key:0,class:x(["absolute-centered transition-opacity",s.checkboxClass])},[r("input",{ref:"checkbox",class:x(["cursor-pointer checkbox",s.inputClass]),type:"checkbox",checked:o.selected,disabled:o.disabled,onInput:t[0]||(t[0]=A((...u)=>s.onSelect&&s.onSelect(...u),["stop"])),onClick:t[1]||(t[1]=A((...u)=>s.onSelect&&s.onSelect(...u),["prevent","stop"]))},null,42,Ge)],2))])],2)}const We=b(Xe,[["render",Ke]]),Je={components:{XTooltip:Q,BoxIcon:ye,LicenseReportActionMenu:Ue,LicenseReportLocationModal:je,BaseIcon:ae,BaseParagraph:P,TableCellSelectable:We},props:{license:Object,activeRepositoryFilter:String,activeContainerRepositoryFilter:String,isSelected:{type:Boolean,default:!1}},data(){return{showLocationModal:!1}},computed:{repositories(){const e=[...new Map(this.license.repos.map(t=>[t.id,t])).values()];return this.activeContainerRepositoryFilter&&this.activeContainerRepositoryFilter.length>0?[]:this.activeRepositoryFilter?e.filter(t=>this.activeRepositoryFilter.includes(t.id)):e},containerRepositories(){const e=[...new Map(this.license.images.map(t=>[t.id,t])).values()];return this.activeRepositoryFilter&&this.activeRepositoryFilter.length>0?[]:this.activeContainerRepositoryFilter?e.filter(t=>this.activeContainerRepositoryFilter.includes(t.id)):e},locations(){return[...this.repositories,...this.containerRepositories]},primaryLocation(){return this.locations[0]},primaryLocationName(){var e,t;return((e=this.primaryLocation)==null?void 0:e.scm_repo_name)||((t=this.primaryLocation)==null?void 0:t.cloud_repo_name)},primaryLocationPath(){var e;return(e=this.primaryLocation)!=null&&e.cloud_repo_name?`/container/${this.primaryLocation.id}`:`/repositories/${this.primaryLocation.id}`},locationNames(){return this.locations.map(e=>e.scm_repo_name||e.cloud_repo_name)},locatonIcon(){var e;return(e=this.primaryLocation)!=null&&e.cloud_repo_name?"icon-container":"icon-code-tags"},isCritical(){return["critical"].includes(this.license.new_risk??this.license.risk)},licenseTextColor(){const e=this.license.new_risk??this.license.risk;return e==="critical"?"text-surface-red-100":e==="high"?"text-surface-orange-100":e==="medium"||e==="varies_on_usage"?"text-surface-blue-100":"text-surface-green-100"},licenseIcon(){if(this.license.new_risk){const e=K[this.license.risk];return K[this.license.new_risk]-e>0?"icon-arrow-up":"icon-arrow-down"}return this.license.risk==="critical"?"icon-critical":this.license.risk==="high"?"icon-high_risk":null},newRiskReason(){return this.license.new_risk_reason?this.license.new_risk_reason.toLowerCase()==="known safe package"?"Aikido determined from context that the risk is low":`Reason: ${this.license.new_risk_reason}`:null},licenseType(){return this.license.license_type=="-"?this.license.license_lookup_failed==0?"Fetching License...":"Unknown":this.license.license_type}},methods:{openLicenseRiskInfoModal(){this.$modal.show("LicenseRiskInfoModal",{licenseType:this.license.license_type})}}},Qe={class:"tr group"},Ye={class:"flex align-center justify-center text-center text--bold text-gray-500"},Ze={class:"td max-w-0 w-30p truncate"},et={key:0,class:"text-carbon-60"},tt={class:"td max-w-0 w-25p"},st={class:"flex align-center gap-4px"},it={class:"valign-middle truncate"},nt={class:"ws-pre"},lt={class:"td max-w-0 w-25p"},ot={class:"flex flex-1 gap-4px justify-between align-center"},at={class:"flex align-center gap-4px overflow-hidden"},rt={key:0,class:"status-tag small gray-light text-10px direction-ltr"},ct={class:"ws-pre"},dt={class:"td max-w-0"};function ut(e,t,o,p,l,s){const u=a("BoxIcon"),y=a("TableCellSelectable"),h=a("XTooltip"),m=a("BaseIcon"),R=a("BaseLink"),_=a("LicenseReportActionMenu"),v=a("LicenseReportLocationModal");return c(),f(w,null,[r("div",Qe,[n(y,{selected:o.isSelected,disabled:e.$groupUser.is_team_restricted,hideCheckBox:e.$groupUser.is_team_restricted,useScopedGroupHover:!0,onSelect:t[0]||(t[0]=()=>e.$emit("selectLicense",o.license.id))},{default:i(()=>[r("div",Ye,[n(u,{text:o.license.language},null,8,["text"])])]),_:1},8,["selected","disabled","hideCheckBox"]),r("div",Ze,[o.license.language=="java"&&o.license.org_name?(c(),f("span",et,k(o.license.org_name)+":",1)):C("",!0),d(k(o.license.package_name)+" ",1),n(h,null,{default:i(()=>[o.license.language=="java"&&o.license.org_name?(c(),f(w,{key:0},[d(k(o.license.org_name)+":",1)],64)):C("",!0),d(k(o.license.package_name),1)]),_:1})]),r("div",tt,[r("div",st,[r("span",it,k(s.licenseType),1),r("i",{onClick:t[1]||(t[1]=(...g)=>s.openLicenseRiskInfoModal&&s.openLicenseRiskInfoModal(...g)),class:"icon icon-12px icon-information valign-middle text-gray-200 opacity-0 group_hover_opacity-100 cursor-pointer"}),n(h,{class:"ws-pre"},{default:i(()=>[d(k(s.licenseType.split(",").join(`
`)),1)]),_:1})])]),r("div",{class:x(["td max-w-0 w-15p",{"bg-danger-10p":s.isCritical}])},[r("div",{class:x(["inline-flex align-center gap-4px",s.licenseTextColor])},[s.licenseIcon?(c(),f("i",{key:0,class:x(["icon icon-12px",s.licenseIcon])},null,2)):C("",!0),d(" "+k(e.$t(`RISK_${o.license.new_risk??o.license.risk}`))+" ",1),o.license.new_risk?(c(),L(h,{key:1},{default:i(()=>[r("span",nt,[d(" Changed risk from "+k(e.$t(`RISK_${o.license.risk}`).toLowerCase())+" to "+k(e.$t(`RISK_${o.license.new_risk}`).toLowerCase())+" ",1),o.license.new_risk_reason?(c(),f(w,{key:0},[d("with reason: "+k(o.license.new_risk_reason),1)],64)):C("",!0)])]),_:1})):s.newRiskReason?(c(),L(h,{key:2},{default:i(()=>[d(k(s.newRiskReason),1)]),_:1})):C("",!0)],2)],2),r("div",lt,[r("div",ot,[r("div",at,[n(m,{icon:s.locatonIcon},null,8,["icon"]),n(R,{href:s.primaryLocationPath,target:"_blank",class:"truncate-left text--normal underline text-blue-dark"},{default:i(()=>[d(k(s.primaryLocationName),1)]),_:1},8,["href"]),r("i",{onClick:t[2]||(t[2]=g=>l.showLocationModal=!0),class:"icon icon-12px icon-information valign-middle text-gray-200 opacity-0 group_hover_opacity-100 cursor-pointer"})]),s.locations.length>1?(c(),f("span",rt,[d(k(e.$t("X_OTHERS",s.locations.length-1))+" ",1),n(h,null,{default:i(()=>[r("span",ct,k(s.locationNames.slice(1).join(`
`)),1)]),_:1})])):C("",!0)])]),r("div",dt,[e.$groupUser.is_team_restricted?C("",!0):(c(),L(_,{key:0,license:o.license},null,8,["license"]))])]),l.showLocationModal?(c(),L(v,{key:0,onClose:t[3]||(t[3]=g=>l.showLocationModal=!1),packageName:this.license.package_name},null,8,["packageName"])):C("",!0)],64)}const pt=b(Je,[["render",ut]]),ht={components:{LoadingSkeleton:re}},gt={class:"tr"},mt={class:"td mobile_max-w-full mobile_w-full w-48px max-w-0"},_t={class:"td max-w-0 w-30p"},ft={class:"td max-w-0 w-25p"},Lt={class:"td max-w-0 w-20p"},kt={class:"td max-w-0 w-20p"},yt={class:"td max-w-0"};function Ct(e,t,o,p,l,s){const u=a("LoadingSkeleton");return c(),f("div",gt,[r("div",mt,[n(u,{height:"20px"})]),r("div",_t,[n(u,{height:"20px"})]),r("div",ft,[n(u,{height:"20px"})]),r("div",Lt,[n(u,{height:"20px"})]),r("div",kt,[n(u,{height:"20px"})]),r("div",yt,[n(u,{height:"20px"})])])}const St=b(ht,[["render",Ct]]),Rt={components:{XPagination:ve,BaseSelect:q},props:{page:{type:Number},currentPageCount:{type:Number},total:{type:Number},perPage:{type:Number,required:!0},perPageOptions:{type:Array,required:!0}},computed:{formattedPerPageOptions(){return this.perPageOptions.map(e=>({id:e,title:e}))}},methods:{onIconClick(){console.log(this.$refs);const e=this.$refs.trigger;var t=document.createEvent("MouseEvents");t.initMouseEvent("mousedown",!0,!0,window),e.dispatchEvent(t)}}},vt={class:"flex justify-between"},wt={class:"flex gap-8px align-center pagination"};function bt(e,t,o,p,l,s){const u=a("XPagination"),y=a("BaseParagraph"),h=a("BaseSelect");return c(),f("div",vt,[n(u,{page:o.page,"onUpdate:page":t[0]||(t[0]=m=>e.$emit("update:page",m)),perPage:o.perPage,currentPageCount:o.currentPageCount,total:o.total},null,8,["page","perPage","currentPageCount","total"]),r("div",wt,[n(y,{color:"subdued"},{default:i(()=>[d("Results per page")]),_:1}),n(h,{class:"w-54px select-input--compact select-input--squared select-input--text-subdued",modelValue:o.perPage,"onUpdate:modelValue":t[1]||(t[1]=m=>e.$emit("update:perPage",m)),options:s.formattedPerPageOptions},null,8,["modelValue","options"])])])}const Tt=b(Rt,[["render",bt]]),xt={props:{initialRepositoryFilter:{type:String,default:"all"},initialTargetpathFilter:{type:String,default:"all"},initialContainerRepoFilter:{type:String,default:"all"},initialLanguageFilter:{type:String,default:"all"},selectedLicenses:{type:Array,required:!0},isAllLicensesSelected:{type:Boolean,required:!0},licenseOptions:{type:Array,required:!0},isLicenseTypeFilterActive:{type:Boolean,required:!0},licenseTypesLoaded:{type:Boolean,required:!0}},components:{BasePopover:ce,BaseParagraph:P,BaseSelect:q,FilterButton:te,InputMultiSelect:se},emits:["filterSelected","update:selectedLicenses","update:isAllChecked"],expose:["handleToggleCheckAllLicenseTypes"],data(){return{languages:[...Object.entries(W).map(([e,t])=>({value:e,label:t})),{value:"os",label:"OS"}],riskLevels:[{id:"all",title:"All"},...Object.entries(H).map(([e,t])=>({id:e,title:t}))],repositories:[],containerRepos:[],repositoriesLoading:!0,containerReposLoading:!0,isLicenseTypeDropdownOpen:!1,selectedLanguages:[],isAllLanguagesSelected:!0,isLanguageDropdownOpen:!1,selectedRepositories:[],isAllRepositoriesSelected:!0,isRepositoriesDropdownOpen:!1,selectedContainerRepos:[],isAllContainerReposSelected:!0,isContainerRepoDropdownOpen:!1,selectedRiskLevel:"all",selectedTargetFile:this.initialTargetpathFilter,targetFiles:[],targetFilesLoading:!0}},async created(){this.selectedLanguages=this.languages.map(t=>t.value);let e=!1;if(this.initialRepositoryFilter&&this.initialRepositoryFilter!="all"){this.isAllRepositoriesSelected=!1;const t=+this.initialRepositoryFilter;this.selectedRepositories=[t],await this.fetchTargetPathsForRepo(),e=!0}if(this.initialContainerRepoFilter&&this.initialContainerRepoFilter!="all"){this.isAllContainerReposSelected=!1;const t=+this.initialContainerRepoFilter;this.selectedContainerRepos=[t],e=!0}this.initialLanguageFilter&&this.initialLanguageFilter!="all"&&(this.isAllLanguagesSelected=!1,this.selectedLanguages=[this.initialLanguageFilter],e=!0),e&&this.emitFilterSelected(),await Promise.allSettled([this.loadRepositories(),this.loadContainerRepos()])},computed:{hasFilter(){return!this.isAllLanguagesSelected||this.selectedRiskLevel!="all"||!this.isAllRepositoriesSelected||!this.isAllContainerReposSelected},filter(){let e=[];if(!this.isAllLicensesSelected&&this.licenseTypesLoaded&&e.push("License Type"),!this.isAllLanguagesSelected)if(this.selectedLanguages.length==1){const t=this.selectedLanguages[0];e.push(W[t])}else e.push("Languages");if(this.selectedRiskLevel&&this.selectedRiskLevel!=="all"&&e.push(H[this.selectedRiskLevel]),!this.isAllRepositoriesSelected)if(this.selectedRepositories.length==0)e.push("Excl. repositories");else if(this.selectedRepositories.length==1){const t=this.selectedRepositories[0],o=this.repositories.find(p=>p.value==t);e.push(o==null?void 0:o.label)}else e.push("Repositories");if(!this.isAllContainerReposSelected)if(this.selectedContainerRepos.length==0)e.push("Excl. containers");else if(this.selectedContainerRepos.length==1){const t=this.selectedContainerRepos[0],o=this.containerRepos.find(p=>p.value==t);e.push(o==null?void 0:o.label)}else e.push("Containers");return e.length?e.join(", "):null}},methods:{async loadRepositories(){const e=await de("",!1,!0,{skip:null,limit:null},null,null,null,{},!0);this.repositories=e.map(t=>({value:t.id,label:be(t)})),this.isAllRepositoriesSelected&&(this.selectedRepositories=this.repositories.map(t=>t.value)),this.selectedRepositories.length==1&&this.fetchTargetPathsForRepo(),this.repositoriesLoading=!1},async loadContainerRepos(){const e=await ue({activeOnly:!0});this.containerRepos=e.map(t=>({value:t.id,label:t.name})),this.isAllContainerReposSelected&&(this.selectedContainerRepos=this.containerRepos.map(t=>t.value)),this.containerReposLoading=!1},handleClearFilters(){this.selectedLanguages=this.languages.map(e=>e.value),this.isAllLanguagesSelected=!0,this.selectedRiskLevel="all",this.selectedRepositories=this.repositories.map(e=>e.value),this.isAllRepositoriesSelected=!0,this.selectedContainerRepos=this.containerRepos.map(e=>e.value),this.isAllContainerReposSelected=!0,this.selectedTargetFile="all",this.isAllLicensesSelected||this.handleToggleCheckAllLicenseTypes(),this.closeAllDropdownsExceptCurrent(""),this.emitFilterSelected()},handleChangeRiskLevel(e){this.selectedRiskLevel=e,this.emitFilterSelected()},handleChangeTargetFile(e){this.selectedTargetFile=e,this.emitFilterSelected()},emitFilterSelected(){this.$emit("filterSelected",{language:this.isAllLanguagesSelected?null:this.selectedLanguages,riskLevel:this.selectedRiskLevel==="all"?null:this.selectedRiskLevel,repository:this.isAllRepositoriesSelected?null:this.selectedRepositories,targetPathId:this.selectedTargetFile==="all"?null:this.selectedTargetFile,containerRepo:this.isAllContainerReposSelected?null:this.selectedContainerRepos})},async fetchTargetPathsForRepo(){if(this.targetFilesLoading=!0,this.selectedRepositories.length!=1){this.targetFiles=[];return}const e=this.selectedRepositories[0],t=await pe(e),o=this.getRelevantTargetPaths(t.open_source_dependency_monitoring.target_paths);this.targetFiles=[{id:"all",title:"All"},...o.map(p=>({id:p.id,title:p.target_path}))],this.targetFilesLoading=!1},getRelevantTargetPaths(e){const t=[];for(const o of e)for(const p of we)if(o.target_path.toLowerCase().includes(p.toLowerCase())){t.push(o);break}return t},handleToggleCheckAllLicenseTypes(){this.$refs.licenceTypeMultiSelect.handleToggleCheckAll()},handleLicenseTypeFilterOpenChanged(e){this.isLicenseTypeDropdownOpen=e,e&&this.closeAllDropdownsExceptCurrent("licenseType")},handleLanguageFilterOpenChanged(e){this.isLanguageDropdownOpen=e,e&&this.closeAllDropdownsExceptCurrent("language")},handleRepositoriesFilterOpenChanged(e){this.isRepositoriesDropdownOpen=e,e&&this.closeAllDropdownsExceptCurrent("repositories")},handleContainerRepoFilterOpenChanged(e){this.isContainerRepoDropdownOpen=e,e&&this.closeAllDropdownsExceptCurrent("containerRepo")},closeAllDropdownsExceptCurrent(e){this.isLicenseTypeDropdownOpen&&e!="licenseType"&&this.$refs.licenceTypeMultiSelect.toggleDropdown(),this.isLanguageDropdownOpen&&e!="language"&&this.$refs.languageMultiSelect.toggleDropdown(),this.isRepositoriesDropdownOpen&&e!="repositories"&&this.$refs.repoMultiSelect.toggleDropdown(),this.isContainerRepoDropdownOpen&&e!="containerRepo"&&this.$refs.containerMultiSelect.toggleDropdown()},onUpdateSelectedLanguages(e){this.selectedLanguages=e,this.emitFilterSelected()},async onUpdateSelectedRepositories(e){this.selectedRepositories=e,this.emitFilterSelected(),this.selectedTargetFile="all",await this.fetchTargetPathsForRepo()},onUpdateSelectedContainerRepos(e){this.selectedContainerRepos=e,this.emitFilterSelected(),this.selectedTargetFile="all"},closeDropdownsWhenClickedOutside(e){const t=[...e.target.classList],o=[...e.target.parentElement.classList],p=t.some(s=>s.includes("input")),l=o.some(s=>s.includes("input"));p||l||this.closeAllDropdownsExceptCurrent("")}}},At=r("i",{class:"icon icon-filter icon-12px"},null,-1),Bt={key:0},It={class:"text-primary-aik-100"},Ft={key:1},Pt={class:"flex justify-between align-center"},Mt={class:"grid gap-16px align-center",style:{"grid-template-columns":"1fr minmax(0, 4fr)"}};function Ot(e,t,o,p,l,s){const u=a("i18n-t"),y=a("FilterButton"),h=a("BaseParagraph"),m=a("InputMultiSelect"),R=a("BaseSelect"),_=a("BasePopover");return c(),L(_,{placement:"bottom-start",keepOtherPopoversOpen:!0,keepPopoverOpenOnInsideClick:!0,popoverClass:"overflow-visible"},{trigger:i(v=>[n(y,{onClick:v.toggle,class:x({"filter-button--active":s.hasFilter})},{default:i(()=>[At,s.filter?(c(),f("span",Bt,[n(u,{keypath:"QUEUE.QUICK_FILTER.LABEL"},{filter:i(()=>[r("span",It,k(s.filter),1)]),_:1})])):(c(),f("span",Ft," Filter "))]),_:2},1032,["onClick","class"])]),content:i(v=>[r("div",{class:"flex flex-column gap-16px py-16px px-24px w-525px",onClick:t[8]||(t[8]=(...g)=>s.closeDropdownsWhenClickedOutside&&s.closeDropdownsWhenClickedOutside(...g))},[r("div",Pt,[n(h,{size:"small",color:"gray",bold:""},{default:i(()=>[d("Filter By")]),_:1}),r("button",{class:"button-brand button--as-link",onClick:t[0]||(t[0]=(...g)=>s.handleClearFilters&&s.handleClearFilters(...g))},"Clear all Filters")]),r("div",Mt,[n(h,{size:"small"},{default:i(()=>[d("License")]),_:1}),n(m,{ref:"licenceTypeMultiSelect",selectedItems:o.selectedLicenses,isAllChecked:o.isAllLicensesSelected,"onUpdate:selectedItems":t[1]||(t[1]=g=>e.$emit("update:selectedLicenses",g)),"onUpdate:isAllChecked":t[2]||(t[2]=g=>e.$emit("update:isAllLicensesSelected",g)),options:o.licenseOptions,selectAllText:"All Licenses",showFilterActive:o.isLicenseTypeFilterActive,width:"unset",enableCheckAll:!0,enableSearch:!0,useFilterStyling:!1,shouldTruncateOptions:!0,truncateOptionsWidth:225,showTooltipForOptions:!0,isLoading:!o.licenseTypesLoaded,maxHeight:200,onIsOpenChanged:s.handleLicenseTypeFilterOpenChanged},null,8,["selectedItems","isAllChecked","options","showFilterActive","isLoading","onIsOpenChanged"]),n(h,{size:"small"},{default:i(()=>[d("Language")]),_:1}),n(m,{ref:"languageMultiSelect",selectedItems:l.selectedLanguages,isAllChecked:l.isAllLanguagesSelected,"onUpdate:isAllChecked":t[3]||(t[3]=g=>l.isAllLanguagesSelected=g),"onUpdate:selectedItems":s.onUpdateSelectedLanguages,options:l.languages,selectAllText:"All Languages",width:"unset",enableCheckAll:!0,enableSearch:!1,useFilterStyling:!1,shouldTruncateOptions:!0,truncateOptionsWidth:225,showTooltipForOptions:!0,maxHeight:200,onIsOpenChanged:s.handleLanguageFilterOpenChanged},null,8,["selectedItems","isAllChecked","onUpdate:selectedItems","options","onIsOpenChanged"]),n(h,{size:"small"},{default:i(()=>[d("Risk level")]),_:1}),n(R,{modelValue:l.selectedRiskLevel,"onUpdate:modelValue":g=>{s.handleChangeRiskLevel(g),v.close()},options:l.riskLevels,onClick:t[4]||(t[4]=A(()=>s.closeAllDropdownsExceptCurrent(""),["stop"]))},null,8,["modelValue","onUpdate:modelValue","options"]),n(h,{size:"small"},{default:i(()=>[d("Repo")]),_:1}),n(m,{ref:"repoMultiSelect",selectedItems:l.selectedRepositories,isAllChecked:l.isAllRepositoriesSelected,"onUpdate:isAllChecked":t[5]||(t[5]=g=>l.isAllRepositoriesSelected=g),"onUpdate:selectedItems":s.onUpdateSelectedRepositories,options:l.repositories,selectAllText:"All Repositories",width:"unset",enableCheckAll:!0,enableSearch:!0,useFilterStyling:!1,shouldTruncateOptions:!0,truncateOptionsWidth:225,showTooltipForOptions:!0,isLoading:l.repositoriesLoading,maxHeight:200,onIsOpenChanged:s.handleRepositoriesFilterOpenChanged},null,8,["selectedItems","isAllChecked","onUpdate:selectedItems","options","isLoading","onIsOpenChanged"]),l.selectedRepositories.length==1?(c(),f(w,{key:0},[n(h,{size:"small"},{default:i(()=>[d("Path")]),_:1}),n(R,{modelValue:l.selectedTargetFile,"onUpdate:modelValue":g=>{s.handleChangeTargetFile(g),v.close()},isLoading:l.targetFilesLoading,options:l.targetFiles,onClick:t[6]||(t[6]=A(()=>s.closeAllDropdownsExceptCurrent(""),["stop"]))},null,8,["modelValue","onUpdate:modelValue","isLoading","options"])],64)):C("",!0),n(h,{size:"small"},{default:i(()=>[d("Container")]),_:1}),n(m,{ref:"containerMultiSelect",selectedItems:l.selectedContainerRepos,isAllChecked:l.isAllContainerReposSelected,"onUpdate:isAllChecked":t[7]||(t[7]=g=>l.isAllContainerReposSelected=g),"onUpdate:selectedItems":s.onUpdateSelectedContainerRepos,options:l.containerRepos,selectAllText:"All Containers",width:"unset",enableCheckAll:!0,enableSearch:!0,useFilterStyling:!1,shouldTruncateOptionsLeft:!0,truncateOptionsWidth:300,showTooltipForOptions:!0,isLoading:l.containerReposLoading,maxHeight:200,onIsOpenChanged:s.handleContainerRepoFilterOpenChanged},null,8,["selectedItems","isAllChecked","onUpdate:selectedItems","options","isLoading","onIsOpenChanged"])])])]),_:1})}const Dt=b(xt,[["render",Ot]]),Ut={components:{BaseButton:M,BaseForm:xe,BaseHeading:D,BaseConfirmModal:he,BaseParagraph:P,BaseSelect:q,InputTextArea:ge},emits:["close"],props:{licenses:{type:Array,required:!0}},data(){return{scoringValue:"",scoringReason:"",scoringValueError:void 0}},computed:{scoringValues(){return Object.entries(H).map(([e,t])=>({id:e,title:t}))},repositoryNames(){const e=this.licenses.map(o=>o.repos.map(p=>p.scm_repo_name)).flat(1);return[...new Set(e)]},imageNames(){const e=this.licenses.map(o=>o.images.map(p=>p.cloud_repo_name)).flat(1);return[...new Set(e)]}},methods:{async handleSubmit(){if(this.scoringValueError=void 0,!this.scoringValue){this.scoringValueError="Scoring value is required";return}const e=[];for(const p of this.licenses)for(const l of p.repos)e.push(G({repo_id:l.id,package_name:p.package_name,language:p.language,new_risk:this.scoringValue,reason:this.scoringReason}));for(const p of this.licenses)for(const l of p.images)e.push(G({image_id:l.id,package_name:p.package_name,language:p.language,new_risk:this.scoringValue,reason:this.scoringReason}));(await Promise.allSettled(e)).some(p=>p.status!=="fulfilled")||this.$toast.success("Successfully adjusted the risk of the licenses"),F.emit("licenseUpdated"),this.$emit("close")},handleCancel(){this.$emit("close")}}},Et={class:"flex flex-column gap-16px"},Vt={class:"flex flex-column gap-12px"},Nt={key:0,class:"flex flex-column gap-8px"},Ht={class:"list-disc pl-8px"},$t={key:1,class:"flex flex-column gap-8px"},qt={class:"list-disc pl-8px"};function jt(e,t,o,p,l,s){const u=a("BaseParagraph"),y=a("BaseSelect"),h=a("InputTextArea"),m=a("BaseForm"),R=a("BaseConfirmModal");return c(),L(R,{width:485,title:`Change license risk score of ${e.$t("X_PACKAGES",o.licenses.length)}`,onSubmit:s.handleSubmit,onSecondaryButtonClicked:s.handleCancel,onClose:s.handleCancel},{default:i(()=>[r("div",Et,[r("div",Vt,[s.repositoryNames.length>0?(c(),f("div",Nt,[n(u,{size:"medium"},{default:i(()=>[d(" This will affect its usage in the following repositories: ")]),_:1}),r("ul",Ht,[(c(!0),f(w,null,T(s.repositoryNames,_=>(c(),L(u,{size:"medium",key:_},{default:i(()=>[r("li",null,k(_),1)]),_:2},1024))),128))])])):C("",!0),s.imageNames.length>0?(c(),f("div",$t,[n(u,{size:"medium"},{default:i(()=>[d(" This will affect its usage in the following container repositories: ")]),_:1}),r("ul",qt,[(c(!0),f(w,null,T(s.imageNames,_=>(c(),L(u,{size:"medium",key:_},{default:i(()=>[r("li",null,k(_),1)]),_:2},1024))),128))])])):C("",!0)]),n(m,{id:"scoringForm",onSubmit:A(s.handleSubmit,["prevent"])},{default:i(()=>[n(y,{modelValue:l.scoringValue,"onUpdate:modelValue":t[0]||(t[0]=_=>l.scoringValue=_),name:"scoring",label:"Package Risk Level",options:s.scoringValues,error:l.scoringValueError},null,8,["modelValue","options","error"]),n(h,{modelValue:l.scoringReason,"onUpdate:modelValue":t[1]||(t[1]=_=>l.scoringReason=_),name:"scoringReason",title:"Score Change Reason",placeholder:`• A license for this package was purchased.
• The package is not statically linked.
• The package is no longer in use`,rows:"4"},null,8,["modelValue","placeholder"])]),_:1},8,["onSubmit"])])]),_:1},8,["title","onSubmit","onSecondaryButtonClicked","onClose"])}const Xt=b(Ut,[["render",jt]]),zt={components:{BaseButton:M,BaseHeading:D,BaseModal:$,BaseParagraph:P},emits:["close"],props:{licenses:{type:Array,required:!0}},mounted(){document.addEventListener("keydown",this.enterHandler)},beforeUnmount(){document.removeEventListener("keydown",this.enterHandler)},methods:{async handleSubmit(){const e=[];for(const t of this.licenses)for(const o of t.repos)e.push(O({repo_id:o.id,package_name:t.package_name,language:t.language}));for(const t of this.licenses)for(const o of t.images)e.push(O({image_id:o.id,package_name:t.package_name,language:t.language}));await Promise.allSettled(e),F.emit("licenseUpdated"),Toast.success({title:"Licenses marked as internal",description:"These licenses have correctly been marked as an internal packages"}),this.$emit("close")},enterHandler(e){e.key=="Enter"&&this.handleSubmit()}}},Gt={class:"flex flex-column gap-16px"},Kt={class:"text--bold"};function Wt(e,t,o,p,l,s){const u=a("BaseParagraph"),y=a("BaseHeading"),h=a("BaseButton"),m=a("BaseModal");return c(),L(m,{onClose:t[1]||(t[1]=R=>e.$emit("close"))},{header:i(()=>[n(u,{color:"gray",size:"small"},{default:i(()=>[d("Mark as internal")]),_:1})]),content:i(()=>[r("div",Gt,[n(y,{as:"h3"},{default:i(()=>[d(" Are you sure you want to mark the "),r("span",Kt,k(e.$t("X_SELECTED_PACKAGES",o.licenses.length)),1),d(" as an internal package? ")]),_:1}),n(u,{size:"medium"},{default:i(()=>[d("Aikido will no longer show these licenses as a risk.")]),_:1})])]),footer:i(()=>[n(h,{variation:"tertiary",onClicked:t[0]||(t[0]=R=>e.$emit("close")),class:"ml-auto"},{default:i(()=>[d("Cancel")]),_:1}),n(h,{variation:"primary",onClicked:s.handleSubmit},{default:i(()=>[d("Mark as internal package")]),_:1},8,["onClicked"])]),_:1})}const Jt=b(zt,[["render",Wt]]),Qt={components:{InputSearch:me,TableList:Y,TableListHeader:Z,LicenseReportRow:pt,XPaginationWithPageSize:Tt,LicenseReportFilter:Dt,LicenseReportRowSkeleton:St,DataTableHeader:ee,InputMultiSelect:se,InputCheckbox:Te,FilterButton:te,ActionMenu:j,ContestLicenseScoringBulkModal:Xt,MarkAsInternalLicenseBulkModal:Jt},emits:["filter"],data(){return{licenses:[],totalLicenses:0,page:0,perPage:10,searchTerm:this.$route.query.q||"",language:null,riskLevel:null,repository:null,containerRepo:null,targetPathId:null,isLoading:!1,isInitialLoading:!0,sortBy:{},licenseTypes:[],selectedLicenses:[],licenseTypesLoaded:!1,isAllLicensesSelected:!1,skipNextDataLoad:!1,latestLoadLicensesJobId:0,perPageOptions:[10,20,50],selectedLicenseIds:[],showContestLicenseScoringModal:!1,showMarkAsInternalLicenseModal:!1}},async created(){this.prefillPerPage(),this.loadLicenseTypes(),this.$route.query.repositoryId||this.$route.query.containerRepoId||this.$route.query.depTargetPath||this.$route.query.language||await this.loadData(this.$route.query.license_type),F.on("licenseUpdated",this.loadData)},beforeUnmount(){this.$emit("filter",{}),F.off("licenseUpdated",this.loadData)},computed:{licenseOptions(){return this.licenseTypes.map(e=>({label:`${e.license_type} (${e.count})`,value:e.license_type}))},isLicenseTypeFilterActive(){return this.isAllLicensesSelected?!1:this.selectedLicenses.length>0},visibleSelectedLicenses(){return this.licenses.filter(e=>this.selectedLicenseIds.includes(e.id))},visibleSelectedLicenseIds(){return this.visibleSelectedLicenses.map(e=>e.id)},hasSelectedLicenses(){return this.isLoading?!1:this.visibleSelectedLicenseIds.length>0},areAllLicensesSelected(){return this.isLoading||this.licenses.length==0?!1:this.licenses.length==this.visibleSelectedLicenseIds.length},bulkSections(){return[{title:"Actions",items:[{label:"Mark as Internal License",onClick:this.markAsInternalLicenseBulk,icon:"icon-shield_check",iconColor:"green"},{label:"Change Risk Level",onClick:this.changeRiskLevelBulk,icon:"icon-edit"}]}]},actionSections(){return[{title:"Actions",items:[{label:"Display Licenses in Feed",onClick:()=>this.$modal.show("LicensesInFeedModal"),icon:"icon-page-check"}]}]}},methods:{async loadData(e=null){this.isLoading=!0,this.selectedLicenseIds=[];let t=null;e!=null?t=e:!this.isAllLicensesSelected&&this.licenseTypesLoaded&&(t=this.selectedLicenses.join("@@")),++this.latestLoadLicensesJobId;const o=this.latestLoadLicensesJobId,p=this.language?this.language.join(","):null,l=this.repository?this.repository.join(","):null,s=this.containerRepo?this.containerRepo.join(","):null,{grouped_licenses:u,grouped_licenses_total:y}=await fe({page:this.page,sort_by_column:this.sortBy.column,sort_by_direction:this.sortBy.direction,search:this.searchTerm,filter_repo_id:l,filter_container_repo_id:s,filter_risk_level:this.riskLevel,filter_language:p,filter_target_path_id:this.targetPathId,filter_license_types:t,per_page:this.perPage});this.latestLoadLicensesJobId==o&&(this.licenses=u,this.totalLicenses=y),this.isLoading=!1,this.isInitialLoading=!1},async loadLicenseTypes(){this.licenseTypes=await Le(),await this.prefillLicenseTypeFilter(),this.licenseTypesLoaded=!0},sortByChanged(e){this.sortBy=e,this.loadData()},handleFilterSelected(e){this.language=e.language,this.riskLevel=e.riskLevel,this.repository=e.repository,this.containerRepo=e.containerRepo,this.targetPathId=e.targetPathId,this.page=0,this.emitFiltersChanged(),this.loadData()},emitFiltersChanged(){const e={language:this.language,riskLevel:this.riskLevel,repository:this.repository,containerRepo:this.containerRepo,targetPathId:this.targetPathId};this.licenseTypesLoaded&&!this.isAllLicensesSelected&&(e.license_types=this.selectedLicenses),this.$emit("filter",e)},handleChangeSearchTerm(e){this.searchTerm=e,this.page=0,this.loadData()},handleChangePage(e){this.page=e,this.loadData(),this.perPage>10&&this.scrollToTop()},handleChangePerPage(e){this.perPage=+e,this.page=0,localStorage.setItem("aik.licenses.per_page",e),this.loadData(),this.perPage>10&&this.scrollToTop()},async handleLicenceTypeFilterChanged(){if(this.skipNextDataLoad){this.skipNextDataLoad=!1;return}this.page=0,this.emitFiltersChanged(),this.loadData()},async prefillLicenseTypeFilter(){const e=this.$route.query.license_type||"",t=this.licenseOptions.find(o=>o.value.toLowerCase()==e.toLowerCase());t?this.selectedLicenses=[t.value]:(await this.$nextTick(),this.skipNextDataLoad=!0,this.$refs.licenseReportFilter.handleToggleCheckAllLicenseTypes())},scrollToTop(){scrollTo({behavior:"smooth",top:0})},prefillPerPage(){const e=localStorage.getItem("aik.licenses.per_page");if(!e)return;const t=+e;this.perPageOptions.includes(t)&&(this.perPage=t)},handleToggleSelectAllVisibleLicenses(e){if(!e){this.selectedLicenseIds=[];return}this.selectedLicenseIds=this.licenses.map(t=>t.id)},isLicenseSelected(e){return this.visibleSelectedLicenseIds.includes(e)},onSelectLicense(e){if(!this.isLicenseSelected(e)){this.selectedLicenseIds.push(e);return}const t=[...this.selectedLicenseIds],o=t.findIndex(p=>p==e);t.splice(o,1),this.selectedLicenseIds=t},markAsInternalLicenseBulk(){if(N.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");this.showMarkAsInternalLicenseModal=!0},changeRiskLevelBulk(){if(N.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");this.showContestLicenseScoringModal=!0}}},Yt={class:"flex align-center gap-8px mb-16px"},Zt={class:"ml-auto flex gap-8px"},es=r("i",{class:"icon icon-caret_down icon-12px"},null,-1),ts=r("i",{class:"icon icon-caret_down icon-12px"},null,-1),ss={class:"thead mobile_hidden"},is={class:"tr"},ns={key:1,class:"w-30px h-30px"},ls={class:"tbody"};function os(e,t,o,p,l,s){const u=a("InputSearch"),y=a("LicenseReportFilter"),h=a("FilterButton"),m=a("ActionMenu"),R=a("InputCheckbox"),_=a("TableListHeader"),v=a("LicenseReportRowSkeleton"),g=a("LicenseReportRow"),U=a("TableList"),E=a("XPaginationWithPageSize"),B=a("ContestLicenseScoringBulkModal"),I=a("MarkAsInternalLicenseBulkModal");return c(),f(w,null,[r("div",Yt,[n(u,{modelValue:l.searchTerm,"onUpdate:modelValue":[t[0]||(t[0]=S=>l.searchTerm=S),s.handleChangeSearchTerm],modelModifiers:{trim:!0},spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),n(y,{ref:"licenseReportFilter",onFilterSelected:s.handleFilterSelected,initialRepositoryFilter:e.$route.query.repositoryId,initialTargetpathFilter:e.$route.query.depTargetPath,initialContainerRepoFilter:e.$route.query.containerRepoId,initialLanguageFilter:e.$route.query.language,selectedLicenses:l.selectedLicenses,"onUpdate:selectedLicenses":[t[1]||(t[1]=S=>l.selectedLicenses=S),s.handleLicenceTypeFilterChanged],isAllLicensesSelected:l.isAllLicensesSelected,"onUpdate:isAllLicensesSelected":t[2]||(t[2]=S=>l.isAllLicensesSelected=S),licenseOptions:s.licenseOptions,isLicenseTypeFilterActive:s.isLicenseTypeFilterActive,licenseTypesLoaded:l.licenseTypesLoaded},null,8,["onFilterSelected","initialRepositoryFilter","initialTargetpathFilter","initialContainerRepoFilter","initialLanguageFilter","selectedLicenses","isAllLicensesSelected","onUpdate:selectedLicenses","licenseOptions","isLicenseTypeFilterActive","licenseTypesLoaded"]),r("div",Zt,[s.hasSelectedLicenses&&!e.$groupUser.is_team_restricted?(c(),L(m,{key:0,sections:s.bulkSections,placement:"bottom-start"},{trigger:i(S=>[n(h,{onClick:S.toggle},{default:i(()=>[d(" Bulk Actions "),es]),_:2},1032,["onClick"])]),_:1},8,["sections"])):C("",!0),n(m,{useBaseIcon:!0,sections:s.actionSections,placement:"bottom-start"},{trigger:i(S=>[n(h,{onClick:S.toggle},{default:i(()=>[d(" Actions "),ts]),_:2},1032,["onClick"])]),_:1},8,["sections"])])]),n(U,{onSort:s.sortByChanged},{default:i(()=>[r("div",ss,[r("div",is,[n(_,{class:"w-48px p-12px--important"},{default:i(()=>[e.$groupUser.is_team_restricted?(c(),f("div",ns)):(c(),L(R,{key:0,"semi-checked":s.hasSelectedLicenses,modelValue:s.areAllLicensesSelected,"onUpdate:modelValue":s.handleToggleSelectAllVisibleLicenses},null,8,["semi-checked","modelValue","onUpdate:modelValue"]))]),_:1}),n(_,null,{default:i(()=>[d("Package name")]),_:1}),n(_,{sortBy:"license_type"},{default:i(()=>[d("License type")]),_:1}),n(_,{sortBy:"risk"},{default:i(()=>[d("Risk")]),_:1}),n(_,null,{default:i(()=>[d("Location")]),_:1}),n(_)])]),r("div",ls,[l.isLoading||l.isInitialLoading?(c(!0),f(w,{key:0},T(l.perPage,S=>(c(),L(v,{key:S}))),128)):(c(!0),f(w,{key:1},T(l.licenses,S=>(c(),L(g,{license:S,key:S.id,"active-repository-filter":l.repository,"active-container-repository-filter":l.containerRepo,isSelected:s.isLicenseSelected(S.id),onSelectLicense:s.onSelectLicense},null,8,["license","active-repository-filter","active-container-repository-filter","isSelected","onSelectLicense"]))),128))])]),_:1},8,["onSort"]),n(E,{page:l.page,"onUpdate:page":s.handleChangePage,perPage:l.perPage,"onUpdate:perPage":s.handleChangePerPage,currentPageCount:l.licenses.length,total:l.totalLicenses,perPageOptions:l.perPageOptions},null,8,["page","onUpdate:page","perPage","onUpdate:perPage","currentPageCount","total","perPageOptions"]),l.showContestLicenseScoringModal?(c(),L(B,{key:0,licenses:s.visibleSelectedLicenses,onClose:t[3]||(t[3]=S=>l.showContestLicenseScoringModal=!1)},null,8,["licenses"])):C("",!0),l.showMarkAsInternalLicenseModal?(c(),L(I,{key:1,isBulk:!0,licenses:s.visibleSelectedLicenses,onClose:t[4]||(t[4]=S=>l.showMarkAsInternalLicenseModal=!1)},null,8,["licenses"])):C("",!0)],64)}const as=b(Qt,[["render",os]]),rs={components:{TableList:Y,TableListHeader:Z,ActionMenu:j,BaseIconButton:J,TableListActionMenu:Ae},data(){return{licenseCountByType:[],sortBy:{},loaded:!1}},async mounted(){await this.loadData(),this.loaded=!0,F.on("licenseRiskUpdated",this.loadData)},beforeUnmount(){F.off("licenseRiskUpdated",this.loadData)},methods:{getActions(e,t){return[{title:"Actions",items:[{visible:!0,label:"Adjust risk",onClick:()=>this.handleAdjustRiskLevel(e,t),icon:"icon-edit"}]}]},async loadData(){this.licenseCountByType=await ke({sort_by_column:this.sortBy.column,sort_by_direction:this.sortBy.direction})},isHighRisk(e){return["high","critical"].includes(e)},sortByChanged(e){this.sortBy=e,this.loadData()},handleAdjustRiskLevel(e,t){this.$modal.show("AdjustLicenseRiskInfoModal",{licenseType:e,count:t})},openLicenseRiskInfoModal(e){this.$modal.show("LicenseRiskInfoModal",{licenseType:e})}}},cs={key:1,class:"mt-48px"},ds={class:"thead mobile_hidden"},us={class:"tr"},ps={class:"tbody"},hs={class:"td"},gs={class:"flex align-center gap-4px"},ms={class:"valign-middle truncate"},_s=["onClick"],fs={class:"td"},Ls={key:0,class:"icon icon-critical valign-middle mr-4px"},ks={class:"valign-middle"},ys={key:1,class:"td"};function Cs(e,t,o,p,l,s){const u=a("XPreloader"),y=a("TableListHeader"),h=a("TableListActionMenu"),m=a("RouterLink"),R=a("TableList");return l.loaded?(c(),f("div",cs,[n(R,{onSort:s.sortByChanged},{default:i(()=>[r("div",ds,[r("div",us,[n(y,{sortBy:"license_type"},{default:i(()=>[d("License type")]),_:1}),n(y,{sortBy:"count"},{default:i(()=>[d("Dependency Count")]),_:1}),n(y,{sortBy:"risk"},{default:i(()=>[d("Risk")]),_:1}),n(y)])]),r("div",ps,[(c(!0),f(w,null,T(l.licenseCountByType,({license_type:_,count:v,risk:g})=>(c(),L(m,{class:"tr clickable group",key:_,to:`/licenses?license_type=${_}`},{default:i(()=>[r("div",hs,[r("div",gs,[r("span",ms,k(_),1),r("i",{onClick:A(()=>s.openLicenseRiskInfoModal(_),["prevent","stop"]),class:"icon icon-12px icon-information valign-middle text-gray-200 opacity-0 group_hover_opacity-100 cursor-pointer"},null,8,_s)])]),r("div",fs,k(v),1),r("div",{class:x(["td max-w-0 w-30p",{"text-color-danger":s.isHighRisk(g)}])},[s.isHighRisk(g)?(c(),f("i",Ls)):C("",!0),r("span",ks,k(e.$t(`RISK_${g}`)),1)],2),e.$groupUser.is_team_restricted?(c(),f("div",ys)):(c(),L(h,{key:0,sections:s.getActions(_,v),onClick:t[0]||(t[0]=A(()=>{},["prevent","stop"]))},null,8,["sections"]))]),_:2},1032,["to"]))),128))])]),_:1},8,["onSort"])])):(c(),L(u,{key:0,class:"center",theme:"transparent"}))}const Ss=b(rs,[["render",Cs]]),Rs={components:{PageHeader:ne,XTabs:le,LicenseReportOverview:as,LicenseGroups:Ss,BaseParagraph:P,XTooltip:Q,BaseButton:M},data(){return{tab:"overview",tabs:[{title:this.$t("OVERVIEW"),id:"overview"},{title:this.$t("LICENSE_GROUPS"),id:"license_groups"}],meta:null,filters:{}}},async created(){this.meta=await ie("license")},computed:{lastScanned(){var e;return(e=this.meta)!=null&&e.last_scanned_at?`Last scan ${Be(this.meta.last_scanned_at)} ago`:"No scans just yet"},nextScanTime(){var e;return(e=this.meta)!=null&&e.next_scan_at?`Next scan on ${z.fromUnix(this.meta.next_scan_at).format(z.SHORT_DATE_FORMAT)}`:null},pageTitle(){return"Licenses & SBOM"},pageSubtitle(){return this.$t("X_LICENSED_PACKAGES")},breadcrumbs(){return[{label:this.$t("REPORTS"),href:"/reports"},{label:this.pageTitle}]}},methods:{async downloadSBOM(){if(!N.isPayingAndNoProTrial()&&!this.$featureflags.enable_sbom_export)return this.$modal.show("UpgradeAccountModal");const e={...this.filters,team:this.$teamContext},t=await this.$modal.show("ExportLicensesModal",{filters:e});return t.type!=="saved"?void 0:t.value==="csv_sbom"?await X("/api/licenses/export/csv",{filters:e},!1,"post"):await X("/api/licenses/export/sbom",{filters:e,export_type:t.value},!1,"post")},handleApplyFilter(e){this.filters=e}}},vs={class:"flex gap-16px"},ws=r("i",{class:"icon icon-calender icon-12px valign-middle ml-8px"},null,-1),bs={class:"page-content relative"};function Ts(e,t,o,p,l,s){const u=a("BaseButton"),y=a("XTooltip"),h=a("BaseParagraph"),m=a("XTabs"),R=a("PageHeader"),_=a("LicenseReportOverview"),v=a("LicenseGroups");return c(),f(w,null,[n(R,{breadcrumbs:s.breadcrumbs,title:s.pageTitle,subtitle:s.pageSubtitle},{rightContent:i(()=>[r("div",vs,[e.$groupUser.is_team_restricted?C("",!0):(c(),L(u,{key:0,onClicked:s.downloadSBOM,variation:"primary"},{default:i(()=>[d("Download SBOM")]),_:1},8,["onClicked"]))])]),footerRightContent:i(()=>[l.meta?(c(),L(h,{key:0,color:"subdued"},{default:i(()=>[d(k(s.lastScanned)+" ",1),ws,n(y,null,{default:i(()=>[d(k(s.nextScanTime),1)]),_:1})]),_:1})):C("",!0)]),tabs:i(()=>[n(m,{tabs:l.tabs,modelValue:l.tab,"onUpdate:modelValue":t[0]||(t[0]=g=>l.tab=g),class:"page-tabs"},null,8,["tabs","modelValue"])]),_:1},8,["breadcrumbs","title","subtitle"]),r("div",bs,[l.tab==="overview"?(c(),L(_,{key:0,onFilter:s.handleApplyFilter},null,8,["onFilter"])):C("",!0),l.tab==="license_groups"?(c(),L(v,{key:1})):C("",!0)])],64)}const Qs=b(Rs,[["render",Ts]]);export{Qs as default};
