import{A}from"./ActionMenu-3e4470bf.js";import{F as x}from"./FilterButton-bb5393a7.js";import{_ as E,a2 as k,x as v,r,q as c,m as f,n as o,s as b,u as C,k as I,w as p,o as a,p as _,au as R,X as U,N as w,K as F,aR as L,a$ as M,ad as W,a0 as P,F as D,U as g,cD as y,A as O}from"./index-13ff96f4.js";import{I as N}from"./InputMultiSelect-21584437.js";import{B}from"./BaseRadioInput-a7ac3557.js";import{D as V}from"./DateRangePicker-89d26e9f.js";import{d as Y}from"./export-427c6d83.js";const j={emits:["update"],components:{DateRangePicker:V,XTooltip:k,BaseIcon:v},props:{label:String,tooltip:String,sublabel:[String,void 0]}},G={class:"flex flex-column select-input select-input--theme-light"},Q=["for"],X={key:0,class:"select-input__label__sub-label"},q=["onClick"],K={class:"select-input__input select-input__input--default"},z={class:"text--semi text-primary-aik-140"},H={class:"text-primary-aik-100"},J={class:"text-primary-aik-100"},Z=o("div",{class:"select-input__input-indicator"},[o("i",{class:"icon icon-14px icon-caret_down text-carbon-60 leading-22px"})],-1);function $(e,t,n,T,s,i){const d=r("XTooltip"),m=r("BaseIcon"),S=r("i18n-t"),h=r("DateRangePicker");return c(),f("div",G,[n.label?(c(),f("label",{key:0,for:e.id,class:"select-input__label"},[o("span",null,[b(C(n.label)+" ",1),n.tooltip?(c(),I(m,{key:0,icon:"icon-help",class:"cursor-help inline-flex valign-middle"},{default:p(()=>[a(d,null,{default:p(()=>[b(C(n.tooltip),1)]),_:1})]),_:1})):_("",!0)]),n.sublabel?(c(),f("span",X,C(n.sublabel),1)):_("",!0)],8,Q)):_("",!0),a(h,{onUpdate:t[0]||(t[0]=u=>e.$emit("update",u)),class:"w-full",customEmptystate:"All Time"},{trigger:p(u=>[o("div",{onClick:u.toggle,class:"select-input__input-container"},[o("div",K,[o("div",z,[a(S,{keypath:u.buttonLabel},{fromDate:p(()=>[o("span",H,C(u.formattedFromDate),1)]),toDate:p(()=>[o("span",J,C(u.formattedToDate),1)]),_:2},1032,["keypath"])])]),Z],8,q)]),_:1})])}const ee=E(j,[["render",$]]);function te(e){var n;let t=e.name;return(n=e.cloud_repo_id)!=null&&n.includes("_aikidoclone_")&&e.tag&&(t+=":"+e.tag),t}const se={components:{BaseConfirmModal:R,InputMultiSelect:N,BaseRadioInput:B,XTooltip:k,XPreloader:U,InputDateRangeDropdown:ee,BaseSelect:w},emits:["close"],props:{repository:{type:Object,default:null},cloud:{type:Object,default:null},container:{type:Object,default:null},initialSeverityFilter:{type:String,default:""}},data(){return{modalWidth:600,selectedRepositoryIds:[],repositories:[],areAllRepositoriesChecked:!1,isLoadingRepositories:!1,selectedCloudIds:[],clouds:[],areAllCloudsChecked:!1,isLoadingClouds:!1,selectedContainerIds:[],containers:[],areAllContainersChecked:!1,isLoadingContainers:!1,selectedExportFormat:"CSV",statusOptions:[{value:"open",label:this.$t("STATUSTAG_open")},{value:"snoozed",label:this.$t("STATUSTAG_snoozed")},{value:"ignored",label:this.$t("STATUSTAG_ignored")},{value:"closed",label:this.$t("STATUSTAG_closed")}],selectedStatusOptions:["open"],allStatusesChecked:!1,issueTypeOptions:[{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.OPEN_SOURCE_ISSUES"),value:"open_source"},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.CLOUD_CONFIG_ISSUES"),value:"cloud"},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.LEAKED_SECRETS"),value:"leaked_secret"},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.SAST_ISSUES"),value:"sast"},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.IAC_ISSUES"),value:"iac"},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.SURFACE_MONITORING_ISSUES"),value:"surface_monitoring"},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.EOL_ISSUES"),value:"eol"},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.MALWARE_ISSUES"),value:"malware"},{label:this.$t("QUEUE.QUICK_FILTER.ACTIONS.DOCKER"),value:"docker_container"},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.SCM_SECURITY_ISSUES"),value:"scm_security"}],selectedIssueTypes:[],allIssueTypesChecked:!1,dateRangeFilterFrom:null,dateRangeFilterTo:null,teams:[],selectedTeamId:-1,selectedSeverities:["critical","high","medium","low"],allSeveritiesChecked:!0,severityOptions:[{value:"critical",label:"Critical"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}]}},async mounted(){this.severityOptions.map(t=>t.value).includes(this.initialSeverityFilter)&&(this.selectedSeverities=[this.initialSeverityFilter],this.allSeveritiesChecked=!1),this.$teamContext>0&&(this.selectedTeamId=this.$teamContext),await this.init()},computed:{multiSelectWidth(){return this.modalWidth-72},innerSelectWidth(){return this.multiSelectWidth-60},canSelectExportOptions(){return!this.repository&&!this.cloud&&!this.container},isLoadingOptions(){return this.isLoadingRepositories||this.isLoadingClouds||this.isLoadingContainers},exportOptionType(){return this.repository?this.$t("REPOSITORY"):this.cloud?this.$t("CLOUD_INTEGRATION"):this.container?this.$t("CONTAINER"):null},selectedExportOption(){return this.repository?this.repository.scm_repo_name:this.cloud?this.cloud.name:this.container?this.container.name:null},repositoryOptions(){return this.repositories.map(e=>({value:e.id,label:e.scm_repo_name}))},cloudOptions(){return this.clouds.map(e=>({value:e.id,label:e.name}))},containerOptions(){return this.containers.map(e=>({value:e.id,label:e.name}))},queryStringParams(){const e={};return this.areAllRepositoriesChecked?e.repos="all":this.selectedRepositoryIds.length>0&&(e.repos=this.selectedRepositoryIds.join(",")),this.areAllCloudsChecked?e.clouds="all":this.selectedCloudIds.length>0&&(e.clouds=this.selectedCloudIds.join(",")),this.areAllContainersChecked?e.containers="all":this.selectedContainerIds.length>0&&(e.containers=this.selectedContainerIds.join(",")),this.dateRangeFilterFrom&&(e.after_timestamp=this.dateRangeFilterFrom.toUTC()),this.dateRangeFilterTo&&(e.before_timestamp=this.dateRangeFilterTo.toUTC()),this.selectedTeamId>0&&(e.team_filter=this.selectedTeamId),e.statuses=this.selectedStatusOptions.join(","),e.issue_types=this.selectedIssueTypes.join(","),this.allSeveritiesChecked||(e.severities=this.selectedSeverities.join(",")),e.format=this.selectedExportFormat,e},disableSubmit(){return this.selectedStatusOptions.length==0},statusOptionsError(){return this.selectedStatusOptions.length==0?"This option cannot be empty":""},teamOptions(){const e=this.teams.map(t=>({id:t.id,title:t.name}));return e.unshift({id:-1,title:"All Teams"}),e}},methods:{async init(){if(await this.$nextTick(),this.$refs.issueTypeMultiSelect.handleToggleCheckAll(),this.repository){this.selectedRepositoryIds=[this.repository.id];return}if(this.cloud){this.selectedCloudIds=[this.cloud.id];return}if(this.container){this.selectedContainerIds=[this.container.id];return}await Promise.all([this.loadRepositories(),this.loadClouds(),this.loadContainers(),this.loadTeams()])},async loadRepositories(){this.isLoadingRepositories=!0,this.repositories=await F(void 0,!1,!1,{skip:null,limit:null},null,null,null,{},!0),await this.$nextTick(),this.$refs.repositoryMultiSelect.handleToggleCheckAll(),this.isLoadingRepositories=!1},async loadClouds(){this.isLoadingClouds=!0,this.clouds=await L(),await this.$nextTick(),this.$refs.cloudMultiSelect.handleToggleCheckAll(),this.isLoadingClouds=!1},async loadContainers(){this.isLoadingContainers=!0;const e=await M({activeOnly:!0});for(const t of e)t.name=te(t);this.containers=e,await this.$nextTick(),this.$refs.containerMultiSelect.handleToggleCheckAll(),this.isLoadingContainers=!1},async loadTeams(){const e=await W();this.teams=e},async exportIssues(){if(this.$emit("close"),this.selectedExportFormat=="PDF"&&(this.selectedStatusOptions.includes("ignored")||this.selectedStatusOptions.includes("closed"))){const e=await P.get("/api/issues/export",{params:{...this.queryStringParams,no_download:!0}});window.open(`/reports/audit-reports/external/report?report_id=${e.data.report_id}`,"_blank")}else await Y("/api/issues/export",this.queryStringParams,!0)},handleUpdateDateRangeFilter(e){this.dateRangeFilterFrom=e.from,this.dateRangeFilterTo=e.to}}},ie=o("hr",{class:"divider w-full"},null,-1),le={class:"mt-16px select-input select-input--theme-light"},oe=o("label",{class:"select-input__label"},[o("span",null,"Export Format")],-1),ne={class:"flex gap-12px"},ae={class:"flex gap-4px align-center cursor-pointer"},re=o("label",{for:"CSV",class:"text-center paragraph paragraph--small text-carbon-60 cursor-pointer"},"CSV",-1),de={class:"flex gap-4px align-center cursor-pointer"},ce=o("label",{for:"PDF",class:"text-center paragraph paragraph--small text-carbon-60 cursor-pointer"},"PDF",-1);function ue(e,t,n,T,s,i){const d=r("InputMultiSelect"),m=r("XPreloader"),S=r("InputDateRangeDropdown"),h=r("BaseSelect"),u=r("BaseConfirmModal");return c(),I(u,{title:e.$t("ISSUES.EXPORT.MODAL.TITLE"),description:e.$t("ISSUES.EXPORT.MODAL.SUBTITLE"),buttonSubmitText:"Export",disableSubmit:i.disableSubmit,onSubmit:i.exportIssues,onClose:t[15]||(t[15]=l=>e.$emit("close")),onSecondaryButtonClicked:t[16]||(t[16]=l=>e.$emit("close")),width:s.modalWidth},{default:p(()=>[o("div",null,[ie,a(d,{ref:"statusMultiSelect",class:"mt-16px mb-16px",options:s.statusOptions,selectedItems:s.selectedStatusOptions,"onUpdate:selectedItems":t[0]||(t[0]=l=>s.selectedStatusOptions=l),label:e.$t("STATUS"),width:i.multiSelectWidth,truncateOptionsWidth:i.innerSelectWidth,enableCheckAll:!0,isAllChecked:s.allStatusesChecked,"onUpdate:isAllChecked":t[1]||(t[1]=l=>s.allStatusesChecked=l),error:i.statusOptionsError,required:!0},null,8,["options","selectedItems","label","width","truncateOptionsWidth","isAllChecked","error"]),a(d,{ref:"issueTypeMultiSelect",class:"mt-16px mb-16px",options:s.issueTypeOptions,selectedItems:s.selectedIssueTypes,"onUpdate:selectedItems":t[2]||(t[2]=l=>s.selectedIssueTypes=l),label:e.$t("ISSUE_TYPES"),width:i.multiSelectWidth,truncateOptionsWidth:i.innerSelectWidth,enableCheckAll:!0,isAllChecked:s.allIssueTypesChecked,"onUpdate:isAllChecked":t[3]||(t[3]=l=>s.allIssueTypesChecked=l)},null,8,["options","selectedItems","label","width","truncateOptionsWidth","isAllChecked"]),a(d,{ref:"severityMultiSelect",class:"mt-16px mb-16px",options:s.severityOptions,selectedItems:s.selectedSeverities,"onUpdate:selectedItems":t[4]||(t[4]=l=>s.selectedSeverities=l),label:"Severity",width:i.multiSelectWidth,truncateOptionsWidth:i.innerSelectWidth,enableCheckAll:!0,enableSearch:!1,isAllChecked:s.allSeveritiesChecked,"onUpdate:isAllChecked":t[5]||(t[5]=l=>s.allSeveritiesChecked=l)},null,8,["options","selectedItems","width","truncateOptionsWidth","isAllChecked"]),i.canSelectExportOptions?(c(),f(D,{key:0},[i.isLoadingOptions?(c(),I(m,{key:0,class:"supercenter",size:"medium"})):_("",!0),a(d,{ref:"repositoryMultiSelect",class:"mt-16px mb-16px",options:i.repositoryOptions,selectedItems:s.selectedRepositoryIds,"onUpdate:selectedItems":t[6]||(t[6]=l=>s.selectedRepositoryIds=l),label:e.$t("REPOSITORIES"),isLoading:s.isLoadingRepositories,width:i.multiSelectWidth,truncateOptionsWidth:i.innerSelectWidth,enableCheckAll:!0,isAllChecked:s.areAllRepositoriesChecked,"onUpdate:isAllChecked":t[7]||(t[7]=l=>s.areAllRepositoriesChecked=l)},null,8,["options","selectedItems","label","isLoading","width","truncateOptionsWidth","isAllChecked"]),a(d,{ref:"cloudMultiSelect",class:"mt-16px mb-16px",options:i.cloudOptions,selectedItems:s.selectedCloudIds,"onUpdate:selectedItems":t[8]||(t[8]=l=>s.selectedCloudIds=l),label:e.$t("CLOUD_INTEGRATIONS"),isLoading:s.isLoadingClouds,width:i.multiSelectWidth,truncateOptionsWidth:i.innerSelectWidth,enableCheckAll:!0,isAllChecked:s.areAllCloudsChecked,"onUpdate:isAllChecked":t[9]||(t[9]=l=>s.areAllCloudsChecked=l)},null,8,["options","selectedItems","label","isLoading","width","truncateOptionsWidth","isAllChecked"]),a(d,{ref:"containerMultiSelect",class:"mt-16px mb-16px",options:i.containerOptions,selectedItems:s.selectedContainerIds,"onUpdate:selectedItems":t[10]||(t[10]=l=>s.selectedContainerIds=l),label:e.$t("CONTAINER_IMAGE_REGISTRY"),isLoading:s.isLoadingContainers,width:i.multiSelectWidth,truncateOptionsWidth:i.innerSelectWidth,enableCheckAll:!0,isAllChecked:s.areAllContainersChecked,"onUpdate:isAllChecked":t[11]||(t[11]=l=>s.areAllContainersChecked=l)},null,8,["options","selectedItems","label","isLoading","width","truncateOptionsWidth","isAllChecked"])],64)):(c(),I(d,{key:1,ref:"repositoryMultiSelect",class:"mt-16px mb-16px",options:[{value:i.selectedExportOption,label:i.selectedExportOption}],selectedItems:[i.selectedExportOption],label:i.exportOptionType,width:i.multiSelectWidth,truncateOptionsWidth:i.innerSelectWidth,enableCheckAll:!1,error:i.statusOptionsError,disabled:!0},null,8,["options","selectedItems","label","width","truncateOptionsWidth","error"])),a(S,{class:"mt-16px mb-16px",label:"Date Range",tooltip:"Aikido will filter issues to only includes findings that were newly found or still open during this date range",onUpdate:i.handleUpdateDateRangeFilter},null,8,["onUpdate"]),a(h,{label:"Team",modelValue:s.selectedTeamId,"onUpdate:modelValue":t[12]||(t[12]=l=>s.selectedTeamId=l),options:i.teamOptions,disabled:e.$teamContext>0,disabledReason:"Global team filter active"},null,8,["modelValue","options","disabled"]),o("div",le,[oe,o("div",ne,[o("div",ae,[g(o("input",{id:"CSV",class:"radio-input",ref:"input",type:"radio","onUpdate:modelValue":t[13]||(t[13]=l=>s.selectedExportFormat=l),value:"CSV"},null,512),[[y,s.selectedExportFormat]]),re]),o("div",de,[g(o("input",{id:"PDF",class:"radio-input",ref:"input",type:"radio","onUpdate:modelValue":t[14]||(t[14]=l=>s.selectedExportFormat=l),value:"PDF"},null,512),[[y,s.selectedExportFormat]]),ce])])])])]),_:1},8,["title","description","disableSubmit","onSubmit","width"])}const pe=E(se,[["render",ue]]),he={components:{ActionMenu:A,FilterButton:x,IssuesExportModal:pe},emits:["refresh"],props:{repository:{type:Object,default:null},cloud:{type:Object,default:null},container:{type:Object,default:null},initialSeverityFilter:{type:String,default:""}},data(){return{showIssuesExportModal:!1}},computed:{canExportSbom(){return!(this.$groupUser.only_team_related_issues||!this.container)},actions(){return[{title:"Actions",items:[{label:"Refresh Table",onClick:()=>this.$emit("refresh"),icon:"icon-refresh",iconClass:"w-16px"},{visible:!this.$groupUser.only_team_related_issues,label:"Export Issues",onClick:this.handleIssuesExport,icon:"icon-download",iconClass:"w-16px"},{visible:this.canExportSbom,label:"Export Raw SBOM",onClick:this.handleSBOMExport,icon:"icon-download",iconClass:"w-16px"}].filter(t=>t.visible!==!1)}]}},methods:{handleIssuesExport(){if(!O.isPaying())return this.$modal.show("UpgradeAccountModal");this.showIssuesExportModal=!0},handleSBOMExport(){if(!O.isPaying())return this.$modal.show("UpgradeAccountModal");this.$modal.show("ExportSbomModal",{image:this.container})}}},me=o("i",{class:"icon icon-caret_down icon-12px"},null,-1);function Se(e,t,n,T,s,i){const d=r("FilterButton"),m=r("ActionMenu"),S=r("IssuesExportModal");return c(),f("div",null,[a(m,{sections:i.actions,placement:"bottom-end",useBaseIcon:!0},{trigger:p(h=>[a(d,{onClick:()=>h.toggle()},{default:p(()=>[b(" Actions "),me]),_:2},1032,["onClick"])]),_:1},8,["sections"]),s.showIssuesExportModal?(c(),I(S,{key:0,repository:n.repository,cloud:n.cloud,container:n.container,initialSeverityFilter:n.initialSeverityFilter,onClose:t[0]||(t[0]=h=>s.showIssuesExportModal=!1)},null,8,["repository","cloud","container","initialSeverityFilter"])):_("",!0)])}const ge=E(he,[["render",Se]]);export{ge as F};
