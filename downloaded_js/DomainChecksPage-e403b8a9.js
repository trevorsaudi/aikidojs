import{_ as R,B as I,a1 as v,d as q,dC as F,bK as E,r as i,q as d,k as y,c7 as V,w as l,m as C,t as D,o as a,n as k,s as g,u as O,p as _,F as S,aa as N,I as z,z as U,dD as H,dE as Z,dF as K,aw as W,dG as j,dH as X}from"./index-13ff96f4.js";import{S as Q}from"./SlidingButtonGroup-ee0f3352.js";import{I as J}from"./InputFilterDropdown-674351d9.js";import{D as L,a as x}from"./DataTable-e31a825a.js";import{D as P,a as B}from"./DataTableCell-51c0104f.js";import{D as M}from"./DataTableSeverityIndicator-48ffb8dc.js";import{I as Y}from"./InputMultiSelect-21584437.js";import{X as $}from"./XPagination-8f16f099.js";import"./FilterButton-bb5393a7.js";import"./ActionMenu-3e4470bf.js";import"./InputCheckbox-81cb3ca6.js";const ee={components:{DataTable:L,DataTableCell:P,DataTableHeader:x,DataTableRow:B,BaseParagraph:I,LoadingSkeleton:v,DataTableSeverityIndicator:M,BasePill:q},props:{search:{type:String,default:""},showOnlyAuthenticatedRules:{type:Boolean,default:!1}},data(){return{loading:!0,surfaceMonitoringRules:[]}},async created(){this.surfaceMonitoringRules=await F(),this.loading=!1},computed:{authenticatedOnlySurfaceMonitoringRules(){return this.surfaceMonitoringRules.filter(e=>!!e.is_auth_only)},filteredSurfaceMonitoringRules(){const e=this.showOnlyAuthenticatedRules?this.authenticatedOnlySurfaceMonitoringRules:this.surfaceMonitoringRules;return this.search==""?e:e.filter(t=>{const o=this.search.toLowerCase();return t.title.toLowerCase().indexOf(o)>-1})}},methods:{getSeverityText(e){return this.$t(E(e))},handleOpenCheckAttemptsModal(e,t){this.$modal.show("AuthenticatedCheckAttemptsModal",{ruleId:e,title:t})}}},te={class:"flex gap-8px align-center flex-1"},ae={class:"flex flex-column"};function le(e,t,o,c,s,n){const p=i("DataTableHeader"),r=i("BaseParagraph"),u=i("BasePill"),m=i("BaseButton"),T=i("DataTableCell"),b=i("DataTableSeverityIndicator"),A=i("DataTableRow"),f=i("LoadingSkeleton"),w=i("DataTable");return d(),y(w,null,V({header:l(()=>[a(p,{width:"auto"},{default:l(()=>[g("Title")]),_:1}),a(p,{width:"auto"},{default:l(()=>[g("Description")]),_:1}),a(p,{width:"96px"},{default:l(()=>[g("Severity")]),_:1})]),_:2},[s.loading?{name:"body",fn:l(()=>[(d(),C(S,null,D(10,h=>a(A,{key:h},{default:l(()=>[a(T,null,{default:l(()=>[a(f)]),_:1}),a(T,null,{default:l(()=>[a(f,{width:"256px"})]),_:1}),a(T,null,{default:l(()=>[a(f)]),_:1})]),_:2},1024)),64))]),key:"1"}:{name:"body",fn:l(()=>[(d(!0),C(S,null,D(n.filteredSurfaceMonitoringRules,(h,G)=>(d(),y(A,{key:G},{default:l(()=>[a(T,null,{default:l(()=>[k("div",te,[a(r,null,{default:l(()=>[g(O(h.title),1)]),_:2},1024),h.is_auth_only?(d(),y(u,{key:0,variation:"gray-fill",title:"Authenticated only"})):_("",!0),h.is_auth_only?(d(),y(m,{key:1,size:"small",variation:"plain",onClick:()=>n.handleOpenCheckAttemptsModal(h.rule_code,h.title),class:"ml-auto"},{default:l(()=>[g("See details")]),_:2},1032,["onClick"])):_("",!0)])]),_:2},1024),a(T,null,{default:l(()=>[k("div",ae,[a(r,{size:"small"},{default:l(()=>[g(O(h.description),1)]),_:2},1024)])]),_:2},1024),a(b,{priority:h.initial_severity},null,8,["priority"])]),_:2},1024))),128))]),key:"0"}]),1024)}const se=R(ee,[["render",le]]),oe={components:{DataTable:L,DataTableHeader:x,DataTableRow:B,DataTableCell:P,BaseParagraph:I,DataTableSeverityIndicator:M,LoadingSkeleton:v},props:{nucleiTemplates:{type:Array,required:!0},isLoading:{type:Boolean,default:!1}}},ne={class:"flex flex-column"};function ie(e,t,o,c,s,n){const p=i("DataTableHeader"),r=i("LoadingSkeleton"),u=i("DataTableCell"),m=i("DataTableRow"),T=i("BaseParagraph"),b=i("DataTableSeverityIndicator"),A=i("DataTable");return d(),y(A,null,{header:l(()=>[a(p,{width:"auto"},{default:l(()=>[g("Name")]),_:1}),a(p,{width:"auto"},{default:l(()=>[g("Description")]),_:1}),a(p,{width:"160px"},{default:l(()=>[g("Tags")]),_:1}),a(p,{width:"90px"},{default:l(()=>[g("Severity")]),_:1})]),body:l(()=>[o.isLoading?(d(),C(S,{key:0},D(10,f=>a(m,{key:f},{default:l(()=>[a(u,null,{default:l(()=>[a(r)]),_:1}),a(u,null,{default:l(()=>[a(r)]),_:1}),a(u,null,{default:l(()=>[a(r)]),_:1}),a(u,null,{default:l(()=>[a(r)]),_:1})]),_:2},1024)),64)):(d(!0),C(S,{key:1},D(o.nucleiTemplates,f=>(d(),y(m,{key:f.id},{default:l(()=>[a(u,null,{default:l(()=>[a(T,null,{default:l(()=>[g(O(f.name),1)]),_:2},1024)]),_:2},1024),a(u,null,{default:l(()=>[k("div",ne,[a(T,{size:"small"},{default:l(()=>[g(O(f.description),1)]),_:2},1024)])]),_:2},1024),a(u,null,{default:l(()=>[a(T,null,{default:l(()=>[g(O(f.tags.join(", ")),1)]),_:2},1024)]),_:2},1024),a(b,{priority:f.severity},null,8,["priority"])]),_:2},1024))),128)),N(e.$slots,"tableEnd")]),_:3})}const ce=R(oe,[["render",ie]]),re={components:{BasePill:q,DataTable:L,DataTableHeader:x,DataTableRow:B,DataTableCell:P,BaseParagraph:I,DataTableSeverityIndicator:M,LoadingSkeleton:v},props:{aktoRules:{type:Array,required:!0},isLoading:{type:Boolean,default:!1},showOnlyAuthenticatedRules:{type:Boolean,default:!1}},computed:{visibleRules(){return this.showOnlyAuthenticatedRules?this.aktoRules.filter(e=>!!e.is_auth_only):this.aktoRules}},methods:{handleOpenCheckAttemptsModal(e,t){this.$modal.show("AuthenticatedCheckAttemptsModal",{ruleId:e,title:t})}}},he={class:"flex gap-8px align-center flex-1"},ue={class:"flex flex-column"};function de(e,t,o,c,s,n){const p=i("DataTableHeader"),r=i("LoadingSkeleton"),u=i("DataTableCell"),m=i("DataTableRow"),T=i("BaseParagraph"),b=i("BasePill"),A=i("BaseButton"),f=i("DataTableSeverityIndicator"),w=i("DataTable");return d(),y(w,null,{header:l(()=>[a(p,{width:"auto"},{default:l(()=>[g("Title")]),_:1}),a(p,{width:"auto"},{default:l(()=>[g("Description")]),_:1}),a(p,{width:"96px"},{default:l(()=>[g("Severity")]),_:1})]),body:l(()=>[o.isLoading?(d(),C(S,{key:0},D(10,h=>a(m,{key:h},{default:l(()=>[a(u,null,{default:l(()=>[a(r)]),_:1}),a(u,null,{default:l(()=>[a(r)]),_:1}),a(u,null,{default:l(()=>[a(r)]),_:1})]),_:2},1024)),64)):(d(!0),C(S,{key:1},D(n.visibleRules,h=>(d(),y(m,{key:h.rule_id},{default:l(()=>[a(u,null,{default:l(()=>[k("div",he,[a(T,null,{default:l(()=>[g(O(h.title),1)]),_:2},1024),h.is_auth_only?(d(),y(b,{key:0,variation:"gray-fill",title:"Authenticated only"})):_("",!0),h.is_auth_only?(d(),y(A,{key:1,size:"small",variation:"plain",onClick:()=>n.handleOpenCheckAttemptsModal(h.rule_id,h.title),class:"ml-auto"},{default:l(()=>[g("See details")]),_:2},1032,["onClick"])):_("",!0)])]),_:2},1024),a(u,null,{default:l(()=>[k("div",ue,[a(T,{size:"small"},{default:l(()=>[g(O(h.description),1)]),_:2},1024)])]),_:2},1024),a(f,{priority:h.severity},null,8,["priority"])]),_:2},1024))),128)),N(e.$slots,"tableEnd")]),_:3})}const pe=R(re,[["render",de]]),ge={components:{InputSearch:z,SlidingButtonGroup:Q,InputFilterDropdown:J,RepositoryDetailSurfaceMonitoring:se,DomainNucleiChecksTable:ce,InputMultiSelect:Y,XPagination:$,InputSwitch:U,DomainAktoChecksTable:pe},props:{scanType:{type:String},tagGroups:{type:Array},showOnlyAuthenticatedRules:{type:Boolean,default:!1}},data(){return{selectedCheckType:this.scanType==="nuclei"?"nuclei":"zap",technologySearch:"",tagSearch:"",allNucleiTemplates:[],search:"",debouncedSearch:"",selectedTechnologies:[],selectedAllTechnologies:!0,selectedTags:[],selectedAllTags:!0,technologyTagsMap:{},technologyOptions:[],tagOptions:[],page:0,perPage:30,isLoadingNucleiTemplates:!1,showAuthenticatedZapRulesOnly:!!this.$route.query.filter_authenticated_only,isLoadingAktoRules:!1,aktoRules:[],isLoadingAktoGraphqlRules:!1,aktoGraphqlRules:[]}},created(){const{scanner:e}=this.$route.query;let t=e;e==="rest"?t="akto":e==="graphql"&&(t="akto_graphql"),t&&(this.selectedCheckType=t),this.scanType=="akto"&&(this.selectedCheckType="akto"),this.scanType=="akto_graphql"&&(this.selectedCheckType="akto_graphql")},async mounted(){await Promise.allSettled([this.loadNucleiChecks(),this.loadAktoChecks(),this.loadAktoGraphqlChecks()])},computed:{checkTypeActions(){const e=!!this.domainIdFilter;let t=[];return(!e||this.selectedCheckType==="zap")&&t.push({key:"zap",label:"ZAP",onAction:()=>this.selectCheckType("zap"),metadata:{tooltip:this.$t("DOMAIN_OVERVIEW.CHECKS.ZAP.TOOLTIP")},hidden:e&&this.selectedCheckType!=="zap"}),(!e||this.selectedCheckType==="nuclei")&&t.push({key:"nuclei",label:"Nuclei",onAction:()=>this.selectCheckType("nuclei"),metadata:{tooltip:this.$t("DOMAIN_OVERVIEW.CHECKS.NUCLEI.TOOLTIP")},hidden:e&&this.selectedCheckType!=="nuclei"}),(!e||this.selectedCheckType==="akto")&&t.push({key:"akto",label:"REST API",onAction:()=>this.selectCheckType("akto"),metadata:{tooltip:this.$t("DOMAIN_OVERVIEW.CHECKS.AKTO.TOOLTIP")},hidden:e&&this.selectedCheckType!=="akto"}),(!e||this.selectedCheckType==="akto_graphql")&&t.push({key:"akto_graphql",label:"GraphQL",onAction:()=>this.selectCheckType("akto_graphql"),metadata:{tooltip:this.$t("DOMAIN_OVERVIEW.CHECKS.AKTO_GRAPHQL.TOOLTIP")},hidden:e&&this.selectedCheckType!=="akto_graphql"}),t},nucleiTechnologyOptionsForDomain(){return this.domainIdFilter?!Array.isArray(this.tagGroups)||this.tagGroups.length===0?this.technologyOptions:this.technologyOptions.filter(e=>this.tagGroups.includes(e.value)):this.technologyOptions},filteredTechnologyOptions(){return this.nucleiTechnologyOptionsForDomain.filter(t=>{const o=this.technologySearch.toLowerCase();return t.label.toLowerCase().indexOf(o)>-1})},nucleiTagOptionsForDomain(){if(!this.domainIdFilter)return this.tagOptions;if(!Array.isArray(this.tagGroups)||this.tagGroups.length===0)return this.tagOptions;let e=[];for(const o of this.allNucleiTemplatesForDomain)e=[...e,...o.tags];const t=Array.from(new Set(e));return this.tagOptions.filter(o=>t.includes(o.value))},filteredTagOptions(){return this.nucleiTagOptionsForDomain.filter(t=>{const o=this.tagSearch.toLowerCase();return t.label.toLowerCase().indexOf(o)>-1})},filteredTemplates(){let e=this.allNucleiTemplatesForDomain;this.debouncedSearch!=""&&(e=this.allNucleiTemplates.filter(c=>{const s=this.debouncedSearch.toLowerCase(),n=[c.id,c.name,c.description||"",c.tags.join(", ")];for(const p of n)if(p.toLowerCase().indexOf(s)>-1)return!0;return!1}));let t=e;this.selectedAllTags||(t=e.filter(c=>{for(const s of this.selectedTags)if(c.tags.includes(s))return!0;return!1}));let o=t;return this.selectedAllTechnologies||(o=t.filter(c=>{for(const s of this.selectedTechnologies){const n=this.technologyTagsMap[s];if(c.tags.some(r=>n.includes(r)))return!0}return!1})),o},nucleiTemplates(){const e=this.page*this.perPage,t=e+this.perPage;return this.filteredTemplates.slice(e,t)},domainIdFilter(){return this.$route.params.domainId?this.$route.params.domainId:null},allNucleiTemplatesForDomain(){return this.domainIdFilter?this.allNucleiTemplates.filter(e=>{for(const t of this.tagGroups??[]){const o=this.technologyTagsMap[t];if(!o||e.tags.some(s=>o.includes(s)))return!0}return!1}):this.allNucleiTemplates},visibleAktoRules(){if(!this.debouncedSearch)return this.aktoRules;const e=this.debouncedSearch.toLowerCase();return this.aktoRules.filter(t=>{if(t.title.toLowerCase().indexOf(e)>-1||t.description.toLowerCase().indexOf(e)>-1)return!0})},visibleAktoGraphqlRules(){if(!this.debouncedSearch)return this.aktoGraphqlRules;const e=this.debouncedSearch.toLowerCase();return this.aktoGraphqlRules.filter(t=>{if(t.title.toLowerCase().indexOf(e)>-1||t.description.toLowerCase().indexOf(e)>-1)return!0})},isAuthenticatedDomainType(){return["zap","akto","akto_graphql"].includes(this.selectedCheckType)}},methods:{async loadAllNucleiTemplates(){const e=await H(),o=Object.values(e).sort((r,u)=>u.severity-r.severity);this.allNucleiTemplates=o;const c=o.map(r=>r.tags).flat(1),s={};for(const r of c){const u=s[r]||0;s[r]=u+1}const n=Object.entries(s).filter(([r,u])=>u>2).map(([r,u])=>r),p=[...new Set(n)];this.selectedTags=p,this.tagOptions=p.map(r=>({label:r,value:r}))},async loadTechnologyOptions(){this.technologyTagsMap=await Z();const e=Object.keys(this.technologyTagsMap),t=await K();this.technologyOptions=e.map(o=>{const c=t.find(n=>n.technology==o);let s=0;return c&&(s=c.amount_templates),{label:o+` (${s})`,value:o}}),this.selectedTechnologies=this.filteredTechnologyOptions.map(o=>o.value)},selectCheckType(e){this.selectedCheckType=e},technologySearchChanged(e){this.technologySearch=e,this.sortTechnologyOptions()},tagSearchChanged(e){this.tagSearch=e,this.sortTagOptions()},handleChangePage(e){this.page=e,window.scrollTo({top:0,behavior:"smooth"})},async onIsAllTechnologiesCheckedChange(e){this.selectedAllTechnologies=e,e&&(await this.$nextTick(),this.selectedTechnologies=this.filteredTechnologyOptions.map(t=>t.value))},async onIsAllTagsCheckedChange(e){this.selectedAllTags=e,e&&(await this.$nextTick(),this.selectedTags=this.tagOptions.map(t=>t.value))},onSearchUpdate(e){this.search=e,this.setDebouncedSearch()},setDebouncedSearch:W(function(){this.debouncedSearch=this.search,this.page=0},200),onIsOpenTechnologySelectChanged(e){e||this.sortTechnologyOptions()},onIsOpenTagSelectChanged(e){e||this.sortTagOptions()},sortTechnologyOptions(){this.technologyOptions=[...this.technologyOptions].sort((e,t)=>{const o=this.selectedTechnologies.includes(e.value),c=this.selectedTechnologies.includes(t.value);if(o==c)return 0;if(o)return-1;if(c)return 1})},sortTagOptions(){this.tagOptions=[...this.tagOptions].sort((e,t)=>{const o=this.selectedTags.includes(e.value),c=this.selectedTags.includes(t.value);if(o==c)return 0;if(o)return-1;if(c)return 1})},prefillSelectedTechnologies(){const{technologies:e}=this.$route.query;if(!e)return;const t=e.split(",");if(t.length==1&&t[0]=="")return;const o=[];for(const c of t)this.technologyTagsMap[c]&&o.push(c);this.selectedTechnologies=o,this.selectedAllTechnologies=!1,this.sortTechnologyOptions()},async loadNucleiChecks(){this.isLoadingNucleiTemplates=!0,await this.loadAllNucleiTemplates(),await this.loadTechnologyOptions(),this.prefillSelectedTechnologies(),this.isLoadingNucleiTemplates=!1},async loadAktoChecks(){this.isLoadingAktoRules=!0;const e=await j();this.aktoRules=e,this.isLoadingAktoRules=!1},async loadAktoGraphqlChecks(){this.isLoadingAktoGraphqlRules=!0;try{const e=await X();this.aktoGraphqlRules=e}finally{this.isLoadingAktoGraphqlRules=!1}}}},fe={class:"flex flex-column gap-16px"},Te={class:"flex gap-8px flex-wrap align-center"},ye={class:"flex flex-column gap-4px max-w-300px ws-normal leading-14px text-break-word"},me={ref:"tableEnd"};function _e(e,t,o,c,s,n){const p=i("InputSearch"),r=i("SlidingButtonGroup"),u=i("InputSwitch"),m=i("InputMultiSelect"),T=i("BaseParagraph"),b=i("RepositoryDetailSurfaceMonitoring"),A=i("DomainNucleiChecksTable"),f=i("XPagination"),w=i("DomainAktoChecksTable");return d(),C("div",fe,[k("div",Te,[a(p,{modelValue:s.search,"onUpdate:modelValue":n.onSearchUpdate,spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),a(r,{actions:n.checkTypeActions,"initial-selected-button":s.selectedCheckType,class:"bg-carbon-20",showToolTipIcons:!0,disabled:!!n.domainIdFilter},{"tooltip-content":l(h=>[k("div",ye,[k("span",null,O(h.metadata.tooltip),1)])]),_:1},8,["actions","initial-selected-button","disabled"]),n.isAuthenticatedDomainType?(d(),y(u,{key:0,modelValue:s.showAuthenticatedZapRulesOnly,"onUpdate:modelValue":t[0]||(t[0]=h=>s.showAuthenticatedZapRulesOnly=h),name:"show_authenticated_zap_rules_only","label-right":"Authenticated Rules Only"},null,8,["modelValue"])):_("",!0),s.selectedCheckType=="nuclei"?(d(),C(S,{key:1},[a(m,{options:n.filteredTechnologyOptions,selectedItems:s.selectedTechnologies,"onUpdate:selectedItems":t[1]||(t[1]=h=>s.selectedTechnologies=h),enableCheckAll:!0,isAllChecked:s.selectedAllTechnologies,"onUpdate:isAllChecked":n.onIsAllTechnologiesCheckedChange,selectAllText:"All Technologies",disableSimpleSearch:!0,onOnSearchChanged:n.technologySearchChanged,shouldTruncateOptions:!0,onIsOpenChanged:n.onIsOpenTechnologySelectChanged},null,8,["options","selectedItems","isAllChecked","onUpdate:isAllChecked","onOnSearchChanged","onIsOpenChanged"]),a(m,{options:n.filteredTagOptions,selectedItems:s.selectedTags,"onUpdate:selectedItems":t[2]||(t[2]=h=>s.selectedTags=h),enableCheckAll:!0,isAllChecked:s.selectedAllTags,"onUpdate:isAllChecked":n.onIsAllTagsCheckedChange,selectAllText:"All Tags",disableSimpleSearch:!0,onOnSearchChanged:n.tagSearchChanged,shouldTruncateOptions:!0,onIsOpenChanged:n.onIsOpenTagSelectChanged},null,8,["options","selectedItems","isAllChecked","onUpdate:isAllChecked","onOnSearchChanged","onIsOpenChanged"]),a(T,{class:"ml-auto",color:"gray",size:"small"},{default:l(()=>[g(O(n.filteredTemplates.length)+" search results ",1)]),_:1})],64)):_("",!0)]),s.selectedCheckType=="zap"?(d(),y(b,{key:0,search:s.search,showOnlyAuthenticatedRules:!!s.showAuthenticatedZapRulesOnly},null,8,["search","showOnlyAuthenticatedRules"])):_("",!0),s.selectedCheckType=="nuclei"?(d(),C(S,{key:1},[a(A,{isLoading:s.isLoadingNucleiTemplates,nucleiTemplates:n.nucleiTemplates},{tableEnd:l(()=>[k("div",me,null,512)]),_:1},8,["isLoading","nucleiTemplates"]),a(f,{page:s.page,"onUpdate:page":n.handleChangePage,perPage:s.perPage,currentPageCount:n.nucleiTemplates.length,total:n.filteredTemplates.length},null,8,["page","onUpdate:page","perPage","currentPageCount","total"])],64)):_("",!0),s.selectedCheckType=="akto"?(d(),y(w,{key:2,isLoading:s.isLoadingAktoRules,aktoRules:n.visibleAktoRules,showOnlyAuthenticatedRules:!!s.showAuthenticatedZapRulesOnly},null,8,["isLoading","aktoRules","showOnlyAuthenticatedRules"])):_("",!0),s.selectedCheckType=="akto_graphql"?(d(),y(w,{key:3,isLoading:s.isLoadingAktoGraphqlRules,aktoRules:n.visibleAktoGraphqlRules,showOnlyAuthenticatedRules:!!s.showAuthenticatedZapRulesOnly},null,8,["isLoading","aktoRules","showOnlyAuthenticatedRules"])):_("",!0)])}const Le=R(ge,[["render",_e]]);export{Le as default};
