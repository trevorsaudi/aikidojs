import{_ as I,bt as S,N as y,fm as A,r as p,q as c,k as E,w as n,o as s,m as g,n as u,u as b,p as P,S as x,s as d,F as L,ai as C}from"./index-13ff96f4.js";import{F as B}from"./FilterButton-bb5393a7.js";import{S as w}from"./SelectRepoSearchable-f2be202e.js";import{L as k}from"./languages-12749071.js";const O={methods:{closeAllInnerPopoversWhenPossible(t){this.isTargetAnInputElement(t)||this.closeAllInnerPopoversWithException()},closeAllInnerPopoversWithException(t=null){if(this.popoversNameRefMap)for(const[e,i]of Object.entries(this.popoversNameRefMap))e!=t&&(!i||!i.closePopover||i.closePopover())},isTargetAnInputElement(t){var o,f,h;return(o=t==null?void 0:t.target)!=null&&o.classList?[...t.target.classList].some(a=>a.includes("input"))?!0:(h=(f=t.target)==null?void 0:f.parentElement)!=null&&h.classList?!![...t.target.parentElement.classList].some(a=>a.includes("input")):!1:!1}}},N={mixins:[O],emits:["selectFilter"],props:{groupedIssueFilterProp:{type:Number,default:void 0},hideLockfileFilter:{type:Boolean,default:!1},initialRepoFilter:{type:String,default:"all"},repoOwnerNames:{type:Array,default:()=>[]},shouldShowRepoPathsFilter:{type:Boolean,default:!1},hideLanguageFilter:{type:Boolean,default:!1}},components:{BasePopover:S,BaseSelect:y,FilterButton:B,SelectRepoSearchable:w},data(){return{selectedLockfile:"all",selectedRepoId:this.initialRepoFilter>0?+this.initialRepoFilter:null,selectedLanguage:"all",targetPaths:[],groupedIssueFilter:void 0,skipAutoEmit:!1,isRepoFilterLoaded:!1,selectedRepoPath:"all",selectedSeverity:"all",severityOptions:[{id:"all",title:"All Severities"},{id:"critical",title:"Critical"},{id:"high",title:"High"},{id:"medium",title:"Medium"},{id:"low",title:"Low"}]}},async created(){this.groupedIssueFilter=this.groupedIssueFilterProp,await this.loadAutofixLockfiles()},watch:{filterKey(){this.skipAutoEmit||this.emitFilter()},groupedIssueFilterProp(){this.groupedIssueFilter=this.groupedIssueFilterProp}},computed:{filterKey(){return`${this.selectedLockfile}-${this.selectedRepoId}-${this.selectedLanguage}-${this.selectedRepoPath}-${this.selectedSeverity}`},filter(){const t=[];if(this.selectedLockfile!="all"&&t.push(this.selectedLockfile),this.selectedRepoId&&this.selectedRepoId!="all"&&this.isRepoFilterLoaded){const e=this.$refs.SelectRepoSearchable.scmRepositories.find(i=>i.value==this.selectedRepoId);t.push(e.label)}return this.selectedLanguage!="all"&&t.push(k[this.selectedLanguage]),this.groupedIssueFilterProp&&t.push("grouped issue"),t.join(", ")},lockfileOptions(){const t=this.targetPaths.map(e=>({id:e,title:e}));return t.unshift({id:"all",title:"All"}),t},languageOptions(){const t=[{id:"all",title:"All"}];for(const[e,i]of Object.entries(k))t.push({id:e,title:i});return t},repoPathOptions(){const t=this.repoOwnerNames.filter(e=>!!e).map(e=>({id:e,title:e}));return[{id:"all",title:"All Projects"},...t]},popoversNameRefMap(){return{SelectRepoSearchable:this.$refs.SelectRepoSearchable}}},methods:{emitFilter(){this.$emit("selectFilter",{selectedLockfile:this.selectedLockfile,selectedRepoId:this.selectedRepoId,selectedLanguage:this.selectedLanguage,groupedIssueFilter:this.groupedIssueFilter,selectedRepoPath:this.selectedRepoPath,selectedSeverity:this.selectedSeverity}),this.$refs.BasePopover.hidePopover()},handleClearFilters(){this.selectedLockfile="all",this.selectedRepoId="all",this.selectedLanguage="all",this.selectedRepoPath="all",this.selectedSeverity="all",this.groupedIssueFilter=void 0,this.loadAutofixLockfiles()},async loadAutofixLockfiles(){const t=this.selectedLanguage!="all"?this.selectedLanguage:null;this.targetPaths=await A(t)},async updateSelectedLanguage(t){this.skipAutoEmit=!0,this.$refs.BasePopover.hidePopover(),this.selectedLanguage=t,this.selectedLockfile="all",this.emitFilter(),await this.$nextTick(),this.skipAutoEmit=!1,await this.loadAutofixLockfiles()}}},V=u("i",{class:"icon icon-filter icon-12px"},null,-1),_={key:0},U={class:"text-primary-aik-100"},T={class:"flex justify-between align-center"},W={class:"grid gap-16px align-center",style:{"grid-template-columns":"1fr minmax(0, 4fr)"}};function z(t,e,i,R,r,o){const f=p("i18n-t"),h=p("FilterButton"),a=p("BaseParagraph"),m=p("BaseSelect"),v=p("SelectRepoSearchable"),F=p("BasePopover");return c(),E(F,{placement:"bottom-start",ref:"BasePopover",keepOtherPopoversOpen:!0,popoverClass:"overflow-visible"},{trigger:n(l=>[s(h,{onClick:l.toggle,class:x({"filter-button--active":o.filter})},{default:n(()=>[V,o.filter?(c(),g("span",_,[s(f,{keypath:"QUEUE.QUICK_FILTER.LABEL"},{filter:n(()=>[u("span",U,b(o.filter),1)]),_:1})])):P("",!0)]),_:2},1032,["onClick","class"])]),content:n(()=>[u("div",{class:"flex flex-column gap-16px py-16px px-24px w-600px mb-8px",onClick:e[11]||(e[11]=C((...l)=>t.closeAllInnerPopoversWhenPossible&&t.closeAllInnerPopoversWhenPossible(...l),["stop"]))},[u("div",T,[s(a,{size:"small",color:"gray",bold:""},{default:n(()=>[d("Filter By")]),_:1}),u("button",{class:"button-brand button--as-link",onClick:e[0]||(e[0]=(...l)=>o.handleClearFilters&&o.handleClearFilters(...l))},"Clear all Filters")]),u("div",W,[i.hideLanguageFilter?P("",!0):(c(),g(L,{key:0},[s(a,{size:"small"},{default:n(()=>[d("Language")]),_:1}),s(m,{options:o.languageOptions,"onUpdate:modelValue":o.updateSelectedLanguage,onClick:e[1]||(e[1]=()=>t.closeAllInnerPopoversWithException())},null,8,["options","onUpdate:modelValue"])],64)),i.hideLockfileFilter?P("",!0):(c(),g(L,{key:1},[s(a,{size:"small"},{default:n(()=>[d("Lockfile")]),_:1}),s(m,{modelValue:r.selectedLockfile,"onUpdate:modelValue":e[2]||(e[2]=l=>r.selectedLockfile=l),options:o.lockfileOptions,onClick:e[3]||(e[3]=()=>t.closeAllInnerPopoversWithException())},null,8,["modelValue","options"])],64)),s(a,{size:"small"},{default:n(()=>[d("Repo")]),_:1}),s(v,{selectedRepoId:r.selectedRepoId,"onUpdate:selectedRepoId":e[4]||(e[4]=l=>r.selectedRepoId=l),includeRepoPath:!0,label:"",ref:"SelectRepoSearchable",popoverClass:"w-70p",onLoaded:e[5]||(e[5]=l=>r.isRepoFilterLoaded=!0),onClick:e[6]||(e[6]=()=>t.closeAllInnerPopoversWithException("SelectRepoSearchable"))},null,8,["selectedRepoId"]),i.shouldShowRepoPathsFilter?(c(),g(L,{key:2},[s(a,{size:"small"},{default:n(()=>[d("Project")]),_:1}),s(m,{modelValue:r.selectedRepoPath,"onUpdate:modelValue":e[7]||(e[7]=l=>r.selectedRepoPath=l),options:o.repoPathOptions,onClick:e[8]||(e[8]=()=>t.closeAllInnerPopoversWithException())},null,8,["modelValue","options"])],64)):P("",!0),s(a,{size:"small"},{default:n(()=>[d("Severity")]),_:1}),s(m,{modelValue:r.selectedSeverity,"onUpdate:modelValue":e[9]||(e[9]=l=>r.selectedSeverity=l),options:r.severityOptions,onClick:e[10]||(e[10]=()=>t.closeAllInnerPopoversWithException())},null,8,["modelValue","options"])])])]),_:1},512)}const Q=I(N,[["render",z]]);export{Q as A};
