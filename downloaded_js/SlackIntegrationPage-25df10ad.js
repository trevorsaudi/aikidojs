import{_ as E,B as O,x as U,r as a,q as i,k as c,w as t,o as e,m,s as l,u as f,a1 as V,X as $,f as H,z as M,N as z,H as Y,an as g,A,n as S,p as D,F as p,t as I}from"./index-13ff96f4.js";import{s as G,l as K,a as W,t as X,b as F}from"./slack-a279c841.js";import{g as q}from"./getAuthorizeChannelUrl-cddf16ce.js";import{P as j}from"./PageHeader-46c38a32.js";import{D as J,a as Q}from"./DataTable-e31a825a.js";import{S as Z}from"./SettingsEmptyState-8e8644cd.js";import{E as tt}from"./EmptyUsersIllustration-1a5638d0.js";import{D as et}from"./DataTableActionsCell-bde7169b.js";import{a as N,D as L}from"./DataTableCell-51c0104f.js";import{O as at}from"./OverviewEmptyState-c8440b9c.js";import{_ as nt}from"./slack-acc9a57d.js";import"./ActionMenu-3e4470bf.js";const it={props:{settings:Object,channels:Array},components:{DataTableRow:N,DataTableCell:L,DataTableActionsCell:et,BaseParagraph:O,BaseIcon:U},computed:{hasEnabledCriticalNotifications(){return!!this.settings.push_new_criticals},criticalsChannelLabel(){if(this.hasEnabledCriticalNotifications){const s=this.getChannelNameById(this.settings.new_criticals_channel);let r="critical";return this.settings.minimum_severity_threshold==="high"&&(r="high and critical"),this.settings.minimum_severity_threshold==="medium"&&(r="medium, high and critical"),this.settings.minimum_severity_threshold==="low"&&(r="all"),`#${s}: ${r} ${this.issueTypeCopy.toLowerCase()} issues`}return"Not applicable"},issueTypeCopy(){return this.settings.issue_type!="all"?this.$t(`ISSUE_TYPE.${this.settings.issue_type}`):""},hasEnabledDigestNotifications(){return!!this.settings.push_digest_friday},digestChannelLabel(){return this.hasEnabledDigestNotifications?this.getChannelNameById(this.settings.digest_friday_channel):"Not applicable"},sections(){return[{title:"Actions",items:[{label:"Send test alert",onClick:this.handleTestNotification,icon:"icon-email"},{label:"Edit alert",onClick:this.handleEditNotificationSettings,icon:"icon-edit"},{label:"Delete alert",onClick:this.handleDeleteNotificationSettings,destructive:!0}]}]}},methods:{getChannelNameById(s){const r=this.channels.find(h=>h.channel_id===s);return r?r.channel_name:s},handleEditNotificationSettings(){this.$modal.show("SlackNotificationSettingsModal",{settingsId:this.settings.id})},handleDeleteNotificationSettings(){this.$modal.show("DeleteSlackNotificationsAlertModal",{settings:this.settings})},async handleTestNotification(){await G(this.settings.id),this.$toast.success("Test message successfully send")}}},st={key:0,class:"flex align-center gap-8px"};function lt(s,r,h,w,_,n){const d=a("BaseIcon"),o=a("BaseParagraph"),u=a("DataTableCell"),y=a("DataTableActionsCell"),C=a("DataTableRow");return i(),c(C,null,{default:t(()=>[e(u,null,{default:t(()=>[h.settings.team_id>0?(i(),m("div",st,[e(d,{icon:"icon-team",color:"#141031",size:16}),h.settings.team_name?(i(),c(o,{key:0},{default:t(()=>[l(f(h.settings.team_name),1)]),_:1})):(i(),c(o,{key:1,color:"danger"},{default:t(()=>[l(" Deleted team ")]),_:1}))])):(i(),c(o,{key:1},{default:t(()=>[l("All users")]),_:1}))]),_:1}),e(u,null,{default:t(()=>[n.hasEnabledCriticalNotifications?(i(),c(o,{key:0},{default:t(()=>[l(f(n.criticalsChannelLabel),1)]),_:1})):(i(),c(o,{key:1,color:"subdued"},{default:t(()=>[l(f(n.criticalsChannelLabel),1)]),_:1}))]),_:1}),e(u,null,{default:t(()=>[n.hasEnabledDigestNotifications?(i(),c(o,{key:0},{default:t(()=>[l(f(n.digestChannelLabel),1)]),_:1})):(i(),c(o,{key:1,color:"subdued"},{default:t(()=>[l(f(n.digestChannelLabel),1)]),_:1}))]),_:1}),e(y,{sections:n.sections,"always-visible":""},null,8,["sections"])]),_:1})}const ot=E(it,[["render",lt]]),ct={components:{DataTableCell:L,DataTableRow:N,LoadingSkeleton:V}};function rt(s,r,h,w,_,n){const d=a("LoadingSkeleton"),o=a("DataTableCell"),u=a("DataTableRow");return i(),c(u,null,{default:t(()=>[e(o,null,{default:t(()=>[e(d,{height:"14px"})]),_:1}),e(o,null,{default:t(()=>[e(d,{height:"14px"})]),_:1}),e(o,null,{default:t(()=>[e(d,{height:"14px"})]),_:1}),e(o,null,{default:t(()=>[e(d,{height:"14px"})]),_:1})]),_:1})}const dt=E(ct,[["render",rt]]),ht={components:{XPreloader:$,BaseButton:H,InputSwitch:M,BaseSelect:z,SettingsEmptyState:Z,EmptyUsersIllustration:tt,PageHeader:j,DataTable:J,DataTableHeader:Q,SlackNotificationSettingsRow:ot,SlackNotificationSettingsRowLoading:dt,DataTableRow:N,OverviewEmptyState:at,BaseHeading:Y},data(){return{loaded:!1,settings:[],channels:[]}},async mounted(){g.on("slackAlertDeleted",this.loadData),g.on("slackIntegrationDeleted",this.loadData),g.on("slackChannelUpdated",this.loadData),await this.loadData(),this.loaded=!0,this.$route.query.create_notification==="true"&&this.hasIntegrationEnabled&&this.handleAddNotification()},beforeUnmount(){g.on("slackAlertDeleted",this.loadData),g.on("slackIntegrationDeleted",this.loadData),g.off("slackChannelUpdated",this.loadData)},computed:{breadcrumbs(){return[{label:"Settings",href:"/settings"},{label:"Integrations",href:"/settings/integrations"},{label:"Slack"}]},hasIntegrationEnabled(){return this.loaded&&this.channels.length>0},showEmptyState(){return this.loaded&&this.settings.length===0},isSupportUser(){var s;return((s=A.data.user)==null?void 0:s.is_support_user)===1}},methods:{async loadData(){await Promise.allSettled([this.loadNotificationSettings(),this.loadChannels()])},async loadNotificationSettings(){this.settings=await K()},async loadChannels(){this.channels=await W()},handleAddNotification(){if(!A.isPayingAndNoProTrial()&&this.settings.length>=1)return this.$modal.show("UpgradeAccountModal",{title:"Upgrade to add more Slack Alerts",msg:"Our free plan includes 1 Slack alert. Upgrade now to any paid plan to setup multiple alerts for different teams."});this.$modal.show("SlackNotificationSettingsModal",{})},handleAddSlackChannel(){window.location=q()},handleUnlinkIntegration(){this.$modal.show("DeleteSlackIntegrationModal")},async handleTriggerDigestDryRun(){await X()},async handleTriggerCriticalDryRun(){await F()}}},ut={class:"flex align-center gap-16px"},_t=S("img",{src:nt,height:"40",class:"rounded-2px"},null,-1),gt={class:"page-content relative"},mt={class:"flex align-center gap-12px mb-24px"},ft={colspan:"4"};function pt(s,r,h,w,_,n){const d=a("BaseHeading"),o=a("PageHeader"),u=a("XPreloader"),y=a("EmptyUsersIllustration"),C=a("SettingsEmptyState"),k=a("BaseButton"),T=a("DataTableHeader"),R=a("SlackNotificationSettingsRowLoading"),B=a("SlackNotificationSettingsRow"),v=a("OverviewEmptyState"),P=a("DataTableRow"),x=a("DataTable");return i(),m(p,null,[e(o,{breadcrumbs:n.breadcrumbs},{title:t(()=>[S("div",ut,[_t,e(d,{as:"h1"},{default:t(()=>[l(" Slack integration ")]),_:1})])]),_:1},8,["breadcrumbs"]),S("div",gt,[_.loaded?D("",!0):(i(),c(u,{key:0,class:"supercenter"})),n.hasIntegrationEnabled?(i(),m(p,{key:2},[S("div",mt,[n.isSupportUser?(i(),m(p,{key:0},[e(k,{size:"small",variation:"secondary",onClick:n.handleTriggerDigestDryRun},{default:t(()=>[l("Digest alert dry-run")]),_:1},8,["onClick"]),e(k,{size:"small",variation:"secondary",onClick:n.handleTriggerCriticalDryRun},{default:t(()=>[l("Critical alert dry-run")]),_:1},8,["onClick"])],64)):D("",!0),e(k,{class:"ml-auto",size:"small",onClick:n.handleAddNotification},{default:t(()=>[l("Create alert")]),_:1},8,["onClick"]),e(k,{variation:"destructive",size:"small",onClick:n.handleUnlinkIntegration},{default:t(()=>[l("Unlink Slack")]),_:1},8,["onClick"])]),e(x,null,{header:t(()=>[e(T,{width:"30%"},{default:t(()=>[l("Target audience")]),_:1}),e(T,{width:"auto"},{default:t(()=>[l("Instant notification channel")]),_:1}),e(T,{width:"auto"},{default:t(()=>[l("Digest channel")]),_:1}),e(T,{width:"48px",alignment:"center"})]),body:t(()=>[_.loaded?(i(!0),m(p,{key:1},I(_.settings,b=>(i(),c(B,{key:b.id,settings:b,channels:_.channels},null,8,["settings","channels"]))),128)):(i(),m(p,{key:0},I(5,b=>e(R,{key:b})),64)),n.showEmptyState?(i(),c(P,{key:2},{default:t(()=>[S("td",ft,[e(v,{title:s.$t("SETTINGS.SLACK.OVERVIEW.EMPTY_STATE_TITLE"),description:s.$t("SETTINGS.SLACK.OVERVIEW.EMPTY_STATE_DESCRIPTION"),actionLabel:s.$t("SETTINGS.SLACK.OVERVIEW.EMPTY_STATE_ACTION_LABEL"),onOnAction:n.handleAddNotification},{default:t(()=>[e(y)]),_:1},8,["title","description","actionLabel","onOnAction"])])]),_:1})):D("",!0)]),_:1})],64)):(i(),c(C,{key:1,title:s.$t("SETTINGS.SLACK.OVERVIEW.EMPTY_STATE_TITLE"),description:s.$t("SETTINGS.SLACK.OVERVIEW.EMPTY_STATE_DESCRIPTION"),actionLabel:"Connect Slack",onAction:n.handleAddSlackChannel},{default:t(()=>[e(y)]),_:1},8,["title","description","onAction"]))])],64)}const Lt=E(ht,[["render",pt]]);export{Lt as default};
