import{_ as y,A as r,aX as M,an as n,aY as R,r as l,q as c,k as f,w as i,aa as O,B as D,e as L,d as z,o as s,n as h,s as _,u as w,p as g,m as I,ai as C,f as P,I as V,ad as $,aZ as N,F as B,S as j,t as H}from"./index-13ff96f4.js";import{D as U,a as F}from"./DataTable-e31a825a.js";import{a as E,D as S}from"./DataTableCell-51c0104f.js";import{A as X}from"./ActionMenu-3e4470bf.js";import{S as G}from"./StackedAvatars-4925baeb.js";const W={props:{team:{type:Object}},components:{ActionMenu:X},computed:{isImportedTeam(){return this.team.source_kind!==null},showEditTeamAction(){return!this.isImportedTeam},showEditTeamExternalRefAction(){var a,o,T,m,t;const e=[6,11];return((T=(o=(a=r)==null?void 0:a.data)==null?void 0:o.user)==null?void 0:T.is_support_user)===1&&e.includes(((t=(m=r.data)==null?void 0:m.group)==null?void 0:t.partner_id)??0)},actions(){return[{title:"Actions",items:[{label:"Edit team",onClick:this.handleEditTeam,visible:this.showEditTeamAction,icon:"icon-edit"},{label:"Edit team external ref",onClick:this.handleEditTeamExternalRef,visible:this.showEditTeamExternalRefAction,icon:"icon-edit"},{label:"Delete",onClick:this.handleDeleteTeam,destructive:!0,visible:!this.isImportedTeam},{label:"Disable",onClick:this.handleDisableTeam,destructive:!0,visible:this.isImportedTeam&&!this.team.disabled},{label:"Enable",onClick:this.handleEnableTeam,visible:this.isImportedTeam&&!!this.team.disabled}].filter(a=>a.visible!==!1)}]}},methods:{handleDeleteTeam(){this.$modal.show("DeleteTeamModal",{team:this.team})},async handleEditTeam(){await this.$modal.show("EditTeamModal",{team:this.team})},handleEditTeamExternalRef(){this.$modal.show("EditTeamExternalRefModal",{team:this.team})},async handleDisableTeam(){await M(this.team.id),this.$toast.success("Team disabled"),n.emit("team.disabled",this.team.id)},async handleEnableTeam(){await R(this.team.id),this.$toast.success("Team enabled"),n.emit("team.enabled",this.team.id)}}};function q(e,a,o,T,m,t){const b=l("ActionMenu");return c(),f(b,{sections:t.actions,placement:"bottom-end"},{trigger:i(u=>[O(e.$slots,"trigger",{toggle:u.toggle})]),_:3},8,["sections"])}const Y=y(W,[["render",q]]),Z={props:{team:Object},components:{DataTableRow:E,DataTableCell:S,BaseParagraph:D,BaseIconButton:L,TeamOverviewTableActionMenu:Y,BasePill:z,StackedAvatars:G},computed:{link(){return`/settings/teams/${this.team.id}`},teamImportSourceLabel(){return this.team.source_kind==="github"?"GitHub":this.team.source_kind==="bitbucket"?"Bitbucket":this.team.source_kind==="azure_devops"?"Azure Devops":this.team.source_kind==="backstage_io"?"Catalog file":null},teamImportSourceIcon(){return this.team.source_kind==="github"?"icon-github":this.team.source_kind==="bitbucket"?"icon-bitbucket":this.team.source_kind==="azure_devops"?"icon-azure":null},responsibilties(){let e=[];return this.team.linked_repo_count>0&&e.push(this.$t("X_REPOS",this.team.linked_repo_count)),this.team.linked_cloud_count>0&&e.push(this.$t("X_CLOUDS",this.team.linked_cloud_count)),e.join(", ")}}},J={class:"flex align-center justify-between flex-1"},K={class:"flex gap-4px align-center"};function Q(e,a,o,T,m,t){const b=l("BaseParagraph"),u=l("BasePill"),d=l("DataTableCell"),k=l("StackedAvatars"),v=l("BaseIconButton"),p=l("TeamOverviewTableActionMenu"),x=l("DataTableRow");return c(),f(x,{href:t.link,disabled:o.team.disabled,clickable:!o.team.disabled},{default:i(()=>[s(d,null,{default:i(()=>[h("div",J,[h("div",K,[s(b,null,{default:i(()=>[_(w(o.team.name),1)]),_:1}),o.team.external_ref?(c(),f(u,{key:0,title:o.team.external_ref,variation:"gray-fill"},null,8,["title"])):g("",!0)]),t.teamImportSourceLabel?(c(),f(u,{key:0,title:e.$t("TEAMS.OVERVIEW.IMPORTED_FROM",{source:t.teamImportSourceLabel}),icon:t.teamImportSourceIcon,variation:"gray-fill"},null,8,["title","icon"])):g("",!0)])]),_:1}),s(d,null,{default:i(()=>[s(k,{users:o.team.users},null,8,["users"])]),_:1}),s(d,null,{default:i(()=>[s(b,null,{default:i(()=>[_(w(t.responsibilties),1)]),_:1})]),_:1}),s(d,{spacing:"compact",alignment:"center",class:"data-table__cell--action"},{default:i(()=>[e.$groupUser.can_manage_teams?(c(),I("div",{key:0,class:"data-table__row__action-container",onClick:a[0]||(a[0]=C(()=>e.$refs.actionMenuTrigger.click(),["stop","prevent"]))},[s(p,{team:o.team},{trigger:i(A=>[s(v,{icon:"icon-actions",class:"data-table__row__action",onClick:C(A.toggle,["prevent"]),ref:"actionMenuTrigger"},null,8,["onClick"])]),_:1},8,["team"])])):g("",!0)]),_:1})]),_:1},8,["href","disabled","clickable"])}const ee=y(Z,[["render",Q]]),te={components:{BaseButton:P,DataTable:U,DataTableHeader:F,DataTableRow:E,DataTableCell:S,BaseParagraph:D,TeamOverviewTableRow:ee,InputSearch:V},data(){return{isLoading:!0,teams:[],isImporting:!1,search:""}},created(){n.on("team.created",this.loadTeams),n.on("team.updated",this.loadTeams),n.on("team.deleted",this.loadTeams),n.on("team.synced",this.loadTeams),n.on("team.disabled",this.loadTeams),n.on("team.enabled",this.loadTeams)},async mounted(){await this.loadTeams(),this.isLoading=!1},beforeUnmount(){n.off("team.created",this.loadTeams),n.off("team.updated",this.loadTeams),n.off("team.deleted",this.loadTeams),n.off("team.synced",this.loadTeams),n.off("team.disabled",this.loadTeams),n.off("team.enabled",this.loadTeams)},computed:{showImportTeamsButton(){if(r.data.group.is_demo_group===1)return!1;const e=r.data.group.scm_type;return e==="github"||e==="bitbucket"||e==="azure_devops"},importTeamsLabel(){return r.data.group.scm_type==="github"?"GitHub":r.data.group.scm_type==="bitbucket"?"Bitbucket":r.data.group.scm_type==="azure_devops"?"Azure DevOps":null},importTeamsIcon(){return r.data.group.scm_type==="github"?"icon-github":r.data.group.scm_type==="bitbucket"?"icon-bitbucket":r.data.group.scm_type==="azure_devops"?"icon-azure":null},sortedTeams(){return this.teams.slice().filter(e=>{if(!this.search)return!0;const a=e.name.toLowerCase(),o=this.search.toLowerCase();return a.includes(o)}).sort((e,a)=>e.disabled&&!a.disabled?1:!e.disabled&&a.disabled?-1:0)}},methods:{async loadTeams(){this.teams=await $(!1,!0)},handleShowCreateTeamModal(){this.$modal.show("CreateTeamModal")},async handleSyncTeams(){this.isImporting=!0;try{await N({no_disable_buttons:!0})}finally{n.emit("team.created"),this.isImporting=!1}}}},ae={class:"mb-16px flex justify-between align-center w-full"},se={class:"flex gap-8px align-center"};function ie(e,a,o,T,m,t){const b=l("InputSearch"),u=l("BaseButton"),d=l("DataTableHeader"),k=l("TeamOverviewTableRow"),v=l("DataTable");return c(),I(B,null,[h("div",ae,[h("div",null,[s(b,{modelValue:m.search,"onUpdate:modelValue":a[0]||(a[0]=p=>m.search=p),spacing:"compact",fullWidth:!0,disableDebounce:!0},null,8,["modelValue"])]),h("div",se,[t.showImportTeamsButton?(c(),f(u,{key:0,isLoading:m.isImporting,disabled:m.isImporting,size:"small",variation:"blue",onClick:t.handleSyncTeams},{default:i(()=>[h("i",{class:j(["icon icon-12px",[t.importTeamsIcon]])},null,2),_(" Import from "+w(t.importTeamsLabel),1)]),_:1},8,["isLoading","disabled","onClick"])):g("",!0),s(u,{size:"small",onClick:t.handleShowCreateTeamModal},{default:i(()=>[_("Create team")]),_:1},8,["onClick"])])]),h("div",null,[s(v,null,{header:i(()=>[s(d,{width:"auto"},{default:i(()=>[_("Name")]),_:1}),s(d,{width:"auto"},{default:i(()=>[_("Users")]),_:1}),s(d,{width:"200px"},{default:i(()=>[_("Responsibilities")]),_:1}),s(d,{width:"48px",alignment:"center"})]),body:i(()=>[(c(!0),I(B,null,H(t.sortedTeams,p=>(c(),f(k,{key:p.id,team:p},null,8,["team"]))),128))]),_:1})])],64)}const de=y(te,[["render",ie]]);export{de as default};
