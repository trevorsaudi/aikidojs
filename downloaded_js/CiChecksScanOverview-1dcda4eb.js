import{P as $}from"./PageHeader-46c38a32.js";import{_ as C,d as B,r as i,q as r,k as u,a1 as M,w as t,m as S,t as P,o as e,F as y,B as X,I as j,x as W,a2 as Y,bU as Z,Z as w,ag as R,aw as Q,a3 as L,c8 as J,n as _,s as l,u as h,ai as T,p as k,c9 as K}from"./index-13ff96f4.js";import{D as ee,a as te}from"./DataTable-e31a825a.js";import{a as H,D as A}from"./DataTableCell-51c0104f.js";import{O as ae}from"./OverviewEmptyState-c8440b9c.js";import{S as se}from"./SnoozedIllustration-a91c1ac9.js";import{u as ne}from"./useInfiniteScroll-47c60c9e.js";import{I as ie}from"./InputFilterDropdown-674351d9.js";import"./FilterButton-bb5393a7.js";import"./ActionMenu-3e4470bf.js";const le={props:{gateStatus:{type:String,required:!0}},components:{BasePill:B},computed:{statusText(){return this.gateStatus=="failed"?"Gate Failed":this.gateStatus=="unknown"?"Unknown":this.gateStatus=="pending"?"Pending":this.gateStatus=="timed_out"?"Timed Out":"Gate Passed"},statusVariation(){return this.gateStatus=="failed"||this.gateStatus=="timed_out"?"red":this.gateStatus=="unknown"||this.gateStatus=="pending"?"gray-fill":"green"}}};function re(a,o,f,m,c,s){const b=i("BasePill");return r(),u(b,{title:s.statusText,variation:s.statusVariation},null,8,["title","variation"])}const oe=C(le,[["render",re]]),ue={components:{LoadingSkeleton:M,DataTableRow:H,DataTableCell:A},props:{cellAmount:{type:Number,default:4},cellContentHeight:{type:Number,default:14}},computed:{skeletonHeight(){return this.cellContentHeight+"px"}}};function ce(a,o,f,m,c,s){const b=i("LoadingSkeleton"),v=i("DataTableCell"),x=i("DataTableRow");return r(),u(x,null,{default:t(()=>[(r(!0),S(y,null,P(f.cellAmount,d=>(r(),u(v,{key:d},{default:t(()=>[e(b,{height:s.skeletonHeight},null,8,["height"])]),_:2},1024))),128))]),_:1})}const de=C(ue,[["render",ce]]),_e={components:{PageHeader:$,BaseParagraph:X,InputSearch:j,BaseIcon:W,DataTable:ee,DataTableHeader:te,DataTableRow:H,DataTableCell:A,CiCheckStatusLabel:oe,BasePill:B,OverviewEmptyState:ae,SnoozedIllustration:se,LoadingRow:de,XTooltip:Y,InputFilterDropdown:ie},setup(){const{records:a,isLoadingFirstPage:o,isLoading:f,fetch:m,reset:c,watchElement:s}=ne(K,20);return{pullRequestsCiChecks:a,isLoading:o,isFetchingRecords:f,fetchPullRequestsCiChecks:m,resetPullRequestsCiChecks:c,watchElement:s}},data(){return{search:"",repo_id:null,selectedGateStatus:"all"}},async mounted(){const{repo_id:a}=Z();this.repo_id=a,await this.loadPullRequestsCiChecks(),await this.$nextTick(),this.watchElement(this.$refs.tableBottom,{threshold:0,rootMargin:"1000px"})},computed:{breadcrumbs(){return[{label:"Settings",href:"/settings/integrations"},this.ciChecksDetailBreadcrumb,{label:"CI Scan History"}]},ciChecksDetailBreadcrumb(){return w.data.azureDevopsChecks?{label:"Azure DevOps Checks",href:"/settings/integrations/azure-devops/checks"}:w.data.githubChecks?{label:"Github CI",href:"/settings/integrations/github/checks"}:{label:"CI integrations",href:"/settings/integrations/continuous-integration"}},prUrlTitle(){return w.data.azureDevopsChecks?"Azure Devops PR":w.data.githubChecks?"Github PR":"Pull Request"},shouldShowEmptyState(){return this.isLoading?!1:this.pullRequestsCiChecks.length==0},isFilterActive(){return this.search!=""},emptyStateTitle(){return this.$teamContext?`No PR Scan History Found For This Team (${R.teamName})`:this.isFilterActive?"No PR Scan History Found":"No PR Scan History Yet"},emptyStateDescription(){return"All your PR scans will appear here. Aikido will give an overview of all passed and failed PR scans with details of newly introduced and solved issues."},actionLabel(){return this.$teamContext?"Reset Team Filter":"Learn more"},gateStatusOptions(){return[{value:"all",label:"All Scans",default:!0},{value:"passed",label:"Gate Passed"},{value:"failed",label:"Gate Failed"},{value:"timed_out",label:"Timed Out"},{value:"pending",label:"Pending"}]}},methods:{async loadPullRequestsCiChecks(){await this.resetPullRequestsCiChecks({search:this.search,repo_id:this.repo_id,gate_status:this.selectedGateStatus})},searchPullRequestsCiChecks:Q(async function(){await this.loadPullRequestsCiChecks()},250),getIssueCountText(a){return a<0?"Unknown":a},getStartedAtDate(a){return L.fromUnix(a).format(L.YMD_HM_SHORT)},redirectToPullRequest(a){window.open(a,"_blank")},isRowClickable(a){return!["timed_out"].includes(a.gate_status)},getCheckRunTitle(a){return a.is_release_gating?"Release gate":a.pull_request_title?a.pull_request_title:a.branch_name},async retryCheck(a){try{this.$globalLoadingIndicator.show(),await J(a.scan_id),Toast.success({title:"Scan started",description:"We successfully restarted a scan for this pull request."}),this.loadPullRequestsCiChecks()}finally{this.$globalLoadingIndicator.hide()}},showRetryCiCheck(a){return!(a.gate_status!=="timed_out"||!["azure_devops","github","bitbucket","gitlab","gitlab_server"].includes(this.$group.scm_type)||a.configuration_id<1)},handleEmptyStateAction(){if(this.$teamContext){R.clearTeamId();return}this.$group.scm_type=="github"?window.open("https://help.aikido.dev/doc/github-ci-pr-gating-via-aikido-dashboard/docZayPeps1j","_blank"):this.$group.scm_type=="azure_devops"?window.open("https://help.aikido.dev/doc/azure-pipelines-ci-pr-gating-via-aikido-dashboard/docVU0nLa09W","_blank"):this.$group.scm_type=="gitlab"||this.$group.scm_type=="gitlab_server"?window.open("https://help.aikido.dev/doc/gitlab-ci-setting-up-gating-for-merge-requests/doco2l9FLm2k","_blank"):this.$group.scm_type=="bitbucket"&&window.open("https://help.aikido.dev/doc/bitbucket-pipes-setting-up-gating-for-pull-requests/docl8wXHhcmn","_blank")}}},pe={class:"page-content"},he={class:"mb-16px flex flex-row gap-12px"},me={class:"flex justify-between align-center w-full"},ge={class:"flex gap-8px align-center"},fe={class:"flex align-center gap-4px"},be=_("i",{class:"icon icon-12px icon-viewDetails valign-middle text-gray-100 hidden group-hover:block"},null,-1),we={colspan:"6"},ke={ref:"tableBottom"};function Se(a,o,f,m,c,s){const b=i("PageHeader"),v=i("InputSearch"),x=i("InputFilterDropdown"),d=i("DataTableHeader"),p=i("BaseParagraph"),F=i("XTooltip"),D=i("BasePill"),g=i("DataTableCell"),V=i("BaseIcon"),N=i("router-link"),O=i("CiCheckStatusLabel"),I=i("DataTableRow"),z=i("LoadingRow"),U=i("SnoozedIllustration"),E=i("OverviewEmptyState"),G=i("DataTable");return r(),S(y,null,[e(b,{breadcrumbs:s.breadcrumbs,title:"CI Scan History"},null,8,["breadcrumbs"]),_("div",pe,[_("div",he,[e(v,{modelValue:c.search,"onUpdate:modelValue":[o[0]||(o[0]=n=>c.search=n),s.searchPullRequestsCiChecks],spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),e(x,{modelValue:c.selectedGateStatus,"onUpdate:modelValue":[o[1]||(o[1]=n=>c.selectedGateStatus=n),s.loadPullRequestsCiChecks],options:s.gateStatusOptions},null,8,["modelValue","options","onUpdate:modelValue"])]),e(G,null,{header:t(()=>[e(d,null,{default:t(()=>[l("PR Name")]),_:1}),e(d,{width:"200px"},{default:t(()=>[l("Repository")]),_:1}),e(d,{class:"wide-tablet_hidden",width:"95px"},{default:t(()=>[l("# New")]),_:1}),e(d,{class:"wide-tablet_hidden",width:"95px"},{default:t(()=>[l("# Solved")]),_:1}),e(d,{class:"wide-tablet_hidden",width:"185px"},{default:t(()=>[l("Date Scan")]),_:1}),e(d,{width:"160px"},{default:t(()=>[l("Status")]),_:1})]),body:t(()=>[(r(!0),S(y,null,P(m.pullRequestsCiChecks,n=>(r(),u(I,{key:n.scan_id,href:`/featurebranch/scan/${n.scan_id}`,clickable:s.isRowClickable(n),class:"group"},{default:t(()=>[e(g,null,{default:t(()=>[_("div",me,[_("div",ge,[e(p,null,{default:t(()=>[l(h(s.getCheckRunTitle(n)),1)]),_:2},1024),e(p,{color:"subdued"},{default:t(()=>[l(h(n.related_commit_sha.slice(0,7))+" ",1),e(F,null,{default:t(()=>[l(h(n.related_commit_sha),1)]),_:2},1024)]),_:2},1024)]),_("div",fe,[n.pull_request_url?(r(),u(D,{key:0,class:"hidden group-hover:block cursor-pointer",variation:"gray-fill",title:s.prUrlTitle,onClick:T(q=>s.redirectToPullRequest(n.pull_request_url),["stop","prevent"])},null,8,["title","onClick"])):k("",!0),s.showRetryCiCheck(n)?(r(),u(D,{key:1,class:"cursor-pointer",variation:"purple",title:"Retry Scan",onClick:T(q=>s.retryCheck(n),["stop","prevent"])},null,8,["onClick"])):k("",!0)])])]),_:2},1024),e(g,null,{default:t(()=>[e(N,{class:"flex flex-1 align-center gap-4px link link-hover group text--normal overflow-hidden",to:`/repositories/${n.scm_repo_id}`,onClick:o[2]||(o[2]=T(()=>{},["stop"]))},{default:t(()=>[e(V,{icon:"icon-frontend",class:"icon-12px mr-4px inline-flex align-center justify-center leading-14px text-carbon-60"}),e(p,{truncate:""},{default:t(()=>[l(h(n.scm_repo_name),1)]),_:2},1024),be]),_:2},1032,["to"])]),_:2},1024),e(g,{class:"wide-tablet_hidden"},{default:t(()=>[e(p,null,{default:t(()=>[l(h(s.getIssueCountText(n.new_issues_count)),1)]),_:2},1024)]),_:2},1024),e(g,{class:"wide-tablet_hidden"},{default:t(()=>[n.is_release_gating?(r(),u(p,{key:0,color:"subdued"},{default:t(()=>[l("N/A")]),_:1})):(r(),u(p,{key:1},{default:t(()=>[l(h(s.getIssueCountText(n.solved_issues_count)),1)]),_:2},1024))]),_:2},1024),e(g,{class:"wide-tablet_hidden"},{default:t(()=>[e(p,null,{default:t(()=>[l(h(s.getStartedAtDate(n.started_at)),1)]),_:2},1024)]),_:2},1024),e(g,null,{default:t(()=>[e(O,{gateStatus:n.gate_status},null,8,["gateStatus"])]),_:2},1024)]),_:2},1032,["href","clickable"]))),128)),m.isLoading?(r(),S(y,{key:0},P(5,n=>e(z,{key:n,cellAmount:6})),64)):k("",!0),s.shouldShowEmptyState?(r(),u(I,{key:1},{default:t(()=>[_("td",we,[e(E,{title:s.emptyStateTitle,description:s.emptyStateDescription,actionLabel:s.actionLabel,onOnAction:s.handleEmptyStateAction},{default:t(()=>[e(U)]),_:1},8,["title","description","actionLabel","onOnAction"])])]),_:1})):k("",!0)]),_:1}),_("div",ke,null,512)])],64)}const Be=C(_e,[["render",Se]]);export{Be as default};
