import{g as _,u as S,s as y}from"./thoropass-d55c2825.js";import{_ as E,X as I,f as v,H as A,A as g,Q as w,r,k as C,m as d,o as i,w as l,p as P,F as k,a as B,q as c,s as p}from"./index-13ff96f4.js";import{P as O}from"./PageHeader-46c38a32.js";import{S as V}from"./SettingsEmptyState-8e8644cd.js";import{E as N}from"./EmptyUsersIllustration-1a5638d0.js";function U(t=128){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";let s="";for(let o=0;o<t;o++){const e=Math.floor(Math.random()*a.length);s+=a[e]}return s}async function x(t){const s=new TextEncoder().encode(t),o=await crypto.subtle.digest("SHA-256",s);let e=btoa(String.fromCharCode(...new Uint8Array(o)));return e=e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),e}const H={components:{XPreloader:I,BaseButton:v,SettingsEmptyState:V,EmptyUsersIllustration:N,PageHeader:O,BaseHeading:A},data(){return{activeThoropassIntegration:null,loaded:!1,disableButtons:!1}},created(){this.init()},computed:{breadcrumbs(){return[{label:"Settings",href:"/settings"},{label:"Integrations",href:"/settings/integrations"},{label:"Thoropass"}]},subtitle(){return this.activeThoropassIntegration?"Active":""},canAlwaysUseThoropass(){return!!this.$featureflags.force_enable_thoropass}},methods:{async init(){this.activeThoropassIntegration=await _(),this.loaded=!0},async addThoropassIntegration(){if(!g.isPayingAndNoProTrial()&&!this.canAlwaysUseThoropass)return this.$modal.show("UpgradeAccountModal",{title:"This integration is available on all paid plans",msg:"Upgrade now to any paid plan to start integrating with your compliancy tool."});let t="hRAOZkWwBvMdNv7DRQYcMLwKREUEWPSn6CH6ciY4",a="http://localhost/settings/integrations/compliance/thoropass/callback";B()==="production"&&(t="muotUZfp7VRsdCI1qKm8XBvfqwxEvq8Ges0QaHCe",a="https://app.aikido.dev/settings/integrations/compliance/thoropass/callback");const s="vulnerability:write vulnerability:read vulnerabilityScan:read vulnerabilityScan:write vulnerabilityScanConfiguration:read vulnerabilityScanConfiguration:write",o="code",e=U(),n=await x(e),h="S256";sessionStorage.setItem("aik.oauth.thoropass.codeVerifier",e),window.location=`https://app.thoropass.com/partner-api?client_id=${t}&scope=${s}&redirect_uri=${a}&response_type=${o}&code_challenge=${n}&code_challenge_method=${h}`},async deactivateThoropass(){await w({headerText:"Thoropass Integration",description:"Do you want to deactivate the Thoropass integration?",buttonSubmitText:"Yes, deactivate"})&&(await S(this.activeThoropassIntegration.id),this.init(),Toast.success({title:this.$t("NOTIFICATIONS.INTEGRATION_DEACTIVATED.TITLE"),description:this.$t("THOROPASS_DEACTIVATED")}))},async sendToThoropass(){if(!g.isPayingAndNoProTrial()&&!this.canAlwaysUseThoropass)return this.$modal.show("UpgradeAccountModal",{title:"This integration is available on all paid plans",msg:"Upgrade now to any paid plan to start integrating with your compliancy tool."});this.disableButtons=!0,y({disable_toasts:!0}),Toast.success({title:this.$t("SUCCESS"),description:"Aikido will start sending vulnerabilities to Thoropass shortly"})}}},R={key:0,class:"page-content"},M={key:0},D={key:1};function $(t,a,s,o,e,n){const h=r("XPreloader"),m=r("PageHeader"),b=r("EmptyUsersIllustration"),f=r("SettingsEmptyState"),u=r("BaseHeading"),T=r("BaseButton");return e.loaded?(c(),d(k,{key:1},[i(m,{title:"Thoropass integration",breadcrumbs:n.breadcrumbs,subtitle:n.subtitle},null,8,["breadcrumbs","subtitle"]),e.loaded?(c(),d("div",R,[e.activeThoropassIntegration==null?(c(),d("div",M,[i(f,{title:t.$t("SETTINGS.THOROPASS.OVERVIEW.EMPTY_STATE_TITLE"),description:t.$t("SETTINGS.THOROPASS.OVERVIEW.EMPTY_STATE_DESCRIPTION"),actionLabel:t.$t("SETTINGS.THOROPASS.OVERVIEW.EMPTY_STATE_ACTION_LABEL"),onAction:n.addThoropassIntegration},{default:l(()=>[i(b)]),_:1},8,["title","description","actionLabel","onAction"])])):(c(),d("div",D,[i(u,{as:"h4",class:"flex justify-between mb-8px"},{default:l(()=>[p("Actions")]),_:1}),i(T,{class:"mt-4px",size:"small",onClick:n.sendToThoropass,disabled:e.disableButtons},{default:l(()=>[p("Send vulnerabilities to Thoropass")]),_:1},8,["onClick","disabled"]),i(u,{as:"h4",class:"flex justify-between mt-36px mb-8px"},{default:l(()=>[p("Danger zone")]),_:1}),i(T,{class:"mt-4px",variation:"destructive",size:"small",onClick:n.deactivateThoropass,disabled:e.disableButtons},{default:l(()=>[p("Deactivate")]),_:1},8,["onClick","disabled"])]))])):P("",!0)],64)):(c(),C(h,{key:0,class:"supercenter",theme:"transparent"}))}const q=E(H,[["render",$]]);export{q as default};
