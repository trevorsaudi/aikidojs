import{b as L}from"./reports-ed4978a9.js";import{P as $}from"./PageHeader-46c38a32.js";import{_ as B,B as R,f as H,r as a,q as o,k as m,w as n,m as l,o as s,s as c,u as p,p as S,S as F,F as v,t as A,n as u,g as M,H as T,dv as I,bn as N,X as V}from"./index-13ff96f4.js";import{A as W,a as X}from"./AccordionItem-61c3c0ba.js";import{D as q,a as z}from"./DataTable-e31a825a.js";import{a as E,D as U}from"./DataTableCell-51c0104f.js";import{B as Y}from"./BracesIcon-0a8568f4.js";import{P as G}from"./PdfDownloadButton-072addbd.js";import{C as J}from"./CompliancePrintHeader-341b18be.js";const K={props:{measure:Object},components:{AccordionItem:W,BaseParagraph:R,DataTable:q,DataTableHeader:z,DataTableRow:E,DataTableCell:U,BracesIcon:Y,BaseButton:H},computed:{issue(){return this.measure.issue?this.measure.issue==="no_clouds_monitored"?"No cloud monitored":this.measure.issue:null},complianceCount(){const e=Object.values(this.measure.results);return`${e.filter(r=>r.status==="complying").length}/${e.length}`}},methods:{getStatusColor(e){return e==="complying"?"success":e==="failing"?"danger":"dark-gray"},getLinkForResult(e){if(e.status!=="failing")return null;if(e.rule_type==="settings_rule"&&e.measure==="enabled_email_notifications")return"/settings/account";if(e.rule_type==="settings_rule"&&e.measure==="enabled_slack")return"/settings/integrations/notifications/slack";const t=new URLSearchParams;if(e.rule_type==="open_issue_rule"&&e.measure==="no_issues_outside_of_sla"&&t.append("filter","out_of_sla"),e.rule_type==="open_issue_rule"&&(e.measure==="no_critical_open_source_issues"||e.measure==="no_open_oss_issues")&&(t.append("issue_type_filter","open_source"),t.append("filter","critical")),e.rule_type==="open_issue_rule"&&e.measure==="no_open_dast_issues"&&(t.append("issue_type_filter","surface_monitoring"),t.append("filter","critical")),e.rule_type==="open_issue_rule"&&e.measure==="no_open_iac_issues"&&(t.append("issue_type_filter","iac"),t.append("filter","critical")),e.rule_type==="open_issue_rule"&&e.measure==="prevents_exposed_secrets"&&t.append("issue_type_filter","leaked_secret"),["sast_rule","cloud_rule"].includes(e.rule_type)){const r=e.affected_issue_ids??[];t.append("issue_id_filter",r)}return t.toString()===""?null:`/queue?${t.toString()}`}}},Q={key:0,class:"flex align-center gap-8px"},Z={key:1,class:"flex align-center gap-12px flex-1"},ee={key:0,class:"flex align-center gap-4px"},te=u("i",{class:"icon icon-critical icon-14px text-surface-orange-120"},null,-1),ne={key:0,class:"flex align-center justify-center"},oe=u("i",{class:"icon icon-cloud text-carbon-60"},null,-1),se=[oe],ae={key:1,class:"flex align-center justify-center"},re=u("i",{class:"icon icon-settings text-carbon-60"},null,-1),ie=[re],ce={key:2,class:"flex align-center justify-center"},le=u("i",{class:"icon icon-group text-carbon-60"},null,-1),ue=[le],_e={key:3,class:"flex align-center justify-center"},de={key:0,class:"icon icon-IasC text-carbon-60"},pe={key:4,class:"flex align-center justify-center"},me=u("i",{class:"icon icon-recent text-carbon-60"},null,-1),fe=[me],ge={class:"flex flex-1 gap-8px align-center justify-between"};function he(e,t,r,f,k,i){const _=a("BaseParagraph"),g=a("BaseButton"),h=a("DataTableHeader"),b=a("BracesIcon"),y=a("DataTableCell"),x=a("RouterLink"),C=a("DataTableRow"),P=a("DataTable"),w=a("AccordionItem");return o(),m(w,null,{title:n(()=>[r.measure.is_blurred?(o(),l("div",Q,[s(_,null,{default:n(()=>[c("This section is available on any paid plan.")]),_:1}),s(g,{class:"inline-block",as:"outside-link",target:"_blank",href:"/settings/account?upgrade=true",size:"xs",semiBold:""},{default:n(()=>[c("Upgrade now")]),_:1})])):(o(),l("div",Z,[s(_,{size:"medium"},{default:n(()=>[c(p(r.measure.title),1)]),_:1}),s(_,{bold:""},{default:n(()=>[c(p(i.complianceCount),1)]),_:1}),i.issue?(o(),l("div",ee,[te,s(_,{color:"warning"},{default:n(()=>[c(p(i.issue),1)]),_:1})])):S("",!0)]))]),body:n(()=>[s(P,{class:F({"blur user-select-none":r.measure.is_blurred})},{header:n(()=>[s(h,{width:"48px",spacing:"compact",alignment:"center"},{default:n(()=>[c("Type")]),_:1}),s(h,{width:"auto"},{default:n(()=>[c("Rule name")]),_:1}),s(h,{width:"120px",alignment:"center"},{default:n(()=>[c("Status")]),_:1})]),body:n(()=>[(o(!0),l(v,null,A(r.measure.results,(d,j)=>(o(),m(C,{key:j},{default:n(()=>[s(y,{spacing:"compact",alignment:"center"},{default:n(()=>{var D,O;return[d.rule_type==="cloud_rule"?(o(),l("div",ne,se)):d.rule_type==="settings_rule"?(o(),l("div",ae,ie)):d.rule_type==="dast_rule"?(o(),l("div",ce,ue)):d.rule_type==="sast_rule"?(o(),l("div",_e,[((D=d.metadata)==null?void 0:D.programming_language)==="IAC"?(o(),l("i",de)):(o(),m(b,{key:1,text:(O=d.metadata)==null?void 0:O.programming_language},null,8,["text"]))])):(o(),l("div",pe,fe))]}),_:2},1024),s(y,null,{default:n(()=>[u("div",ge,[s(_,null,{default:n(()=>[c(p(d.title),1)]),_:2},1024),i.getLinkForResult(d)?(o(),m(x,{key:0,to:i.getLinkForResult(d),target:"_blank",class:"link text--normal print_hidden"},{default:n(()=>[c(" See open issues ")]),_:2},1032,["to"])):S("",!0)])]),_:2},1024),s(y,{alignment:"center"},{default:n(()=>[s(_,{color:i.getStatusColor(d.status)},{default:n(()=>[c(p(d.status),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["class"])]),_:1})}const ye=B(K,[["render",he]]),be={props:{topic:Object},components:{BaseParagraph:R,BaseLink:M},computed:{metadata(){var e,t,r,f;return((f=(r=(t=(e=this.topic)==null?void 0:e.has_completed_surveys_for_repos)==null?void 0:t.results)==null?void 0:r.configured_monitoring_for_code_repos)==null?void 0:f.metadata)??{}}}},xe={class:"my-8px"};function ke(e,t,r,f,k,i){const _=a("BaseLink"),g=a("BaseParagraph");return o(),l("div",xe,[s(g,null,{default:n(()=>[c("You have currently configured the architecture for "),u("strong",null,p(i.metadata.architecture_count)+" of your "+p(i.metadata.repo_count),1),c(" active repositories. Check out how you can improve this by clicking "),s(_,{target:"_blank",href:"https://help.aikido.dev/en/articles/8228077-how-to-improve-risk-scoring-for-your-repositories"},{default:n(()=>[c("this link")]),_:1}),c(".")]),_:1})])}const we=B(be,[["render",ke]]),ve={props:{code:String,topic:Object},components:{Accordion:X,BaseParagraph:R,OwaspMeasure:ye,BaseHeading:T,ProgressBar:I},computed:{totalRuleCount(){return Object.values(this.topic).reduce((e,t)=>e+Object.values(t.results).length,0)},complyingRuleCount(){return Object.values(this.topic).reduce((e,t)=>{const r=Object.values(t.results).filter(f=>f.status==="complying");return e+r.length},0)},complianceCount(){return`${this.complyingRuleCount}/${this.totalRuleCount}`},compliancePercentage(){const e=this.complyingRuleCount??0;return e===0?0:Math.round(e/this.totalRuleCount*100)},title(){return this.code==="A01:2021"?"Broken access control":this.code==="A02:2021"?"Cryptographic failures ":this.code==="A03:2021"?"Injection":this.code==="A04:2021"?"Insecure design":this.code==="A05:2021"?"Security misconfiguration":this.code==="A06:2021"?"Vulnerable and Outdated Components":this.code==="A07:2021"?"Identification and Authentication Failures":this.code==="A08:2021"?"Software and Data Integrity Failures":this.code==="A09:2021"?"Security Logging and Monitoring Failures":this.code==="A10:2021"?"Server-Side Request Forgery":""},metadataElement(){return this.code==="A04:2021"?we:null}}},Be={class:"flex flex-1 justify-between align-center"},Ce={class:"flex flex-1 align-center gap-12px"},Pe={class:"text-16px"},Re={class:"text--semi-bold"},Ae={class:"flex align-center gap-12px"};function De(e,t,r,f,k,i){const _=a("BaseHeading"),g=a("ProgressBar"),h=a("OwaspMeasure"),b=a("Accordion");return o(),m(b,null,{header:n(()=>[u("div",Be,[u("div",Ce,[s(_,{as:"h4"},{default:n(()=>[u("span",Pe,[u("span",Re,p(r.code),1),c(" "+p(i.title),1)])]),_:1})]),u("div",Ae,[s(g,{progress:i.compliancePercentage},null,8,["progress"])])])]),body:n(()=>[(o(),m(N(i.metadataElement),{topic:r.topic},null,8,["topic"])),(o(!0),l(v,null,A(r.topic,(y,x)=>(o(),m(h,{key:x,measure:y},null,8,["measure"]))),128))]),_:1})}const Oe=B(ve,[["render",De]]),Se={components:{PageHeader:$,BaseHeading:T,OwaspTopic:Oe,XPreloader:V,ProgressBar:I,PdfDownloadButton:G,CompliancePrintHeader:J},data(){return{isLoading:!0,overview:{},groupReference:void 0}},async mounted(){await Promise.allSettled([this.loadBreakdown()])},watch:{async $teamContext(){this.$globalLoadingIndicator.show();try{await this.loadBreakdown()}finally{this.$globalLoadingIndicator.hide()}}},computed:{breadcrumbs(){return[{label:"Reports",href:"/reports"},{label:"OWASP breakdown"}]},topics(){const e={};for(const[t,r]of Object.entries(this.overview))t==="total_complying_rule_count"||t==="total_rule_count"||(e[t]=r);return e},compliance(){const e=this.overview.total_complying_rule_count??0,t=this.overview.total_rule_count??0;return e===0||this.isLoading?0:Math.round(e/t*100)}},methods:{async loadBreakdown(){this.overview=await L({teamId:null}),this.isLoading=!1}}},Te={class:"flex gap-32px align-center"},Ie={class:"page-content"},je={key:1,class:"flex flex-column gap-24px",id:"ComplianceSectionWrapper"};function Le(e,t,r,f,k,i){const _=a("BaseHeading"),g=a("ProgressBar"),h=a("PdfDownloadButton"),b=a("PageHeader"),y=a("XPreloader"),x=a("CompliancePrintHeader"),C=a("OwaspTopic");return o(),l(v,null,[s(b,{breadcrumbs:i.breadcrumbs},{title:n(()=>[u("div",Te,[s(_,{as:"h1"},{default:n(()=>[c("OWASP top 10 breakdown")]),_:1}),s(g,{progress:i.compliance},null,8,["progress"])])]),rightContent:n(()=>[s(h,{exportType:"owasp"})]),_:1},8,["breadcrumbs"]),u("div",Ie,[k.isLoading?(o(),m(y,{key:0,class:"absolute-centered",theme:"transparent"})):(o(),l("div",je,[s(x,{title:"OWASP top 10 breakdown"}),(o(!0),l(v,null,A(i.topics,(P,w)=>(o(),m(C,{key:w,code:w,topic:P},null,8,["code","topic"]))),128))]))])],64)}const ze=B(Se,[["render",Le]]);export{ze as default};
