import{P as b}from"./PageHeader-46c38a32.js";import{_ as f,bk as A,V as P,g as I,f as B,H as S,x as y,a2 as w,f2 as N,r as a,q as _,m as g,n as e,o as l,w as d,s as n,F as k,N as D,bE as V,bg as E,an as O,A as H,k as x,p as v}from"./index-13ff96f4.js";import{P as L}from"./ProgressTracker-672a1ecc.js";const U={props:{initialPAToken:String,initialTokenName:String},components:{BaseBody:A,InputText:P,BaseLink:I,BaseButton:B,BaseHeading:S,BaseIcon:y,XTooltip:w},emits:["cancel","continue"],data(){return{tokenName:this.initialTokenName,PAToken:this.initialPAToken}},computed:{isComplete(){return!(!this.PAToken||this.PAToken&&this.PAToken===""||!this.tokenName||this.tokenName&&this.tokenName==="")}},methods:{handleCancel(){this.$emit("cancel")},async handleSave(){if(!this.PAToken.startsWith("dop_v1_")){Toast.error({title:"Invalid personal access token",description:'Digital Ocean Personal Access Token should start with "dop_v1_"'});return}try{const i=await N(this.PAToken,this.tokenName);this.$emit("continue",{PAToken:this.PAToken,cloudId:i.cloud_id})}catch(i){console.log(i)}},handleKeyDown(){this.isComplete&&this.handleSave()}}},K={class:"flex flex-column gap-32px"},$={class:"flex flex-column gap-8px"},G={class:"cloud-config__content__list"},M=e("strong",null,"API section in the sidebar",-1),F=e("li",null,[n("On the Applications & API page, click on "),e("strong",null,"Generate New Token"),n(".")],-1),R=e("li",null,"Give your token a name, (i.e. Aikido). Enter the value below. ",-1),W=e("li",null,'Select "No expire" for the expiration. Leave the scope on Read (default).',-1),j=e("li",null,[n("Click on "),e("strong",null,"Generate Token"),n(" and copy the value.")],-1),q={class:"flex flex-column gap-24px"},Y=e("hr",{class:"divider my-24px"},null,-1),X={class:"flex flex-end gap-16px mt-12px justify-end"};function z(i,o,C,T,s,t){const p=a("BaseHeading"),m=a("BaseBody"),h=a("BaseLink"),u=a("InputText"),c=a("BaseButton");return _(),g(k,null,[e("div",K,[e("div",$,[l(p,{as:"h3"},{default:d(()=>[n("Digital Ocean Cloud Provider Configuration")]),_:1}),l(m,{color:"subdued"},{default:d(()=>[n("Navigate to the API section and add a new token.")]),_:1})]),e("div",null,[e("ul",G,[e("li",null,[n(" Log into your "),l(h,{href:"https://cloud.digitalocean.com/login",target:"_blank"},{default:d(()=>[n(" Digital Ocean Account ")]),_:1}),n(" and navigate to the "),M,n(". ")]),F,R,W,j])]),e("div",null,[e("div",q,[l(u,{title:"Paste the PA token below.",placeholder:"dop_v1_432b2569fae585585cc9131837506a228583952eb3184ea8e139d5a0184a5a14",modelValue:s.PAToken,"onUpdate:modelValue":o[0]||(o[0]=r=>s.PAToken=r),modelModifiers:{trim:!0},name:"PAToken",onEnterKeyPress:t.handleKeyDown},null,8,["modelValue","onEnterKeyPress"]),l(u,{title:"Enter your token name.",placeholder:"Aikido token 1",modelValue:s.tokenName,"onUpdate:modelValue":o[1]||(o[1]=r=>s.tokenName=r),modelModifiers:{trim:!0},name:"tokenName",onEnterKeyPress:t.handleKeyDown},null,8,["modelValue","onEnterKeyPress"])])])]),e("div",null,[Y,e("div",X,[l(c,{variation:"plain",onClicked:t.handleCancel},{default:d(()=>[n("Cancel")]),_:1},8,["onClicked"]),l(c,{disabled:!t.isComplete,onClicked:t.handleSave},{default:d(()=>[n("Save & Continue")]),_:1},8,["disabled","onClicked"])])])],64)}const J=f(U,[["render",z]]),Q={components:{BaseBody:A,InputText:P,BaseButton:B,BaseSelect:D,BaseHeading:S},props:{cloudId:Number},emits:["cancel","complete"],data(){return{name:void 0,purpose:void 0}},computed:{purposeOptions(){return[{id:"production",title:"Production"},{id:"staging",title:"Staging"},{id:"development",title:"Development"},{id:"mixed",title:"Mixed"}]},isComplete(){return!(!this.name||this.name&&this.name===""||!this.purpose||this.purpose&&this.purpose==="")}},methods:{handleCancel(){this.$emit("cancel")},async handleSubmit(){await V({cloud_id:this.cloudId,account_purpose:this.purpose,name:this.name}),Toast.success({title:this.$t("NOTIFICATIONS.CLOUD_UPDATED.TITLE"),description:this.$t("SUCCESSFULLY_EDITED_INTEGRATION")}),await E(this.cloudId,"scan"),this.$emit("complete"),O.emit("cloudAdded")}}},Z={class:"flex flex-column gap-32px"},ee={class:"flex flex-column gap-8px"},te={class:"flex flex-column gap-24px"},oe=e("hr",{class:"divider my-24px"},null,-1),ne={class:"flex flex-end gap-16px mt-12px justify-end"};function se(i,o,C,T,s,t){const p=a("BaseHeading"),m=a("BaseBody"),h=a("InputText"),u=a("BaseSelect"),c=a("BaseButton");return _(),g(k,null,[e("div",Z,[e("div",ee,[l(p,{as:"h3"},{default:d(()=>[n("It worked! Everything seems to be connected.")]),_:1}),l(m,{color:"subdued"},{default:d(()=>[n(" Your cloud is connected, please answer two questions and you are good to go! ")]),_:1})]),e("div",null,[e("div",te,[l(h,{title:"Name your Cloud.",placeholder:"Digital Ocean Infrastructure",modelValue:s.name,"onUpdate:modelValue":o[0]||(o[0]=r=>s.name=r),modelModifiers:{trim:!0},name:"name"},null,8,["modelValue"]),l(u,{modelValue:s.purpose,"onUpdate:modelValue":o[1]||(o[1]=r=>s.purpose=r),label:"What is the purpose of your cloud?",options:t.purposeOptions},null,8,["modelValue","options"])])])]),e("div",null,[oe,e("div",ne,[l(c,{variation:"plain",onClicked:t.handleCancel},{default:d(()=>[n("Cancel")]),_:1},8,["onClicked"]),l(c,{disabled:!t.isComplete,onClicked:t.handleSubmit},{default:d(()=>[n("Save")]),_:1},8,["disabled","onClicked"])])])],64)}const le=f(Q,[["render",se]]),ae={components:{AddTokenDigoceanCloudConfiguration:J,PageHeader:b,ProgressTracker:L,CompleteDigoceanCloudConfiguration:le},computed:{breadcrumbs(){return[{label:"Add a cloud"},{label:"Digital Ocean"}]},steps(){return[{title:"Add a new secret",completed:this.completedSteps.includes("add_secret"),pending:this.showSecretStep},{title:"Name your cloud configuration",completed:this.completedSteps.includes("complete_setup"),pending:this.showCompleteSetup}]}},data(){return{showSecretStep:!0,showCompleteSetup:!1,PAToken:void 0,completedSteps:[],cloudId:void 0}},methods:{handleCancel(){this.$router.back()},handleContinue(i,o){if(H.data.group.is_demo_group===1)return this.$modal.show("AddWorkspaceRedirectModal");this.PAToken=o.PAToken,this.cloudId=o.cloudId,this.completedSteps.push(i),this.showSecretStep=!1,this.showCompleteSetup=!0},handleGoBack(i,o){this.completedSteps.pop()},handleComplete(){this.$router.back()}}},ie={class:"page-content bg-white"},de={class:"cloud-config"},ce={class:"cloud-config__step-container"},re={class:"cloud-config__progress-container"};function ue(i,o,C,T,s,t){const p=a("PageHeader"),m=a("AddTokenDigoceanCloudConfiguration"),h=a("CompleteDigoceanCloudConfiguration"),u=a("ProgressTracker");return _(),g(k,null,[l(p,{breadcrumbs:t.breadcrumbs,title:"Cloud configuration"},null,8,["breadcrumbs"]),e("div",ie,[e("div",de,[e("div",ce,[s.showSecretStep?(_(),x(m,{key:0,"initial-PAToken":s.PAToken,"cloud-id":s.cloudId,onCancel:t.handleCancel,onContinue:o[0]||(o[0]=c=>t.handleContinue("add_secret",c))},null,8,["initial-PAToken","cloud-id","onCancel"])):v("",!0),s.showCompleteSetup?(_(),x(h,{key:1,cloudId:s.cloudId,onCancel:t.handleCancel,onComplete:t.handleComplete},null,8,["cloudId","onCancel","onComplete"])):v("",!0)]),e("div",re,[l(u,{steps:t.steps},null,8,["steps"])])])])],64)}const _e=f(ae,[["render",ue]]);export{_e as default};
