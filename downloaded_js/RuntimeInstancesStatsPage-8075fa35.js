import{E as b}from"./EvolutionGraph-0cd8ecd4.js";import{_ as f,r as i,q as l,k as m,a3 as k,e4 as C,m as h,o as d,w as g,s as I,e0 as D,n as B,F as $}from"./index-13ff96f4.js";import{B as _}from"./BaseCard-471d3203.js";import{p as v,C as T,a as S,L as N,B as w,b as R,c as F,d as E}from"./index-fdfd2f30.js";import{I as H}from"./InputFilterDropdown-674351d9.js";import{R as L}from"./RuntimeNoTokenCallout-f395432e.js";import"./dateFns-a344cb79.js";import"./index-b87db690.js";import"./transform-c376ec3f.js";import"./linear-efb37b7f.js";import"./FilterButton-bb5393a7.js";import"./ActionMenu-3e4470bf.js";import"./BaseCallout-aea0aba4.js";function O(e){const{chart:t,tooltip:a}=e,s=P(t);if(a.opacity===0){s.style.opacity=0;return}if(a.body){const p=a.title[0]||"",u=a.labelColors[0].backgroundColor,x=a.$context.tooltipItems[0].dataset.label,y=a.dataPoints[0].formattedValue||0;s.innerHTML=`
			<div class="chart-tooltip-base text-12px leading-none w-200px">
				<div>
					<div class="bg-gray-50 text-gray-900 text--semi-bold px-16px py-10px rounded-t-4px ws-nowrap">
						${p}
					</div>
					<div class="px-16px py-10px">
						<div class="flex align-center gap-8px justify-between">
							<div class="graph-legend evolution-graph flex align-center">
								<div>
									<div class="circle legend w-10px h-10px" style="background-color: ${u}"></div>
								</div>
								<div class="text-carbon-60">
									${x}
								</div>
							</div>

							<div class="text-gray-900 text--semi-bold">
								${y}
							</div>
						</div>
					</div>
				</div>
			</div>
		`}const{offsetLeft:r,offsetTop:o}=t.canvas;s.style.opacity=1,s.style.left=r+a.caretX+"px",s.style.top=o+a.caretY+"px";const n=200,c=t.canvas.offsetWidth;r+a.caretX+n>c&&(s.style.left=c-n+"px")}function P(e){let t=e.canvas.parentNode.querySelector("div");return t||(t=document.createElement("div"),t.style.position="absolute",t.style.transform="translate(-50%, 0)",e.canvas.parentNode.appendChild(t)),t}v.positioners.cursor=function(e,t){return t};T.register(S,N,w,R,v,F);const q={components:{Bar:E},props:{chartData:{type:Array,required:!0},stacked:{type:Boolean,default:!0}},computed:{chartOptions(){let e=1.1;return this.stacked||(e=.9),{backgroundColor:"#00adee",barPercentage:e,scales:{x:{grid:{display:!1},stacked:this.stacked},y:{position:"right",grid:{display:!1},stacked:this.stacked}},plugins:{legend:{position:"top",align:"start",labels:{boxHeight:6,usePointStyle:!0},onHover:function(t){t.native.target.style.cursor="pointer"},onLeave:function(t){t.native.target.style.cursor="unset"}},tooltip:{enabled:!1,position:"cursor",external:O}}}},formattedChartData(){const e=this.chartData[0].data.map(a=>a.label),t=this.chartData.map(a=>({data:a.data.map(s=>s.value),label:a.title,backgroundColor:a.color}));return{labels:e,datasets:t}}}};function V(e,t,a,s,r,o){const n=i("Bar");return l(),m(n,{data:o.formattedChartData,options:o.chartOptions},null,8,["data","options"])}const G=f(q,[["render",V]]),M={components:{EvolutionGraph:b,BaseCard:_,BarChart:G,InputFilterDropdown:H},data(){return{stats:{},chartOptions:{measure_title:"Open issues",formatValue(e){return e}},everythingDataGraph:null,chartDataLoading:!0}},async created(){this.chartDataLoading=!0,await this.loadStats(),this.chartDataLoading=!1},computed:{serviceId(){return this.$route.params.serviceId},graphData1(){return[{title:"Amount requests seen",color:"#00b391",data:this.getFormattedDataForType("amount_requests_total")},{title:"Attacks blocked",color:"#ff9505",data:this.getFormattedDataForType("amount_request_attacks_blocked")},{title:"Attacks detected in monitoring mode",color:"#d72638",data:this.getFormattedDataForType("amount_request_attacks_detected")}]}},methods:{getFormattedDataForType(e){const t=[];for(const[a,s]of Object.entries(this.stats)){const r=k.fromISOString(a);let o=r.format("HH:mm");r.isToday()||(o=r.format("MMM do HH:mm")),t.push({label:o,value:s[e]})}return t},chartHasNoData(e){for(const t of e)for(const a of t.data)if(a.value>0)return!1;return!0},async loadStats(){this.stats=await C({service_id:this.serviceId})}}},X={class:"flex flex-column"},j={key:1,class:"flex flex-column justify-center"};function A(e,t,a,s,r,o){const n=i("XPreloader"),c=i("BaseParagraph"),p=i("BarChart"),u=i("BaseCard");return l(),h("div",X,[d(u,null,{default:g(()=>[r.chartDataLoading?(l(),m(n,{key:0,class:"absolute-centered my-16px",theme:"transparent",size:"medium"})):o.chartHasNoData(o.graphData1)?(l(),h("div",j,[d(c,{size:"medium"},{default:g(()=>[I("No data to display")]),_:1})])):(l(),m(p,{key:2,chartData:o.graphData1,stacked:!1,class:"max-h-400px"},null,8,["chartData"]))]),_:1})])}const W=f(M,[["render",A]]),z={components:{RuntimeNoTokenCallout:L,RuntimeInstanceStatsGraph:W,BaseCard:_},computed:{serviceId(){return this.$route.params.serviceId}},async mounted(){const e=await D(this.serviceId);if(!e){this.$router.push("/runtime/services");return}this.$breadcrumbs.show({breadcrumbs:[{label:this.$t("RUNTIME_PROTECTION"),href:"/runtime"},{label:e.name}]})}},Y={class:"flex flex-column gap-16px"};function U(e,t,a,s,r,o){const n=i("RuntimeNoTokenCallout"),c=i("RuntimeInstanceStatsGraph");return l(),h($,null,[d(n,{serviceId:o.serviceId},null,8,["serviceId"]),B("div",Y,[d(c)])],64)}const lt=f(z,[["render",U]]);export{lt as default};
