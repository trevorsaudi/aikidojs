import{_ as I,B as T,r,q as i,m as h,n as e,o as n,w as t,s,u as g,f as P,g as M,H,V as R,a3 as C,aM as S,aN as z,Q as x,aO as U,aP as V,k as p,F as b,t as y,p as D}from"./index-13ff96f4.js";import{P as F}from"./PageHeader-46c38a32.js";import{C as N}from"./ContinuousIntegrationCopyTokenModal-b6dba601.js";const j={components:{BaseParagraph:T},props:{integration:{type:Object,required:!0}}},G=["href"],Y={class:"flex justify-between align-center"},E={class:"flex align-center gap-8px"},O=["src"],X={class:"flex flex-column gap-8px"};function q(a,_,c,w,d,o){const k=r("BaseParagraph");return i(),h("a",{href:c.integration.url,target:"_blank",class:"flex flex-column w-360px wide-tablet_w-full bg-white rounded-8px border-1 p-24px gap-16px transition-box-shadow-500 shadow-card card-clickable border-gray-table"},[e("div",Y,[e("div",E,[e("img",{src:c.integration.icon,height:"26",class:"rounded-2px"},null,8,O),n(k,{size:"large"},{default:t(()=>[s(g(c.integration.label),1)]),_:1})])]),e("div",X,[n(k,{color:"subdued",size:"small"},{default:t(()=>[s(g(c.integration.description),1)]),_:1})])],8,G)}const W=I(j,[["render",q]]),J={components:{BaseParagraph:T,BaseButton:P,BaseLink:M,BaseHeading:H,PageHeader:F,InputText:R,ContinuousIntegrationCopyTokenModal:N,ContinuousIntegrationToolCard:W},data(){return{loaded:!1,token:void 0,tokenUpdatedAt:void 0,tokenCreatedBy:void 0,isLoading:!1,showTokenModal:!1}},async mounted(){try{await this.handleFetchToken()}finally{this.loaded=!0}},computed:{isIntegrationActive(){return this.loaded&&this.token},redactedToken(){return`********************${this.token.slice(-4)}`},integrationsList(){return[{label:"GitHub Actions",description:"Connect GitHub Actions to block risky code from being merged.",icon:"/assets/icons/github.svg",url:"https://github.com/marketplace/actions/aikido-security-github-action",hidden:!this.$featureflags.show_old_gh_actions},{label:"GitLab CI",description:"Connect Gitlab CI to block risky code from being merged.",icon:"/assets/icons/gitlab.svg",url:"https://gitlab.com/aikido-security/gitlab-ci-integration"},{label:"Bitbucket Pipes",description:"Connect Bitbucket Pipes to block risky code from being merged.",icon:"/assets/icons/bitbucket.svg",url:"https://bitbucket.org/aikido-production/bitbucket-pipe"},{label:"Jenkins",description:"Setup release gating to block a new release as long as issues are still open.",icon:"/assets/icons/jenkins.svg",url:"https://www.npmjs.com/package/@aikidosec/ci-api-client"},{label:"CircleCI",description:"Setup release gating to block a new release as long as issues are still open.",icon:"/assets/icons/circleci.svg",url:"https://www.npmjs.com/package/@aikidosec/ci-api-client"}].filter(_=>!_.hidden)},advancedIntegrationsList(){return[{label:"Aikido public CI API",url:"https://help.aikido.dev/doc/aikido-ci-api/docVFKO3fMXY"},{label:"Aikido CLI tool",url:"https://www.npmjs.com/package/@aikidosec/ci-api-client"}]},breadcrumbs(){return[{label:"Settings",href:"/settings"},{label:"Integrations",href:"/settings/integrations"},{label:"CI integrations"}]},formattedTokenUpdatedAtTimestamp(){return this.tokenUpdatedAt?C.fromUnix(this.tokenUpdatedAt).format(C.US_FRIENDLY_DATE_WITH_TIME):null}},methods:{handleCopyToken(){window.isSecureContext&&navigator.clipboard.writeText(this.token)},async handleAddIntegration(){const a=await S();this.token=a.token,this.showTokenModal=!0},async handleFetchToken(){this.isLoading=!0;try{const a=await z({disable_toasts:!0});this.token=a.token,this.tokenUpdatedAt=a.updated_at,this.tokenCreatedBy=a.created_by_name}finally{this.isLoading=!1}},async handleRotateToken(){if(await x({headerText:"Rotate token",description:"Do you want to rotate the CI auth token? This will invalidate the current token and you will need to update it in your CI configuration.",buttonSubmitText:"Yes, rotate"})){this.isLoading=!0;try{const a=await U();this.token=a.token,this.showTokenModal=!0}finally{this.isLoading=!1}}},async handleRevokeToken(){if(await x({headerText:"Revoke token",description:"Do you want to revoke the CI auth token?",buttonSubmitText:"Yes, revoke"})){this.isLoading=!1;try{await V(),this.token=void 0}finally{this.isLoading=!1}}},async handleCloseTokenModal(){this.showTokenModal=!1,this.token="***",await this.handleFetchToken()}}},K=e("span",{class:"text--bold"},"CI Scan History",-1),Q={class:"page-content flex flex-column gap-48px"},Z={key:1,class:"flex flex-column gap-8px"},$={class:"flex align-center gap-8px mt-16px"},ee=e("i",{class:"icon icon-refresh icon-12px"},null,-1),te=e("span",{class:"text--semi"},"Rotate token",-1),ne=e("span",{class:"text--semi"},"Revoke token",-1),ae={class:"flex flex-wrap gap-24px mt-16px"},oe={class:"flex align-center gap-8px mt-16px"},ie=e("i",{class:"icon icon-Aikido icon-12px"},null,-1),se={class:"text--semi"};function re(a,_,c,w,d,o){const k=r("XPreloader"),u=r("BaseButton"),v=r("PageHeader"),f=r("BaseHeading"),m=r("BaseParagraph"),B=r("InputText"),A=r("ContinuousIntegrationToolCard"),L=r("ContinuousIntegrationCopyTokenModal");return d.loaded?(i(),h(b,{key:1},[n(v,{title:"CI integrations",breadcrumbs:o.breadcrumbs},{rightContent:t(()=>[n(u,{size:"medium",variation:"tertiary",as:"link",to:"/settings/integrations/ci/checks/scans"},{default:t(()=>[K]),_:1})]),_:1},8,["breadcrumbs"]),e("div",Q,[e("section",null,[n(f,{as:"h4"},{default:t(()=>[s("Token Generation")]),_:1}),n(m,{class:"mt-8px"},{default:t(()=>[s(" Add this generated CI integration token to the variables of your CI/CD pipeline. ")]),_:1}),o.isIntegrationActive?(i(),h("div",Z,[e("div",$,[n(B,{modelValue:o.redactedToken,disabled:!0,ref:"input",class:"truncate flex-1 max-w-400px",inputClass:"bg-white"},null,8,["modelValue"]),n(u,{size:"small",variation:"primary",onClicked:o.handleRotateToken},{default:t(()=>[ee,te]),_:1},8,["onClicked"]),n(u,{size:"small",variation:"plain",onClicked:o.handleRevokeToken},{default:t(()=>[ne]),_:1},8,["onClicked"])]),n(m,{size:"tiny"},{default:t(()=>[s("Token generated on "+g(o.formattedTokenUpdatedAtTimestamp)+" by "+g(d.tokenCreatedBy),1)]),_:1})])):(i(),p(u,{key:0,class:"mt-16px",size:"small",variation:"secondary",onClicked:o.handleAddIntegration},{default:t(()=>[s(" Generate Token ")]),_:1},8,["onClicked"]))]),e("section",null,[n(f,{as:"h4"},{default:t(()=>[s("Integrate with your CI")]),_:1}),n(m,{class:"mt-8px"},{default:t(()=>[s(" Choose your specific CI from the list. We will redirect you to the correct documentation. Not available? Integrate manually via our CI API. ")]),_:1}),e("div",ae,[(i(!0),h(b,null,y(o.integrationsList,l=>(i(),p(A,{key:l.label,integration:l},null,8,["integration"]))),128))])]),e("section",null,[n(f,{as:"h4"},{default:t(()=>[s("Advanced Integrations")]),_:1}),n(m,{class:"mt-8px"},{default:t(()=>[s(" Your CI integration not in the list? Integrate manually via our CI API or with the help of our CLI tool. ")]),_:1}),e("div",oe,[(i(!0),h(b,null,y(o.advancedIntegrationsList,l=>(i(),p(u,{key:l.label,as:"outside-link",target:"_blank",href:l.url,size:"small",variation:"plain"},{default:t(()=>[ie,e("span",se,g(l.label),1)]),_:2},1032,["href"]))),128))])]),d.showTokenModal?(i(),p(L,{key:0,token:d.token,onClose:o.handleCloseTokenModal},null,8,["token","onClose"])):D("",!0)])],64)):(i(),p(k,{key:0,class:"supercenter",theme:"transparent"}))}const ue=I(J,[["render",re]]);export{ue as default};
