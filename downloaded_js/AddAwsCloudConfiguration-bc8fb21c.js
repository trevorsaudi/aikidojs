import{P}from"./PageHeader-46c38a32.js";import{P as $}from"./ProgressTracker-672a1ecc.js";import{_ as k,bk as A,g as M,f as I,H as S,B as v,a as g,A as C,e$ as N,r as s,q as f,m as w,n as e,o as a,w as i,s as t,F as b,V as T,z as U,x as E,a2 as L,f0 as V,N as z,bE as W,bg as D,an as j,k as y,p as B}from"./index-13ff96f4.js";import{_ as H}from"./awsoutputtab-d18f8503.js";const O={props:{initialApplicationId:String,initialDirectoryId:String},emits:["cancel","continue"],components:{BaseBody:A,BaseLink:M,BaseButton:I,BaseHeading:S,BaseParagraph:v},computed:{templateUrl(){return g()==="staging"?"https://aikido-staging-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy.json":g()==="production"?"https://aikido-production-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy.json":"https://aikido-dev-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy.json"},iamRoleAndPolicyLink(){let l=`https://eu-central-1.console.aws.amazon.com/cloudformation/home?region=eu-central-1#/stacks/create/review?stackName=aikido-security-readonly-dev&templateURL=https://aikido-dev-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy.json&param_ExternalId=aikido-${C.data.groupId}`;return g()==="staging"?l=`https://eu-central-1.console.aws.amazon.com/cloudformation/home?region=eu-central-1#/stacks/create/review?stackName=aikido-security-readonly-staging&templateURL=https://aikido-staging-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy.json&param_ExternalId=aikido-${C.data.groupId}`:g()==="production"&&(l=`https://eu-central-1.console.aws.amazon.com/cloudformation/home?region=eu-central-1#/stacks/create/review?stackName=aikido-security-readonly&templateURL=https://aikido-production-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy.json&param_ExternalId=aikido-${C.data.groupId}`),l}},methods:{handleCancel(){this.$emit("cancel")},handleSubmit(){this.$emit("continue")},async handleDownloadTerraformTemplate(){await N().then(l=>{const n=window.URL.createObjectURL(new Blob([l.file_content])),u=document.createElement("a");u.href=n,u.setAttribute("download","aikido_terraform.tf"),document.body.appendChild(u),u.click()})}}},F={class:"flex flex-column gap-32px"},Y={class:"flex flex-column gap-8px"},G={class:"cloud-config__content__list"},K=e("li",null,"Use the below button to create the required IAM Role & Policy using Cloudformation template.",-1),X=e("li",null,[t("You’ll also need to mark "),e("strong",null,"«I acknowledge that AWS CloudFormation might create IAM resources»")],-1),q=e("li",null,[t("Then click "),e("strong",null,"create stack")],-1),Z=e("hr",{class:"divider my-24px"},null,-1),J={class:"flex flex-end gap-16px mt-12px justify-end"};function Q(l,n,u,x,c,o){const m=s("BaseHeading"),h=s("BaseBody"),p=s("BaseLink"),_=s("BaseParagraph"),d=s("BaseButton");return f(),w(b,null,[e("div",F,[e("div",Y,[a(m,{as:"h3"},{default:i(()=>[t("Amazon Web Services (AWS) Configuration")]),_:1}),a(h,{color:"subdued"},{default:i(()=>[t("Please go to your AWS account and login. You’ll need to complete the next few steps in the AWS UI. ")]),_:1})]),e("div",null,[e("ul",G,[e("li",null,[t("Log into your "),a(p,{href:"https://console.aws.amazon.com/",target:"_blank"},{default:i(()=>[t("AWS account")]),_:1}),t(".")]),K,X,q])]),a(_,{loose:!0},{default:i(()=>[t(" Via this IAM role, Aikido will be able to access resource policies in your AWS account. Want to know what kind of permissions you'll be giving Aikido? "),a(p,{href:o.templateUrl,target:"_blank",inline:!0},{default:i(()=>[t("Click here")]),_:1},8,["href"]),t(" to see the policy. Alternatively, you can download the Terraform code to create the role "),e("button",{class:"link inline-link",onClick:n[0]||(n[0]=(...r)=>o.handleDownloadTerraformTemplate&&o.handleDownloadTerraformTemplate(...r))},"here"),t(". ")]),_:1}),a(d,{as:"outside-link",variation:"blue",href:o.iamRoleAndPolicyLink,target:"_blank"},{default:i(()=>[t("Create IAM Role & Policy")]),_:1},8,["href"])]),e("div",null,[Z,e("div",J,[a(d,{variation:"plain",onClicked:o.handleCancel},{default:i(()=>[t("Cancel")]),_:1},8,["onClicked"]),a(d,{onClicked:o.handleSubmit},{default:i(()=>[t("Continue")]),_:1},8,["onClicked"])])])],64)}const ee=k(O,[["render",Q]]),te={props:{initialArn:String},components:{BaseBody:A,BaseButton:I,InputText:T,BaseHeading:S,BaseParagraph:v,InputSwitch:U,BaseIcon:E,XTooltip:L},emits:["goBack","continue"],data(){return{arn:this.initialArn}},computed:{isComplete(){return!(!this.arn||this.arn&&this.arn==="")}},methods:{handleBack(){this.$emit("goBack",{arn:this.arn})},async handleSubmit(){const l=await V({aws_arn_id:this.arn});this.$emit("continue",{cloudId:l})},handleKeyDown(){this.isComplete&&this.handleSubmit()}}},oe={class:"flex flex-column gap-32px"},ne={class:"flex flex-column gap-8px"},ae={class:"cloud-config__content__list"},se=e("li",null,"In AWS Cloudformation, click the stack that was just created.",-1),le={class:"inline-flex gap-4px align-center"},ie=e("strong",null,"outputs",-1),ce=e("img",{src:H,class:"rounded-2px",width:"800"},null,-1),re=e("li",null,[t("Copy the "),e("strong",null,"AikidoRoleARN"),t(" and paste it below")],-1),de=e("hr",{class:"divider my-24px"},null,-1),ue={class:"flex flex-end gap-16px mt-12px justify-end"};function pe(l,n,u,x,c,o){const m=s("BaseHeading"),h=s("BaseBody"),p=s("XTooltip"),_=s("BaseIcon"),d=s("InputText"),r=s("BaseButton");return f(),w(b,null,[e("div",oe,[e("div",ne,[a(m,{as:"h3"},{default:i(()=>[t("Connect accounts")]),_:1}),a(h,{color:"subdued"},{default:i(()=>[t("If you have inspector enabled, Aikido will import container scanning results from there.")]),_:1})]),e("ul",ae,[se,e("li",null,[e("span",le,[t("Navigate to the "),ie,t(" tab. "),a(_,{icon:"icon-help",class:"cursor-help inline-flex"},{default:i(()=>[a(p,{noOpacity:""},{default:i(()=>[ce]),_:1})]),_:1})])]),re]),a(d,{title:"Paste the arn below.",placeholder:"arn:aws:iam::123830977344:role/aikido-security-readonly-AikidoSecurityRole-XYZXYZ123456",modelValue:c.arn,"onUpdate:modelValue":n[0]||(n[0]=R=>c.arn=R),modelModifiers:{trim:!0},name:"awsRoleArn",onEnterKeyPress:o.handleKeyDown},null,8,["modelValue","onEnterKeyPress"])]),e("div",null,[de,e("div",ue,[a(r,{variation:"plain",onClicked:o.handleBack},{default:i(()=>[t("Go back")]),_:1},8,["onClicked"]),a(r,{disabled:!o.isComplete,onClicked:o.handleSubmit},{default:i(()=>[t(" Continue ")]),_:1},8,["disabled","onClicked"])])])],64)}const me=k(te,[["render",pe]]),he={components:{BaseBody:A,InputText:T,BaseButton:I,BaseSelect:z,BaseHeading:S},props:{cloudId:Number},emits:["cancel","complete"],data(){return{name:void 0,purpose:void 0}},computed:{purposeOptions(){return[{id:"production",title:"Production"},{id:"staging",title:"Staging"},{id:"development",title:"Development"},{id:"mixed",title:"Mixed"}]},isComplete(){return!(!this.name||this.name&&this.name===""||!this.purpose||this.purpose&&this.purpose==="")}},methods:{async handleSubmit(){await W({cloud_id:this.cloudId,account_purpose:this.purpose,name:this.name}),Toast.success({title:this.$t("NOTIFICATIONS.CLOUD_UPDATED.TITLE"),description:this.$t("SUCCESSFULLY_EDITED_INTEGRATION")});const l="scan";await D(this.cloudId,l),this.$emit("complete"),j.emit("cloudAdded")}}},_e={class:"flex flex-column gap-32px"},fe={class:"flex flex-column gap-8px"},ge={class:"flex flex-column gap-24px"},Ce=e("hr",{class:"divider my-24px"},null,-1),ke={class:"flex flex-end gap-16px mt-12px justify-end"};function we(l,n,u,x,c,o){const m=s("BaseHeading"),h=s("BaseBody"),p=s("InputText"),_=s("BaseSelect"),d=s("BaseButton");return f(),w(b,null,[e("div",_e,[e("div",fe,[a(m,{as:"h3"},{default:i(()=>[t("It worked! Everything seems to be connected.")]),_:1}),a(h,{color:"subdued"},{default:i(()=>[t(" Your cloud is connected, please answer two questions and you are good to go! ")]),_:1})]),e("div",null,[e("div",ge,[a(p,{title:"Name your Cloud.",placeholder:"AWS cloud infrastructure",modelValue:c.name,"onUpdate:modelValue":n[0]||(n[0]=r=>c.name=r),modelModifiers:{trim:!0},name:"name"},null,8,["modelValue"]),a(_,{modelValue:c.purpose,"onUpdate:modelValue":n[1]||(n[1]=r=>c.purpose=r),label:"What is the purpose of your cloud?",options:o.purposeOptions},null,8,["modelValue","options"])])])]),e("div",null,[Ce,e("div",ke,[a(d,{disabled:!o.isComplete,onClicked:o.handleSubmit},{default:i(()=>[t(" Save ")]),_:1},8,["disabled","onClicked"])])])],64)}const be=k(he,[["render",we]]),xe={components:{CreateIAMRole:ee,PageHeader:P,ProgressTracker:$,ConnectAccount:me,CompleteConfiguration:be},computed:{breadcrumbs(){return[{label:"Add a cloud"},{label:"Amazon Web Services"}]},steps(){return[{title:"Sign in create IAM Role & Policy",completed:this.completedSteps.includes("create_iam_role"),pending:this.showCreateIAMRole},{title:"Connect accounts",completed:this.completedSteps.includes("connect_account"),pending:this.showConnectAccount},{title:"Name your cloud connection",completed:this.completedSteps.includes("complete_setup"),pending:this.showCompleteSetup}]}},data(){return{showCreateIAMRole:!0,showConnectAccount:!1,showCompleteSetup:!1,completedSteps:[],cloudId:void 0,roleArn:void 0}},methods:{handleCancel(){this.$router.back()},handleContinue(l,n){if(C.data.group.is_demo_group===1)return this.$modal.show("AddWorkspaceRedirectModal");switch(this.completedSteps.push(l),l){case"create_iam_role":this.showCreateIAMRole=!1,this.showConnectAccount=!0;return;case"connect_account":this.cloudId=n.cloudId,this.showConnectAccount=!1,this.showCompleteSetup=!0;return}},handleGoBack(l,n){switch(this.completedSteps.pop(),l){case"connect_account":this.roleArn=n.arn,this.showCreateIAMRole=!0,this.showConnectAccount=!1;return}},handleComplete(){this.showCompleteSetupStep=!1,this.$router.back()}}},ye={class:"page-content bg-white"},Be={class:"cloud-config"},Ae={class:"cloud-config__step-container"},Ie={class:"cloud-config__progress-container"};function Se(l,n,u,x,c,o){const m=s("PageHeader"),h=s("CreateIAMRole"),p=s("ConnectAccount"),_=s("CompleteConfiguration"),d=s("ProgressTracker");return f(),w(b,null,[a(m,{breadcrumbs:o.breadcrumbs,title:"Cloud configuration"},null,8,["breadcrumbs"]),e("div",ye,[e("div",Be,[e("div",Ae,[c.showCreateIAMRole?(f(),y(h,{key:0,onCancel:o.handleCancel,onContinue:n[0]||(n[0]=r=>o.handleContinue("create_iam_role",r))},null,8,["onCancel"])):B("",!0),c.showConnectAccount?(f(),y(p,{key:1,"initial-arn":c.roleArn,onGoBack:n[1]||(n[1]=r=>o.handleGoBack("connect_account",r)),onContinue:n[2]||(n[2]=r=>o.handleContinue("connect_account",r))},null,8,["initial-arn"])):B("",!0),c.showCompleteSetup?(f(),y(_,{key:2,"cloud-id":c.cloudId,onCancel:o.handleCancel,onComplete:o.handleComplete},null,8,["cloud-id","onCancel","onComplete"])):B("",!0)]),e("div",Ie,[a(d,{steps:o.steps},null,8,["steps"])])])])],64)}const $e=k(xe,[["render",Se]]);export{$e as default};
