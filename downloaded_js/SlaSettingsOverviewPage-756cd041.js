import{s as N,g as E,a as O,e as M,d as U}from"./slaSettings-fece48e7.js";import{B as L}from"./BaseCard-471d3203.js";import{_ as y,au as R,N as F,V as C,Z as p,az as D,r as l,q as d,k as I,w as i,n as c,p as T,o as a,f as j,A as z,s as o,u as v,B as H,z as G,X as K,H as X,m,S as Y,F as B,t as q}from"./index-13ff96f4.js";import{g as W}from"./taskTrackerNaming-55adac3e.js";import{g as Z}from"./taskTrackerIcon-504ea566.js";const J={components:{BaseConfirmModal:R,BaseSelect:F,InputText:C},emits:["close","submit"],props:{notificationSettings:{type:[Object,null],default:null}},data(){return{selectedProject:null,projectOptions:[],projectsIsLoading:!1,tagName:"",selectedInstance:null}},async mounted(){this.notificationSettings&&(this.tagName=this.notificationSettings.sla_breached_issue_tracker_tag_name),this.fillSelectedInstance(),await this.handleFetchProjects(),this.fillSelectedProject()},computed:{issueTrackerName(){return this.$t("TASK_TRACKER_"+p.data.issueTracker).replace(" issues","")},title(){return`Set up ${this.issueTrackerName} Ticketing for SLA Breach`},description(){return`Enter details for creating a ${this.issueTrackerName} ticket.`},projectSelectionLabel(){const e=W();return`Select ${this.issueTrackerName} ${e}`},canChangeTag(){return["github","jira","jira-data-center","linear"].includes(p.data.issueTracker)},activeIssueTrackerIntegrations(){return p.data.activeIssueTrackerIntegrations},integrationInstanceOptions(){return this.activeIssueTrackerIntegrations.map(e=>({id:e.id,title:e.name,apideck_consumer_identifier:e.apideck_consumer_identifier}))},selectedInstanceIntegration(){return this.activeIssueTrackerIntegrations.find(e=>e.id==this.selectedInstance)}},methods:{async handleSelectInstance(e){this.selectedInstance=e,this.selectedProject=null,await this.handleFetchProjects()},async handleFetchProjects(){this.projectsIsLoading=!0;let e=null;this.selectedInstanceIntegration&&(e=this.selectedInstanceIntegration.apideck_consumer_identifier),this.projectOptions=await D(e),this.projectOptions.length===1&&(this.selectedProject=this.projectOptions[0].id),this.projectsIsLoading=!1},fillSelectedInstance(){if(this.integrationInstanceOptions.length<1)return;if(!this.notificationSettings){this.selectedInstance=this.integrationInstanceOptions[0].id;return}const e=this.integrationInstanceOptions.find(s=>s.apideck_consumer_identifier==this.notificationSettings.sla_breached_issue_tracker_apideck_consumer_identifier);if(e){this.selectedInstance=e.id;return}this.selectedInstance=this.integrationInstanceOptions[0].id},fillSelectedProject(){if(!this.notificationSettings)return;this.tagName=this.notificationSettings.sla_breached_issue_tracker_tag_name;const e=this.projectOptions.find(s=>s.id==this.notificationSettings.sla_breached_issue_tracker_project);e&&(this.selectedProject=e.id)},async handleSubmit(){let e=null;this.selectedInstanceIntegration&&(e=this.selectedInstanceIntegration.apideck_consumer_identifier),await N({sla_breached_issue_tracker_project:this.selectedProject,sla_breached_issue_tracker_tag_name:this.tagName,sla_breached_issue_tracker_apideck_consumer_identifier:e}),this.$toast.success("Successfully saved sla settings"),this.$emit("submit")}}},Q={class:"flex flex-column gap-16px"};function $(e,s,h,g,t,n){const _=l("BaseSelect"),r=l("InputText"),S=l("BaseConfirmModal");return d(),I(S,{width:600,title:n.title,description:n.description,buttonSubmitText:"Apply Changes",disableSubmit:!t.selectedProject,onSubmit:n.handleSubmit,onClose:s[2]||(s[2]=u=>e.$emit("close")),onSecondaryButtonClicked:s[3]||(s[3]=u=>e.$emit("close"))},{default:i(()=>[c("div",Q,[n.integrationInstanceOptions.length>1?(d(),I(_,{key:0,label:"Instance",options:n.integrationInstanceOptions,modelValue:t.selectedInstance,"onUpdate:modelValue":n.handleSelectInstance},null,8,["options","modelValue","onUpdate:modelValue"])):T("",!0),a(_,{label:n.projectSelectionLabel,options:t.projectOptions,modelValue:t.selectedProject,"onUpdate:modelValue":s[0]||(s[0]=u=>t.selectedProject=u),"is-loading":t.projectsIsLoading},null,8,["label","options","modelValue","is-loading"]),n.canChangeTag?(d(),I(r,{key:1,title:"Specify Default Label",modelValue:t.tagName,"onUpdate:modelValue":s[1]||(s[1]=u=>t.tagName=u),placeholder:"Out of SLA"},null,8,["modelValue"])):T("",!0)])]),_:1},8,["title","description","disableSubmit","onSubmit"])}const ee=y(J,[["render",$]]),te={components:{BaseCard:L,BaseButton:j,SlaBreachSettingsModal:ee},emits:["settingsUpdated"],props:{notificationSettings:{type:[Object,null],default:null}},data(){return{showSlaBreachSettingsModal:!1}},computed:{issueTrackerName(){return this.$t("TASK_TRACKER_"+p.data.issueTracker).replace(" issues","")},taskTrackerIcon:Z},methods:{onSubmit(){this.showSlaBreachSettingsModal=!1,this.$emit("settingsUpdated")},openSlaBreachSettingsModal(){if(z.hasExpiredFullTrial()&&!this.$featureflags.force_enable_task_trackers)return this.$modal.show("UpgradeAccountModal");this.showSlaBreachSettingsModal=!0}}};function se(e,s,h,g,t,n){const _=l("BaseParagraph"),r=l("BaseIcon"),S=l("BaseButton"),u=l("SlaBreachSettingsModal"),w=l("BaseCard");return d(),I(w,{title:"Advanced Actions"},{default:i(()=>[c("div",null,[a(_,{size:"medium",bold:""},{default:i(()=>[o("Create new "+v(n.issueTrackerName)+" Ticket",1)]),_:1}),a(_,{size:"small",color:"subdued",class:"mt-8px"},{default:i(()=>[o("Automatically create a new "+v(n.issueTrackerName)+" ticket when an issue goes out of SLA.",1)]),_:1}),a(S,{class:"mt-16px",variation:"plain",onClick:n.openSlaBreachSettingsModal},{default:i(()=>[a(r,{icon:n.taskTrackerIcon},null,8,["icon"]),o(" Manage "+v(n.issueTrackerName)+" Tasks ",1)]),_:1},8,["onClick"])]),t.showSlaBreachSettingsModal?(d(),I(u,{key:0,notificationSettings:h.notificationSettings,onClose:s[0]||(s[0]=x=>t.showSlaBreachSettingsModal=!1),onSubmit:n.onSubmit},null,8,["notificationSettings","onSubmit"])):T("",!0)]),_:1})}const ae=y(te,[["render",se]]),ne={components:{BaseParagraph:H,InputText:C,BaseCard:L,BaseButton:j,InputSwitch:G,XPreloader:K,BaseHeading:X,AdvancedSlaSettingsCard:ae},data(){return{slaSettings:[],isLoading:!0,isSaving:!1,isEnabled:!1,dueSoonThreshold:10,notificationSettings:null}},watch:{async isEnabled(e){await this.handleToggleSlaSettings(e)}},async mounted(){await this.fetchSlaSettings(),this.isLoading=!1},computed:{issuePriorityLevels(){return["critical","high","medium","low"]},shouldShowAdvancedSlaSettings(){return!(!this.$featureflags.enable_sla_task_creation||!this.isEnabled||!p.data.issueTracker)}},methods:{async fetchSlaSettings(){const e=await E();this.slaSettings=e.settings,this.isEnabled=e.is_enabled,this.dueSoonThreshold=e.threshold_settings.due_soon,this.notificationSettings=e.notification_settings},async handleSaveSettings(){this.isSaving=!0;try{await O(this.slaSettings,this.dueSoonThreshold),Toast.success({title:"SLA settings saved",description:"The SLA settings were saved successfully"})}finally{this.isSaving=!1}await p.fetchIntegrationStatusOverview()},isFieldDisabled(e){return e===0},getFieldLabel(e){switch(e){case"critical":return this.$t("SETTINGS.SLA.PRIORITY_LEVEL.CRITICAL");case"high":return this.$t("SETTINGS.SLA.PRIORITY_LEVEL.HIGH");case"medium":return this.$t("SETTINGS.SLA.PRIORITY_LEVEL.MEDIUM");case"low":return this.$t("SETTINGS.SLA.PRIORITY_LEVEL.LOW");default:return e}},async handleToggleSlaSettings(e){if(!this.isLoading){this.isLoading=!0;try{e?(await M(),await this.fetchSlaSettings()):await U(),await p.fetchIntegrationStatusOverview()}finally{this.isLoading=!1}}},handleToggleSlaForPriority(e,s){const{issue_priority_level:h}=this.slaSettings[s];if(e===0)return;let g=1;h==="critical"?g=5:h==="high"?g=20:h==="medium"?g=60:h==="low"&&(g=100),this.slaSettings[s].duration_in_days=g}}},ie={class:"flex gap-40px wide-tablet_flex-column"},le={class:"flex"},oe={class:"flex flex-column gap-24px"},re={class:"flex flex-column gap-12px"},ce={class:"flex align-center gap-16px"},de={key:0,class:"min-h-110px relative"},ue={class:"flex flex-column gap-16px"},he={class:"flex flex-column gap-16px mt-48px"},ge={class:"flex flex-column gap-12px"},_e={class:"flex align-center gap-8px"},fe={class:"flex gap-4px min-w-150px align-center"},pe={key:0,class:"w-calc-50p-40px wide-tablet_w-full"};function Se(e,s,h,g,t,n){const _=l("InputSwitch"),r=l("BaseParagraph"),S=l("RouterLink"),u=l("XPreloader"),w=l("InputText"),x=l("BaseHeading"),P=l("BaseButton"),V=l("BaseCard"),A=l("AdvancedSlaSettingsCard");return d(),m("div",ie,[a(V,{title:"Configure your SLA per severity level",class:Y(["wide-tablet_w-full",{"w-full":!e.$featureflags.enable_sla_task_creation,"w-calc-50p-40px":e.$featureflags.enable_sla_task_creation}])},{headerContent:i(()=>[c("div",le,[a(_,{modelValue:t.isEnabled,"onUpdate:modelValue":s[0]||(s[0]=k=>t.isEnabled=k),labelLeft:"Enable SLAs"},null,8,["modelValue"])])]),default:i(()=>[c("div",oe,[c("div",re,[c("div",ce,[a(r,null,{default:i(()=>[o(" Manage stakeholder expectations by setting a defined time period to fix vulnerabilities. ")]),_:1})]),a(r,null,{default:i(()=>[o(" Non-compliance with the SLA will be visible inside of the "),a(S,{class:"link",to:"/reports/audit-reports/external"},{default:i(()=>[o("customer-facing report")]),_:1}),o(". ")]),_:1})]),t.isLoading?(d(),m("div",de,[a(u,{class:"absolute-centered",theme:"transparent",size:"medium"})])):t.isEnabled?(d(),m(B,{key:1},[c("div",ue,[(d(!0),m(B,null,q(t.slaSettings,(k,f)=>(d(),m("div",{key:f,class:"flex align-center gap-8px"},[a(r,{class:"min-w-150px"},{default:i(()=>[o(v(n.getFieldLabel(k.issue_priority_level)),1)]),_:2},1024),a(w,{disabled:n.isFieldDisabled(t.slaSettings[f].duration_in_days),modelValue:t.slaSettings[f].duration_in_days,"onUpdate:modelValue":b=>t.slaSettings[f].duration_in_days=b,inputClass:"max-w-80px",type:"number"},null,8,["disabled","modelValue","onUpdate:modelValue"]),a(r,null,{default:i(()=>[o("days")]),_:1}),a(_,{onChange:b=>n.handleToggleSlaForPriority(b,f),modelValue:t.slaSettings[f].duration_in_days,"onUpdate:modelValue":b=>t.slaSettings[f].duration_in_days=b},null,8,["onChange","modelValue","onUpdate:modelValue"])]))),128))]),c("div",he,[c("div",ge,[a(x,{as:"h4",class:"flex justify-between w-full pb-16px border-bottom-1 border-carbon-20"},{default:i(()=>[o(" Define 'Due Soon' Status for Issues ")]),_:1}),a(r,null,{default:i(()=>[o(" Streamline your workflow by filtering issues that are close to their due date. Define the visibility threshold for the "),a(S,{class:"link",to:"/queue?filter=due_soon"},{default:i(()=>[o("SLA Due Soon view")]),_:1}),o(" by setting the number of days prior to the SLA deadline. ")]),_:1})]),c("div",_e,[c("div",fe,[a(r,null,{default:i(()=>[o("Days to Show Before Due")]),_:1})]),a(w,{modelValue:t.dueSoonThreshold,"onUpdate:modelValue":s[1]||(s[1]=k=>t.dueSoonThreshold=k),inputClass:"max-w-80px",type:"number"},null,8,["modelValue"]),a(r,null,{default:i(()=>[o("days")]),_:1})])]),a(P,{onClick:n.handleSaveSettings,size:"normal","is-loading":t.isSaving},{default:i(()=>[o("Save SLA")]),_:1},8,["onClick","is-loading"])],64)):T("",!0)])]),_:1},8,["class"]),n.shouldShowAdvancedSlaSettings?(d(),m("div",pe,[a(A,{notificationSettings:t.notificationSettings,onSettingsUpdated:n.fetchSlaSettings},null,8,["notificationSettings","onSettingsUpdated"])])):T("",!0)])}const we=y(ne,[["render",Se]]);export{we as default};
