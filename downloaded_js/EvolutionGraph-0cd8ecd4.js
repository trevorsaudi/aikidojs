import{_ as A,q as g,m,S as it,ah as I,p as _,n as p,s as R,u as D,r as O,F as Q,t as at,k as P,U as K,aQ as Z,o as T,a3 as Y,d as st}from"./index-13ff96f4.js";import{f as $}from"./dateFns-a344cb79.js";import{s as lt}from"./transform-c376ec3f.js";import{i as tt,l as ct}from"./linear-efb37b7f.js";class X extends Map{constructor(n,e=dt){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),n!=null)for(const[r,o]of n)this.set(r,o)}get(n){return super.get(U(this,n))}has(n){return super.has(U(this,n))}set(n,e){return super.set(ht(this,n),e)}delete(n){return super.delete(ut(this,n))}}function U({_intern:t,_key:n},e){const r=n(e);return t.has(r)?t.get(r):e}function ht({_intern:t,_key:n},e){const r=n(e);return t.has(r)?t.get(r):(t.set(r,e),e)}function ut({_intern:t,_key:n},e){const r=n(e);return t.has(r)&&(e=t.get(r),t.delete(r)),e}function dt(t){return t!==null&&typeof t=="object"?t.valueOf():t}function ft(t,n,e){t=+t,n=+n,e=(o=arguments.length)<2?(n=t,t=0,1):o<3?1:+e;for(var r=-1,o=Math.max(0,Math.ceil((n-t)/e))|0,a=new Array(o);++r<o;)a[r]=t+r*e;return a}function gt(t){return t}var B=1,z=2,N=3,W=4,q=1e-6;function mt(t){return"translate("+t+",0)"}function pt(t){return"translate(0,"+t+")"}function yt(t){return n=>+t(n)}function wt(t,n){return n=Math.max(0,t.bandwidth()-n*2)/2,t.round()&&(n=Math.round(n)),e=>+t(e)+n}function _t(){return!this.__axis}function et(t,n){var e=[],r=null,o=null,a=6,s=6,i=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,h=t===B||t===W?-1:1,f=t===W||t===z?"x":"y",d=t===B||t===N?mt:pt;function c(u){var y=r??(n.ticks?n.ticks.apply(n,e):n.domain()),k=o??(n.tickFormat?n.tickFormat.apply(n,e):gt),b=Math.max(a,0)+i,x=n.range(),M=+x[0]+l,L=+x[x.length-1]+l,V=(n.bandwidth?wt:yt)(n.copy(),l),F=u.selection?u.selection():u,C=F.selectAll(".domain").data([null]),w=F.selectAll(".tick").data(y,n).order(),j=w.exit(),H=w.enter().append("g").attr("class","tick"),E=w.select("line"),G=w.select("text");C=C.merge(C.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),w=w.merge(H),E=E.merge(H.append("line").attr("stroke","currentColor").attr(f+"2",h*a)),G=G.merge(H.append("text").attr("fill","currentColor").attr(f,h*b).attr("dy",t===B?"0em":t===N?"0.71em":"0.32em")),u!==F&&(C=C.transition(u),w=w.transition(u),E=E.transition(u),G=G.transition(u),j=j.transition(u).attr("opacity",q).attr("transform",function(v){return isFinite(v=V(v))?d(v+l):this.getAttribute("transform")}),H.attr("opacity",q).attr("transform",function(v){var S=this.parentNode.__axis;return d((S&&isFinite(S=S(v))?S:V(v))+l)})),j.remove(),C.attr("d",t===W||t===z?s?"M"+h*s+","+M+"H"+l+"V"+L+"H"+h*s:"M"+l+","+M+"V"+L:s?"M"+M+","+h*s+"V"+l+"H"+L+"V"+h*s:"M"+M+","+l+"H"+L),w.attr("opacity",1).attr("transform",function(v){return d(V(v)+l)}),E.attr(f+"2",h*a),G.attr(f,h*b).text(k),F.filter(_t).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===z?"start":t===W?"end":"middle"),F.each(function(){this.__axis=V})}return c.scale=function(u){return arguments.length?(n=u,c):n},c.ticks=function(){return e=Array.from(arguments),c},c.tickArguments=function(u){return arguments.length?(e=u==null?[]:Array.from(u),c):e.slice()},c.tickValues=function(u){return arguments.length?(r=u==null?null:Array.from(u),c):r&&r.slice()},c.tickFormat=function(u){return arguments.length?(o=u,c):o},c.tickSize=function(u){return arguments.length?(a=s=+u,c):a},c.tickSizeInner=function(u){return arguments.length?(a=+u,c):a},c.tickSizeOuter=function(u){return arguments.length?(s=+u,c):s},c.tickPadding=function(u){return arguments.length?(i=+u,c):i},c.offset=function(u){return arguments.length?(l=+u,c):l},c}function xt(t){return et(z,t)}function vt(t){return et(N,t)}const J=Symbol("implicit");function nt(){var t=new X,n=[],e=[],r=J;function o(a){let s=t.get(a);if(s===void 0){if(r!==J)return r;t.set(a,s=n.push(a)-1)}return e[s%e.length]}return o.domain=function(a){if(!arguments.length)return n.slice();n=[],t=new X;for(const s of a)t.has(s)||t.set(s,n.push(s)-1);return o},o.range=function(a){return arguments.length?(e=Array.from(a),o):e.slice()},o.unknown=function(a){return arguments.length?(r=a,o):r},o.copy=function(){return nt(n,e).unknown(r)},tt.apply(o,arguments),o}function rt(){var t=nt().unknown(void 0),n=t.domain,e=t.range,r=0,o=1,a,s,i=!1,l=0,h=0,f=.5;delete t.unknown;function d(){var c=n().length,u=o<r,y=u?o:r,k=u?r:o;a=(k-y)/Math.max(1,c-l+h*2),i&&(a=Math.floor(a)),y+=(k-y-a*(c-l))*f,s=a*(1-l),i&&(y=Math.round(y),s=Math.round(s));var b=ft(c).map(function(x){return y+a*x});return e(u?b.reverse():b)}return t.domain=function(c){return arguments.length?(n(c),d()):n()},t.range=function(c){return arguments.length?([r,o]=c,r=+r,o=+o,d()):[r,o]},t.rangeRound=function(c){return[r,o]=c,r=+r,o=+o,i=!0,d()},t.bandwidth=function(){return s},t.step=function(){return a},t.round=function(c){return arguments.length?(i=!!c,d()):i},t.padding=function(c){return arguments.length?(l=Math.min(1,h=+c),d()):l},t.paddingInner=function(c){return arguments.length?(l=Math.min(1,c),d()):l},t.paddingOuter=function(c){return arguments.length?(h=+c,d()):h},t.align=function(c){return arguments.length?(f=Math.max(0,Math.min(1,c)),d()):f},t.copy=function(){return rt(n(),[r,o]).round(i).paddingInner(l).paddingOuter(h).align(f)},tt.apply(d(),arguments)}const kt={props:{color:String,title:String,group:String},computed:{styles(){if(this.color.indexOf("#")>-1)return{background:this.color}},bgColorClass(){const t=["text"];for(const n of t)if(this.color.indexOf(n)==0)return this.color.replace(n,"bg");return""}}},bt={class:"graph-legend evolution-graph"},Dt={key:0,class:"text-gray-600 text-10px mt-4px"};function Ot(t,n,e,r,o,a){return g(),m("div",bt,[e.color?(g(),m("div",{key:0,class:it(["circle",`legend ${e.color} ${a.bgColorClass}`]),style:I(a.styles)},null,6)):_("",!0),p("div",null,[R(D(e.title)+" ",1),e.group?(g(),m("div",Dt,D(e.group),1)):_("",!0)])])}const ot=A(kt,[["render",Ot]]);function Mt(t,n){return t.reduce((e,r)=>((e[r[n]]=e[r[n]]||[]).push(r),e),{})}const Ct={props:{items:{type:Array,default:()=>[]},showAllOptions:{type:Boolean,default:!1}},components:{EvolutionGraphLegendItem:ot},computed:{visibleItems(){const t=[],n=Mt(this.items,"color");if(this.showAllOptions)return this.getAllItems(n);if(n.primaryColor){const e=n.primaryColor,r=e[0].title;t.push({color:"primaryColor",title:this.$t("OPTION_OR_X_OPTIONS_SELECTED",{firstOptionTitle:r,count:e.length})})}return n.secondaryColor&&t.push({color:"secondaryColor",title:n.secondaryColor[0].title}),t}},methods:{getAllItems(t){const n=[];for(const[e,r]of Object.entries(t))for(const o of r)n.find(s=>s.color==e&&s.title==o.title)||n.push({color:e,title:o.title});return n}}},Tt={class:"flex flex-wrap"};function Ft(t,n,e,r,o,a){const s=O("EvolutionGraphLegendItem");return g(),m("div",Tt,[(g(!0),m(Q,null,at(a.visibleItems,(i,l)=>(g(),P(s,{key:`legend_${l}`,class:"mr-20px last_mr-0",color:i.color,title:i.title},null,8,["color","title"]))),128))])}const Et=A(Ct,[["render",Ft]]),Gt={data(){return{tooltip:{show:!1,data:{},style:{}}}},methods:{showTooltip(t,n,e){this.tooltip.show=!0,this.tooltip.data=t,this.setTooltipPosition(n,e)},hideTooltip(){this.tooltip.show=!1},setTooltipPosition(t,n){if(!this.$refs.tooltip)return;const e=window.innerHeight-this.$refs.tooltip.offsetHeight-25,r=window.innerWidth-this.$refs.tooltip.offsetWidth-25,o={};n>e?o.top=e+"px":o.top=n+"px",t>r?o.left=r+"px":o.left=t+"px",this.tooltip.style=o}}},It={props:{chartOptions:Object,everythingDataGraph:Object,showLegend:{type:Boolean,default:!1},showTotal:{type:Boolean,default:!1}},mixins:[Gt],components:{EvolutionGraphLegendItem:ot},computed:{showDataForEverything(){return!(!this.showLegend||!this.tooltip.data||!this.everythingDataGraph||this.tooltip.data.title===this.everythingDataGraph.title)},valueForEverythingDataForSelectedMonth(){if(!this.showDataForEverything)return 0;const{month:t,year:n,week:e}=this.tooltip.data;for(const r of this.everythingDataGraph.data)if(r.week==e&&r.month==t&&r.year==n)return r.stats.current;return 0},title(){return this.tooltip.show?this.tooltip.data.day?$(this.tooltip.data.date,"MMMM do","MMMM do yyyy"):this.tooltip.data.week?`Week ${parseInt(this.tooltip.data.week)} - ${this.tooltip.data.year}`:$(this.tooltip.data.date,"MMMM","MMMM yyyy"):""}},methods:{formatMonthWithoutCurrentYear:$}},$t={key:0},At={class:"bg-gray-50 text-gray-900 text--semi-bold px-16px py-10px rounded-t-4px"},Lt={class:"px-16px py-10px"},Vt={class:"flex"},Ht={class:"text-gray-900 text--semi-bold"},St={key:0,class:"flex mt-8px"},Wt={class:"text-gray-900 text--semi-bold"},zt={key:1,class:"flex mt-8px"},Pt={class:"text-gray-900 text--semi-bold"};function jt(t,n,e,r,o,a){const s=O("EvolutionGraphLegendItem");return K((g(),m("div",{class:"chart-tooltip-base text-12px leading-none",ref:"tooltip",style:I(t.tooltip.style)},[t.tooltip.data?(g(),m("div",$t,[p("div",At,[e.showLegend?(g(),m(Q,{key:0},[R(D(e.chartOptions.measure_title)+" - ",1)],64)):_("",!0),R(" "+D(a.title),1)]),p("div",Lt,[p("div",Vt,[e.showLegend?(g(),P(s,{key:0,class:"flex-1 mr-32px",color:t.tooltip.data.color,title:t.tooltip.data.title,group:t.tooltip.data.group},null,8,["color","title","group"])):(g(),P(s,{key:1,class:"flex-1 mr-32px",color:"primaryColor",title:e.chartOptions.measure_title},null,8,["title"])),p("div",Ht,D(e.chartOptions.formatValue(t.tooltip.data.current)),1)]),t.tooltip.data.total&&e.showTotal?(g(),m("div",St,[T(s,{class:"flex-1 mr-32px",color:"secondaryColor",title:e.chartOptions.measure_title.toLowerCase()},null,8,["title"]),p("div",Wt,D(e.chartOptions.formatValue(t.tooltip.data.total)),1)])):_("",!0),a.showDataForEverything&&a.valueForEverythingDataForSelectedMonth?(g(),m("div",zt,[T(s,{class:"flex-1 mr-32px",color:e.everythingDataGraph.color,title:e.everythingDataGraph.title,group:e.everythingDataGraph.group},null,8,["color","title","group"]),p("div",Pt,D(e.chartOptions.formatValue(a.valueForEverythingDataForSelectedMonth)),1)])):_("",!0)])])):_("",!0)],4)),[[Z,t.tooltip.show]])}const Bt=A(It,[["render",jt]]);function Rt({rootElement:t,containerWidth:n,containerHeight:e,graphData:r,margin:o,chartOptions:a,showTooltip:s,hideTooltip:i}){const l=lt(t),h=n<600,f=n-o.left-o.right,d=e-o.top-o.bottom,{maxValue:c,allDates:u,infoByDateMap:y}=Xt({graphData:r,isMobile:h}),k=ct().range([0,d]).domain([0,c]),b=k.copy().range([d,0]),x=rt().range([0,f]).paddingInner(0).padding(0).domain(u),M=Yt({graphData:r,height:d,isMobile:h,getBarHeightInPxFromDataValue:k});Nt({$root:l,combinedGraphData:M,showTooltip:s,hideTooltip:i,xScaleBand:x}),Jt({$root:l,width:f,height:d,scaleForYAxis:b,xScaleBand:x,isMobile:h,formatValue:a.formatValue,infoByDateMap:y})}function Nt({$root:t,combinedGraphData:n,showTooltip:e,hideTooltip:r,xScaleBand:o}){let s=t.select(".bars").selectAll("rect").data(n,i=>i.id);s.exit().remove(),s.enter().append("rect").attr("class",i=>i.color).attr("fill",i=>i.fill).attr("stroke","#FFFFFF").attr("x",i=>o(i.date)).attr("y",i=>i.y).attr("width",o.bandwidth()).attr("height",i=>i.height).on("mouseover",(i,l)=>{e(l,i.clientX,i.clientY)}).on("mousemove",(i,l)=>{e(l,i.clientX,i.clientY)}).on("mouseout",()=>{r()}),s.attr("x",i=>o(i.date)).attr("y",i=>i.y).attr("width",o.bandwidth()).attr("height",i=>i.height)}function Yt({graphData:t,height:n,isMobile:e,getBarHeightInPxFromDataValue:r}){const o=[],a=qt(t);for(const s of t)for(const i of s.data){const l=i.stats.current;let h=r(l);0<h&&h<2&&(h=2);const f=a[`${i.year}-${i.month}-${i.day}-${i.week}`][s.stackIndex];let d=r(f);0<d&&d<2&&(d=2);const c=n-d-h,u=Y.fromUnix(i.timestamp).toJsDate();o.push({id:`${i.year}-${i.month}-${i.day}-${i.week}-${s.stackIndex}`,color:s.color,fill:s.fill,title:s.title,group:s.group,date:u,year:i.year,month:i.month,day:i.day,week:i.week,current:l,total:i.total,y:c,height:h})}return e?Ut(o):o}function Xt({graphData:t,isMobile:n}){const e=[];let r=0;const o={},a={},s=new Date(new Date().setFullYear(new Date().getFullYear()-1));for(const i of t)for(const l of i.data){const h=Y.fromUnix(l.timestamp).toJsDate();n&&h<=s||(e.push(h),o[h]=l,a[h]=a[h]||[],a[h].push(l))}for(const i of Object.values(a)){let l=0;for(const h of i)l+=h.stats.current;l>r&&(r=l)}return r=r*1.1,{maxValue:r,allDates:e,infoByDateMap:o}}function Ut(t){const n=new Date(new Date().setFullYear(new Date().getFullYear()-1));return t.filter(e=>e.date>n)}function qt(t){const n={},e={};for(const r of t)for(const o of r.data){const a=`${o.year}-${o.month}-${o.day}-${o.week}`;n[a]||(n[a]={}),e[a]||(e[a]=0),n[a][r.stackIndex]=e[a],r.stackIndex>-1&&(e[a]+=o.stats.current)}return n}function Jt({$root:t,width:n,height:e,xScaleBand:r,scaleForYAxis:o,isMobile:a,formatValue:s,infoByDateMap:i}){t.select(".x-axis").attr("transform",`translate(0, ${e})`).call(vt(r).tickFormat(l=>Qt(l,i)).tickValues(r.domain().filter((l,h)=>{const f=r.domain()[0];let d=i[f].month%4,c=i[l].month;return i[l].week&&(c=i[l].week,d=i[f].week%4),i[l].day?r.domain().length<90?Zt(r.domain().length,h):i[l].day==1:a?h%4===0:(d=++d%4,c%4===d)}))),t.select(".y-axis").attr("transform",`translate(${n}, 0)`).call(xt(o).tickFormat(s))}function Qt(t,n){return n[t].week?`Week ${n[t].week}`:n[t].day?Kt(t,n):$(t)}function Kt(t,n){if(Object.values(n).length>=95)return $(t);const e=new Date(t);return Y.fromDate(e).format("dd MMM yyyy")}function Zt(t,n){let e=Math.floor(t/10);e==0&&(e=1);const r=Math.floor((t-e)/3);return n%r===e}const te={props:{graphData:{type:Array,default:()=>[]},chartOptions:{type:Object,default(){return{object:"",formatValue:t=>t}}},margin:Object,containerWidth:Number,containerHeight:Number},watch:{graphData(){this.renderChart()},containerWidth(){this.renderChart()}},methods:{async renderChart(){this.graphData.length&&(await this.$nextTick(),Rt({rootElement:this.$refs.chart,containerWidth:this.containerWidth,containerHeight:this.containerHeight,graphData:this.graphData,margin:this.margin,chartOptions:this.chartOptions,showTooltip:(t,n,e)=>{this.$emit("showTooltip",{item:t,x:n,y:e})},hideTooltip:()=>{this.$emit("hideTooltip")}}))}}},ee=["width","height"],ne=["transform"],re=p("g",{class:"bars"},null,-1),oe=p("g",{class:"x-axis"},null,-1),ie=p("g",{class:"y-axis"},null,-1),ae=[re,oe,ie];function se(t,n,e,r,o,a){return g(),m("svg",{width:e.containerWidth,height:e.containerHeight},[p("g",{ref:"chart",class:"container",transform:`translate(${e.margin.left}, ${e.margin.top})`},ae,8,ne)],8,ee)}const le=A(te,[["render",se]]),ce={components:{EvolutionGraphLegend:Et,EvolutionGraphTooltip:Bt,EvolutionGraphChart:le,BasePill:st},props:{everythingDataGraph:Object,graphData:Array,chartOptions:Object,smallerChart:{type:Boolean,default:!1},chartDataLoading:Boolean,hideLegend:Boolean,customMargin:{type:Object,default:null}},data(){return{margin:this.customMargin||{top:10,right:80,bottom:(this.smallerChart,20),left:0},containerWidth:700,containerHeight:this.smallerChart?200:500}},watch:{smallerChart(){this.margin.bottom=(this.smallerChart,20),this.containerHeight=this.smallerChart?200:500}},computed:{hasMultipleRows(){return this.graphData.length>1}},mounted(){window.addEventListener("resize",this.onResize),this.onResize()},beforeDestroy(){window.removeEventListener("resize",this.onResize)},methods:{onResize(){this.containerWidth=this.$refs.container.offsetWidth||700,this.containerHeight=this.smallerChart?200:500},showTooltip({item:t,x:n,y:e}){this.$refs.tooltip&&this.$refs.tooltip.showTooltip(t,n,e)},hideTooltip(){this.$refs.tooltip&&this.$refs.tooltip.hideTooltip()}}},he={ref:"container",class:"chart__container evolution-graph"},ue={class:"absolute-centered"};function de(t,n,e,r,o,a){const s=O("EvolutionGraphLegend"),i=O("XPreloader"),l=O("EvolutionGraphChart"),h=O("BasePill"),f=O("EvolutionGraphTooltip");return g(),m("div",he,[e.hideLegend?_("",!0):(g(),P(s,{key:0,class:"justify-end",style:I({marginRight:`${o.margin.right}px`}),items:e.graphData,showAllOptions:!0},null,8,["style","items"])),e.chartDataLoading?(g(),m("div",{key:1,style:I({height:o.containerHeight+"px",width:o.containerWidth+"px"})},[T(i,{class:"absolute-centered",size:"medium"})],4)):_("",!0),K(T(l,{graphData:e.graphData,chartOptions:e.chartOptions,margin:o.margin,containerHeight:o.containerHeight,containerWidth:o.containerWidth,onShowTooltip:a.showTooltip,onHideTooltip:a.hideTooltip},null,8,["graphData","chartOptions","margin","containerHeight","containerWidth","onShowTooltip","onHideTooltip"]),[[Z,!e.chartDataLoading&&this.graphData.length]]),!e.chartDataLoading&&!this.graphData.length?(g(),m("div",{key:2,style:I({height:o.containerHeight+"px",width:o.containerWidth+"px"})},[p("div",ue,[T(h,{variation:"gray-fill",title:"No Severity Selected"})])],4)):_("",!0),T(f,{ref:"tooltip",chartOptions:e.chartOptions,showLegend:!0,showTotal:a.hasMultipleRows,everythingDataGraph:e.everythingDataGraph},null,8,["chartOptions","showTotal","everythingDataGraph"])],512)}const ye=A(ce,[["render",de]]);export{ye as E,vt as a,rt as b,xt as c,Et as d,Bt as e};
