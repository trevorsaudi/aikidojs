import{_ as k,B as g,r as a,q as s,m as i,k as l,p as h,F as y,n as x,w as r,o as c,s as u,u as _,t as M,M as L,f as $,H as N,al as j,gC as P,a0 as v}from"./index-13ff96f4.js";import{G as T}from"./GreenCheckMarkRoundedIcon-3695986c.js";const E={props:{status:String},components:{BaseParagraph:g,GreenCheckMarkRoundedIcon:T},computed:{}},O={key:1,class:"flex min-w-20px justify-center"},R=x("i",{class:"icon icon-12px icon-close text-surface-red-100 icon--bold"},null,-1),H=[R];function K(t,m,n,f,p,e){const o=a("GreenCheckMarkRoundedIcon");return s(),i(y,null,[n.status=="succeeded"?(s(),l(o,{key:0,width:20,class:"min-w-20px"})):h("",!0),n.status=="failed"?(s(),i("div",O,H)):h("",!0)],64)}const S=k(E,[["render",K]]),W={props:{attempt:Object},components:{BaseParagraph:g,StatusIcon:S},computed:{path(){return`${new URL(this.attempt.url).pathname}`},status(){return this.attempt.status_code>199&&this.attempt.status_code<300?"failed":"succeeded"}}};function F(t,m,n,f,p,e){const o=a("StatusIcon"),d=a("BaseParagraph");return s(),l(d,{class:"flex align-center gap-8px"},{default:r(()=>[c(o,{status:e.status},null,8,["status"]),u(" path: "+_(e.path)+" - status code: "+_(n.attempt.status_code),1)]),_:1})}const D=k(W,[["render",F]]),J={props:{metadata:Object},components:{BaseParagraph:g,StatusIcon:S},computed:{status(){return this.metadata.sessionStorageKey||this.metadata.localStorageKey?"failed":"succeeded"},storageKey(){return this.metadata.sessionStorageKey||this.metadata.localStorageKey||"unknown"}}},U={key:0},G={key:1};function V(t,m,n,f,p,e){const o=a("StatusIcon"),d=a("BaseParagraph");return s(),l(d,{class:"flex align-center gap-8px"},{default:r(()=>[c(o,{status:e.status},null,8,["status"]),e.status==="succeeded"?(s(),i("span",U,"Token was not found in browser storage")):h("",!0),e.status==="failed"?(s(),i("span",G,[u("Token was found in local browser storage under key: "),x("b",null,_(e.storageKey),1)])):h("",!0)]),_:1})}const q=k(J,[["render",V]]),Y={props:{metadata:Object},components:{BaseParagraph:g,StatusIcon:S},computed:{cookieName(){var t;return(t=this.metadata.cookie)!=null&&t.name?`Cookie '${this.metadata.cookie.name}'`:"Cookie"},isHttpOnlyCookie(){var t;return!!((t=this.metadata.result)!=null&&t.isHttpOnly)},isSecureCookie(){var t;return!!((t=this.metadata.result)!=null&&t.isSecure)}}};function z(t,m,n,f,p,e){const o=a("StatusIcon"),d=a("BaseParagraph");return s(),i(y,null,[c(d,{class:"flex align-center gap-8px"},{default:r(()=>[c(o,{status:e.isHttpOnlyCookie?"succeeded":"failed"},null,8,["status"]),u(" "+_(e.cookieName)+" is HttpOnly ",1)]),_:1}),c(d,{class:"flex align-center gap-8px"},{default:r(()=>[c(o,{status:e.isSecureCookie?"succeeded":"failed"},null,8,["status"]),u(" "+_(e.cookieName)+" is secured ",1)]),_:1})],64)}const Q=k(Y,[["render",z]]),X={props:{metadata:Object,status:String},components:{BaseParagraph:g,StatusIcon:S},computed:{label(){return this.status==="succeeded"?`${this.cookieName} is properly scoped to domain`:`${this.cookieName} is too loosely scoped to domain`},cookieName(){var t;return(t=this.metadata.cookie)!=null&&t.name?`Cookie '${this.metadata.cookie.name}'`:"Cookie"}}};function Z(t,m,n,f,p,e){const o=a("StatusIcon"),d=a("BaseParagraph");return s(),l(d,{class:"flex align-center gap-8px"},{default:r(()=>[c(o,{status:n.status},null,8,["status"]),u(" "+_(e.label),1)]),_:1})}const ee=k(X,[["render",Z]]),te={props:{log:Object,ruleId:String},components:{AuthenticatedCheckUrlAttempt:D,CredentialsInBrowserStorageAttempt:q,SecureSessionCookieAttempt:Q,LooselyScopedCookieAttempt:ee,BaseParagraph:g,StatusIcon:S},computed:{checkStatus(){return this.log.metadata.status==="failed"?"failed":"succeeded"},isApplicable(){return this.log.metadata.applicable},isNotApplicableText(){return this.isApplicable?null:["aik_dast_jwt_weak_secret","aik_dast_jwt_none_algorithm_accepted","aik_dast_invalid_jwt_accepted","aik_dast_self_provided_jwk_accepted"].includes(this.ruleId)?"This domain does not make use of JWT's for its sessions":["aik_dast_loosely_scoped_cookie","aik_dast_session_cookie_secured","aik_dast_credentials_in_browser_storage"].includes(this.ruleId)?"This domain does not use cookies to store session information":"This rule is not applicable to this domain"},isWeakSecretAttempt(){return this.ruleId==="aik_dast_jwt_weak_secret"},isCredentialsInBrowserStorageAttempt(){return["aik_dast_credentials_in_browser_storage"].includes(this.ruleId)},isSecureCookieAttempt(){return["aik_dast_session_cookie_secured"].includes(this.ruleId)},isLooselyScopedCookieAttempt(){return["aik_dast_loosely_scoped_cookie"].includes(this.ruleId)},domainName(){const t=new URL(this.log.domain_name);return`${t.protocol}//${t.host}`}}},se={class:"flex flex-column gap-8px"},ae={class:"flex flex-column gap-8px"},oe={key:0},ne={key:1};function re(t,m,n,f,p,e){const o=a("BaseParagraph"),d=a("StatusIcon"),C=a("CredentialsInBrowserStorageAttempt"),A=a("SecureSessionCookieAttempt"),w=a("LooselyScopedCookieAttempt"),B=a("AuthenticatedCheckUrlAttempt");return s(),i("div",se,[c(o,{bold:""},{default:r(()=>[u(_(e.domainName),1)]),_:1}),x("div",ae,[e.isApplicable?(s(),i(y,{key:1},[e.isWeakSecretAttempt?(s(),l(o,{key:0,class:"flex align-center gap-8px"},{default:r(()=>[c(d,{status:e.checkStatus},null,8,["status"]),e.checkStatus==="succeeded"?(s(),i("span",oe,"Secret is not one of 3502 known weak JWT signing keys secrets")):(s(),i("span",ne,"Secret is one of 3502 known weak JWT signing keys secrets"))]),_:1})):h("",!0),e.isCredentialsInBrowserStorageAttempt?(s(),l(C,{key:1,metadata:n.log.metadata},null,8,["metadata"])):h("",!0),e.isSecureCookieAttempt?(s(),l(A,{key:2,metadata:n.log.metadata},null,8,["metadata"])):h("",!0),e.isLooselyScopedCookieAttempt?(s(),l(w,{key:3,metadata:n.log.metadata,status:e.checkStatus},null,8,["metadata","status"])):(s(!0),i(y,{key:4},M(n.log.metadata.attempts,(I,b)=>(s(),l(B,{key:b,attempt:I},null,8,["attempt"]))),128))],64)):(s(),l(o,{key:0,color:"subdued"},{default:r(()=>[u(_(e.isNotApplicableText),1)]),_:1}))])])}const ce=k(te,[["render",re]]),ie={components:{AuthenticatedCheckAttemptLog:ce,BaseModal:L,BaseButton:$,BaseHeading:N,BaseParagraph:g,LoadingSpinner:j},emits:["close"],props:{ruleId:String,title:String},data(){return{attemptLogs:[],isLoading:!0,errorMessage:null}},async mounted(){await this.loadData(),this.isLoading=!1},computed:{hasApiErrorMessage(){return!!this.errorMessage},hasNoAttemptsErrorMessage(){return!this.isLoading&&this.attemptLogs.length===0},hasErrorMessage(){return this.hasApiErrorMessage||this.hasNoAttemptsErrorMessage},error(){return this.errorMessage?this.errorMessage:this.hasNoAttemptsErrorMessage?"We did not scan your authenticated domains yet. Start a scan manually and wait for it to complete.":null},domainIdFilter(){return this.$route.params.domainId?this.$route.params.domainId:null}},methods:{async loadData(){try{this.attemptLogs=await P(this.ruleId,this.domainIdFilter,{disable_toasts:!0})}catch(t){if(v.isAxiosError(t)&&t.response.status==404){this.errorMessage="You did not yet configure authentication for any of your domains.";return}this.errorMessage="An unknown error occured."}},handleCloseModal(){this.$emit("close")}}},de={class:"flex flex-column gap-24px"},le={class:"flex flex-column gap-12px"},ue={key:0,class:"flex flex-1 justify-center py-16px"},_e={key:1,class:"flex px-24px"},pe={key:2,class:"flex flex-column gap-12px"};function me(t,m,n,f,p,e){const o=a("BaseParagraph"),d=a("BaseHeading"),C=a("LoadingSpinner"),A=a("AuthenticatedCheckAttemptLog"),w=a("BaseButton"),B=a("BaseModal");return s(),l(B,{width:600,onClose:e.handleCloseModal,"allow-background-close":!1},{header:r(()=>[c(o,{color:"gray"},{default:r(()=>[u("Authenticated Check Attempts")]),_:1})]),content:r(()=>[x("div",de,[x("div",le,[c(d,{as:"h3"},{default:r(()=>[u(_(n.title),1)]),_:1}),c(o,null,{default:r(()=>[u("See which attempts we made to verify this rule. We replayed requests to the endpoints listed below with an adjusted token.")]),_:1}),p.isLoading?(s(),i("div",ue,[c(C,{width:24,height:24,color:"#6551F3",backgroundColor:"#E0DCFD"})])):e.hasErrorMessage?(s(),i("div",_e,[c(o,{color:"subdued",class:"py-16px text-center"},{default:r(()=>[u(_(e.error),1)]),_:1})])):(s(),i("div",pe,[(s(!0),i(y,null,M(p.attemptLogs,(I,b)=>(s(),l(A,{key:b,log:I,"rule-id":n.ruleId},null,8,["log","rule-id"]))),128))]))])])]),footer:r(()=>[c(w,{onClicked:e.handleCloseModal,class:"ml-auto"},{default:r(()=>[u("OK")]),_:1},8,["onClicked"])]),_:1},8,["onClose"])}const ge=k(ie,[["render",me]]);export{ge as default};
