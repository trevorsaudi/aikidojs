import{_ as y,a2 as I,d as x,B as v,z as w,r,q as m,m as _,n as a,o as i,w as l,s as c,u as h,k as A,S as C,p as T,ai as P,ah as L,g as B,au as S,X as N,A as k,hd as O,em as E,an as M,F as R,t as V}from"./index-13ff96f4.js";import{I as F}from"./InputMultiSelect-21584437.js";import{j as U,a as z}from"./string-814c5ffd.js";import{a as W}from"./dateFns-a344cb79.js";import"./ActionMenu-3e4470bf.js";import"./InputCheckbox-81cb3ca6.js";import"./index-b87db690.js";const j={components:{XTooltip:I,BasePill:x,BaseParagraph:v,InputSwitch:w},props:{list:{type:Object,required:!0},subscribed:{type:Boolean,required:!0},onToggle:{type:Function,required:!0}},methods:{getFormattedLastScannedAtTimestampForTables:W,handleToggleClick(){this.onToggle(this.list.value)}}},q={class:"flex flex-column gap-2px"},X={class:"flex justify-between"},D={class:"flex align-center gap-8px"},K={key:0},$={class:"flex align-center gap-8px"},H={class:"flex align-center gap-4px"},G=["src"],J={class:"flex align-center gap-4px"},Q=["src"];function Y(s,t,e,g,u,o){const n=r("BaseParagraph"),d=r("BasePill"),b=r("XTooltip"),f=r("InputSwitch");return m(),_("div",q,[a("div",X,[a("div",D,[i(n,{bold:"",color:e.list.disabled?"light-gray":"black"},{default:l(()=>[c(h(e.list.label),1)]),_:1},8,["color"]),e.list.disabled?(m(),_("div",K,[e.list.disabled?(m(),A(d,{key:0,onClick:e.list.disabledAction.handleAction,icon:e.list.disabledAction.planIcon,variation:e.list.disabledAction.planVariation,size:"compact",title:e.list.disabledAction.text,class:C({"cursor-pointer":!0,"text-secondary-dev-120":!0})},null,8,["onClick","icon","variation","title"])):T("",!0),i(b,null,{default:l(()=>[c(h(e.list.disabledTooltip),1)]),_:1})])):T("",!0)]),i(f,{disabled:e.list.disabled,modelValue:e.subscribed,onClick:t[0]||(t[0]=P(()=>{},["stop"])),"onUpdate:modelValue":o.handleToggleClick,small:""},null,8,["disabled","modelValue","onUpdate:modelValue"])]),a("div",$,[a("div",H,[a("img",{src:"/assets/icons/ip.svg",height:"10",class:"text-carbon-60",style:L({opacity:e.list.disabled?"0.5":"1"})},null,12,G),i(n,{size:"small","semi-bold":"",color:e.list.disabled?"light-gray":"gray"},{default:l(()=>[c(h(e.list.amount)+" total IPs ",1)]),_:1},8,["color"])]),a("div",J,[a("img",{src:"/assets/icons/refresh.svg",height:"10",class:"text-carbon-60",style:L({opacity:e.list.disabled?"0.5":"1"})},null,12,Q),i(n,{size:"small","semi-bold":"",color:e.list.disabled?"light-gray":"gray"},{default:l(()=>[c(" Last update "+h(o.getFormattedLastScannedAtTimestampForTables(e.list.lastUpdatedAt)),1)]),_:1},8,["color"]),i(b,null,{default:l(()=>[c("Updates every 15 minutes")]),_:1})])]),i(n,{size:"small",color:e.list.disabled?"light-gray":"subdued"},{default:l(()=>[c(h(e.list.description),1)]),_:1},8,["color"])])}const Z=y(j,[["render",Y]]),tt={components:{BaseLink:B,KnownThreatActorList:Z,BaseParagraph:v,InputSwitch:w,BaseConfirmModal:S,InputMultiSelect:F,XPreloader:N},emits:["close"],props:{serviceId:{type:String,required:!0}},data(){return{modalWidth:1e3,isLoadingLists:!1,selectedListIds:[],lists:[],disableSubmit:!1}},async mounted(){await this.init()},computed:{listOptions(){const s=this.getPlan();return this.lists.map(t=>{if(t.plans.includes(s))return t;const e=this.getPlanName(t.plans[0]),g=U(t.plans.map(d=>this.getPlanName(d))),u=z(t.plans.map(d=>this.getPlanName(d)));let o="icon-starter",n="neon-green";return t.plans[0]==="pro"&&(o="icon-pro",n="purple"),{...t,disabled:!0,disabledTooltip:`${t.label} is available on ${g} plan, click to upgrade.`,disabledAction:{handleAction:()=>{this.$modal.show("UpgradeAccountModal",{title:`${t.label} is available on ${g} plan`,msg:`Upgrade now to ${u} plan to block these known threat actors.`})},text:`${e} plan`,planIcon:o,planVariation:n}}})}},methods:{getPlan(){return k.isPayingProAndNotTrial()?"pro":k.isPayingAndNoProTrial()?"standard":"free"},getPlanName(s){switch(s){case"pro":return"Pro";case"standard":return"Basic";default:return"Free"}},async init(){await this.$nextTick(),await Promise.all([this.loadLists()])},async loadLists(){this.isLoadingLists=!0;const s=await O(this.serviceId);for(const t of s)this.lists.push({value:t.id,label:t.name,plans:t.plans,code:t.code,amount:t.amount_of_ips,description:t.description,lastUpdatedAt:t.last_updated_at}),t.subscribed&&this.selectedListIds.push(t.id);this.isLoadingLists=!1},async submit(){this.disableSubmit=!0,await E({serviceId:this.serviceId,type:"block",subscriptions:this.selectedListIds,source:"known_threat_actors"}),this.$toast.success("Successfully blocked known threat actors, it might take up to a minute to take effect."),M.emit("runtime.lists.ip.updated"),this.$emit("close")},handleToggleClick(s){this.selectedListIds.includes(s)?this.selectedListIds=this.selectedListIds.filter(t=>t!==s):this.selectedListIds.push(s)}}},et={class:"flex align-center py-32px gap-8px"},st=["src"],at={class:"flex flex-column gap-8px"},it=a("hr",{class:"divider my-8px"},null,-1);function lt(s,t,e,g,u,o){const n=r("BaseParagraph"),d=r("BaseLink"),b=r("KnownThreatActorList"),f=r("BaseConfirmModal");return m(),A(f,{title:s.$t("RUNTIME_PROTECTION.FIREWALL.THREAT_ACTORS.MODAL.TITLE"),description:s.$t("RUNTIME_PROTECTION.FIREWALL.THREAT_ACTORS.MODAL.DESC"),buttonSubmitText:"Block Threat Actors",disableSubmit:u.disableSubmit,onSubmit:o.submit,onClose:t[0]||(t[0]=p=>s.$emit("close")),onSecondaryButtonClicked:t[1]||(t[1]=p=>s.$emit("close")),width:u.modalWidth,allowBackgroundClose:!1},{bottomLeftContent:l(()=>[a("div",et,[i(n,{color:"subdued",size:"tiny"},{default:l(()=>[c("Collaboration with")]),_:1}),i(d,{href:"https://www.crowdsec.net?utm_source=aikido",target:"_blank",rel:"noreferrer noopener"},{default:l(()=>[a("img",{src:"/assets/icons/crowdsec.svg",class:"valign-middle",height:"32",alt:"CrowdSec"},null,8,st)]),_:1})])]),default:l(()=>[a("div",null,[a("ul",at,[(m(!0),_(R,null,V(o.listOptions,p=>(m(),_("li",{key:p.value},[i(b,{list:p,subscribed:u.selectedListIds.includes(p.value),onToggle:o.handleToggleClick},null,8,["list","subscribed","onToggle"]),it]))),128))])])]),_:1},8,["title","description","disableSubmit","onSubmit","width"])}const pt=y(tt,[["render",lt]]);export{pt as default};
