import{_ as v,M as A,g as D,B as F,f as E,H as N,d3 as R,r as c,q as a,k as y,w as o,o as l,s as p,m as n,F as b,t as M,u as g,n as _,S as m,p as h,ai as q,al as T,d4 as O,c6 as P,d5 as V,d6 as H,an as U,d7 as j}from"./index-13ff96f4.js";import{R as z}from"./RadioButtonList-1d4cdaad.js";import $ from"./EnableIntegrationModal-48b01f56.js";const G={components:{BaseModal:A,BaseLink:D,BaseParagraph:F,BaseButton:E,BaseHeading:N},props:{showModal:Boolean,groupedIssueId:Number,filterRepoId:{type:[Number,String],default:void 0}},data(){return{prsByRepo:{},loaded:!1}},watch:{showModal(){this.loaded||this.loadScanIdsWithPullRequestFix()}},computed:{scmTypeIcon(){return this.$group.scm_type==="bitbucket"?"icon-bitbucket":this.$group.scm_type==="azure_devops"?"icon-azure":this.$group.scm_type==="gitlab"||this.$group.scm_type==="gitlab_server"?"icon-Gitlab":"icon-github"},scansHavingFixByPrUrl(){const e={};for(const t of this.scansHavingFix)t.latest_ci_info.pull_request_url&&(e[t.latest_ci_info.pull_request_url]=t.scan_id);return e}},methods:{async loadScanIdsWithPullRequestFix(){this.prsByRepo=await R(this.groupedIssueId,this.filterRepoId),this.loaded=!0},closeModal(){this.$emit("update:showModal",!1)}}},W={key:0,class:"text-center"},X={key:1,class:"flex flex-column gap-16px"},Y={key:0,class:"flex align-center flex-wrap"},J={class:"valign-middle ml-4px inline-block truncate max-w-500px"},K={key:0,class:"valign-middle ml-4px inline-block"},Q={key:0,class:"flex text-carbon-100"},Z=_("span",{class:"mx-8px flex align-center"},"â€¢",-1),ee=_("div",null,"Verified by Aikido",-1),te={key:1},se=_("i",{class:"icon text-primary-aik-140 text--normal valign-middle icon-gh_pr"},null,-1),ae={class:"valign-middle ml-4px inline-block truncate max-w-500px"};function oe(e,t,i,x,r,s){const f=c("BaseParagraph"),u=c("BaseHeading"),I=c("XPreloader"),k=c("BaseLink"),w=c("BaseIcon"),S=c("BaseButton"),C=c("BaseModal");return i.showModal?(a(),y(C,{key:0,width:"auto","max-width":"80%",onClose:s.closeModal,allowBackgroundClose:!1},{header:o(()=>[l(f,{color:"gray"},{default:o(()=>[p("Issue fixes")]),_:1})]),content:o(()=>[l(u,{as:"h3"},{default:o(()=>[p("Pull request related to this issue")]),_:1}),r.loaded?(a(),n("div",X,[(a(!0),n(b,null,M(r.prsByRepo,(B,L)=>(a(),n("div",{key:`repo_${L}`},[l(u,{as:"h5",class:"text--normal mb-8px"},{default:o(()=>[p(g(B[0].repo_name),1)]),_:2},1024),(a(!0),n(b,null,M(B,d=>(a(),n("div",{key:d.pr_url||d.diffs_url,class:"flex gap-4px align-center flex-wrap"},[d.pr_url?(a(),n("div",Y,[l(k,{href:d.pr_url,target:"_blank",class:"inline-block align-center max-w-full py-6px"},{default:o(()=>[_("i",{class:m(["icon text-primary-aik-140 text--normal valign-middle",s.scmTypeIcon])},null,2),_("span",J,g(d.title),1),d.pull_request_number?(a(),n("span",K," #"+g(d.pull_request_number),1)):h("",!0)]),_:2},1032,["href"]),d.diffs_url?(a(),n("span",Q,[Z,l(k,{class:"flex ml-4px gap-4px",href:d.diffs_url,onClick:t[0]||(t[0]=q(()=>{},["stop"])),target:"_blank"},{default:o(()=>[l(w,{icon:"icon-tick-circle",class:"text-green-100 flex"}),ee]),_:2},1032,["href"])])):h("",!0)])):(a(),n("div",te,[l(k,{href:d.diffs_url,target:"_blank",class:"inline-block align-center max-w-full py-6px"},{default:o(()=>[se,_("span",ae,g(d.title),1)]),_:2},1032,["href"])]))]))),128))]))),128))])):(a(),n("div",W,[l(I,{size:"medium"})]))]),footer:o(()=>[l(S,{onClicked:s.closeModal,size:"small",variation:"tertiary",class:"ml-auto"},{default:o(()=>[p("Close")]),_:1},8,["onClicked"])]),_:1},8,["onClose"])):h("",!0)}const ne=v(G,[["render",oe]]),ie={components:{IssueFixesModal:ne},props:{groupedIssue:Object,singleIssue:Object,filterRepoId:{type:[Number,String],default:void 0},rootClass:{type:String,default:""}},data(){return{showFixesModal:!1}},computed:{issue(){return this.singleIssue?this.singleIssue:this.groupedIssue},statusData(){switch(this.issue.enhanced_status){case"snoozed":return{color:"gray",icon:"icon-snooze"};case"ignored":return{color:"gray",icon:"icon-hidden"};case"auto-ignored":return{color:"gray"};case"closed":return{color:"green",icon:"icon-shield_check"};case"task_open":return{color:"blue"};case"task_closed":return{color:"blue"};case"pull_request_open":return{color:"blue-140",icon:"icon-gh_pr"};case"todo":case"open":return{color:"gray-dark"};case"new":return{color:"purple"};case"autofix_preview_available":return{color:"blue-20"};default:return{color:"gray"}}},canOpenPreview(){return!(this.issue.enhanced_status!="autofix_preview_available"||!this.issue.preview_task_id||this.issue.preview_task_id<1)},clickable(){return!!(!this.singleIssue&&this.issue.enhanced_status==="pull_request_open"||["task_open","task_closed"].includes(this.issue.enhanced_status)||this.canOpenPreview)}},methods:{onItemClicked(e){if(e.stopPropagation(),["task_open","task_closed"].includes(this.issue.enhanced_status)){this.$router.replace({path:this.$route.path,query:{...this.$route.query,sidebarIssue:this.groupedIssue.id,sidebarTab:"tasks"}});return}if(this.canOpenPreview){this.$modal.show("AutofixDiffsModal",{taskId:this.issue.preview_task_id,usesVsCode:this.$user.ide_types.includes("vscode")});return}this.showFixesModal=!0}}},le={class:"valign-middle"},re={class:"valign-middle"};function ce(e,t,i,x,r,s){const f=c("IssueFixesModal");return a(),n(b,null,[s.clickable?(a(),n("span",{key:0,onClick:t[0]||(t[0]=(...u)=>s.onItemClicked&&s.onItemClicked(...u)),class:m(["cursor-pointer",i.rootClass])},[_("span",{class:m(["status-tag",s.statusData.color])},[_("span",le,g(e.$t(`STATUSTAG_${s.issue.enhanced_status}`)),1),s.statusData.icon?(a(),n("i",{key:0,class:m(["icon icon-8px valign-middle ml-4px",s.statusData.icon])},null,2)):h("",!0)],2)],2)):(a(),n("span",{key:1,class:m(["status-tag",[s.statusData.color,i.rootClass]])},[_("span",re,g(e.$t(`STATUSTAG_${s.issue.enhanced_status}`)),1),s.statusData.icon?(a(),n("i",{key:0,class:m(["icon icon-8px valign-middle ml-4px",s.statusData.icon])},null,2)):h("",!0)],2)),l(f,{showModal:r.showFixesModal,"onUpdate:showModal":t[1]||(t[1]=u=>r.showFixesModal=u),groupedIssueId:i.groupedIssue.id,filterRepoId:i.filterRepoId},null,8,["showModal","groupedIssueId","filterRepoId"])],64)}const be=v(ie,[["render",ce]]),ue={props:{issue:Object,packageName:String},components:{BaseModal:A,BaseParagraph:F,RadioButtonList:z,BaseButton:E,LoadingSpinner:T},emits:["cancel","integrationDisabled"],data(){return{options:[],selectedSolutionId:null,isLoading:!0,error:null,isConfirming:!1}},async mounted(){var e,t;try{const i=await O(this.issue.id,{disable_toasts:!0});this.options=i.options,this.options.length>0&&(this.selectedSolutionId=this.options[0].id)}catch(i){i instanceof P.AxiosError?this.error=((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.reason_phrase)??"An unknown error occured, please try again later":this.error="An unknown error occured, please try again later"}finally{this.isLoading=!1}},computed:{showError(){return this.isLoading===!1&&this.error!==null},showOptions(){return this.isLoading===!1&&this.error===null},showEmptyState(){return this.isLoading===!1&&this.error===null&&this.options.length===0}},methods:{handleCancel(){this.$emit("cancel")},handleConfirm(){const e=this.options.find(t=>t.id===this.selectedSolutionId);this.selectedSolutionId==="fix_prototype_pollution"?this.handleInstallDependency("nopp","latest"):this.selectedSolutionId==="update_parent"?this.handleParentUpdate(e):this.selectedSolutionId.startsWith("fix_sast_")?this.handleFixSastAi(this.selectedSolutionId):this.handlePatchPackage(e)},handleInstallDependency(e,t){const i={issueId:this.issue.id,pkg:e,version:t,action:"install"};this.handleStartAutoFix(i)},handleParentUpdate(e){const t={issueId:this.issue.id,pkg:this.packageName,version:e.version,action:"update_parent"};this.handleStartAutoFix(t)},handlePatchPackage(e){const t={issueId:this.issue.id,pkg:this.packageName,version:e.version,action:"patch"};this.handleStartAutoFix(t)},handleFixSastAi(e){const t={issueId:this.issue.id,preview:e=="fix_sast_preview",action:"fix_sast_ai"};this.handleStartAutoFix(t)},async handleStartAutoFix(e){this.isConfirming=!0;try{const x=(await(e.preview===!0?V:H)(e.issueId,e.action,e.pkg,e.version,e.preview)).task_id;U.emit(j,{task_id:x,type:"started",message:"Creating isolated sandbox for this Autofix. This can take about 15 seconds",event:0,metadata:{package:this.packageName??e.pkg,action:e.action,version:e.version??"latest",preview:e.preview}}),this.$emit("cancel")}catch(t){t instanceof P.AxiosError&&t.response.status===403&&this.$emit("integrationDisabled")}finally{this.isConfirming=!1}}}},de={class:"flex flex-column gap-16px"},pe={key:0,class:"flex align-center flex-column text-center justify-center flex-1 py-32px gap-8px"},he={key:1,class:"flex align-center flex-column text-center justify-center flex-1 py-32px gap-8px"},_e=_("i",{class:"icon icon icon-critical text-34px text-color-danger"},null,-1),fe={key:2,class:"flex align-center flex-column text-center justify-center flex-1 py-32px gap-8px"};function ge(e,t,i,x,r,s){const f=c("BaseHeading"),u=c("BaseParagraph"),I=c("LoadingSpinner"),k=c("RadioButtonList"),w=c("BaseButton"),S=c("BaseModal");return a(),y(S,{width:800,onClose:s.handleCancel,allowBackgroundClose:!1},{header:o(()=>[l(f,{as:"h3"},{default:o(()=>[p("Create autofix PR")]),_:1})]),content:o(()=>[_("div",de,[l(u,null,{default:o(()=>[p(" Below you can find the different ways that Aikido can automatically resolve this issue for you by creating pull requests in the repository. ")]),_:1}),r.isLoading?(a(),n("div",pe,[l(I,{width:40,height:40}),l(u,null,{default:o(()=>[p("Checking for appropriate solutions")]),_:1})])):h("",!0),s.showError?(a(),n("div",he,[_e,l(u,{color:"danger"},{default:o(()=>[p(g(r.error),1)]),_:1})])):h("",!0),s.showEmptyState?(a(),n("div",fe,[l(u,{color:"warning",bold:""},{default:o(()=>[p("No solutions found. A patch might not be available yet.")]),_:1})])):h("",!0),s.showOptions?(a(),y(k,{key:3,class:"max-h-300px scroll-y-auto",modelValue:r.selectedSolutionId,"onUpdate:modelValue":t[0]||(t[0]=C=>r.selectedSolutionId=C),options:r.options},null,8,["modelValue","options"])):h("",!0)])]),footer:o(()=>[l(w,{onClicked:s.handleCancel,variation:"plain",class:"ml-auto"},{default:o(()=>[p("Cancel")]),_:1},8,["onClicked"]),l(w,{onClicked:s.handleConfirm,disabled:r.selectedSolutionId===null,isLoading:r.isConfirming},{default:o(()=>[p("Create Autofix")]),_:1},8,["onClicked","disabled","isLoading"])]),_:1},8,["onClose"])}const me=v(ue,[["render",ge]]),xe={props:{issue:{type:Object},packageName:String},emits:["cancel"],components:{SelectSolutionModal:me,EnableIntegrationModal:$},data(){return{showSelectSolutionModal:!0,showEnableIntegrationModal:!1}},methods:{handleCancel(){this.$emit("cancel")},handleShowEnableAutofixIntegration(){this.showSelectSolutionModal=!1,this.showEnableIntegrationModal=!0}}};function ke(e,t,i,x,r,s){const f=c("SelectSolutionModal"),u=c("EnableIntegrationModal");return a(),n(b,null,[r.showSelectSolutionModal?(a(),y(f,{key:0,issue:i.issue,"package-name":i.packageName,onCancel:s.handleCancel,onIntegrationDisabled:s.handleShowEnableAutofixIntegration},null,8,["issue","package-name","onCancel","onIntegrationDisabled"])):h("",!0),r.showEnableIntegrationModal?(a(),y(u,{key:1,onCancel:t[0]||(t[0]=I=>this.showEnableIntegrationModal=!1)})):h("",!0)],64)}const ve=v(xe,[["render",ke]]);export{ve as C,be as I};
