import{P as I}from"./PageHeader-46c38a32.js";import{X as E}from"./XTabs-d492da26.js";import{_ as R,e as N,X as V,d as b,h as u,d_ as A,an as r,dZ as C,A as B,O,r as s,k as v,m as P,o as n,w as o,n as l,F as U,q as m,p as w,s as k}from"./index-13ff96f4.js";import{R as F}from"./RuntimeServiceActions-b7c4daa9.js";import{F as M}from"./FilterButton-bb5393a7.js";import"./ActionMenu-3e4470bf.js";function x(e){return e.charAt(0).toUpperCase()+e.slice(1)}const y={components:{FilterButton:M,RuntimeServiceActions:F,BaseIconButton:N,XPreloader:V,PageHeader:I,XTabs:E,BasePill:b},data(){return{tab:this.$route.name,tabs:[{title:this.$t("RUNTIME_PROTECTION.TABS.EVENTS"),id:"runtimeEvents"},{title:this.$t("RUNTIME_PROTECTION.TABS.FIREWALL"),id:"runtimeFirewall"},{title:this.$t("RUNTIME_PROTECTION.TABS.ENDPOINTS"),id:"runtimeEndpoints"},{title:this.$t("RUNTIME_PROTECTION.TABS.USERS"),id:"runtimeUsers"},{title:this.$t("RUNTIME_PROTECTION.TABS.INSTANCES"),id:"runtimeInstances"},{title:this.$t("RUNTIME_PROTECTION.TABS.HOSTNAMES"),id:"runtimeHostnames"},{title:this.$t("RUNTIME_PROTECTION.TABS.STATS"),id:"runtimeStats"}],loading:!0,services:[],latestVersions:this.latestVersions}},async mounted(){if(this.$route.path==="/runtime"){this.$router.push("/runtime/services");return}this.activateRuntimeFeature(),this.services=await u(),this.latestVersions=await A(),this.loading=!1},created(){r.on("runtime.service.added",this.refreshServices),r.on("runtime.service.updated",this.refreshServices),r.on("runtime.service.deleted",this.refreshServices)},beforeUnmount(){r.off("runtime.service.added",this.refreshServices),r.off("runtime.service.updated",this.refreshServices),r.off("runtime.service.deleted",this.refreshServices)},watch:{async"$route.path"(){this.$route.name==="runtimeEvents"&&(this.tab="runtimeEvents"),this.$route.name==="runtimeStats"&&(this.tab="runtimeStats"),this.$route.name==="runtimeEndpoints"&&(this.tab="runtimeEndpoints"),this.$route.name==="runtimeHostnames"&&(this.tab="runtimeHostnames"),this.$route.name==="runtimeUsers"&&(this.tab="runtimeUsers"),this.$route.name==="runtimeInstances"&&(this.tab="runtimeInstances"),this.$route.name==="runtimeFirewall"&&(this.tab="runtimeFirewall"),this.services=await u()}},computed:{title(){return this.service?this.service.name:""},service(){const e=this.$route.params.serviceId;return this.services.find(a=>String(a.id)===String(e))},subtitle(){return this.service?x(this.service.environment):this.service},agentVersion(){var a,c;if((c=(a=this.service)==null?void 0:a.agent)!=null&&c.version)return this.service.agent.version;const e=this.latestVersions.find(h=>{var i;return h.runtime===((i=this.service)==null?void 0:i.runtime)});return e==null?void 0:e.version},isOutdated(){return this.service&&this.service.agent&&this.service.agent.version!==this.service.agent.latest_version}},methods:{async refreshServices(){this.services=await u()},onTabClicked(e){e==="runtimeEvents"&&this.$router.push(`/runtime/services/${this.$route.params.serviceId}/events/`),e==="runtimeStats"&&this.$router.push(`/runtime/services/${this.$route.params.serviceId}/stats`),e==="runtimeEndpoints"&&this.$router.push(`/runtime/services/${this.$route.params.serviceId}/endpoints`),e==="runtimeHostnames"&&this.$router.push(`/runtime/services/${this.$route.params.serviceId}/hostnames`),e==="runtimeUsers"&&this.$router.push(`/runtime/services/${this.$route.params.serviceId}/users`),e==="runtimeInstances"&&this.$router.push(`/runtime/services/${this.$route.params.serviceId}/instances`),e==="runtimeFirewall"&&this.$router.push(`/runtime/services/${this.$route.params.serviceId}/firewall`)},async activateRuntimeFeature(){this.$group&&(this.$featureflags.enable_rasp||(await C(),B.fetchGroup(),this.$group.is_demo_group||O("firewall_activated")))},handleAgentVersionClick(){this.service&&this.$modal.show("RuntimeUpdateInstructionsModal",{serviceId:this.service.id})}}},H={class:"flex gap-8px"},X=l("i",{class:"icon icon-caret_down icon-12px"},null,-1),L={class:"page-content"};function D(e,a,c,h,i,t){const f=s("XPreloader"),d=s("BasePill"),p=s("FilterButton"),_=s("RuntimeServiceActions"),T=s("XTabs"),g=s("PageHeader"),$=s("router-view");return i.loading?(m(),v(f,{key:0,class:"supercenter",theme:"transparent"})):(m(),P(U,{key:1},[n(g,{title:t.title},{subTitle:o(()=>[l("div",H,[n(d,{title:t.subtitle,variation:"green"},null,8,["title"]),t.agentVersion?(m(),v(d,{key:0,class:"cursor-pointer",title:t.isOutdated?`Version ${t.agentVersion} Â· Upgrade`:`Version ${t.agentVersion}`,variation:t.isOutdated?"orange":"gray-fill",onClick:t.handleAgentVersionClick},null,8,["title","variation","onClick"])):w("",!0)])]),footerRightContent:o(()=>[n(_,{service:t.service,redirectAfterDelete:""},{trigger:o(S=>[n(p,{onClick:()=>S.toggle()},{default:o(()=>[k(" Actions "),X]),_:2},1032,["onClick"])]),_:1},8,["service"])]),tabs:o(()=>[n(T,{class:"page-tabs",tabs:i.tabs,modelValue:i.tab,"onUpdate:modelValue":t.onTabClicked},null,8,["tabs","modelValue","onUpdate:modelValue"])]),_:1},8,["title"]),l("div",L,[n($)])],64))}const J=R(y,[["render",D]]);export{J as default};
