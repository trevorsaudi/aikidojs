import{_ as k,eB as E,eA as N,V as O,f as b,a3 as p,cc as A,r,k as C,w as c,q as u,o,n as s,u as a,s as i,m as D,p as I}from"./index-13ff96f4.js";import{u as x,a as R}from"./azureDevops-98ef9f6d.js";import{O as S}from"./OnboardingProgressIndicator-8fa4a42d.js";const V={components:{OnboardingPage:E,OnboardingSection:N,OnboardingProgressIndicator:S,InputText:O,BaseButton:b},data(){return{accessToken:void 0,isUpdateingToken:!1,personalAccessToken:null,externalDirectLink:null,isLoading:!0}},async mounted(){var e;if(((e=this.$group)==null?void 0:e.scm_type)!="azure_devops"){this.$toast.error("This page is only available for Azure Devops workspaces."),this.$router.push("/settings");return}await this.getAccountInfo(),this.isLoading=!1},computed:{inputIsValid(){return!!this.accessToken&&this.accessToken.trim()!==""},personalAccessTokenDetails(){if(!this.personalAccessToken)return;const e=p.fromUnix(this.personalAccessToken.last_updated_at).format(p.US_FRIENDLY_DATE_WITH_TIME);return!this.personalAccessToken||this.personalAccessToken.last_updated_by_id<1?`Last updated at ${e}`:`Last updated by ${this.personalAccessToken.last_updated_by_name} at ${e}`}},methods:{async handleUpdate(){if(this.isUpdateingToken=!0,!await this.handleShouldContinueUpdate()){this.isUpdateingToken=!1;return}try{await x(this.accessToken),go("/"),this.isUpdateingToken=!1}catch(t){throw this.isUpdateingToken=!1,t}},async handleShouldContinueUpdate(){const{accessible_repos_difference:e,repos_not_accessible_anymore:t}=await R(this.accessToken);return e==0||e>0||(await this.$modal.show("UpdateAzureDevopsServerTokenConfirmationModal",{difference:e,reposNotAccessibleAnymore:t})).type=="saved"},async getAccountInfo(){const e=await A();this.personalAccessToken=e.personal_access_token??null,e.scm_org_base_url&&(this.externalDirectLink=e.scm_org_base_url+"/_usersSettings/tokens")}}},y=s("img",{class:"",src:"https://cdn.aikido.dev/assets/logo-white.svg?v=2",width:"180"},null,-1),U={class:"onboarding__title mb-36px mt-64px text-white"},v={class:"onboarding__paragraph onboarding__paragraph--size-large text-carbon-20"},B={class:"onboarding__title text-primary-aik-140 mb-8px"},w={class:"onboarding__paragraph onboarding__paragraph--size-medium text-carbon-60"},L=s("br",null,null,-1),P=s("a",{class:"link",href:"https://help.aikido.dev/en/articles/7155730-how-to-connect-your-azure-devops-projects-to-aikido",target:"_BLANK"},"read our guide",-1),z={class:"mb-16px mt-32px gap-32px flex flex-column"},$={class:"flex gap-12px flex-column"},G={class:"flex w-full justify-between"},Z=["href"],M=s("i",{class:"icon icon-openLink icon-12px text--normal"},null,-1),j={class:"onboarding__title text-primary-aik-140"},K={class:"flex mt-auto gap-16px justify-end"};function q(e,t,h,F,n,l){const g=r("OnboardingProgressIndicator"),d=r("OnboardingSection"),_=r("InputText"),m=r("BaseButton"),T=r("OnboardingPage");return u(),C(T,null,{default:c(()=>[o(d,{"align-content":"bottom",theme:"dark",class:"onboarding__section__content"},{default:c(()=>[y,s("h1",U,a(e.$t("ONBOARDING.AZURE_DEVOPS.CONNECT_SERVER.TITLE")),1),s("p",v,a(e.$t("ONBOARDING.AZURE_DEVOPS.CONNECT_SERVER.DESCRIPTION")),1),o(g,{"number-of-completed-steps":1,"number-of-steps":1})]),_:1}),o(d,{"is-loading":n.isLoading,"align-content":"top",theme:"light",class:"onboarding__section__content"},{default:c(()=>[s("h4",B,a(e.$t("ONBOARDING.AZURE_DEVOPS.CONNECT_SERVER.CONNECT.TITLE")),1),s("p",w,[i(a(e.$t("ONBOARDING.AZURE_DEVOPS.CONNECT_SERVER.CONNECT.DESCRIPTION"))+" ",1),L,i("To learn where you can find this information, "),P,i(". ")]),s("div",z,[o(_,{disabled:"",modelValue:e.$group.name,name:"organization_name",class:"onboarding__input",placeholder:"ACME Dev Team",title:e.$t("ONBOARDING.AZURE_DEVOPS.CONNECT_SERVER.CONNECT.ORGANIZATION_NAME.LABEL")},null,8,["modelValue","title"]),s("div",$,[o(_,{modelValue:n.accessToken,"onUpdate:modelValue":t[0]||(t[0]=f=>n.accessToken=f),name:"personal_access_token",class:"onboarding__input",placeholder:"accesstoken123"},{title:c(()=>[s("span",G,[i(a(e.$t("ONBOARDING.AZURE_DEVOPS.CONNECT_SERVER.CONNECT.ACCESS_TOKEN.LABEL"))+" ",1),n.externalDirectLink?(u(),D("a",{key:0,href:n.externalDirectLink,target:"_blank",class:"link flex gap-4px align-center mt-2px"},[i(" Generate Azure DevOps token here"),M],8,Z)):I("",!0)])]),_:1},8,["modelValue"]),s("h5",j,a(l.personalAccessTokenDetails),1)])]),s("div",K,[o(m,{onClicked:l.handleUpdate,size:"large",disabled:!l.inputIsValid,"is-loading":n.isUpdateingToken},{default:c(()=>[i("Update")]),_:1},8,["onClicked","disabled","is-loading"])])]),_:1},8,["is-loading"])]),_:1})}const J=k(V,[["render",q]]);export{J as default};
