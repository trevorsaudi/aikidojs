import{_ as f,cr as F,r as i,q as S,k as E,w as h,o as r,S as w,s as k,u as C,n as d,I as Q,cq as m,an as c,cs as U,m as L,c7 as R,F as b,cu as A}from"./index-13ff96f4.js";import{F as O}from"./FeedActionsMenu-6d8ea3a2.js";import{Q as q}from"./QueueTable-de6aabd1.js";import{Q as v}from"./QueueSidebar-47492277.js";import{Q as G}from"./QueueQuickFilter-70881bd4.js";import{F as x}from"./FilterButton-bb5393a7.js";import{A as B}from"./ActionMenu-3e4470bf.js";import{S as N}from"./SlaEmptyState-a5a9e243.js";import{s as P}from"./slaEmptyState-e877fc05.js";import{u as V}from"./useInfiniteScroll-47c60c9e.js";const M={components:{ActionMenu:B,FilterButton:x},props:{initialRelatedTypeFilter:String},data(){return{relatedTypeFilter:this.initialRelatedTypeFilter}},emits:["filterSelected"],computed:{label(){return this.relatedTypeFilter?this.$t("QUEUE.QUICK_FILTER.LABEL",{filter:this.$t(`QUEUE.FILTER.LABEL_SHORTHAND.${this.relatedTypeFilter}`)}):"All types"},actions(){return[{title:this.$t("QUEUE.TYPE_FILTER.TITLE"),action:{label:"Clear filter",onClick:()=>this.handleClearFilter()},items:[{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.OPEN_SOURCE_ISSUES"),onClick:()=>this.handleToggleTypeFilter("open_source"),icon:"icon-box",active:this.isActive("open_source")},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.SURFACE_MONITORING_ISSUES"),onClick:()=>this.handleToggleTypeFilter("surface_monitoring"),icon:"icon-group",active:this.isActive("surface_monitoring")},{label:this.$t("QUEUE.TYPE_FILTER.ACTIONS.EOL_ISSUES"),onClick:()=>this.handleToggleTypeFilter("eol"),icon:"icon-eol",active:this.isActive("eol")}]}]},hasFilter(){return!!this.relatedTypeFilter}},methods:{isActive(t){return this.relatedTypeFilter===t},handleClearFilter(){this.relatedTypeFilter=void 0,this.emitSelectedFilter()},handleToggleTypeFilter(t){this.relatedTypeFilter===t?this.relatedTypeFilter=void 0:this.relatedTypeFilter=t,this.emitSelectedFilter()},emitSelectedFilter(){this.$emit("filterSelected",{relatedType:this.relatedTypeFilter}),F({relatedTypeFilter:this.relatedTypeFilter})}}},z=d("i",{class:"icon icon-caret_down icon-12px"},null,-1);function D(t,n,a,u,s,e){const l=i("FilterButton"),o=i("ActionMenu");return S(),E(o,{sections:e.actions,placement:"bottom-start",useBaseIcon:!0},{trigger:h(p=>[r(l,{onClick:p.toggle,class:w({"filter-button--active":e.hasFilter})},{default:h(()=>[k(C(e.label)+" ",1),z]),_:2},1032,["onClick","class"])]),_:1},8,["sections"])}const Y=f(M,[["render",D]]),j={components:{QueueTable:q,QueueSidebar:v,InputSearch:Q,FeedActionsMenu:O,QueueQuickFilter:G,ContainerIssueTypeFilter:Y,SlaEmptyState:N},props:{cloudRepoId:{type:Number,required:!0},cloudRepo:{type:Object,default:null}},setup(){const t=async e=>{const l=await A(e);return e.quick_filter=="ignored"?l.map(o=>({...o,enhanced_status:"ignored"})):e.quick_filter=="closed"?l.map(o=>({...o,enhanced_status:"closed"})):l},{records:n,fetch:a,reset:u,watchElement:s}=V(t,25,e=>e);return{groupedIssues:n,fetchGroupedIssues:a,resetGroupedIssues:u,watchElement:s}},data(){return{isLoading:!0,showLoadingState:!0,searchTerm:m("search",""),filters:{quickFilter:m("filter",void 0)},issueTypeFilter:m("type_filter","")}},async mounted(){await Promise.all([this.loadGroupedIssues()]),this.showLoadingState=!1,await this.$nextTick(),this.watchElement(this.$refs.tableBottom,{threshold:0,rootMargin:"1000px"})},created(){c.on("issueUpdated",this.handleIssueUpdated),c.on("cloudRepoScanFinished",this.loadGroupedIssues)},beforeUnmount(){c.off("issueUpdated",this.handleIssueUpdated),c.off("cloudRepoScanFinished",this.loadGroupedIssues)},watch:{async cloudRepoId(){this.cloudRepoId&&(this.showLoadingState=!0,await Promise.all([this.loadGroupedIssues()]),this.showLoadingState=!1)}},computed:{showEmptyState(){return this.showLoadingState?!1:this.groupedIssues.length==0},hasActiveFilter(){return!!(this.searchTerm||this.issueTypeFilter||this.filters.quickFilter)},shouldUseSlaEmptyState(){return P(this.filters.quickFilter)}},methods:{async onItemSelected(t){U.replace({path:this.$route.path,query:{...this.$route.query,sidebarIssue:t.id}})},onSearchTermChanged(){this.loadGroupedIssues(),F({search:this.searchTerm})},async handleIssueUpdated(){await this.loadGroupedIssues()},async loadGroupedIssues(){this.isLoading=!0,await this.resetGroupedIssues({filter_cloud_repo_id:this.cloudRepoId,search_term:this.searchTerm,quick_filter:this.filters.quickFilter,issue_type_filter:this.issueTypeFilter}),this.isLoading=!1},async onQueueQuickFilterSelected(t){this.filters=t,this.showLoadingState=!0,await this.loadGroupedIssues(),this.showLoadingState=!1},async onIssueTypeFilterSelected(t){this.issueTypeFilter=t.relatedType,this.showLoadingState=!0,await this.loadGroupedIssues(),this.showLoadingState=!1}}},H={class:"flex align-center justify-between mb-16px"},K={class:"flex gap-8px align-center"},J={ref:"tableBottom"};function W(t,n,a,u,s,e){const l=i("InputSearch"),o=i("ContainerIssueTypeFilter"),p=i("QueueQuickFilter"),I=i("FeedActionsMenu"),_=i("SlaEmptyState"),y=i("QueueTable"),T=i("QueueSidebar");return S(),L(b,null,[d("div",H,[d("div",K,[r(l,{modelValue:s.searchTerm,"onUpdate:modelValue":[n[0]||(n[0]=g=>s.searchTerm=g),e.onSearchTermChanged],spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),r(o,{onFilterSelected:e.onIssueTypeFilterSelected,"initial-related-type-filter":s.issueTypeFilter},null,8,["onFilterSelected","initial-related-type-filter"]),r(p,{onFilterSelected:e.onQueueQuickFilterSelected,hideCriticalOption:!0,hideNewOption:!0,hideLanguageFilter:!0,hideAttackSurfaceFilters:!0,showSnoozedFilter:!0,"initial-filter":s.filters.quickFilter,persistFilterToQueryParams:!0},null,8,["onFilterSelected","initial-filter"])]),r(I,{container:a.cloudRepo,onRefresh:e.loadGroupedIssues},null,8,["container","onRefresh"])]),r(y,{onItemClicked:e.onItemSelected,groupedIssues:u.groupedIssues,isLoading:s.showLoadingState,filterImageId:a.cloudRepoId,quickFilter:s.filters.quickFilter,showEmptyState:e.showEmptyState,hasActiveFilter:e.hasActiveFilter},R({bottomContent:h(()=>[d("div",J,null,512)]),_:2},[e.shouldUseSlaEmptyState?{name:"emptyState",fn:h(()=>[r(_)]),key:"0"}:void 0]),1032,["onItemClicked","groupedIssues","isLoading","filterImageId","quickFilter","showEmptyState","hasActiveFilter"]),r(T,{groupedIssues:u.groupedIssues,filterCloudRepoId:a.cloudRepoId,showIgnoredOnly:s.filters.quickFilter==="ignored",showSnoozedOnly:s.filters.quickFilter==="snoozed",showClosedOnly:s.filters.quickFilter==="closed",filterOutOfSla:s.filters.quickFilter==="out_of_sla",filterDueSoon:s.filters.quickFilter==="due_soon"},null,8,["groupedIssues","filterCloudRepoId","showIgnoredOnly","showSnoozedOnly","showClosedOnly","filterOutOfSla","filterDueSoon"])],64)}const ae=f(j,[["render",W]]);export{ae as C};
