import{_ as k,r as a,q as i,k as h,w as n,o as s,n as l,a1 as O,m as v,t as y,F as x,B as N,d as q,al as V,d$ as H,an as I,e0 as U,e1 as D,p as g,s as p,S as C,u as E,ai as W}from"./index-13ff96f4.js";import{R as j}from"./RuntimeServicesEmptyState-4762d358.js";import{a as $,D as L}from"./DataTableCell-51c0104f.js";import{a as B,D as z}from"./DataTable-e31a825a.js";import{O as G}from"./OverviewEmptyState-c8440b9c.js";import{R as J}from"./RuntimeIllustration-4912df3a.js";import{_ as K}from"./ripples-df807ff5.js";import{a as Q}from"./dateFns-a344cb79.js";import{g as X,a as Y,b as Z}from"./event-11956904.js";import{I as ee}from"./InputFilterDropdown-674351d9.js";import{u as te}from"./useInfiniteScroll-47c60c9e.js";import{R as se}from"./RuntimeNoTokenCallout-f395432e.js";import{D as ne}from"./DataTableSeverityIndicator-48ffb8dc.js";import"./index-b87db690.js";import"./FilterButton-bb5393a7.js";import"./ActionMenu-3e4470bf.js";import"./BaseCallout-aea0aba4.js";const ae={emits:["viewInstructions"],components:{RuntimeIllustration:J,OverviewEmptyState:G},computed:{title(){return"Protect your apps at runtime"},description(){return"Waiting for first event..."},actionLabel(){return"View install instructions"}}},oe=l("div",{class:"mt-12px -mb-16px"},[l("img",{src:K,width:"30"})],-1);function ie(t,e,r,m,u,o){const f=a("RuntimeIllustration"),d=a("OverviewEmptyState");return i(),h(d,{title:o.title,description:o.description,actionLabel:o.actionLabel,variation:"empty",onOnAction:e[0]||(e[0]=b=>t.$emit("viewInstructions"))},{subdescription:n(()=>[oe]),default:n(()=>[s(f)]),_:1},8,["title","description","actionLabel"])}const re=k(ae,[["render",ie]]),le={components:{DataTableHeader:B,DataTableRow:$,DataTableCell:L,LoadingSkeleton:O}};function ce(t,e,r,m,u,o){const f=a("LoadingSkeleton"),d=a("DataTableCell"),b=a("DataTableRow");return i(),v(x,null,y(6,_=>s(b,{key:_},{default:n(()=>[s(d,null,{default:n(()=>[s(f,{height:"38px"})]),_:1}),s(d,null,{default:n(()=>[s(f,{height:"38px"})]),_:1}),s(d,null,{default:n(()=>[s(f,{height:"38px"})]),_:1})]),_:2},1024)),64)}const ue=k(le,[["render",ce]]),de={components:{RuntimeEventRowSkeleton:ue,BaseParagraph:N,BasePill:q,RuntimeEventsEmptyState:re,RuntimeServicesEmptyState:j,DataTable:z,DataTableCell:L,DataTableHeader:B,DataTableRow:$,InputFilterDropdown:ee,LoadingSpinner:V,RuntimeNoTokenCallout:se,DataTableSeverityIndicator:ne},setup(){const{records:t,fetch:e,reset:r,watchElement:m,isLoading:u}=te(D,50,o=>o);return{events:t,isFetchingRecords:u,listEventsInfScroll:e,reloadEventsInfScroll:r,watchElement:m}},data(){return{initialLoading:!0,cutOffTime:H(new Date),loading:!0,eventsAfterCutoff:[],page:0,service:void 0}},created(){I.on("runtime-event-captured",this.loadEventsAfterCutoffTime)},beforeUnmount(){I.off("runtime-event-captured",this.loadEventsAfterCutoffTime)},async mounted(){if(await this.$nextTick(),await this.loadService(),!this.service){this.$router.push("/runtime/services");return}this.$breadcrumbs.show({breadcrumbs:[{label:this.$t("RUNTIME_PROTECTION"),href:"/runtime"},{label:this.service.name}]}),this.watchElement(this.$refs.tableBottom,{threshold:0,rootMargin:"1000px"}),await this.loadEvents(),this.loading=!1},computed:{serviceId(){return this.$route.params.serviceId},shouldShowMissingEvents(){return!this.loading&&this.events.length===0&&this.eventsAfterCutoff.length==0},groupedEnrichedEvents(){const t=[];let e=null;for(const r of this.enrichedEvents){if(e&&e.type=="started"&&r.type=="started"&&e.service.id==r.service.id){e.subEvents||(e.subEvents=[]),e.subEvents.push(r);continue}e=r,t.push(r)}return t},enrichedEvents(){return[...this.eventsAfterCutoff,...this.events].map(e=>{const r=X(e);return{...e,title:Y(e),icon:`icon-${r.name} ${r.color}`,severity:Z(e),date_formatted:Q(e.received_at)}})},eventsFilters(){return{cutOffTime:this.cutOffTime,serviceId:this.serviceId,page:this.page}}},methods:{async addRuntimeService(){await this.$modal.show("AddRuntimeServiceModal")},viewInstructions(){this.$modal.show("RuntimeInstallInstructionsModal",{serviceId:this.serviceId})},showEventDetails(t){this.$modal.show("RuntimeEventDetailsModal",{event:t})},async loadService(){this.service=await U(this.serviceId)},async loadEvents(){await this.listEventsInfScroll(this.eventsFilters),this.initialLoading=!1},async loadEventsAfterCutoffTime(){const t={...this.eventsFilters,afterCutoff:!0};this.eventsAfterCutoff=await D(t)},howToEnableProtection(){var t;(t=this.service.agent)!=null&&t.serverless?this.$modal.show("HowToEnableRuntimeProtectModal"):this.$modal.show("EnableBlockingMode",{serviceId:this.service.id})},getDescription(t){var m,u;const e=[];return t.request.url||t.request.method?(t.request.method&&e.push({text:t.request.method}),t.request.url&&e.push({text:t.request.url,truncate:!0})):(u=(m=this.service)==null?void 0:m.agent)!=null&&u.serverless&&e.push({text:"Serverless"}),e.length>0&&e.push({text:"-"}),t.attack.operation?e.push({text:`via ${t.attack.operation}`}):t.attack.module&&e.push({text:`via ${t.attack.module}`}),e}}},me={class:"flex flex-column gap-16px"},pe={class:"flex align-center gap-16px justify-between w-full"},he={class:"flex flex-column gap-8px truncate"},fe={class:"flex flex-column gap-8px"},_e={class:"flex gap-8px align-center"},ve={key:0,class:"flex align-center gap-4px truncate"},ge={class:"flex gap-8px align-center"},be={colspan:"3"},we={ref:"tableBottom"},Ee={key:0,class:"data-table__bottom"},ye=l("hr",null,null,-1),xe={key:0,class:"flex align-center gap-8px"},ke=l("hr",null,null,-1);function Te(t,e,r,m,u,o){const f=a("RuntimeNoTokenCallout"),d=a("DataTableHeader"),b=a("RuntimeEventRowSkeleton"),_=a("BaseParagraph"),T=a("BasePill"),S=a("DataTableCell"),A=a("DataTableSeverityIndicator"),R=a("DataTableRow"),F=a("RuntimeEventsEmptyState"),P=a("DataTable"),M=a("LoadingSpinner");return i(),v("div",me,[l("div",null,[s(f,{serviceId:o.serviceId},null,8,["serviceId"]),s(P,null,{header:n(()=>[s(d,{width:"auto"},{default:n(()=>[p("Title")]),_:1}),s(d,{width:"100px",alignment:"center"},{default:n(()=>[p("Severity")]),_:1}),s(d,{width:"150px"},{default:n(()=>[p("Event Date")]),_:1})]),body:n(()=>[u.initialLoading?(i(),h(b,{key:0})):g("",!0),(i(!0),v(x,null,y(o.groupedEnrichedEvents,c=>(i(),h(R,{key:c.id,onClick:w=>o.showEventDetails(c),clickable:"",class:"text-blue-dark"},{default:n(()=>[s(S,{class:"py-8px"},{default:n(()=>[l("div",pe,[l("div",he,[l("div",fe,[l("div",_e,[l("i",{class:C([c.icon,"icon icon-12px valign-middle"])},null,2),s(_,{class:"truncate"},{default:n(()=>[p(E(c.title),1)]),_:2},1024),c.subEvents?(i(),h(T,{key:0,variation:"gray-fill",title:c.subEvents.length+1+" events"},null,8,["title"])):g("",!0)])]),c.type==="detected_attack"?(i(),v("div",ve,[(i(!0),v(x,null,y(o.getDescription(c),w=>(i(),h(_,{key:w.text,class:C(["ws-nowrap",{truncate:w.truncate}]),color:"subdued"},{default:n(()=>[p(E(w.text),1)]),_:2},1032,["class"]))),128))])):g("",!0)]),l("div",ge,[c.instance.dry_mode==1?(i(),h(T,{key:0,class:"cursor-pointer",title:"Enable blocking",variation:"purple",icon:"icon-shield_check",onClick:W(o.howToEnableProtection,["stop"])},null,8,["onClick"])):g("",!0)])])]),_:2},1024),s(A,{priority:c.severity.severity,noRiskLabel:"Info",noRiskColorClass:"text-carbon-60"},null,8,["priority"]),s(S,null,{default:n(()=>[s(_,null,{default:n(()=>[p(E(c.date_formatted),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o.shouldShowMissingEvents?(i(),h(R,{key:1},{default:n(()=>[l("td",be,[s(F,{onViewInstructions:o.viewInstructions},null,8,["onViewInstructions"])])]),_:1})):g("",!0)]),_:1}),l("div",we,[!u.loading&&!o.shouldShowMissingEvents?(i(),v("div",Ee,[ye,m.isFetchingRecords?(i(),v("div",xe,[s(M,{color:"#6551F3",backgroundColor:"#E0DCFD"}),s(_,{color:"gray"},{default:n(()=>[p("Hang on, we're fetching more events for you")]),_:1})])):(i(),h(_,{key:1,color:"gray"},{default:n(()=>[p("We have no more events to show")]),_:1})),ke])):g("",!0)],512)])])}const Ue=k(de,[["render",Te]]);export{Ue as default};
