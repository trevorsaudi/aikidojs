import{u as E}from"./useDastScanningProgress-93621d89.js";import{_ as v,B as N,a6 as P,e as M,a2 as V,d as F,r as i,q as m,k as g,w as n,o as t,n as u,s as c,u as p,p as S,m as D,ah as U,ai as B,a1 as G,t as C,F as x,f as q,g as z,I as j,an as y,b1 as H,A as W}from"./index-13ff96f4.js";import{D as Y,a as $}from"./DataTable-e31a825a.js";import{D as A,a as L}from"./DataTableCell-51c0104f.js";import{B as X}from"./BaseStatusLabel-0ccd2806.js";import{D as Q}from"./DataTableSeverityIndicator-48ffb8dc.js";import{D as K,h as J}from"./domainLimitations-8beef3a6.js";import{D as Z}from"./DataTableLastScanColumn-e155b78a.js";import{G as ee}from"./GenericIllustration-4aca88e5.js";import{O as te}from"./OverviewEmptyState-c8440b9c.js";import{I as ne}from"./InputFilterDropdown-674351d9.js";import"./ActionMenu-3e4470bf.js";import"./ScanFrequencySettingModal-9f206eb5.js";import"./BaseRadioInput-a7ac3557.js";import"./dateFns-a344cb79.js";import"./index-b87db690.js";import"./FilterButton-bb5393a7.js";const ae={props:{domain:Object},components:{DataTableCell:A,DataTableRow:L,BaseParagraph:N,RouterLink:P,BaseIconButton:M,DomainsActionMenu:K,BaseStatusLabel:X,XTooltip:V,BasePill:F,DataTableSeverityIndicator:Q,DataTableLastScanColumn:Z},setup(e){var a;const{scanningProgress:s}=E(-1,((a=e.domain)==null?void 0:a.domain_id)??-1);return{scanningProgress:s}},computed:{locationUrl(){return this.domain.scm_repo_id>0?`/repositories/${this.domain.scm_repo_id}?type=surface_monitoring`:this.domain.cloud_repo_id>0?`/container/${this.domain.cloud_repo_id}?type=surface_monitoring`:`/domain/${this.domain.domain_id}`},domainNames(){return this.domain.domain_name.split(",")},domainName(){return this.domainNames[0]??""},otherDomainNames(){return this.domainNames.length===1?!1:this.domainNames.slice(1)},href(){return this.domain.domain_id>0?`/domain/${this.domain.domain_id}`:this.locationUrl},isScanning(){var e;return((e=this.scanningProgress)==null?void 0:e.status)==="scanning"},scanningProgressValue(){var e;return(e=this.scanningProgress)==null?void 0:e.progress},scanType(){return this.domain.scan_type=="nuclei"?"Hosted":this.domain.scan_type=="akto"?"REST API":this.domain.scan_type=="akto_graphql"?"GraphQL":"Front-End"}},methods:{getCloudTypeIcon(e){switch(e){case"aws":return"icon-location_aws";case"azure":return"icon-azure";case"digocean":return"icon-digitalocean";case"gcp":return"icon-gcp"}return null},getRegistryKindIcon(e){return e=="docker-hub"?"icon-docker":e=="aws"?"icon-location_aws":e=="acr"?"icon-azure":e=="gitlab"||e=="gitlab-self"?"icon-Gitlab":e=="digitalocean"?"digitalocean-black":e=="scaleway"?"scaleway-black":e=="cloudsmith"?"cloudsmith-black":e=="artifactory"?"artifactory-black":e=="harbor"?"harbor-black":e=="quay"?"quay-black":e=="gcp-container-registry"?"icon-gcp":`icon-${e}`}}},oe={class:"flex flex-1 align-center gap-4px justify-between overflow-hidden"},ie={class:"ws-pre"},se={key:0},re=u("div",{class:"text--semi"},"Aikido will scan for known flaws in these technology stacks:",-1),le=u("div",{class:"shimmer shimmer--blue"},null,-1),de=[le];function ce(e,s,a,T,d,o){const r=i("XTooltip"),l=i("BaseParagraph"),h=i("BaseStatusLabel"),_=i("DataTableCell"),b=i("BasePill"),f=i("DataTableSeverityIndicator"),I=i("DataTableLastScanColumn"),w=i("BaseIconButton"),k=i("DomainsActionMenu"),O=i("DataTableRow");return m(),g(O,{clickable:!0,href:o.href},{default:n(()=>[t(_,null,{default:n(()=>[u("div",oe,[t(l,{truncate:""},{default:n(()=>[c(p(o.domainName)+" ",1),t(r,null,{default:n(()=>[c(p(o.domainName),1)]),_:1})]),_:1}),o.otherDomainNames?(m(),g(h,{key:0,class:"direction-ltr",size:"compact"},{default:n(()=>[c(p(e.$t("X_OTHERS",o.otherDomainNames.length))+" ",1),t(r,null,{default:n(()=>[u("span",ie,p(o.otherDomainNames.join(`
`)),1)]),_:1})]),_:1})):S("",!0)])]),_:1}),t(_,{class:"wide-tablet_hidden"},{default:n(()=>[t(l,{class:"flex align-center justify-between w-full"},{default:n(()=>[u("span",null,p(o.scanType),1),u("span",null,[a.domain.scan_type=="nuclei"?(m(),g(b,{key:0,variation:"gray-fill",class:"cursor-default"},{default:n(()=>[u("span",null,[c(p(a.domain.tag_groups[0])+" ",1),a.domain.tag_groups.length>1?(m(),D("span",se,"+"+p(a.domain.tag_groups.length-1),1)):S("",!0)]),t(r,{class:"ws-pre"},{default:n(()=>[re,c("• "+p(a.domain.tag_groups.join(`
• `)),1)]),_:1})]),_:1})):S("",!0)])]),_:1})]),_:1}),t(f,{priority:a.domain.max_issue_severity},null,8,["priority"]),t(_,{class:"wide-tablet_hidden"},{default:n(()=>[t(l,null,{default:n(()=>[c(p(a.domain.open_issue_count),1)]),_:1})]),_:1}),t(_,{class:"wide-tablet_hidden"},{default:n(()=>[t(l,null,{default:n(()=>[c(p(a.domain.ignored_issue_count),1)]),_:1})]),_:1}),t(_,null,{default:n(()=>[o.isScanning?(m(),D("div",{key:0,class:"loading-bar",style:U({width:`${o.scanningProgressValue}%`})},de,4)):(m(),g(I,{key:1,"last-scanned-at":a.domain.last_scanned_at},null,8,["last-scanned-at"]))]),_:1}),t(_,{spacing:"compact",alignment:"center"},{default:n(()=>[u("div",{class:"data-table__row__action-container increase--popover-trigger",onClick:s[1]||(s[1]=B(()=>e.$refs.trigger.click(),["prevent"]))},[t(k,{domain:a.domain},{trigger:n(R=>[t(w,{onClick:s[0]||(s[0]=B(()=>{},["prevent"])),icon:"icon-actions",onClicked:R.toggle,class:"data-table__row__action",ref:"trigger"},null,8,["onClicked"])]),_:1},8,["domain"])])]),_:1})]),_:1},8,["href"])}const me=v(ae,[["render",ce]]),ue={components:{DataTableRow:L,DataTableCell:A,LoadingSkeleton:G}};function _e(e,s,a,T,d,o){const r=i("LoadingSkeleton"),l=i("DataTableCell"),h=i("DataTableRow");return m(),D(x,null,C(5,_=>t(h,{key:_},{default:n(()=>[t(l,null,{default:n(()=>[t(r,{height:"18px"})]),_:1}),t(l,{class:"wide-tablet_hidden"},{default:n(()=>[t(r,{height:"18px"})]),_:1}),t(l,null,{default:n(()=>[t(r,{height:"18px"})]),_:1}),t(l,{class:"wide-tablet_hidden"},{default:n(()=>[t(r,{height:"18px"})]),_:1}),t(l,{class:"wide-tablet_hidden"},{default:n(()=>[t(r,{height:"18px"})]),_:1}),t(l,null,{default:n(()=>[t(r,{height:"18px"})]),_:1})]),_:2},1024)),64)}const pe=v(ue,[["render",_e]]),he={components:{DataTable:Y,DataTableHeader:$,DataTableRow:L,DomainOverviewTableRow:me,DomainOverviewTableRowLoading:pe,GenericIllustration:ee,OverviewEmptyState:te},emits:["update:sorting","addDomain"],props:{domains:{type:Array,required:!0},sorting:{type:Object,required:!0},isLoading:{type:Boolean,default:!1},isFiltering:{type:Boolean,default:!1}},computed:{emptyStateTitle(){return this.isFiltering?this.$t("DOMAIN_SETTINGS_OVERVIEW.EMPTY_STATE.FILTER.TITLE"):this.$t("DOMAIN_SETTINGS_OVERVIEW.EMPTY_STATE.TITLE")},emptyStateDescription(){return this.isFiltering?this.$t("DOMAIN_SETTINGS_OVERVIEW.EMPTY_STATE.FILTER.DESCRIPTION"):this.$t("DOMAIN_SETTINGS_OVERVIEW.EMPTY_STATE.DESCRIPTION")},actionLabel(){return this.$groupUser.only_team_related_issues?"":this.$t("DOMAIN_SETTINGS_OVERVIEW.EMPTY_STATE.ACTION_LABEL")}},methods:{handleChangeSorting(e){this.$emit("update:sorting",e)}}},fe={colspan:"7"};function ge(e,s,a,T,d,o){const r=i("DataTableHeader"),l=i("DomainOverviewTableRowLoading"),h=i("GenericIllustration"),_=i("OverviewEmptyState"),b=i("DataTableRow"),f=i("DomainOverviewTableRow"),I=i("DataTable");return m(),D("div",null,[t(I,null,{header:n(()=>[t(r,{width:"auto","sort-by":"domain_name",sorted:a.sorting.column==="domain_name",onSort:o.handleChangeSorting},{default:n(()=>[c(" Domain Name ")]),_:1},8,["sorted","onSort"]),t(r,{width:"200px"},{default:n(()=>[c("Type")]),_:1}),t(r,{width:"120px","sort-by":"max_issue_severity",sorted:a.sorting.column==="max_issue_severity",onSort:o.handleChangeSorting,class:"wide-tablet_hidden"},{default:n(()=>[c(" Severity ")]),_:1},8,["sorted","onSort"]),t(r,{width:"120px","sort-by":"open_issue_count",sorted:a.sorting.column==="open_issue_count",onSort:o.handleChangeSorting,"inverted-sorting":"",class:"wide-tablet_hidden"},{default:n(()=>[c(" Open ")]),_:1},8,["sorted","onSort"]),t(r,{width:"120px","sort-by":"ignored_issue_count",sorted:a.sorting.column==="ignored_issue_count",onSort:o.handleChangeSorting,class:"wide-tablet_hidden"},{default:n(()=>[c(" Ignored ")]),_:1},8,["sorted","onSort"]),t(r,{width:"115px"},{default:n(()=>[c("Last Scan")]),_:1}),t(r,{width:"48px",alignment:"center"})]),body:n(()=>[a.isLoading?(m(),g(l,{key:0})):a.domains.length==0?(m(),g(b,{key:1},{default:n(()=>[u("td",fe,[t(_,{title:o.emptyStateTitle,description:o.emptyStateDescription,actionLabel:o.actionLabel,variation:"empty",onOnAction:s[0]||(s[0]=w=>e.$emit("addDomain"))},{default:n(()=>[t(h)]),_:1},8,["title","description","actionLabel"])])]),_:1})):(m(!0),D(x,{key:2},C(a.domains,w=>(m(),g(f,{domain:w,key:w.id},null,8,["domain"]))),128))]),_:1})])}const Te=v(he,[["render",ge]]),ye={components:{BaseButton:q,BaseLink:z,InputSearch:j,DomainOverviewTable:Te,InputFilterDropdown:ne},data(){return{domains:[],isLoading:!0,search:"",sorting:{},sortBy:{},selectedDomainType:"all",domainTypesOptions:[{value:"all",label:"All Domains",default:!0},{value:"owasp-zap",label:"Front-End Apps"},{value:"akto",label:"Rest / GraphQL API"},{value:"nuclei",label:"Hosted Apps"}]}},setup(){const{addListener:e,removeListener:s}=E();return{addScanEventListener:e,removeScanEventListener:s}},created(){y.on("repositoryArchitectureConfigurationUpdated",this.loadDomains),y.on("domainScanFrequencyUpdated",this.loadDomains),y.on("domainAdded",this.loadDomains),this.addScanEventListener()},beforeUnmount(){y.off("repositoryArchitectureConfigurationUpdated",this.loadDomains),y.off("domainScanFrequencyUpdated",this.loadDomains),y.off("domainAdded",this.loadDomains),this.removeScanEventListener()},async mounted(){this.isLoading=!0,await this.loadDomains(),this.isLoading=!1},computed:{visibleDomains(){const s=this.domains.filter(a=>this.selectedDomainType=="all"?!0:a.scan_type.includes(this.selectedDomainType)).filter(a=>{const T=this.search.toLowerCase();return a.domain_name.toLowerCase().indexOf(T)>-1});return this.sortBy.column?s.sort((a,T)=>{const d=a[this.sortBy.column],o=T[this.sortBy.column],r=this.sortBy.desc?1:-1;if(typeof d=="string"){const l=d.toLowerCase(),h=o.toLowerCase();return r*l.localeCompare(h)}return r*(o-d)}):s},isFiltering(){return this.search!=""}},methods:{async loadDomains(){this.domains=await H()},async handleConnectDomain(){if(!this.$groupUser.can_manage_domains){this.$modal.show("InfoModal",{headerText:"Connect Domain",title:"You do not have permission to connect a new domain",description:"Contact your admin to connect a new domain.",buttonSubmitText:"Got It!"});return}if(W.data.group.is_demo_group===1)return this.$modal.show("AddWorkspaceRedirectModal");if(J(this.domains.length))return this.$modal.show("ResourceLimitReachedModal",{resourcesName:"domains"});const e=await this.$modal.show("DomainScanTypeSelectionModal");if(e.type!="saved")return;const s=e.value;(await this.$modal.show("RepositoryArchitectureConfigurationModal",{enforceInternetConnected:!0,scanType:s})).type=="saved"&&y.emit("domainAdded")},openInfoModal(){this.$modal.show("StaticIPInfoModal")},onSort(e){if(this.sorting=e,this.sortBy.column!=e.column){this.sortBy.column=e.column,this.sortBy.desc=!0;return}if(this.sortBy.desc===!0){this.sortBy.desc=!1;return}if(this.sortBy.desc===!1){this.sortBy={},this.sorting={};return}}}},De={class:"flex flex-column gap-16px"},be={class:"flex"},we=u("i",{class:"icon icon-information mr-8px"},null,-1),Se=u("p",{class:"text-underline"},"Aikido static IPs",-1),ve=u("i",{class:"icon icon-add"},null,-1);function Ie(e,s,a,T,d,o){const r=i("InputSearch"),l=i("InputFilterDropdown"),h=i("BaseLink"),_=i("BaseButton"),b=i("DomainOverviewTable");return m(),D("div",De,[u("div",be,[t(r,{modelValue:d.search,"onUpdate:modelValue":s[0]||(s[0]=f=>d.search=f),spacing:"compact"},null,8,["modelValue"]),t(l,{class:"ml-8px",modelValue:d.selectedDomainType,"onUpdate:modelValue":s[1]||(s[1]=f=>d.selectedDomainType=f),options:d.domainTypesOptions},null,8,["modelValue","options"]),t(h,{size:"small",onClick:o.openInfoModal,class:"ml-auto mr-16px plain-button flex align-center text--normal text-carbon-60"},{default:n(()=>[we,Se]),_:1},8,["onClick"]),e.$groupUser.only_team_related_issues?S("",!0):(m(),g(_,{key:0,as:"'button'",size:"small",onClick:o.handleConnectDomain},{default:n(()=>[ve,c(" Add domain ")]),_:1},8,["onClick"]))]),t(b,{domains:o.visibleDomains,isLoading:d.isLoading,isFiltering:o.isFiltering,sorting:d.sorting,"onUpdate:sorting":[s[2]||(s[2]=f=>d.sorting=f),o.onSort],onAddDomain:o.handleConnectDomain},null,8,["domains","isLoading","isFiltering","sorting","onUpdate:sorting","onAddDomain"])])}const ze=v(ye,[["render",Ie]]);export{ze as default};
