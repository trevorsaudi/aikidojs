import{m as O}from"./reports-ed4978a9.js";import{P as E}from"./PageHeader-46c38a32.js";import{_ as P,d as z,B,a2 as M,r as o,q as s,k as m,w as t,o as r,s as i,u as h,n as c,m as g,dv as T,F as R,t as L,p as y,H as A,X as G,aV as X,an as V,S as j}from"./index-13ff96f4.js";import{A as K}from"./ActionMenu-3e4470bf.js";import{F as q}from"./FilterButton-bb5393a7.js";import{A as Q,C as U}from"./ComplianceSection-1226ea47.js";import{C as W}from"./CompliancePrintHeader-341b18be.js";import{P as Y}from"./PdfDownloadButton-072addbd.js";import{A as J}from"./AccordionContainer-09dc0ed4.js";import{D as N,a as H}from"./DataTable-e31a825a.js";import{a as S,D as Z}from"./DataTableCell-51c0104f.js";import"./BracesIcon-0a8568f4.js";const ee={props:{resource:Object},components:{BasePill:z,DataTableRow:S,DataTableCell:Z,BaseParagraph:B,XTooltip:M},computed:{isIgnored(){return!!this.resource.ignore_reason>0},formattedResourceKind(){switch(this.resource.kind){case"aws_cache_cluster":return"Cache Cluser";case"aws_rds_db_instance":return"RDS Instance";case"aws_s3_bucket":return"S3 Bucket";case"aws_eks_cluster":return"EKS Cluster";case"aws_ec2_instance":return"EC2 Instance";case"aws_batch_compute_environment":return"Batch Environment";case"azure_virtual_machine_instance":return"Virtual Machine Instance";case"azure_mysql_db_instance":return"MYSQL Instance";case"azure_mariadb_db_instance":return"MariaDB Instance";case"azure_sql_db_instance":return"SQL DB Instance";case"azure_postgresql_db_instance":return"PostgresQL Instance";case"azure_storage_account":return"Storage Account";case"gcp_gke_cluster":return"GKE Cluster";default:this.resource.kind}return null}},methods:{async ignoreResource(){this.$modal.show("IgnoreGdprCloudResourceModal",{resource:this.resource})}}},oe={class:"flex align-center gap-4px justify-between flex-1"},te={class:"flex gap-4px"};function re(e,a,l,w,p,n){const u=o("BaseParagraph"),d=o("DataTableCell"),f=o("XTooltip"),_=o("BasePill"),C=o("DataTableRow");return s(),m(C,{class:"group",disabled:n.isIgnored},{default:t(()=>[r(d,null,{default:t(()=>[r(u,null,{default:t(()=>[i(h(l.resource.region),1)]),_:1})]),_:1}),r(d,null,{default:t(()=>[r(u,null,{default:t(()=>[i(h(n.formattedResourceKind),1)]),_:1})]),_:1}),r(d,null,{default:t(()=>[c("div",oe,[r(u,null,{default:t(()=>[i(h(l.resource.name),1)]),_:1}),c("div",te,[n.isIgnored?(s(),m(_,{key:0,title:"Ignored",variation:"gray-fill",class:"cursor-pointer brightness-95"},{default:t(()=>[r(f,null,{default:t(()=>[i(h(l.resource.ignore_reason),1)]),_:1})]),_:1})):(s(),g("a",{key:1,title:"Ignore resource",variation:"gray-fill",class:"cursor-pointer link text--normal",onClick:a[0]||(a[0]=(...b)=>n.ignoreResource&&n.ignoreResource(...b))}," Mark as Compliant "))])])]),_:1})]),_:1},8,["disabled"])}const ne=P(ee,[["render",re]]),ae={props:{data:Object},components:{DataTable:N,DataTableHeader:H,DataTableRow:S,BaseParagraph:B,CloudResourceTableRow:ne,ProgressBar:T},computed:{sortedRecords(){return[...this.records].sort((e,a)=>a.timestamp-e.timestamp)},compliancePercentage(){const e=this.data.resources.filter(l=>!l.ignore_reason);let a=100-this.data.total_resource_count/100*e.length;return a=Math.max(0,a),a=Math.min(100,a),Math.round(a)}}},se={colspan:"3"},ce={class:"flex flex-1 justify-between"},le={colspan:"3"},ie={class:"empty-state-overview"},ue={class:"empty-state-overview__container"};function de(e,a,l,w,p,n){const u=o("DataTableHeader"),d=o("BaseParagraph"),f=o("ProgressBar"),_=o("DataTableRow"),C=o("CloudResourceTableRow"),b=o("DataTable");return s(),m(b,{class:"data-table--no-header"},{header:t(()=>[r(u,{width:"150px"}),r(u,{width:"200px"}),r(u,{width:"auto"})]),body:t(()=>[r(_,{class:"data-table__row--section-header"},{default:t(()=>[c("td",se,[c("div",ce,[r(d,null,{default:t(()=>[i(h(l.data.cloud.name),1)]),_:1}),r(f,{progress:n.compliancePercentage},null,8,["progress"])])])]),_:1}),(s(!0),g(R,null,L(l.data.resources,v=>(s(),m(C,{key:v.id,resource:v},null,8,["resource"]))),128)),l.data.resources.length===0?(s(),m(_,{key:0},{default:t(()=>[c("td",le,[c("div",ie,[c("div",ue,[r(d,{loose:!0},{default:t(()=>[i("There are no sensitive cloud resources located outside of the EU in this cloud.")]),_:1})])])])]),_:1})):y("",!0)]),_:1})}const _e=P(ae,[["render",de]]),me={props:{cloudResourceLocations:Array,totalCloudResourcesCount:Number,totalNonCompliantCloudResourcesCount:Number},components:{Accordion:J,AccordionItem:Q,BaseHeading:A,BaseParagraph:B,XTooltip:M,DataTable:N,DataTableHeader:H,CloudResourceTable:_e,ProgressBar:T},computed:{formattedError(){return this.cloudResourceLocations.error_code==="no_clouds_monitored"?"No clouds monitored":null},compliancePercentage(){let e=Math.round(100-this.totalCloudResourcesCount/100*this.totalNonCompliantCloudResourcesCount);return e=Math.max(0,e),e=Math.min(100,e),e}},methods:{formatIssue(e){if(e==="no_sla_configured")return"No SLAs configured";if(e==="no_clouds_monitored")return"No clouds monitored";if(e==="no_domains_monitored")return"No domains monitored"}}},pe={class:"flex flex-1 justify-between align-center"},he={class:"flex flex-1 align-center gap-12px"},ge=c("span",{class:"text-16px"},"Cloud Resource Locations",-1),fe={key:0,class:"flex align-center gap-4px"},Ce=c("i",{class:"icon icon-critical icon-14px text-surface-orange-120"},null,-1),be={class:"flex align-center gap-12px"},ve={class:"flex flex-column gap-16px pt-16px"};function we(e,a,l,w,p,n){const u=o("BaseHeading"),d=o("BaseParagraph"),f=o("ProgressBar"),_=o("DataTableHeader"),C=o("DataTable"),b=o("CloudResourceTable"),v=o("AccordionItem"),k=o("Accordion");return s(),m(k,{class:"print_hidden"},{header:t(()=>[c("div",pe,[c("div",he,[r(u,{as:"h4"},{default:t(()=>[ge]),_:1}),n.formattedError?(s(),g("div",fe,[Ce,r(d,{color:"warning"},{default:t(()=>[i(h(n.formattedError),1)]),_:1})])):y("",!0)]),c("div",be,[r(f,{progress:n.compliancePercentage},null,8,["progress"])])])]),body:t(()=>[r(v,null,{body:t(()=>[r(C,null,{header:t(()=>[r(_,{width:"150px"},{default:t(()=>[i("Region")]),_:1}),r(_,{width:"200px"},{default:t(()=>[i("Kind")]),_:1}),r(_,{width:"auto"},{default:t(()=>[i("Name")]),_:1})]),_:1}),c("div",ve,[(s(!0),g(R,null,L(l.cloudResourceLocations,x=>(s(),m(b,{key:x.cloud.id,data:x},null,8,["data"]))),128))])]),_:1})]),_:1})}const Re=P(me,[["render",we]]),xe={components:{PageHeader:E,BaseHeading:A,XPreloader:G,ProgressBar:T,ComplianceSection:U,CompliancePrintHeader:W,ActionMenu:K,FilterButton:q,BaseParagraph:B,PdfDownloadButton:Y,CloudResourceLocationSection:Re},data(){return{isLoading:!0,overview:{},groupReference:void 0,mode:void 0}},provide(){return{filter_team_id:X(()=>this.$teamContext)}},async mounted(){await Promise.allSettled([this.loadComplianceOverview()]),V.on("gdprReportCloudResourceIgnored",this.handleReloadOverview)},watch:{async $teamContext(){this.$globalLoadingIndicator.show();try{await this.loadComplianceOverview()}finally{this.$globalLoadingIndicator.hide()}}},computed:{breadcrumbs(){return[{label:"Reports",href:"/reports"},{label:"GDPR"}]},totalCloudResourcesCount(){var e;return Array.isArray((e=this.overview)==null?void 0:e.cloud_resource_locations)?this.overview.cloud_resource_locations.reduce((a,l)=>l.total_resource_count+=a,0):0},totalNonCompliantCloudResourcesCount(){var e;return Array.isArray((e=this.overview)==null?void 0:e.cloud_resource_locations)?this.overview.cloud_resource_locations.reduce((a,l)=>{const w=l.resources.filter(p=>!p.ignore_reason);return a+=w.length},0):0},totalComplyingCloudResourcesCount(){let e=this.totalCloudResourcesCount-this.totalNonCompliantCloudResourcesCount;return e=Math.max(0,e),e=Math.min(100,e),e},compliance(){const e=this.overview.total_complying_rule_count??0+this.totalComplyingCloudResourcesCount,a=this.overview.total_rule_count??0+this.totalCloudResourcesCount;return e===0||this.isLoading?0:Math.round(e/a*100)},sections(){return this.mode?this.overview[this.mode]??{}:{...this.overview.principles_result??{},...this.overview.enhanced_controller_and_processor_result??{}}},filterLabel(){return this.mode?this.mode==="principles_result"?"2. Principles":this.mode==="enhanced_controller_and_processor_result"?"4. Controller and processor":this.mode==="cloud_resource_locations"?"Cloud Resource Locations":"Filter controls":"Filter controls"},actions(){return[{title:"Controls",action:{label:"Clear filter",onClick:()=>this.mode=void 0},items:[{label:"2. Principles",onClick:()=>this.handleChangeFilter("principles_result"),active:this.mode==="principles_result"},{label:"4. Controller and processor",onClick:()=>this.handleChangeFilter("enhanced_controller_and_processor_result"),active:this.mode==="enhanced_controller_and_processor_result"},{label:"Cloud Resource Locations",onClick:()=>this.handleChangeFilter("cloud_resource_locations"),active:this.mode==="cloud_resource_locations"}]}]},emptyControlsMessage(){}},methods:{async loadComplianceOverview(){this.overview=await O({teamId:null}),this.isLoading=!1},async handleReloadOverview(){try{this.$globalLoadingIndicator.show(),await this.loadComplianceOverview()}finally{this.$globalLoadingIndicator.hide()}},handleChangeFilter(e){if(this.mode===e){this.mode=void 0;return}this.mode=e}}},ye={class:"flex gap-32px align-center"},Pe={class:"page-content"},Be={class:"mb-16px flex align-center gap-12px"},ke=c("i",{class:"icon icon-caret_down icon-12px"},null,-1),De={class:"flex flex-column gap-12px",id:"ComplianceSectionWrapper"},Te={key:1,class:"flex rounded-8px py-32px px-16px bg-white border-1 border-carbon-20"};function Le(e,a,l,w,p,n){const u=o("BaseHeading"),d=o("ProgressBar"),f=o("PdfDownloadButton"),_=o("PageHeader"),C=o("XPreloader"),b=o("FilterButton"),v=o("ActionMenu"),k=o("CompliancePrintHeader"),x=o("ComplianceSection"),$=o("CloudResourceLocationSection"),F=o("BaseParagraph");return s(),g(R,null,[r(_,{breadcrumbs:n.breadcrumbs},{title:t(()=>[c("div",ye,[r(u,{as:"h1"},{default:t(()=>[i("GDPR Compliance Overview")]),_:1}),r(d,{progress:n.compliance},null,8,["progress"])])]),rightContent:t(()=>[r(f,{exportType:"gdpr"})]),_:1},8,["breadcrumbs"]),c("div",Pe,[p.isLoading?(s(),m(C,{key:0,class:"absolute-centered",theme:"transparent"})):(s(),g(R,{key:1},[c("div",Be,[r(v,{sections:n.actions,placement:"bottom-start"},{trigger:t(D=>[r(b,{onClick:D.toggle,class:j({"filter-button--active":!!p.mode})},{default:t(()=>[i(h(n.filterLabel)+" ",1),ke]),_:2},1032,["onClick","class"])]),_:1},8,["sections"])]),c("div",De,[r(k,{title:"GDPR Compliance Overview"}),(s(!0),g(R,null,L(n.sections??{},(D,I)=>(s(),m(x,{key:I,section:D,code:I},null,8,["section","code"]))),128)),!this.mode||this.mode=="cloud_resource_locations"?(s(),m($,{key:0,cloudResourceLocations:p.overview.cloud_resource_locations,totalCloudResourcesCount:n.totalCloudResourcesCount,totalNonCompliantCloudResourcesCount:n.totalNonCompliantCloudResourcesCount},null,8,["cloudResourceLocations","totalCloudResourcesCount","totalNonCompliantCloudResourcesCount"])):y("",!0),n.emptyControlsMessage?(s(),g("div",Te,[r(F,{size:"medium"},{default:t(()=>[i(h(n.emptyControlsMessage),1)]),_:1})])):y("",!0)])],64))])],64)}const Xe=P(xe,[["render",Le]]);export{Xe as default};
