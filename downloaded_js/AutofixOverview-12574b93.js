import{O as N}from"./OverviewEmptyState-c8440b9c.js";import{G as O}from"./GenericIllustration-4aca88e5.js";import{A as K}from"./AutofixFilter-262abaef.js";import{_ as w,B as I,d as D,a2 as R,r as l,q as r,m as x,o as e,w as a,p as h,n as p,s as n,u as f,k as b,ai as B,F as A,A as L,U as E,aQ as G,t as V,I as M}from"./index-13ff96f4.js";import{g as j}from"./repoName-872812ed.js";import{D as U,a as X}from"./DataTable-e31a825a.js";import{D as q,a as z}from"./DataTableCell-51c0104f.js";import{D as H}from"./DataTableSeverityIndicator-48ffb8dc.js";import{C as Q,I as J}from"./CreateAutoFixProgressFlow-8111d22c.js";import{I as W}from"./IssueStatusTag-dacefc0a.js";import{D as Y}from"./DataTableCellSelectable-71ffdbc4.js";import{T as Z}from"./TableListActionMenu-8ca3c15b.js";import{I as $}from"./InputCheckbox-81cb3ca6.js";import"./FilterButton-bb5393a7.js";import"./SelectRepoSearchable-f2be202e.js";import"./InputSearchDropdown-02988f6b.js";import"./ActionMenu-3e4470bf.js";import"./languages-12749071.js";import"./RadioButtonList-1d4cdaad.js";import"./EnableIntegrationModal-48b01f56.js";const ee={props:{fix:Object,active:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1}},emits:["rowClicked","createAutofixClicked","toggleSelectFix"],components:{DataTableCell:q,BaseParagraph:I,DataTableSeverityIndicator:H,DataTableRow:z,BasePill:D,CreateAutoFixProgressFlow:Q,IssueStatusTag:W,DataTableCellSelectable:Y,TableListActionMenu:Z,XTooltip:R,IssueStatus:J},data(){return{showAutofix:!1}},computed:{upgradeLabelVariation(){return this.fix.patch.upgrade==="major"?"red":"green"},description(){return this.fix.issue_count===1?this.fix.description??"This package has 1 vulnerability":`This package has ${this.fix.issue_count} vulnerabilities`},issue(){return{id:this.fix.id,repo_id:this.fix.repo_id}},patch(){return`${this.fix.patch.from_version} => ${this.fix.patch.to_version}`},isActionButtonAlwaysVisible(){const{sidebarIssue:i,fix:o}=this.$route.query;return i==this.fix.grouped_issue_id&&o==this.fix.id},cves(){return this.fix.related_issues.map(i=>i.cve_id)}},methods:{handleStartAutofix(){this.showAutofix=!0},selectFix(){this.$emit("toggleSelectFix")},getActions(){return[{title:"Actions",items:[{label:"Create PR",onClick:()=>this.$emit("createAutofixClicked"),icon:"icon-shield_check"}]}]}}},te={key:0,class:"absolute h-full pin-t pin-l bg-purple-accent w-5px"},ae={class:"flex flex-column gap-4px overflow-hidden"},ie={class:"flex gap-8px justify-between align-center w-full"},le={class:"flex gap-12px align-center"};function se(i,o,t,T,y,s){const v=l("DataTableCellSelectable"),g=l("BaseParagraph"),_=l("XTooltip"),u=l("DataTableCell"),P=l("DataTableSeverityIndicator"),k=l("BasePill"),d=l("IssueStatus"),c=l("TableListActionMenu"),F=l("DataTableRow"),S=l("CreateAutoFixProgressFlow");return r(),x(A,null,[e(F,{clickable:"",onClick:o[2]||(o[2]=m=>i.$emit("rowClicked",t.fix)),class:"group"},{default:a(()=>[e(v,{mode:"edit",selected:t.isSelected,onSelect:s.selectFix},null,8,["selected","onSelect"]),e(u,null,{default:a(()=>[t.active?(r(),x("span",te)):h("",!0),p("div",ae,[e(g,{truncate:!0},{default:a(()=>[n(f(t.fix.package_name),1)]),_:1}),e(g,{color:"subdued",truncate:!0},{default:a(()=>[n(f(s.description)+" ",1),e(_,{class:"ws-break-spaces"},{default:a(()=>[n(f(s.description),1)]),_:1})]),_:1})])]),_:1}),e(P,{priority:t.fix.aikido_priority},null,8,["priority"]),e(u,null,{default:a(()=>[p("div",ie,[e(g,null,{default:a(()=>[n(f(s.cves[0]||""),1)]),_:1}),s.cves.length>1?(r(),b(k,{key:0,title:`${s.cves.length-1} more`,variation:"gray-fill"},{default:a(()=>[e(_,{class:"ws-pre leading-16px"},{default:a(()=>[n(f(s.cves.join(`
`)),1)]),_:1})]),_:1},8,["title"])):h("",!0)])]),_:1}),e(u,null,{default:a(()=>[p("div",le,[e(g,null,{default:a(()=>[n(f(s.patch),1)]),_:1}),e(k,{title:t.fix.patch.upgrade,variation:s.upgradeLabelVariation,size:"compact"},null,8,["title","variation"])])]),_:1}),e(u,{onClick:o[0]||(o[0]=B(()=>{},["stop"]))},{default:a(()=>[e(d,{groupedIssue:{enhanced_status:t.fix.enhanced_status,id:t.fix.related_issues[0].grouped_issue_id},filterRepoId:t.fix.repo_id,rootClass:"sidebar-open_opacity-0"},null,8,["groupedIssue","filterRepoId"])]),_:1}),e(u,null,{default:a(()=>[e(c,{iconButtonClass:"opacity-0 group_hover_opacity-100",sections:s.getActions(),onClick:o[1]||(o[1]=B(()=>{},["prevent","stop"]))},null,8,["sections"])]),_:1})]),_:1}),y.showAutofix?(r(),b(S,{key:0,onCancel:o[3]||(o[3]=m=>y.showAutofix=!1),issue:s.issue,"package-name":t.fix.packageName},null,8,["issue","package-name"])):h("",!0)],64)}const oe=w(ee,[["render",se]]),ne={components:{DataTable:U,DataTableHeader:X,AutofixOverviewPageRow:oe,BaseParagraph:I,BasePill:D,InputCheckbox:$,XTooltip:R},props:{fixablePackages:Array,isSearchFilteringActive:Boolean},data(){return{selectedFixablePackageKeys:[]}},computed:{availableSelectedFixablePackageKeys(){return this.selectedFixablePackages.map(i=>i.key)},areAllFixesSelected(){if(this.selectedFixablePackageKeys.length==0)return!1;for(const i of this.fixablePackages)if(!this.selectedFixablePackageKeys.includes(i.key))return!1;return!0},hasSelectedFixes(){if(this.selectedFixablePackageKeys.length==0)return!1;for(const i of this.fixablePackages)if(this.selectedFixablePackageKeys.includes(i.key))return!0;return!1},repoName(){return j(this.fixablePackages[0])},selectedFixablePackages(){return this.fixablePackages.filter(i=>this.selectedFixablePackageKeys.includes(i.key))},previewAvailable(){return this.$user.is_aikido_support}},methods:{onToggleSelectFix(i){const o=this.selectedFixablePackageKeys.indexOf(i);o===-1?this.selectedFixablePackageKeys.push(i):this.selectedFixablePackageKeys.splice(o,1)},handleToggleSelectAllPackages(i){i?this.selectedFixablePackageKeys=this.fixablePackages.map(o=>o.key):this.selectedFixablePackageKeys=[]},async startAutofixForSelection(){if(L.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal",{title:"Bulk autofix is available on all paid plans",msg:"Upgrade now to any paid plan to start creating bulk autofixes."});this.selectedFixablePackages.length===0&&this.handleToggleSelectAllPackages(!0),this.$modal.show("SelectBulkAutofixSolutionModal",{fixablePackages:this.selectedFixablePackages})},async startAutofixForPackage(i){this.$modal.show("SelectBulkAutofixSolutionModal",{fixablePackages:[i]})},async startPreviewForSelection(){this.selectedFixablePackages.length===0&&this.handleToggleSelectAllPackages(!0),this.$modal.show("SelectBulkAutofixSolutionModal",{fixablePackages:this.selectedFixablePackages,preview:!0})}}},re={key:0,class:"bg-white rounded-8px mb-32px"},ce={class:"p-16px flex justify-between align-center"},ue=["to"],de={class:"text--semi-bold"},fe=p("i",{class:"icon icon-openLink icon-12px opacity-0 group_hover_opacity-100"},null,-1),pe={class:"flex align-center"};function ge(i,o,t,T,y,s){const v=l("RouterLink"),g=l("BaseParagraph"),_=l("BasePill"),u=l("BaseButton"),P=l("BaseIcon"),k=l("InputCheckbox"),d=l("XTooltip"),c=l("DataTableHeader"),F=l("AutofixOverviewPageRow"),S=l("DataTable");return t.fixablePackages.length>0?(r(),x("div",re,[p("div",ce,[p("a",{class:"link text--normal group py-2px",to:`/repositories/${i.repoId}`,target:"_blank"},[e(g,{class:""},{default:a(()=>[e(v,{class:"flex align-center gap-4px hover_text-surface-blue-100",target:"_blank",to:`/repositories/${t.fixablePackages[0].repo_id}`},{default:a(()=>[n(f(s.repoName)+" | ",1),p("span",de,f(t.fixablePackages[0].target_path),1),fe]),_:1},8,["to"])]),_:1})],8,ue),p("div",pe,[s.availableSelectedFixablePackageKeys.length>0?(r(),b(_,{key:0,title:i.$t("X_PACKAGES_SELECTED",s.availableSelectedFixablePackageKeys.length),variation:"gray-fill"},null,8,["title"])):h("",!0),s.previewAvailable?(r(),b(u,{key:1,class:"flex gap-8px text--normal mx-8px align-center",as:"button",size:"small",variation:"tertiary",onClick:s.startPreviewForSelection},{default:a(()=>[n(" Create Preview ")]),_:1},8,["onClick"])):h("",!0),e(u,{class:"flex gap-8px text--normal mx-8px align-center",as:"button",size:"small",onClick:s.startAutofixForSelection},{default:a(()=>[e(P,{icon:"icon-gh_branch",class:"flex"}),n(" Create PR ")]),_:1},8,["onClick"])])]),e(S,null,{header:a(()=>[e(c,{width:"48px",alignment:"center",spacing:"compact"},{default:a(()=>[e(k,{disabled:t.isSearchFilteringActive,"semi-checked":s.hasSelectedFixes,modelValue:s.areAllFixesSelected,"onUpdate:modelValue":s.handleToggleSelectAllPackages},null,8,["disabled","semi-checked","modelValue","onUpdate:modelValue"]),E(e(d,null,{default:a(()=>[n("Not available when search is active")]),_:1},512),[[G,t.isSearchFilteringActive]])]),_:1}),e(c,{width:"auto"},{default:a(()=>[n("Name")]),_:1}),e(c,{width:"120px"},{default:a(()=>[n("Severity")]),_:1}),e(c,{width:"auto"},{default:a(()=>[n("CVE")]),_:1}),e(c,{width:"auto"},{default:a(()=>[n("Version Upgrade")]),_:1}),e(c,{width:"120px"},{default:a(()=>[n("Status")]),_:1}),e(c,{width:"48px"})]),body:a(()=>[(r(!0),x(A,null,V(t.fixablePackages,m=>(r(),b(F,{fix:m,key:m.key,isSelected:y.selectedFixablePackageKeys.includes(m.key),onToggleSelectFix:C=>s.onToggleSelectFix(m.key),onRowClicked:C=>s.onToggleSelectFix(m.key),onCreateAutofixClicked:C=>s.startAutofixForPackage(m)},null,8,["fix","isSelected","onToggleSelectFix","onRowClicked","onCreateAutofixClicked"]))),128))]),_:1})])):h("",!0)}const me=w(ne,[["render",ge]]),xe={components:{OverviewEmptyState:N,GenericIllustration:O,AutofixFilter:K,InputSearch:M,AutofixOverviewRepoGroup:me},props:{fixablePackagesByPackageAndLockfile:{type:Object,required:!0},amountFixablePackagesVisible:{type:Number,required:!0},amountFixablePackages:{type:Number,required:!0},loadingAllPackages:{type:Boolean,default:!1},searchTerm:{type:String,default:""},repoOwnerNames:{type:Array,default:()=>[]},shouldShowRepoPathsFilter:{type:Boolean,default:!1},groupedIssueFilter:{type:[String,Number]},repoFilter:{type:[String,Number]},emptystateTitle:{type:String,default:""},emptystateDescription:{type:String,default:""}},emits:["fetchAllPackages","update:searchTerm","onFilterChanged"]},he={class:"flex align-center gap-8px mb-16px"},_e={key:0,class:"card"},ke={key:1,class:"flex justify-center mt-16px"};function be(i,o,t,T,y,s){const v=l("InputSearch"),g=l("AutofixFilter"),_=l("GenericIllustration"),u=l("OverviewEmptyState"),P=l("AutofixOverviewRepoGroup"),k=l("BaseButton");return r(),x("div",null,[p("div",he,[e(v,{modelValue:t.searchTerm,"onUpdate:modelValue":o[0]||(o[0]=d=>i.$emit("update:searchTerm",d)),spacing:"compact"},null,8,["modelValue"]),e(g,{groupedIssueFilterProp:t.groupedIssueFilter,initialRepoFilter:t.repoFilter,repoOwnerNames:t.repoOwnerNames,shouldShowRepoPathsFilter:t.shouldShowRepoPathsFilter,onSelectFilter:o[1]||(o[1]=d=>i.$emit("onFilterChanged",d))},null,8,["groupedIssueFilterProp","initialRepoFilter","repoOwnerNames","shouldShowRepoPathsFilter"])]),t.amountFixablePackagesVisible==0?(r(),x("div",_e,[e(u,{title:t.emptystateTitle,description:t.emptystateDescription,variation:"empty",class:"mx-auto"},{default:a(()=>[e(_)]),_:1},8,["title","description"])])):h("",!0),(r(!0),x(A,null,V(t.fixablePackagesByPackageAndLockfile,(d,c)=>(r(),b(P,{key:c,fixablePackages:d,isSearchFilteringActive:t.searchTerm.length>0},null,8,["fixablePackages","isSearchFilteringActive"]))),128)),t.amountFixablePackagesVisible<t.amountFixablePackages?(r(),x("div",ke,[e(k,{onClick:o[2]||(o[2]=d=>i.$emit("fetchAllPackages")),size:"small",theme:"secondary",isLoading:t.loadingAllPackages,disabled:t.loadingAllPackages},{default:a(()=>[n(" Load all fixable packages ("+f(t.amountFixablePackages)+") ",1)]),_:1},8,["isLoading","disabled"])])):h("",!0)])}const Me=w(xe,[["render",be]]);export{Me as default};
