import{_ as I,H as M,f as k,B,M as V,N as F,z as R,x as H,bk as O,d as A,A as v,a3 as C,gE as P,an as D,r as u,q as o,k as p,w as r,o as t,m as _,u as g,p as U,n as c,s as m}from"./index-13ff96f4.js";const j={emits:["close"],components:{BaseHeading:M,BaseButton:k,BaseParagraph:B,BaseModal:V,BaseSelect:F,InputSwitch:R,BaseIcon:H,BaseBody:O,BasePill:A},props:{repositories:Array},data(){const e=this.getDefaultConfig();return{isSaving:!1,minimumSeverity:e.minimum_severity,enableDependencyScan:!!e.fail_on_dependency_scan,enableSastScan:!!e.fail_on_sast_scan,enableIacScan:!!e.fail_on_iac_scan,enableSecretsScan:!!e.fail_on_secrets_scan,enableMalwareScan:!!e.fail_on_malware_scan,postInlineCommentsMinimumSeverity:e.post_inline_comments_min_severity??"none"}},watch:{enableSecretsScan(){this.disableInlineCommentOption&&(this.postInlineCommentsMinimumSeverity="none")},enableSastScan(){this.disableInlineCommentOption&&(this.postInlineCommentsMinimumSeverity="none")},enableIacScan(){this.disableInlineCommentOption&&(this.postInlineCommentsMinimumSeverity="none")}},computed:{isPayingAccount(){return v.isPaying()},isEditingConfigurationForMultipleRepos(){return this.repositories.length>1},singleRepositoryHasConfiguration(){return this.isEditingConfigurationForMultipleRepos?!1:!!this.repositories[0].configuration},scmRepoName(){return this.isEditingConfigurationForMultipleRepos?null:this.repositories[0].scm_repo_name},modalTitle(){if(this.repositories.length>1)return null;const e=this.repositories[0].configuration;return!e||e.updated_by<1||this.scmRepoId!=e.scm_repo_id?null:`Updated on ${C.fromUnix(e.updated_at).format(C.US_FRIENDLY_SHORT_DATE)} by ${e.updated_by_name}`},minimumSeverityOptions(){return[{id:"critical",title:"Critical Only",disabled:this.minimumSeverity==="critical"},{id:"high",title:"High and Above",disabled:this.minimumSeverity==="high"},{id:"medium",title:"Medium and Above",disabled:this.minimumSeverity==="medium"},{id:"low",title:"Low and Above",disabled:this.minimumSeverity==="low"}]},inlineCommentsMinimumSeverityOptions(){return[{id:"critical",title:"Critical Only"},{id:"high",title:"High and Above"},{id:"medium",title:"Medium and Above"},{id:"low",title:"Low and Above"},{id:"none",title:"No Comments"}]},disableInlineCommentOption(){return!this.enableSastScan&&!this.enableSecretsScan&&!this.enableIacScan}},methods:{handleClose(){this.$emit("close")},async handleSaveConfiguration(){if(!this.enableDependencyScan&&!this.enableSastScan&&!this.enableIacScan&&!this.enableSecretsScan&&!this.enableMalwareScan){this.$toast.error({title:"Invalid Configuration",description:"You must enable at least one of the scans to enable scanning."});return}this.isSaving=!0;const e={scm_repo_ids:this.repositories.map(n=>n.id),minimum_severity:this.minimumSeverity,fail_on_dependency_scan:this.enableDependencyScan,fail_on_sast_scan:this.enableSastScan,fail_on_iac_scan:this.enableIacScan,fail_on_secrets_scan:this.enableSecretsScan,fail_on_malware_scan:this.enableMalwareScan,post_inline_comments_min_severity:this.postInlineCommentsMinimumSeverity};try{await P(e),D.emit("githubChecksConfigurationUpdated"),this.handleClose()}finally{this.isSaving=!1}},getDefaultConfig(){const e=this.repositories.map(i=>i.configuration),n=e[0];return n?this.repositories.length===1?n??this.getFallbackConfig():e.every(i=>!!i&&i.minimum_severity===n.minimum_severity)?e.every(i=>!!i&&i.fail_on_dependency_scan===n.fail_on_dependency_scan)?e.every(i=>!!i&&i.fail_on_sast_scan===n.fail_on_sast_scan)?e.every(i=>!!i&&i.fail_on_iac_scan===n.fail_on_iac_scan)?e.every(i=>!!i&&i.post_inline_comments_min_severity===n.post_inline_comments_min_severity)?n:this.getFallbackConfig():this.getFallbackConfig():this.getFallbackConfig():this.getFallbackConfig():this.getFallbackConfig():this.getFallbackConfig()},getFallbackConfig(){return v.isPaying()?{minimum_severity:"critical",fail_on_dependency_scan:!0,fail_on_sast_scan:!0,fail_on_iac_scan:!0,fail_on_secrets_scan:!0,fail_on_malware_scan:!1,post_inline_comments:!0,post_inline_comments_min_severity:"critical"}:{minimum_severity:"critical",fail_on_dependency_scan:!0,fail_on_sast_scan:!1,fail_on_iac_scan:!1,fail_on_secrets_scan:!1,fail_on_malware_scan:!1,post_inline_comments:!1,post_inline_comments_min_severity:"none"}},requestCiMalwareScan(){const e="Hi, I would like to request malware in CI scanning.";window.Intercom("showNewMessage",e)}}},N={key:0},T={class:"flex flex-column gap-8px"},E={key:0,class:"text-gray-900 text-24px"},L={key:1,class:"text-gray-900 text-24px"},q=c("div",{class:"text-gray-200 text-14px"},"This configuration will be applied to selected repos.",-1),G=c("hr",{class:"divider w-full my-16px"},null,-1),Y={class:"flex flex-column gap-16px"},z={class:"flex justify-between align-center"},J=c("div",{class:"text-14px text-primary-aik-140"},"Scan Failure For",-1),K={key:1,class:"flex align-center justify-between"},Q={key:3,class:"flex align-center justify-between"},W={key:5,class:"flex align-center justify-between"},X={key:7,class:"flex align-center justify-between"},Z=c("hr",{class:"divider w-full"},null,-1),$={class:"flex justify-between align-center gap-12px"},ee={class:"flex align-center ml-auto gap-8px"};function ne(e,n,h,w,a,s){const y=u("BaseParagraph"),i=u("BaseSelect"),d=u("InputSwitch"),f=u("BaseBody"),S=u("BasePill"),b=u("BaseButton"),x=u("BaseModal");return o(),p(x,{width:530,onClose:s.handleClose,canClose:!0},{header:r(()=>[t(y,{color:"gray"},{default:r(()=>[s.modalTitle?(o(),_("span",N,g(s.modalTitle),1)):U("",!0)]),_:1})]),content:r(()=>[c("div",T,[s.isEditingConfigurationForMultipleRepos?(o(),_("h3",E,"Manage Configuration for "+g(h.repositories.length)+" repos",1)):(o(),_("h3",L,[m("Manage configuration for "),c("strong",null,g(this.scmRepoName),1)])),q]),G,c("div",Y,[c("label",z,[J,t(i,{modelValue:a.minimumSeverity,"onUpdate:modelValue":n[0]||(n[0]=l=>a.minimumSeverity=l),options:s.minimumSeverityOptions,class:"min-w-116px"},null,8,["modelValue","options"])]),t(d,{modelValue:a.enableDependencyScan,"onUpdate:modelValue":n[1]||(n[1]=l=>a.enableDependencyScan=l),class:"justify-between",labelLeft:"Dependency Scan"},null,8,["modelValue"]),s.isPayingAccount?(o(),p(d,{key:0,modelValue:a.enableSastScan,"onUpdate:modelValue":n[2]||(n[2]=l=>a.enableSastScan=l),class:"justify-between",labelLeft:"SAST Scan"},null,8,["modelValue"])):(o(),_("div",K,[t(f,null,{default:r(()=>[m("SAST Scan")]),_:1}),t(S,{variation:"purple",title:"Upgrade"})])),s.isPayingAccount?(o(),p(d,{key:2,modelValue:a.enableIacScan,"onUpdate:modelValue":n[3]||(n[3]=l=>a.enableIacScan=l),class:"justify-between",labelLeft:"IaC Scan"},null,8,["modelValue"])):(o(),_("div",Q,[t(f,null,{default:r(()=>[m("IAC Scan")]),_:1}),t(S,{variation:"purple",title:"Upgrade"})])),s.isPayingAccount?(o(),p(d,{key:4,modelValue:a.enableSecretsScan,"onUpdate:modelValue":n[4]||(n[4]=l=>a.enableSecretsScan=l),class:"justify-between",labelLeft:"Secrets Scan"},null,8,["modelValue"])):(o(),_("div",W,[t(f,null,{default:r(()=>[m("Secrets Scan")]),_:1}),t(S,{variation:"purple",title:"Upgrade"})])),e.$featureflags.enable_ci_malware_scan?(o(),p(d,{key:6,modelValue:a.enableMalwareScan,"onUpdate:modelValue":n[5]||(n[5]=l=>a.enableMalwareScan=l),class:"justify-between",labelLeft:"Malware Scan"},null,8,["modelValue"])):(o(),_("div",X,[t(f,null,{default:r(()=>[m("Malware Scan")]),_:1}),t(S,{variation:"green",title:"Get in touch",class:"cursor-pointer",onClick:s.requestCiMalwareScan},null,8,["onClick"])])),Z,c("div",$,[t(y,null,{default:r(()=>[m("Add inline comments on the PR in GitHub")]),_:1}),t(i,{modelValue:a.postInlineCommentsMinimumSeverity,"onUpdate:modelValue":n[6]||(n[6]=l=>a.postInlineCommentsMinimumSeverity=l),options:s.inlineCommentsMinimumSeverityOptions,disabled:s.disableInlineCommentOption,class:"min-w-116px"},null,8,["modelValue","options","disabled"])])])]),footer:r(()=>[c("div",ee,[t(b,{onClicked:s.handleClose,variation:"plain"},{default:r(()=>[m("Cancel")]),_:1},8,["onClicked"]),t(b,{onClicked:s.handleSaveConfiguration,variation:"primary","is-loading":a.isSaving},{default:r(()=>[m("Save Configuration")]),_:1},8,["onClicked","is-loading"])])]),_:1},8,["onClose"])}const ae=I(j,[["render",ne]]);export{ae as default};
