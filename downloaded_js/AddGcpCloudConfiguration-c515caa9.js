import{P as $}from"./PageHeader-46c38a32.js";import{P as T}from"./ProgressTracker-672a1ecc.js";import{_ as g,bk as B,f as x,V as I,H as w,g as j,r as c,q as h,m as C,n as e,o,w as l,s as t,F as k,B as A,f1 as G,bs as E,u as N,N as H,bE as K,bg as U,an as V,A as D,k as S,p as y}from"./index-13ff96f4.js";import{U as L}from"./UploadJsonFileInput-be53818c.js";const O={props:{initialProjectId:String},components:{BaseBody:B,BaseButton:x,InputText:I,BaseHeading:w,BaseLink:j},emits:["cancel","continue"],data(){return{projectId:this.initialProjectId}},computed:{isComplete(){return!(!this.projectId||this.projectId&&this.projectId==="")}},methods:{handleCancel(){this.$emit("cancel")},async handleSubmit(){this.$emit("continue",{projectId:this.projectId})},handleKeyDown(){this.isComplete&&this.handleSubmit()}}},q={class:"flex flex-column gap-32px"},F={class:"flex flex-column gap-8px"},J={class:"cloud-config__content__list"},M=e("li",null,"Open the project overview modal from the top left",-1),W=e("li",null,"Locate your project ID",-1),R=e("hr",{class:"divider my-24px"},null,-1),Y={class:"flex flex-end gap-16px mt-12px justify-end"};function z(r,s,b,v,a,n){const u=c("BaseHeading"),p=c("BaseBody"),i=c("BaseLink"),d=c("InputText"),_=c("BaseButton");return h(),C(k,null,[e("div",q,[e("div",F,[o(u,{as:"h3"},{default:l(()=>[t("Google Cloud Platform (GCP) Configuration")]),_:1}),o(p,{color:"subdued"},{default:l(()=>[t("Let’s start with getting your project ID")]),_:1})]),e("ul",J,[e("li",null,[t("Log into your "),o(i,{href:"https://console.cloud.google.com/",target:"_blank"},{default:l(()=>[t("GCP Account")]),_:1}),t(".")]),M,W]),o(d,{title:"Please paste the ID for the project you would like to connect into the field below",placeholder:"stoked-forest-376009",modelValue:a.projectId,"onUpdate:modelValue":s[0]||(s[0]=m=>a.projectId=m),modelModifiers:{trim:!0},name:"projectId",onEnterKeyPress:n.handleKeyDown},null,8,["modelValue","onEnterKeyPress"])]),e("div",null,[R,e("div",Y,[o(_,{variation:"plain",onClicked:n.handleCancel},{default:l(()=>[t("Cancel")]),_:1},8,["onClicked"]),o(_,{disabled:!n.isComplete,onClicked:n.handleSubmit},{default:l(()=>[t(" Save & Continue ")]),_:1},8,["disabled","onClicked"])])])],64)}const Q=g(O,[["render",z]]),X={props:{projectId:String},components:{BaseBody:B,BaseButton:x,BaseHeading:w,BaseParagraph:A,UploadJsonFileInput:L},emits:["back","continue"],data(){return{key:void 0}},methods:{handleGoBack(){this.$emit("back")},async handleSubmit(){const r=await G(this.projectId,this.key);this.$emit("continue",{cloudId:r.cloud_id})}}},Z={class:"flex flex-column gap-32px"},ee={class:"flex flex-column gap-8px"},te=E('<ul class="cloud-config__content__list"><li>Click on the service account you just created</li><li>Navigate to the &#39;Keys&#39; tab</li><li>Click on &#39;Add key&#39; and then on &#39;Create new Key&#39;</li><li>Select &#39;JSON&#39; for the key type when prompted</li><li>Click on &quot;<strong>Access Control (IAM)</strong>&quot;.</li><li>Click on &quot;<strong>Create</strong>&quot;</li><li>This should trigger a download of a JSON file. This contains the security credentials.</li></ul>',1),oe={class:"flex flex-column gap-12px"},ne=e("hr",{class:"divider my-24px"},null,-1),se={class:"flex flex-end gap-16px mt-12px justify-end"};function ce(r,s,b,v,a,n){const u=c("BaseHeading"),p=c("BaseBody"),i=c("BaseParagraph"),d=c("UploadJsonFileInput"),_=c("BaseButton");return h(),C(k,null,[e("div",Z,[e("div",ee,[o(u,{as:"h3"},{default:l(()=>[t("Create the access key")]),_:1}),o(p,{color:"subdued"},{default:l(()=>[t("To create and download the access key please follow these steps in the GCP UI.")]),_:1})]),te,e("div",oe,[o(i,null,{default:l(()=>[t("Finally, just upload the file")]),_:1}),o(d,{onUpload:s[0]||(s[0]=m=>this.key=m)})])]),e("div",null,[ne,e("div",se,[o(_,{variation:"plain",onClicked:n.handleGoBack},{default:l(()=>[t("Go back")]),_:1},8,["onClicked"]),o(_,{onClicked:n.handleSubmit,disabled:!a.key},{default:l(()=>[t("Save & Continue")]),_:1},8,["onClicked","disabled"])])])],64)}const le=g(X,[["render",ce]]),ae={props:{projectId:String},components:{BaseBody:B,BaseButton:x,BaseHeading:w,BaseLink:j},emits:["back","continue"],computed:{createServiceAccountUrl(){return`https://console.cloud.google.com/iam-admin/serviceaccounts/create?project=${this.projectId}`}},methods:{handleGoBack(){this.$emit("back")},async handleSubmit(){this.$emit("continue")},handleCreateServiceAccount(){window.open(this.createServiceAccountUrl,"_blank")}}},ie={class:"flex flex-column gap-32px"},de={class:"flex flex-column gap-8px"},re=e("ul",{class:"cloud-config__content__list"},[e("li",null,"The below button will take you to the service account creation page in GCP."),e("li",null,[t("Give the account a name, you can use whatever you’d like, but we recommend including ‘"),e("strong",null,"Aikido"),t("’ in there somewhere.")])],-1),ue={class:"cloud-config__content__list"},pe=e("li",null,"No other optional permissions are needed.",-1),he=e("hr",{class:"divider my-24px"},null,-1),_e={class:"flex flex-end gap-16px mt-12px justify-end"};function me(r,s,b,v,a,n){const u=c("BaseHeading"),p=c("BaseBody"),i=c("BaseButton"),d=c("BaseLink");return h(),C(k,null,[e("div",ie,[e("div",de,[o(u,{as:"h3"},{default:l(()=>[t("Create service account")]),_:1}),o(p,{color:"subdued"},{default:l(()=>[t("We need to create a service account and assign some permissions.")]),_:1})]),re,o(i,{variation:"blue",size:"small",onClicked:n.handleCreateServiceAccount},{default:l(()=>[t("Create service account")]),_:1},8,["onClicked"]),e("ul",ue,[e("li",null,[t("Assign both the "),o(d,{inline:"",href:"https://cloud.google.com/iam/docs/understanding-roles#iam.securityReviewer",target:"_blank"},{default:l(()=>[t("security reviewer")]),_:1}),t(" and "),o(d,{inline:"",href:"https://cloud.google.com/iam/docs/understanding-roles#basic",target:"_blank"},{default:l(()=>[t("viewer")]),_:1}),t(" role to this service account. We will need both of those roles assigned to the service account to give us the needed permissions.")]),pe])]),e("div",null,[he,e("div",_e,[o(i,{variation:"plain",onClicked:n.handleGoBack},{default:l(()=>[t("Go back")]),_:1},8,["onClicked"]),o(i,{onClicked:n.handleSubmit},{default:l(()=>[t("Continue")]),_:1},8,["onClicked"])])])],64)}const fe=g(ae,[["render",me]]),ge={components:{BaseBody:B,BaseButton:x,BaseHeading:w,BaseParagraph:A},emits:["back","continue"],data(){return{command:"gcloud services enable compute.googleapis.com storage-component.googleapis.com iam.googleapis.com container.googleapis.com logging.googleapis.com monitoring.googleapis.com cloudresourcemanager.googleapis.com cloudkms.googleapis.com bigquery-json.googleapis.com dns.googleapis.com sqladmin.googleapis.com"}},methods:{handleGoBack(){this.$emit("back")},async handleSubmit(){this.$emit("continue")},handleCopyToken(){window.isSecureContext&&navigator.clipboard.writeText(this.token)}}},Ce={class:"flex flex-column gap-32px"},ke={class:"flex flex-column gap-8px"},be=e("ul",{class:"cloud-config__content__list"},[e("li",null,[t("To start, click the "),e("strong",null,'"Activate Cloud Shell"'),t(" icon in the top right in the GCP console.")]),e("li",null,"You will see that at the bottom of your screen, an interactive shell was started where you can enter commands."),e("li",null,"The following command will enable API access to the resources in GCP:")],-1),ve={class:"bg-cream p-12px rounded-4px"},Se=e("strong",null,"Copy and paste it",-1),ye=e("hr",{class:"divider my-24px"},null,-1),Be={class:"flex flex-end gap-16px mt-12px justify-end"};function xe(r,s,b,v,a,n){const u=c("BaseHeading"),p=c("BaseBody"),i=c("BaseParagraph"),d=c("BaseButton");return h(),C(k,null,[e("div",Ce,[e("div",ke,[o(u,{as:"h3"},{default:l(()=>[t("Enable Cloud APIs")]),_:1}),o(p,{color:"subdued"},{default:l(()=>[t("We first need to enable some cloud API's which allows us read-only capabilities to inspect the policies of your cloud resources.")]),_:1})]),be,e("div",ve,[o(i,null,{default:l(()=>[t(N(a.command),1)]),_:1})]),o(i,null,{default:l(()=>[Se,t(" in the interactive shell and enable it. This should return in a success message being shown.")]),_:1})]),e("div",null,[ye,e("div",Be,[o(d,{variation:"plain",onClicked:n.handleGoBack},{default:l(()=>[t("Go back")]),_:1},8,["onClicked"]),o(d,{onClicked:n.handleSubmit},{default:l(()=>[t("Continue")]),_:1},8,["onClicked"])])])],64)}const we=g(ge,[["render",xe]]),Ie={components:{BaseBody:B,InputText:I,BaseButton:x,BaseSelect:H,BaseHeading:w},props:{cloudId:Number},emits:["cancel","complete"],data(){return{name:void 0,purpose:void 0}},computed:{purposeOptions(){return[{id:"production",title:"Production"},{id:"staging",title:"Staging"},{id:"development",title:"Development"},{id:"mixed",title:"Mixed"}]},isComplete(){return!(!this.name||this.name&&this.name===""||!this.purpose||this.purpose&&this.purpose==="")}},methods:{handleCancel(){this.$emit("cancel")},async handleSubmit(){await K({cloud_id:this.cloudId,account_purpose:this.purpose,name:this.name}),Toast.success({title:this.$t("NOTIFICATIONS.CLOUD_UPDATED.TITLE"),description:this.$t("SUCCESSFULLY_EDITED_INTEGRATION")}),await U(this.cloudId,"scan"),this.$emit("complete"),V.emit("cloudAdded")}}},je={class:"flex flex-column gap-32px"},Ae={class:"flex flex-column gap-8px"},Pe={class:"flex flex-column gap-24px"},$e=e("hr",{class:"divider my-24px"},null,-1),Te={class:"flex flex-end gap-16px mt-12px justify-end"};function Ge(r,s,b,v,a,n){const u=c("BaseHeading"),p=c("BaseBody"),i=c("InputText"),d=c("BaseSelect"),_=c("BaseButton");return h(),C(k,null,[e("div",je,[e("div",Ae,[o(u,{as:"h3"},{default:l(()=>[t("It worked! Everything seems to be connected.")]),_:1}),o(p,{color:"subdued"},{default:l(()=>[t(" Your cloud is connected, please answer two questions and you are good to go! ")]),_:1})]),e("div",null,[e("div",Pe,[o(i,{title:"Name your Cloud.",placeholder:"GCP cloud infrastructure",modelValue:a.name,"onUpdate:modelValue":s[0]||(s[0]=m=>a.name=m),modelModifiers:{trim:!0},name:"name"},null,8,["modelValue"]),o(d,{modelValue:a.purpose,"onUpdate:modelValue":s[1]||(s[1]=m=>a.purpose=m),label:"What is the purpose of your cloud?",options:n.purposeOptions},null,8,["modelValue","options"])])])]),e("div",null,[$e,e("div",Te,[o(_,{variation:"plain",onClicked:n.handleCancel},{default:l(()=>[t("Cancel")]),_:1},8,["onClicked"]),o(_,{disabled:!n.isComplete,onClicked:n.handleSubmit},{default:l(()=>[t(" Save ")]),_:1},8,["disabled","onClicked"])])])],64)}const Ee=g(Ie,[["render",Ge]]),Ne={components:{PageHeader:$,ProgressTracker:T,ConnectProjectId:Q,EnableCloudApis:we,CreateServiceAccount:fe,CreateAccessKey:le,CompleteConfiguration:Ee},computed:{breadcrumbs(){return[{label:"Add a cloud"},{label:"Google Cloud Platform"}]},steps(){return[{title:"Sign in and connect project ID",completed:this.completedSteps.includes("connect_project_id"),pending:this.showConnectProjectIdStep},{title:"Enable Cloud APIs",completed:this.completedSteps.includes("enable_cloud_apis"),pending:this.showEnableCloudApisStep},{title:"Create service account",completed:this.completedSteps.includes("create_service_account"),pending:this.showCreateServiceAccountStep},{title:"Create access key",completed:this.completedSteps.includes("create_access_key"),pending:this.showCreateAccessKeyStep},{title:"Name your cloud connection",completed:this.completedSteps.includes("complete_connection"),pending:this.showCompleteConfigStep}]}},data(){return{showConnectProjectIdStep:!0,showEnableCloudApisStep:!1,showCreateServiceAccountStep:!1,showCreateAccessKeyStep:!1,showCompleteConfigStep:!1,completedSteps:[],cloudId:void 0,projectId:void 0}},methods:{handleCancel(){this.$router.back()},handleContinue(r,s){if(D.data.group.is_demo_group===1)return this.$modal.show("AddWorkspaceRedirectModal");switch(this.completedSteps.push(r),r){case"connect_project_id":this.projectId=s.projectId,this.showConnectProjectIdStep=!1,this.showEnableCloudApisStep=!0;return;case"enable_cloud_apis":this.showEnableCloudApisStep=!1,this.showCreateServiceAccountStep=!0;return;case"create_service_account":this.showCreateServiceAccountStep=!1,this.showCreateAccessKeyStep=!0;return;case"create_access_key":this.cloudId=s.cloudId,this.showCreateAccessKeyStep=!1,this.showCompleteConfigStep=!0;return}},handleGoBack(r,s){switch(this.completedSteps.pop(),r){case"enable_cloud_apis":this.showConnectProjectIdStep=!0,this.showEnableCloudApisStep=!1;return;case"create_service_account":this.showEnableCloudApisStep=!0,this.showCreateServiceAccountStep=!1;return;case"create_access_key":this.showCreateServiceAccountStep=!0,this.showCreateAccessKeyStep=!1;return}},handleComplete(){this.showCompleteSetupStep=!1,this.$router.back()}}},He={class:"page-content bg-white"},Ke={class:"cloud-config"},Ue={class:"cloud-config__step-container"},Ve={class:"cloud-config__progress-container"};function De(r,s,b,v,a,n){const u=c("PageHeader"),p=c("ConnectProjectId"),i=c("EnableCloudApis"),d=c("CreateServiceAccount"),_=c("CreateAccessKey"),m=c("CompleteConfiguration"),P=c("ProgressTracker");return h(),C(k,null,[o(u,{breadcrumbs:n.breadcrumbs,title:"Cloud configuration"},null,8,["breadcrumbs"]),e("div",He,[e("div",Ke,[e("div",Ue,[a.showConnectProjectIdStep?(h(),S(p,{key:0,"initial-project-id":a.projectId,onCancel:n.handleCancel,onContinue:s[0]||(s[0]=f=>n.handleContinue("connect_project_id",f))},null,8,["initial-project-id","onCancel"])):y("",!0),a.showEnableCloudApisStep?(h(),S(i,{key:1,onBack:s[1]||(s[1]=()=>n.handleGoBack("enable_cloud_apis")),onContinue:s[2]||(s[2]=f=>n.handleContinue("enable_cloud_apis",f))})):y("",!0),a.showCreateServiceAccountStep?(h(),S(d,{key:2,"project-id":a.projectId,onBack:s[3]||(s[3]=()=>n.handleGoBack("create_service_account")),onContinue:s[4]||(s[4]=f=>n.handleContinue("create_service_account",f))},null,8,["project-id"])):y("",!0),a.showCreateAccessKeyStep?(h(),S(_,{key:3,"project-id":a.projectId,onBack:s[5]||(s[5]=()=>n.handleGoBack("create_access_key")),onContinue:s[6]||(s[6]=f=>n.handleContinue("create_access_key",f))},null,8,["project-id"])):y("",!0),a.showCompleteConfigStep?(h(),S(m,{key:4,"cloud-id":a.cloudId,onCancel:n.handleCancel,onComplete:n.handleComplete},null,8,["cloud-id","onCancel","onComplete"])):y("",!0)]),e("div",Ve,[o(P,{steps:n.steps},null,8,["steps"])])])])],64)}const Je=g(Ne,[["render",De]]);export{Je as default};
