import{_ as T,f as A,g as x,V as I,B as v,a3 as d,cc as P,cd as y,a0 as B,ce as D,Z as b,r as c,m as u,o as r,w as n,n as t,k as w,p as k,F as L,q as l,s as a,u as V}from"./index-13ff96f4.js";import{P as C}from"./PageHeader-46c38a32.js";const S={components:{BaseButton:A,BaseLink:x,InputText:I,BaseParagraph:v,PageHeader:C},data(){return{isLoading:!0,isSaving:!1,externalDirectLink:null,personalAccessToken:"",personalAccessTokenInfo:null}},async mounted(){await Promise.allSettled([this.getPersonalAccessTokenInfo(),this.getAccountInfo()]),this.isLoading=!1},computed:{inputIsValid(){return!!this.personalAccessToken&&this.personalAccessToken.trim()!==""},personalAccessTokenDetails(){if(!this.personalAccessTokenInfo)return;const e=d.fromUnix(this.personalAccessTokenInfo.installed_at).format(d.US_FRIENDLY_DATE_WITH_TIME);return!this.personalAccessTokenInfo||this.personalAccessTokenInfo.last_updated_by_id<1?`Last updated at ${e}`:`Last updated by ${this.personalAccessTokenInfo.last_updated_by_name} at ${e}`}},methods:{async getAccountInfo(){const e=await P();e.scm_org_base_url&&(this.externalDirectLink=e.scm_org_base_url+"/_usersSettings/tokens")},async getPersonalAccessTokenInfo(){var e;try{this.personalAccessTokenInfo=await y()}catch(s){B.isAxiosError(s)&&s.response.status!==404&&this.$toast.error({title:"An error occurred",description:((e=s.response.data)==null?void 0:e.reason_phrase)??"An unknown error occured"})}},async handleUpdatePersonalAccessToken(){if(this.inputIsValid){this.isSaving=!0;try{await D(this.personalAccessToken),await b.fetchAzureDevopsChecksIntegrationStatus(),this.$toast.success({title:"Personal Token Updated",description:"The Personal Access Token for the Azure DevOps Checks integration has been successfully updated"}),this.$router.replace("/settings/integrations/azure-devops/checks")}finally{this.isSaving=!1}}}}},z={class:"page-content"},U={class:"flex flex-column gap-24px min-w-264px max-w-50p"},E={class:"flex flex-column gap-4px"},N={class:"flex w-full justify-between"},H=["href"],F=t("i",{class:"icon icon-openLink icon-12px text--normal"},null,-1),M={class:"flex"};function O(e,s,Z,Y,o,i){const _=c("BaseLink"),p=c("BaseParagraph"),f=c("PageHeader"),h=c("InputText"),m=c("BaseButton");return l(),u(L,null,[r(f,{title:"Manage Azure DevOps Checks Personal Access Token"},{subTitle:n(()=>[r(p,null,{default:n(()=>[a(" Setup instructions and information about the correct scope in Azure DevOps can be found "),r(_,{target:"_blank",href:"https://help.aikido.dev/doc/azure-pipelines-ci-pr-gating-via-aikido-dashboard-with-a-personal-access-token/dockZ58vSobZ"},{default:n(()=>[a("here.")]),_:1})]),_:1})]),_:1}),t("div",z,[t("div",U,[t("div",E,[r(h,{name:"personal_access_token",modelValue:o.personalAccessToken,"onUpdate:modelValue":s[0]||(s[0]=g=>o.personalAccessToken=g)},{title:n(()=>[t("span",N,[a(" Your Personal Access Token "),o.externalDirectLink?(l(),u("a",{key:0,href:o.externalDirectLink,target:"_blank",class:"link flex gap-4px align-center mt-2px"},[a(" Generate Access Token here "),F],8,H)):k("",!0)])]),_:1},8,["modelValue"]),this.personalAccessTokenInfo?(l(),w(p,{key:0,color:"gray"},{default:n(()=>[a(V(i.personalAccessTokenDetails),1)]),_:1})):k("",!0)]),t("div",M,[r(m,{variation:"primary",onClick:i.handleUpdatePersonalAccessToken,disabled:!i.inputIsValid,"is-loading":o.isSaving},{default:n(()=>[a("Update Token")]),_:1},8,["onClick","disabled","is-loading"])])])])],64)}const q=T(S,[["render",O]]);export{q as default};
