import{P as I}from"./PageHeader-46c38a32.js";import{_ as v,d as R,a2 as y,r as i,q as l,k as d,w as n,o as a,n as m,s as _,u as E,p as D,m as b,t as P,F as N,X as $,h as O,A as B,Q as L}from"./index-13ff96f4.js";import{D as x,a as M}from"./DataTable-e31a825a.js";import{a as C,D as w}from"./DataTableCell-51c0104f.js";import{G as U}from"./GenericIllustration-4aca88e5.js";import{O as G}from"./OverviewEmptyState-c8440b9c.js";import{D as X}from"./DataTableActionsCell-bde7169b.js";import{d as Y,a as H,r as K}from"./slack-a279c841.js";import{g as j}from"./getAuthorizeChannelUrl-cddf16ce.js";import"./ActionMenu-3e4470bf.js";const k=3,V={components:{DataTableRow:C,DataTableCell:w,DataTableActionsCell:X,BasePill:R,XTooltip:y},emits:["editAlert","removeAlert"],props:{setting:{type:Object,required:!0}},computed:{visisbleAppNamesText(){return this.setting.services.slice(0,k).map(e=>e.name).join(", ")},extraAppNames(){return this.setting.services.slice(k).map(e=>e.name)},sections(){return[{items:[{label:"Edit Alert",onClick:this.handleEditAlert,icon:"icon-edit",useBaseIcon:!0},{label:"Delete Alert",onClick:this.handleDeleteAlert,destructive:!0,icon:"icon-delete",useBaseIcon:!0,iconColor:"red"}]}]}},methods:{handleEditAlert(){this.$emit("editAlert",this.setting.instant_notification_channel)},handleDeleteAlert(){this.$emit("removeAlert",this.setting.instant_notification_channel)}}},q={class:"flex w-full align-center justify-between"};function F(e,t,o,u,h,s){const r=i("BaseParagraph"),f=i("XTooltip"),p=i("BasePill"),c=i("DataTableCell"),A=i("DataTableActionsCell"),g=i("DataTableRow");return l(),d(g,null,{default:n(()=>[a(c,null,{default:n(()=>[m("div",q,[a(r,null,{default:n(()=>[_(E(s.visisbleAppNamesText),1)]),_:1}),s.extraAppNames.length>0?(l(),d(p,{key:0,class:"cursor-default",title:`${s.extraAppNames.length} more`,variation:"gray-fill"},{default:n(()=>[a(f,{class:"ws-pre leading-16px"},{default:n(()=>[_(E(s.extraAppNames.join(`
`)),1)]),_:1})]),_:1},8,["title"])):D("",!0)])]),_:1}),a(c,null,{default:n(()=>[a(r,null,{default:n(()=>[_(E(o.setting.instant_notification_channel_name),1)]),_:1})]),_:1}),a(A,{sections:s.sections},null,8,["sections"])]),_:1})}const Z=v(V,[["render",F]]),z={components:{DataTable:x,DataTableHeader:M,DataTableRow:C,DataTableCell:w,GenericIllustration:U,OverviewEmptyState:G,RuntimeSlackAlertsRow:Z},emits:["addNotification","editAlert","removeAlert","enableSlackIntegration"],props:{settings:{type:Array,require:!0},hasIntegrationEnabled:{type:Boolean,default:!1}}},Q={colspan:"3"},J={colspan:"3"};function W(e,t,o,u,h,s){const r=i("DataTableHeader"),f=i("RuntimeSlackAlertsRow"),p=i("GenericIllustration"),c=i("OverviewEmptyState"),A=i("DataTableRow"),g=i("DataTable");return l(),d(g,null,{header:n(()=>[a(r,{width:"auto"},{default:n(()=>[_("App Name")]),_:1}),a(r,{width:"auto"},{default:n(()=>[_("Instant notification channel")]),_:1}),a(r,{width:"48px",alignment:"center"})]),body:n(()=>[o.settings.length>0?(l(!0),b(N,{key:0},P(o.settings,T=>(l(),d(f,{key:T.instant_notification_channel,setting:T,onEditAlert:t[0]||(t[0]=S=>e.$emit("editAlert",S)),onRemoveAlert:t[1]||(t[1]=S=>e.$emit("removeAlert",S))},null,8,["setting"]))),128)):o.hasIntegrationEnabled?(l(),d(A,{key:2},{default:n(()=>[m("td",J,[a(c,{title:e.$t("SETTINGS.SLACK.RUNTIME.EMPTY_STATE_TITLE"),description:e.$t("SETTINGS.SLACK.RUNTIME.EMPTY_STATE_DESCRIPTION"),actionLabel:e.$t("SETTINGS.SLACK.RUNTIME.EMPTY_STATE_ACTION_LABEL"),onOnAction:t[3]||(t[3]=T=>e.$emit("addNotification"))},{default:n(()=>[a(p)]),_:1},8,["title","description","actionLabel"])])]),_:1})):(l(),d(A,{key:1},{default:n(()=>[m("td",Q,[a(c,{title:e.$t("SETTINGS.SLACK.RUNTIME.NOT_CONNECTED.EMPTY_STATE_TITLE"),description:e.$t("SETTINGS.SLACK.RUNTIME.NOT_CONNECTED.EMPTY_STATE_DESCRIPTION"),actionLabel:e.$t("SETTINGS.SLACK.RUNTIME.NOT_CONNECTED.EMPTY_STATE_ACTION_LABEL"),onOnAction:t[2]||(t[2]=T=>e.$emit("enableSlackIntegration"))},{default:n(()=>[a(p)]),_:1},8,["title","description","actionLabel"])])]),_:1}))]),_:1})}const ee=v(z,[["render",W]]),te={components:{PageHeader:I,XPreloader:$,RuntimeSlackAlertsTable:ee},data(){return{breadcrumbs:[{label:"Zen",href:"/runtime/services"},{label:"Zen Slack Alerts"}],loading:!1,channels:[],services:[],settings:[]}},async mounted(){this.loading=!0,await this.loadData(),this.$route.query.create_notification&&this.hasIntegrationEnabled&&this.handleAddNotification(),this.loading=!1},computed:{hasIntegrationEnabled(){return this.channels.length>0}},methods:{async loadData(){await Promise.allSettled([this.loadNotificationSettings(),this.loadChannels(),this.loadServices()])},async loadNotificationSettings(){this.settings=await Y()},async loadChannels(){this.channels=await H()},async loadServices(){this.services=await O()},async handleAddNotification(){if(!this.hasIntegrationEnabled)return this.handleAddSlackChannel();const e=1;if(!B.isPayingAndNoProTrial()&&this.settings.length>=e)return this.$modal.show("UpgradeAccountModal",{title:"Upgrade to add more Slack Alerts",msg:`Our free plan includes ${e} Slack alert. Upgrade now to any paid plan to setup multiple alerts`});(await this.$modal.show("RuntimeSlackAlertsModal",{channels:this.channels,services:this.services,settings:this.settings})).type=="saved"&&await this.loadNotificationSettings()},async handleEditAlert(e){const t=this.settings.find(u=>u.instant_notification_channel==e);if(!t)return;(await this.$modal.show("RuntimeSlackAlertsModal",{channels:this.channels,services:this.services,settings:this.settings,setting:t})).type=="saved"&&await this.loadNotificationSettings()},async handleRemoveAlert(e){const t=this.settings.find(s=>s.instant_notification_channel==e);if(!t)return;const o=t.services.length,u=this.$t("RUNTIME_PROTECTION.X_SERVICES",o);await L({title:"Are you sure you want to permanently delete this alert?",markupDescription:`You will no longer receive notifications in the configured channel for *${u}*.`,buttonSubmitText:"Delete Alert"})&&(await K(e),this.$toast.success("Alerts successfully removed"),await this.loadNotificationSettings())},handleAddSlackChannel(){window.location=j("/runtime/alerts/slack")}}},ne=m("div",{class:"bg-purple-darkest w-64px h-64px rounded-16px flex justify-center align-center"},[m("i",{class:"icon icon-slack text-36px"})],-1),ae={class:"page-content"},ie={class:"flex align-center gap-12px mb-24px"};function se(e,t,o,u,h,s){const r=i("PageHeader"),f=i("XPreloader"),p=i("BaseButton"),c=i("RuntimeSlackAlertsTable");return l(),b(N,null,[a(r,{breadcrumbs:h.breadcrumbs,title:"Zen Slack Alerts"},{avatar:n(()=>[ne]),_:1},8,["breadcrumbs"]),m("div",ae,[h.loading?(l(),d(f,{key:0,class:"supercenter"})):(l(),b(N,{key:1},[m("div",ie,[a(p,{class:"ml-auto",size:"small",onClick:s.handleAddNotification},{default:n(()=>[_("Create Alert")]),_:1},8,["onClick"])]),a(c,{settings:h.settings,hasIntegrationEnabled:s.hasIntegrationEnabled,onEnableSlackIntegration:s.handleAddSlackChannel,onEditAlert:s.handleEditAlert,onRemoveAlert:s.handleRemoveAlert,onAddNotification:s.handleAddNotification},null,8,["settings","hasIntegrationEnabled","onEnableSlackIntegration","onEditAlert","onRemoveAlert","onAddNotification"])],64))])],64)}const fe=v(te,[["render",se]]);export{fe as default};
