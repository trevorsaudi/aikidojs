import{P as V}from"./PageHeader-46c38a32.js";import{_ as S,bk as B,V as y,g as z,f as C,H as x,x as R,a2 as J,r as l,q as h,m as f,n as e,o as n,w as s,s as t,F as k,bs as N,B as G,fv as D,fw as H,dL as P,u as I,p as g,N as K,A as $,k as w}from"./index-13ff96f4.js";const E={props:{initialClientId:String},components:{BaseBody:B,InputText:y,BaseLink:z,BaseButton:C,BaseHeading:x,BaseIcon:R,XTooltip:J},emits:["cancel","continue"],data(){return{clientId:this.initialClientId}},computed:{isComplete(){return!(!this.clientId||this.clientId&&this.clientId==="")}},methods:{handleCancel(){this.$emit("cancel")},handleSubmit(){this.$emit("continue",{clientId:this.clientId})},handleKeyDown(){this.isComplete&&this.handleSubmit()}}},T={class:"flex flex-column gap-32px"},L={class:"flex flex-column gap-8px"},F={class:"cloud-config__content__list"},U=e("strong",null,"Microsoft Entra ID service",-1),O=e("li",null,[t("Select App registrations and then click on "),e("strong",null,"New registration"),t(".")],-1),j=e("li",null,'Enter "AikidoSecurityVmScanner" and/or a descriptive name in the Name field, take note of it, it will be used again in step 3.',-1),q=e("li",null,'Leave the "Supported account types" default: "Accounts in this organizational directory only".',-1),X=e("li",null,[t("Click on "),e("strong",null,"Register"),t(".")],-1),W={class:"flex flex-column gap-24px"},Y=e("hr",{class:"divider my-24px"},null,-1),Q={class:"flex flex-end gap-16px mt-12px justify-end"};function Z(a,i,A,b,d,o){const p=l("BaseHeading"),r=l("BaseBody"),_=l("BaseLink"),c=l("XTooltip"),u=l("BaseIcon"),m=l("InputText"),v=l("BaseButton");return h(),f(k,null,[e("div",T,[e("div",L,[n(p,{as:"h3"},{default:s(()=>[t("Microsoft Azure VM Scanning Configuration")]),_:1}),n(r,{color:"subdued"},{default:s(()=>[t("Navigate to Microsoft Entra ID and create a new App Registration.")]),_:1})]),e("div",null,[e("ul",F,[e("li",null,[t("Log into your "),n(_,{href:"https://portal.azure.com/",target:"_blank"},{default:s(()=>[t("Azure Portal")]),_:1}),t(" and navigate to the "),U,t(". "),n(u,{icon:"icon-help",class:"cursor-help inline-flex valign-middle"},{default:s(()=>[n(c,null,{default:s(()=>[t("Formerly known as Azure Active Directory")]),_:1})]),_:1})]),O,j,q,X])]),e("div",null,[e("div",W,[n(m,{title:"Copy the Application ID and Paste it below.",placeholder:"bc38ac14-d509-4586-9e36-2dc0d503d9be",modelValue:d.clientId,"onUpdate:modelValue":i[0]||(i[0]=M=>d.clientId=M),modelModifiers:{trim:!0},name:"clientId",onEnterKeyPress:o.handleKeyDown},null,8,["modelValue","onEnterKeyPress"])])])]),e("div",null,[Y,e("div",Q,[n(v,{variation:"plain",onClicked:o.handleCancel},{default:s(()=>[t("Cancel")]),_:1},8,["onClicked"]),n(v,{disabled:!o.isComplete,onClicked:o.handleSubmit},{default:s(()=>[t("Continue")]),_:1},8,["disabled","onClicked"])])])],64)}const ee=S(E,[["render",Z]]),te={props:{initialClientSecret:String},components:{BaseBody:B,BaseButton:C,InputText:y,BaseHeading:x},emits:["goBack","continue"],data(){return{clientSecret:this.initialClientSecret}},computed:{isComplete(){return!(!this.clientSecret||this.clientSecret&&this.clientSecret==="")}},methods:{handleBack(){this.$emit("goBack",{clientSecret:this.clientSecret})},handleSubmit(){this.$emit("continue",{clientSecret:this.clientSecret})},handleKeyDown(){this.isComplete&&this.handleSubmit()}}},ne={class:"flex flex-column gap-32px"},se={class:"flex flex-column gap-8px"},oe=N('<ul class="cloud-config__content__list"><li>Click on <strong>Manage</strong> and then select <strong>Certificates &amp; secrets</strong>.</li><li>Under Client secrets, click on <strong>New client secret</strong></li><li>Enter a Description (i.e. AikidoSecurity) and select Expires &quot;In 2 years&quot;.</li><li>Click on <strong>Add</strong>.</li><li>Copy the secret key value</li></ul>',1),ie=e("hr",{class:"divider my-24px"},null,-1),le={class:"flex flex-end gap-16px mt-12px justify-end"};function ce(a,i,A,b,d,o){const p=l("BaseHeading"),r=l("BaseBody"),_=l("InputText"),c=l("BaseButton");return h(),f(k,null,[e("div",ne,[e("div",se,[n(p,{as:"h3"},{default:s(()=>[t("Add a new secret")]),_:1}),n(r,{color:"subdued"},{default:s(()=>[t("Now we need to add a secret and set an expiration date.")]),_:1})]),oe,n(_,{title:"Paste the secret key value below.",placeholder:"Jk7******************",modelValue:d.clientSecret,"onUpdate:modelValue":i[0]||(i[0]=u=>d.clientSecret=u),modelModifiers:{trim:!0},name:"secretKey",onEnterKeyPress:o.handleKeyDown},null,8,["modelValue","onEnterKeyPress"])]),e("div",null,[ie,e("div",le,[n(c,{variation:"plain",onClicked:o.handleBack},{default:s(()=>[t("Go back")]),_:1},8,["onClicked"]),n(c,{disabled:!o.isComplete,onClicked:o.handleSubmit},{default:s(()=>[t(" Continue ")]),_:1},8,["disabled","onClicked"])])])],64)}const ae=S(te,[["render",ce]]),de={props:{cloudId:Number,clientId:String,clientSecret:String},components:{BaseBody:B,BaseButton:C,BaseHeading:x,BaseParagraph:G,CopyButton:D},emits:["cancel","goBack","showDefault"],data:()=>({subscriptionId:null,roleJson:null,requiredActions:["Microsoft.Compute/virtualMachines/read","Microsoft.Compute/disks/beginGetAccess/action","Microsoft.Compute/disks/endGetAccess/action","Microsoft.Compute/snapshots/read","Microsoft.Compute/snapshots/write","Microsoft.Compute/snapshots/delete","Microsoft.Compute/snapshots/beginGetAccess/action","Microsoft.Compute/snapshots/endGetAccess/action","Microsoft.Authorization/roleAssignments/read"],showRawJson:!1}),methods:{handleGoBack(){this.$emit("goBack",{})},handleCopyRoleJson(){window.isSecureContext&&navigator.clipboard.writeText(this.roleJson)},handleViewRoleJson(){this.showRawJson=!this.showRawJson},async handleSubmit(){await H({cloud_id:this.cloudId,client_id:this.clientId,client_secret:this.clientSecret}),this.$emit("continue")},async getSubscriptionId(){if(this.subscriptionId)return this.subscriptionId;const a=await P(this.cloudId);return this.subscriptionId=a.account_id,this.subscriptionId},async getRoleJson(){const i={properties:{roleName:"Aikido VM Scanner",description:"",assignableScopes:[`/subscriptions/${await this.getSubscriptionId()}`],permissions:[{actions:this.requiredActions,notActions:[],dataActions:[],notDataActions:[]}]}};this.roleJson=JSON.stringify(i,null,4)}},mounted(){this.getRoleJson()}},re={class:"flex flex-column gap-32px"},ue={class:"flex flex-column gap-8px"},he={class:"flex justify-between"},pe={class:"cloud-config__content__list"},_e=e("strong",null,"Step 1",-1),me=e("strong",null,"Subscriptions",-1),fe={class:"pl-12px my-8px"},ge={class:"flex"},Se=e("strong",null,'"Access Control (IAM)"',-1),Ce=e("strong",null,'"Add"',-1),xe=e("strong",null,'"Add custom role"',-1),ke={class:"flex"},Ae=e("strong",null,'"JSON"',-1),be=e("strong",null,'"Edit"',-1),we={class:"flex"},Be={class:"flex flex-column gap-8px"},ye={class:"flex flex-row gap-8px"},ve={class:"flex"},Ie=e("strong",null,'"Save"',-1),$e={class:"flex"},ze=e("strong",null,'"Review + assign"',-1),Ge=e("strong",null,'"Create"',-1),Me=e("strong",null,"Step 2",-1),Ve=e("strong",null,"Subscription overview",-1),Re={class:"pl-12px my-8px"},Je={class:"flex"},Ne=e("strong",null,'"Access Control (IAM)"',-1),De=e("strong",null,'"Add"',-1),He=e("strong",null,'"Add role assignment"',-1),Pe={class:"flex"},Ke=e("strong",null,"Role",-1),Ee=e("strong",null,'"Next"',-1),Te={class:"flex"},Le=e("strong",null,'"Assign access to"',-1),Fe={class:"flex"},Ue=e("strong",null,'"Select Members"',-1),Oe={class:"flex"},je=e("strong",null,'"Select"',-1),qe=e("strong",null,'"Review + assign"',-1),Xe={key:0,class:"bg-cream p-12px rounded-4px"},We=e("hr",{class:"divider my-24px"},null,-1),Ye={class:"flex flex-end gap-16px mt-12px justify-end"};function Qe(a,i,A,b,d,o){const p=l("BaseHeading"),r=l("BaseBody"),_=l("BaseLink"),c=l("BaseParagraph"),u=l("BaseButton");return h(),f(k,null,[e("div",re,[e("div",ue,[n(p,{as:"h3"},{default:s(()=>[t("Grant access to App Registration")]),_:1}),n(r,{color:"subdued"},{default:s(()=>[t("This is the final step, let’s create a custom role and assign it to the App Registration.")]),_:1}),n(r,{color:"subdued"},{default:s(()=>[t(" We will be using a custom role to grant the necessary permissions to the App Registration. Alternatively, "),n(_,{target:"_blank",href:"https://help.aikido.dev/doc/setup-configuration-in-azure/docUzOYdlI6z",class:"text-14px"},{default:s(()=>[t(" use Azure's default roles instead ")]),_:1})]),_:1})]),e("div",he,[e("div",pe,[n(c,null,{default:s(()=>[_e,t(" Create a custom role by navigating to "),me,t(", then find the relevant Subscription ")]),_:1}),e("ul",fe,[e("li",ge,[n(c,null,{default:s(()=>[t("Under "),Se,t(", click on "),Ce,t(", then "),xe]),_:1})]),e("li",ke,[n(c,null,{default:s(()=>[t("Go to the "),Ae,t(" tab and open the editor by clicking on "),be]),_:1})]),e("li",we,[e("div",Be,[n(c,null,{default:s(()=>[t("Copy and paste the following JSON into the editor")]),_:1}),e("div",ye,[n(u,{variation:"blue",size:"small",onClicked:o.handleCopyRoleJson},{default:s(()=>[t(" Copy role JSON ")]),_:1},8,["onClicked"]),n(u,{variation:"plain",size:"small",onClicked:o.handleViewRoleJson},{default:s(()=>[t(I(a.showRawJson?"Hide":"View")+" raw JSON ",1)]),_:1},8,["onClicked"])])])]),e("li",ve,[n(c,null,{default:s(()=>[t("Review the permissions, then click "),Ie]),_:1})]),e("li",$e,[n(c,null,{default:s(()=>[t(" At the bottom, click "),ze,t(", then "),Ge]),_:1})])]),n(c,null,{default:s(()=>[Me,t(" Go back to the "),Ve,t(" to assign the newly created role ")]),_:1}),e("ul",Re,[e("li",Je,[n(c,null,{default:s(()=>[t("Under "),Ne,t(", click on "),De,t(", then "),He]),_:1})]),e("li",Pe,[n(c,null,{default:s(()=>[t("Find the "),Ke,t(" tab, search and select the custom role you created (”Aikido VM Scanner”), then click "),Ee]),_:1})]),e("li",Te,[n(c,null,{default:s(()=>[t("Leave the "),Le,t(" default value")]),_:1})]),e("li",Fe,[n(c,null,{default:s(()=>[t("Click on "),Ue,t(" and find the App Registration you created at the start, select it.")]),_:1})]),e("li",Oe,[n(c,null,{default:s(()=>[t("Click "),je,t(", then click "),qe,t(" twice ")]),_:1})])])]),a.showRawJson?(h(),f("div",Xe,[n(c,{size:a.small,allowNewlines:!0},{default:s(()=>[t(I(a.roleJson),1)]),_:1},8,["size"])])):g("",!0)])]),e("div",null,[We,e("div",Ye,[n(u,{variation:"plain",onClicked:o.handleGoBack},{default:s(()=>[t("Go back")]),_:1},8,["onClicked"]),n(u,{onClicked:o.handleSubmit},{default:s(()=>[t("Save & Continue")]),_:1},8,["onClicked"])])])],64)}const Ze=S(de,[["render",Qe]]),et={components:{BaseBody:B,InputText:y,BaseButton:C,BaseSelect:K,BaseHeading:x},emits:["complete"],computed:{},methods:{async handleSubmit(){this.$emit("complete")}}},tt={class:"flex flex-column gap-32px"},nt={class:"flex flex-column gap-8px"},st=e("div",null,[e("div",{class:"flex flex-column gap-24px"})],-1),ot=e("hr",{class:"divider my-24px"},null,-1),it={class:"flex flex-end gap-16px mt-12px justify-end"};function lt(a,i,A,b,d,o){const p=l("BaseHeading"),r=l("BaseBody"),_=l("BaseButton");return h(),f(k,null,[e("div",tt,[e("div",nt,[n(p,{as:"h3"},{default:s(()=>[t("All done!")]),_:1}),n(r,{color:"subdued"},{default:s(()=>[t(" Your virtual machines are connected, you are good to go! ")]),_:1})]),st]),e("div",null,[ot,e("div",it,[n(_,{onClicked:o.handleSubmit},{default:s(()=>[t(" View scan ")]),_:1},8,["onClicked"])])])],64)}const ct=S(et,[["render",lt]]),at={components:{PageHeader:V,BaseHeading:x,BaseLink:z,InputText:y,BaseButton:C,BaseParagraph:G,StartAzureSideScanningConfiguration:ee,AddSecretAzureSideScanningConfiguration:ae,GrantAccessAzureSideScanningConfiguration:Ze,CompleteAzureSideScanningConfiguration:ct},data(){return{profile:$,showStartStep:!0,showAddSecretStep:!1,showGrantAccessStep:!1,showCompleteSetupStep:!1,completedSteps:[],cloudId:this.$route.params.cloud_id,clientId:"",clientSecret:"",isSaving:!1}},computed:{steps(){return[{title:"Register your app",completed:this.completedSteps.includes("start"),pending:this.showStartStep}]},isFormValid(){return this.clientId.trim()!==""&&this.clientSecret.trim()!==""},isSubmitButtonDisabled(){return!this.isFormValid},docsUrl(){return"https://help.aikido.dev/"},breadcrumbs(){return[{label:"Side scanning"},{label:"Connect Azure account"}]}},methods:{handleCancel(){this.$router.back()},handleContinue(a,i){if($.data.group.is_demo_group===1)return this.$modal.show("AddWorkspaceRedirectModal");switch(this.completedSteps.push(a),a){case"start":this.clientId=i.clientId,this.showStartStep=!1,this.showAddSecretStep=!0;return;case"secret":this.clientSecret=i.clientSecret,this.showAddSecretStep=!1,this.showGrantAccessStep=!0;return;case"grant-access":this.showGrantAccessStep=!1,this.showCompleteSetupStep=!0;return}},handleGoBack(a,i){switch(this.completedSteps.pop(),a){case"secret":this.secretKey=i.secretKey,this.showStartStep=!0,this.showAddSecretStep=!1;return;case"grant-access":this.showAddSecretStep=!0,this.showGrantAccessStep=!1;return}},handleComplete(){this.showCompleteSetupStep=!1,this.$router.back()},handleKeyDown(){this.isFormValid&&this.handleSubmit()},async handleSubmit(){this.$router.push(`/clouds/${this.cloudId}/virtual-machines`)}}},dt={class:"page-content bg-white"},rt={class:"flex flex-column gap-32px"},ut={class:"flex flex-column gap-32px"};function ht(a,i,A,b,d,o){const p=l("PageHeader"),r=l("StartAzureSideScanningConfiguration"),_=l("AddSecretAzureSideScanningConfiguration"),c=l("GrantAccessAzureSideScanningConfiguration"),u=l("CompleteAzureSideScanningConfiguration");return h(),f(k,null,[n(p,{breadcrumbs:o.breadcrumbs,title:"Azure VM hard drive scanning"},null,8,["breadcrumbs"]),e("div",dt,[e("div",rt,[e("div",ut,[d.showStartStep?(h(),w(r,{key:0,"initial-client-id":d.clientId,onCancel:o.handleCancel,onContinue:i[0]||(i[0]=m=>o.handleContinue("start",m))},null,8,["initial-client-id","onCancel"])):g("",!0),d.showAddSecretStep?(h(),w(_,{key:1,"initial-client-secret":d.clientSecret,onGoBack:i[1]||(i[1]=m=>o.handleGoBack("secret",m)),onContinue:i[2]||(i[2]=m=>o.handleContinue("secret",m))},null,8,["initial-client-secret"])):g("",!0),d.showGrantAccessStep?(h(),w(c,{key:2,"cloud-id":d.cloudId,"client-id":d.clientId,"client-secret":d.clientSecret,onGoBack:i[3]||(i[3]=()=>o.handleGoBack("grant-access")),onContinue:i[4]||(i[4]=m=>o.handleContinue("grant-access",m))},null,8,["cloud-id","client-id","client-secret"])):g("",!0),d.showCompleteSetupStep?(h(),w(u,{key:3,onCancel:o.handleCancel,onComplete:o.handleComplete},null,8,["onCancel","onComplete"])):g("",!0)])])])],64)}const mt=S(at,[["render",ht]]);export{mt as default};
