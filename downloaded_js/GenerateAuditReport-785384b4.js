import{_ as F,f as R,H as S,N as T,a2 as k,A as y,fd as P,ad as V,r as s,m as h,o as t,w as l,k as G,p as f,F as U,q as c,s as o,n as _,S as b}from"./index-13ff96f4.js";import{B as L}from"./BaseCard-471d3203.js";import{S as N}from"./SelectTeam-d51b76ec.js";import{I as A,R as H}from"./IncludeReportFields-959c2d1b.js";import"./StackedAvatars-4925baeb.js";import"./AuditReport-bfa18622.js";import"./PageHeader-46c38a32.js";import"./DataTable-e31a825a.js";import"./DataTableCell-51c0104f.js";import"./languages-12749071.js";import"./RuleComplianceStatus-87ae0def.js";import"./GreenCheckMarkRoundedIcon-3695986c.js";import"./IssueGroupTypeColumn-03f014b0.js";import"./BracesIcon-0a8568f4.js";import"./BoxIcon-9908469f.js";import"./IssueStatusTag-dacefc0a.js";import"./DataTableSeverityIndicator-48ffb8dc.js";import"./slaSettings-fece48e7.js";import"./InputCheckbox-81cb3ca6.js";const I={components:{BaseCard:L,IncludeReportFields:A,BaseButton:R,BaseHeading:S,ReportPreviewModal:H,SelectTeam:N,BaseSelect:T,XTooltip:k},inject:["scrollY"],data(){return{showReportPreview:!1,isGenerating:!1,includedFields:[],selectedTeam:null,teams:[],isLoading:!0}},async mounted(){try{await this.loadTeams()}finally{this.isLoading=!1}},computed:{teamSelectValues(){return this.teams.length==0?[{id:"add_team",title:"Create Team"}]:this.teams.map(e=>({id:e.id,title:e.name})).sort((e,r)=>{const n=e.title.toLowerCase(),d=r.title.toLowerCase();return n==d?0:n>d?1:-1})},excludedReportFields(){return this.selectedTeam?["aikido_benchmark"]:[]},areButtonsSticky(){return this.isLoading?!1:this.scrollY+window.innerHeight<document.body.scrollHeight-80}},methods:{handleUpdateSelectedFields(e){this.includedFields=e},async handleGenerateReport(){if(y.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");this.isGenerating=!0;try{const e=await P(this.includedFields.map(r=>r.id),this.selectedTeam);this.$router.push(`/reports/audit-reports/external/requests/${e}`)}finally{this.isGenerating=!1}},handleShowPreview(){this.showReportPreview=!0},handleClosePreview(){this.showReportPreview=!1},async loadTeams(){this.teams=await V()},onUpdateTeamFilter(e){if(e=="add_team"){this.$router.push("/settings/teams");return}this.selectedTeam=e}}},q={key:0,class:"flex flex-column gap-12px mb-24px max-w-600px"},M={class:"flex gap-12px align-center"};function X(e,r,n,d,i,a){const w=s("XTooltip"),g=s("BaseIcon"),p=s("BaseHeading"),x=s("BaseSelect"),B=s("IncludeReportFields"),m=s("BaseButton"),v=s("BaseCard"),C=s("ReportPreviewModal");return c(),h(U,null,[t(v,{title:"Generate a report","is-loading":i.isLoading},{default:l(()=>{var u;return[i.isLoading?f("",!0):(c(),h("div",q,[t(p,{as:"h5",class:"inline-flex gap-4px align-center"},{default:l(()=>[o(" Select a team to focus the report on "),t(g,{icon:"icon-help",class:"cursor-help inline-flex"},{default:l(()=>[t(w,null,{default:l(()=>[o("Reports can be viewed for specific teams, with their specific repos, containers and domains.")]),_:1})]),_:1})]),_:1}),t(x,{id:"selectedTeam",class:"w-full",options:a.teamSelectValues,modelValue:i.selectedTeam,"onUpdate:modelValue":a.onUpdateTeamFilter,placeholder:"All teams",disablePlaceholder:!1},null,8,["options","modelValue","onUpdate:modelValue"])])),t(p,{as:"h5"},{default:l(()=>[o("Select the fields you'd like to include")]),_:1}),t(B,{request:{status:"open"},"exclude-fields":a.excludedReportFields,onUpdate:a.handleUpdateSelectedFields,"allow-edits":!0,class:"mt-12px",initialSelectedFields:(u=e.$route.query.checked)==null?void 0:u.split(",")},null,8,["exclude-fields","onUpdate","initialSelectedFields"]),_("div",{class:b(["sticky pin-b p-24px -mx-24px -mb-24px bg-white",{"shadow-top-scroll":a.areButtonsSticky}])},[_("div",M,[t(m,{variation:"plain",onClick:a.handleShowPreview},{default:l(()=>[o(" View preview ")]),_:1},8,["onClick"]),t(m,{variation:"primary",onClick:a.handleGenerateReport,"is-loading":i.isGenerating},{default:l(()=>[o(" Generate report ")]),_:1},8,["onClick","is-loading"])])],2)]}),_:1},8,["is-loading"]),i.showReportPreview?(c(),G(C,{key:0,onClose:a.handleClosePreview,"included-fields":i.includedFields,"filter-team-id":i.selectedTeam},null,8,["onClose","included-fields","filter-team-id"])):f("",!0)],64)}const re=F(I,[["render",X]]);export{re as default};
