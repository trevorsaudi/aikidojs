import{_ as N,f as R,H as b,M as E,B as I,N as L,cF as T,an as F,r as t,q as i,k as p,w as e,o as n,s as r,u as _,m as u,p as h,n as m,F as k,t as B,ai as z}from"./index-13ff96f4.js";import{l as M,c as V}from"./licenses-6ab38515.js";import{B as P}from"./BaseForm-4c6fa06f.js";import{a as A}from"./licenses-81c77780.js";const O={components:{BaseButton:R,BaseForm:P,BaseHeading:b,BaseModal:E,BaseParagraph:I,BaseSelect:L,InputTextArea:T},emits:["close"],props:{packageName:String,isIgnore:{type:Boolean,default:!1}},data(){return{scoringValue:void 0,scoringReason:void 0,repos:[],images:[],license:void 0,scoringValueError:void 0,loaded:!1}},async mounted(){const{grouped_licenses:s}=await M({filter_package_name:this.packageName});this.license=s[0],this.scoringValue=this.license.new_risk,this.scoringReason=this.license.new_risk_reason,this.repos=this.license.repos,this.images=this.license.images,this.isIgnore&&(this.scoringValue="low"),this.loaded=!0},computed:{scoringValues(){return Object.entries(A).map(([c,g])=>({id:c,title:g}))},repositoryNames(){return this.repos.map(s=>s.scm_repo_name)},containerRepoNames(){return this.images.map(s=>s.cloud_repo_name)}},methods:{async handleSubmit(){if(this.scoringValueError=void 0,!this.scoringValue){this.scoringValueError="Scoring value is required";return}this.loaded=!1;for(let s of this.license.repos)await V({repo_id:s.id,package_name:this.license.package_name,language:this.license.language,new_risk:this.scoringValue,reason:this.scoringReason});for(let s of this.license.images)await V({image_id:s.id,package_name:this.license.package_name,language:this.license.language,new_risk:this.scoringValue,reason:this.scoringReason});F.emit("licenseUpdated"),this.$emit("saved")},handleCancel(){this.$emit("close")}}},H={key:0,class:"h-32px relative"},U={key:1,class:"flex flex-column gap-12px"},q={class:"flex flex-column gap-12px mb-12px"},D={key:0,class:"flex flex-column gap-8px"},K={class:"list-disc pl-8px"},X={key:1,class:"flex flex-column gap-8px"},j={class:"list-disc pl-8px"};function G(s,c,g,J,l,o){const d=t("BaseParagraph"),x=t("XPreloader"),w=t("BaseHeading"),y=t("BaseSelect"),S=t("InputTextArea"),v=t("BaseForm"),f=t("BaseButton"),C=t("BaseModal");return i(),p(C,{onClose:o.handleCancel},{header:e(()=>[n(d,{color:"gray",size:"small"},{default:e(()=>{var a;return[r(_((a=l.license)==null?void 0:a.package_name),1)]}),_:1})]),content:e(()=>[l.loaded?(i(),u("div",U,[n(w,{as:"h3"},{default:e(()=>[r(" Change License Risk Score ")]),_:1}),s.$featureflags.licenses_in_feed?(i(),p(d,{key:0,size:"medium",loose:""},{default:e(()=>[r(" Only licenses with critical and high risk levels will be shown in the feed. Issues scored as low or medium will be moved to the solved view. ")]),_:1})):h("",!0),m("div",q,[o.repositoryNames.length>0?(i(),u("div",D,[n(d,{size:"medium"},{default:e(()=>[r(" This will affect its usage in the following repositories: ")]),_:1}),m("ul",K,[(i(!0),u(k,null,B(o.repositoryNames,a=>(i(),p(d,{size:"medium",key:a},{default:e(()=>[m("li",null,_(a),1)]),_:2},1024))),128))])])):h("",!0),o.containerRepoNames.length>0?(i(),u("div",X,[n(d,{size:"medium"},{default:e(()=>[r(" This will affect its usage in the following container repositories: ")]),_:1}),m("ul",j,[(i(!0),u(k,null,B(o.containerRepoNames,a=>(i(),p(d,{size:"medium",key:a},{default:e(()=>[m("li",null,_(a),1)]),_:2},1024))),128))])])):h("",!0)]),n(v,{id:"scoringForm",onSubmit:z(o.handleSubmit,["prevent"])},{default:e(()=>[n(y,{modelValue:l.scoringValue,"onUpdate:modelValue":c[0]||(c[0]=a=>l.scoringValue=a),name:"scoring",label:"Package Risk Level",options:o.scoringValues,error:l.scoringValueError,disabled:g.isIgnore},null,8,["modelValue","options","error","disabled"]),n(S,{modelValue:l.scoringReason,"onUpdate:modelValue":c[1]||(c[1]=a=>l.scoringReason=a),name:"scoringReason",title:"Score Change Reason",placeholder:`• A license for this package was purchased.
• The package is not statically linked.
• The package is no longer in use`,rows:"4"},null,8,["modelValue","placeholder"])]),_:1},8,["onSubmit"])])):(i(),u("div",H,[n(x,{class:"absolute-centered mt-12px",size:"medium"})]))]),footer:e(()=>[n(f,{variation:"tertiary",onClicked:o.handleCancel,class:"ml-auto"},{default:e(()=>[r("Cancel")]),_:1},8,["onClicked"]),n(f,{variation:"primary",type:"submit",form:"scoringForm"},{default:e(()=>[r("Submit")]),_:1})]),_:1},8,["onClose"])}const $=N(O,[["render",G]]);export{$ as default};
