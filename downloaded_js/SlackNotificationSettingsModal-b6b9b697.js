import{_ as v,M as T,B as E,H as x,f as b,z as S,N as B,X as k,ad as w,an as I,r as d,q as f,k as g,w as s,o as i,s as r,p as _,n as l,u as V,m as z}from"./index-13ff96f4.js";import{a as L,e as A,u as U,f as O}from"./slack-a279c841.js";import{s as M}from"./sortBy-b18e8152.js";import{g as F}from"./getAuthorizeChannelUrl-cddf16ce.js";import{i as P}from"./issueTypes-85f86ea8.js";import{B as D}from"./BaseRadioInput-a7ac3557.js";import"./ScmSecurity-27bd32ff.js";const H={props:{settingsId:Number},emits:["close"],components:{BaseModal:T,BaseParagraph:E,BaseHeading:x,BaseButton:b,InputSwitch:S,BaseSelect:B,XPreloader:k,BaseRadioInput:D},data(){return{channels:[],teams:[],target:"organization",selectedTeam:null,selectTeam:!1,selectTeamError:null,criticalNotificationChannel:null,criticalNotificationError:null,digestNotificationChannel:null,digestNotificationError:null,severityThresholdLevel:null,selectedIssueTypeForNotification:"all",isLoading:!0}},async mounted(){await Promise.allSettled([this.loadChannels(),this.loadSettings(),this.loadTeams()]),this.isLoading=!1},watch:{digestNotificationEnabled(e){e||(this.digestNotificationError=null,this.digestNotificationChannel=null)},digestNotificationChannel(){this.digestNotificationError!==null&&(this.digestNotificationError=null)},criticalNotificationEnabled(e){e||(this.criticalNotificationError=null,this.criticalNotificationChannel=null)},criticalNotificationChannel(){this.criticalNotificationError!==null&&(this.criticalNotificationError=null)},severityThresholdLevel(e){this.criticalNotificationError!==null&&e&&(this.criticalNotificationError=null)},target(){this.target==="organization"&&(this.selectTeamError=null,this.selectedTeam=null)},selectedTeam(){this.selectTeamError!==null&&(this.selectTeamError=null)}},computed:{isEditing(){return this.settingsId>0},modalHeader(){return"Configure Slack Alerts"},channelOptions(){return[{title:"Channels",options:this.channels},{title:"Connect channel",options:[{id:"add_channel",title:"Link a different channel"}]}]},severityThresholdLevelOptions(){return[{id:"critical",title:"Critical issues"},{id:"high",title:"High and critical issues"},{id:"medium",title:"Medium, high and critical issues"},{id:"low",title:"Any severity issues"}]},issueTypeForNotificationOptions(){return[{id:"all",title:"All Issue Types"},...P.map(e=>({id:e,title:this.$t(`ISSUE_TYPE.${e}`)}))]},addSlackChannelUrl(){return F()},teamOptions(){return this.teams.map(e=>({id:e.id,title:e.name}))},criticalNotificationEnabled(){return!!this.criticalNotificationChannel},digestNotificationEnabled(){return!!this.digestNotificationChannel},disableConfirmButton(){return!this.digestNotificationEnabled&&!this.criticalNotificationEnabled}},methods:{async loadChannels(){let e=await L();const a=M(e,"channel_name");this.channels=a.map(u=>({id:u.channel_id,title:`# ${u.channel_name}`}))},async loadSettings(){if(!this.isEditing)return;const e=await A(this.settingsId);this.criticalNotificationChannel=e.new_criticals_channel,this.criticalNotificationEnabled=e.push_new_criticals>0,this.digestNotificationChannel=e.digest_friday_channel,this.digestNotificationEnabled=e.push_digest_friday,this.severityThresholdLevel=e.push_new_criticals>0?e.minimum_severity_threshold:null,this.selectedIssueTypeForNotification=e.issue_type,this.selectedTeam=e.team_id>0?e.team_id:null,this.target=e.team_id>0?"team":"organization"},async loadTeams(){this.teams=await w()},handleCloseModal(){this.$emit("close")},async handleConfirm(){if(this.target==="team"&&!this.selectedTeam&&(this.selectTeamError="You must select a team or disable it"),!(this.criticalNotificationError!==null||this.digestNotificationError!==null||this.selectTeamError!==null)){if(this.criticalNotificationEnabled&&!this.severityThresholdLevel){this.criticalNotificationError="You must select a severity level for the alerts.";return}this.isEditing?await U({id:this.settingsId,push_digest_friday:this.digestNotificationEnabled,digest_friday_channel:this.digestNotificationChannel,push_new_criticals:this.criticalNotificationEnabled,new_criticals_channel:this.criticalNotificationChannel,team_id:this.selectedTeam,severity_threshold_level:this.severityThresholdLevel,issue_type:this.selectedIssueTypeForNotification}):await O({push_digest_friday:this.digestNotificationEnabled,digest_friday_channel:this.digestNotificationChannel,push_new_criticals:this.criticalNotificationEnabled,new_criticals_channel:this.criticalNotificationChannel,team_id:this.selectedTeam,severity_threshold_level:this.severityThresholdLevel,issue_type:this.selectedIssueTypeForNotification}),Toast.success({title:this.$t("NOTIFICATIONS.INTEGRATION_UPDATED.TITLE"),description:this.$t("CHANGES_SAVED")}),I.emit("slackChannelUpdated"),this.handleCloseModal()}},handleSelectDigestChannel(e){e===""&&(this.digestNotificationChannel=null),e==="add_channel"&&this.handleAddSlackChannel()},handleSelectCriticalsChannel(e){e===""&&(this.criticalNotificationChannel=null),e==="add_channel"&&this.handleAddSlackChannel()},handleAddSlackChannel(){window.location=this.addSlackChannelUrl}}},R={class:"flex flex-column gap-24px"},X={class:"flex flex-column gap-12px"},G=l("hr",{class:"divider w-full"},null,-1),Y={class:"flex flex-column gap-16px"},j={class:"flex flex-column gap-4px"},W={class:"flex gap-12px align-center"},q={class:"flex align-center gap-4px cursor-pointer"},J=l("label",{for:"organization",class:"paragraph paragraph--small text-carbon-60 cursor-pointer"},"All",-1),K={class:"flex align-center gap-4px cursor-pointer"},Q=l("label",{for:"team",class:"paragraph paragraph--small text-carbon-60 cursor-pointer"},"Team-based",-1),Z={key:0,class:"flex flex-column gap-4px"},$=l("hr",{class:"divider w-full"},null,-1),ee={class:"flex flex-column gap-8px"},te={class:"flex justify-between align-center"},ie={class:"flex flex-column gap-4px"},le=l("hr",{class:"divider w-full"},null,-1),ae={class:"flex flex-column gap-8px"},se={class:"flex justify-between align-center"},ne={class:"flex flex-column gap-8px"};function oe(e,a,u,re,t,n){const c=d("BaseParagraph"),N=d("XPreloader"),C=d("BaseHeading"),m=d("BaseRadioInput"),h=d("BaseSelect"),p=d("BaseButton"),y=d("BaseModal");return f(),g(y,{width:600,onClose:n.handleCloseModal},{header:s(()=>[i(c,{color:"gray"},{default:s(()=>[r("Slack Alerts")]),_:1})]),content:s(()=>[t.isLoading?(f(),g(N,{key:0,class:"supercenter",size:"medium"})):_("",!0),l("div",R,[l("div",X,[i(C,{as:"h3"},{default:s(()=>[r(V(n.modalHeader),1)]),_:1}),i(c,{size:"medium"},{default:s(()=>[r("Tailor multiple chat alerts.")]),_:1})]),G,l("div",Y,[l("div",j,[i(c,{size:"medium",bold:""},{default:s(()=>[r("Choose your audience")]),_:1}),i(c,{size:"small",color:"subdued"},{default:s(()=>[r("Tip: Link repositories to teams and configure multiple alerts.")]),_:1})]),l("div",W,[l("div",q,[i(m,{name:"target",id:"organization",value:"organization",onSelect:a[0]||(a[0]=o=>t.target="organization"),checked:t.target==="organization"},null,8,["checked"]),J]),l("div",K,[i(m,{name:"target",id:"team",value:"team",onSelect:a[1]||(a[1]=o=>t.target="team"),checked:t.target==="team"},null,8,["checked"]),Q])]),t.target==="team"?(f(),z("div",Z,[i(h,{class:"text-gray-900","option-groups":n.teamOptions,modelValue:t.selectedTeam,"onUpdate:modelValue":a[2]||(a[2]=o=>t.selectedTeam=o),error:t.selectTeamError},null,8,["option-groups","modelValue","error"])])):_("",!0)]),$,l("div",ee,[l("div",te,[i(c,{size:"medium",bold:""},{default:s(()=>[r("Channel for Weekly Digest")]),_:1})]),i(c,{size:"small",color:"subdued"},{default:s(()=>[r(" Weekly summary sent on Friday. ")]),_:1}),l("div",ie,[i(h,{class:"text-gray-900","option-groups":n.channelOptions,modelValue:t.digestNotificationChannel,"onUpdate:modelValue":[a[3]||(a[3]=o=>t.digestNotificationChannel=o),n.handleSelectDigestChannel],error:t.digestNotificationError,"disable-placeholder":!1,placeholder:"No channel"},null,8,["option-groups","modelValue","onUpdate:modelValue","error"])])]),le,l("div",ae,[l("div",se,[i(c,{size:"medium",bold:""},{default:s(()=>[r("Channel for instant alerts")]),_:1})]),i(c,{size:"small",color:"subdued"},{default:s(()=>[r(" Get instant alerts on new vulnerabilities, specified on issue type and severity level. ")]),_:1}),l("div",ne,[i(h,{class:"text-gray-900",modelValue:t.selectedIssueTypeForNotification,"onUpdate:modelValue":a[4]||(a[4]=o=>t.selectedIssueTypeForNotification=o),options:n.issueTypeForNotificationOptions,placeholder:"Issue Type"},null,8,["modelValue","options"]),i(h,{class:"text-gray-900",modelValue:t.severityThresholdLevel,"onUpdate:modelValue":a[5]||(a[5]=o=>t.severityThresholdLevel=o),options:n.severityThresholdLevelOptions,error:e.severityThresholdLevelError,placeholder:"Severity level"},null,8,["modelValue","options","error"]),i(h,{class:"text-gray-900","option-groups":n.channelOptions,"onUpdate:modelValue":[n.handleSelectCriticalsChannel,a[6]||(a[6]=o=>t.criticalNotificationChannel=o)],modelValue:t.criticalNotificationChannel,error:t.criticalNotificationError,"disable-placeholder":!1,placeholder:"No channel"},null,8,["option-groups","onUpdate:modelValue","modelValue","error"])])])])]),footer:s(()=>[i(p,{onClicked:n.handleCloseModal,variation:"plain",class:"ml-auto"},{default:s(()=>[r("Cancel")]),_:1},8,["onClicked"]),i(p,{onClicked:n.handleConfirm,disabled:n.disableConfirmButton},{default:s(()=>[r("Save Alert")]),_:1},8,["onClicked","disabled"])]),_:1},8,["onClose"])}const ge=v(H,[["render",oe]]);export{ge as default};
