import{_ as f,f as _,d as b,an as c,aV as l,cg as k,a0 as B,Z as C,r as s,k as R,m as v,o as i,w as n,n as r,F as I,q as u,s as y}from"./index-13ff96f4.js";import{P as T}from"./PageHeader-46c38a32.js";const x={components:{BaseButton:_,BasePill:b,PageHeader:T},data(){return{repositories:[],isLoading:!0,isFetchingRepositories:!0}},async mounted(){c.on("bitbucketChecksConfigurationUpdated",this.getRepositories),await this.getRepositories(),this.isLoading=!1},beforeUnmount(){c.off("bitbucketChecksConfigurationUpdated",this.getRepositories)},provide(){return{repositories:l(()=>this.repositories),isFetchingRepositories:l(()=>this.isFetchingRepositories)}},computed:{breadcrumbs(){return[{label:"Settings",href:"/settings/integrations"},{label:"Bitbucket Checks"}]},repositoriesWithConfiguration(){return this.repositories.filter(e=>!!e.configuration)}},methods:{async getRepositories(e){this.isFetchingRepositories=!0;try{const t=await k(e);this.repositories=t}catch(t){B.isAxiosError(t)&&t.response.status===404?this.$toast.error({title:"Integration not enabled",description:"You do not have this integration enabled."}):this.$toast.error({title:"Unable to load configurations",description:t.message??"An unknown error occured"}),this.$router.push("/settings/integrations")}finally{this.isFetchingRepositories=!1}},async handleUninstallIntegration(){(await this.$modal.show("UninstallBitbucketCiServiceModal")).type==="saved"&&(this.$toast.success({title:"Integration removed",description:"The Bitbucket PR checks integration has been removed successfully"}),C.fetchBitbucketChecksIntegrationStatus(),this.$router.push("/settings/integrations"))}}},P={class:"flex align-center gap-8px"},U={class:"flex gap-16px"},w=r("span",{class:"text--bold"},"CI Scan History",-1),E={class:"page-content"};function F(e,t,N,S,d,o){const h=s("XPreloader"),g=s("BasePill"),a=s("BaseButton"),p=s("PageHeader"),m=s("router-view");return d.isLoading?(u(),R(h,{key:0,class:"supercenter",size:"medium"})):(u(),v(I,{key:1},[i(p,{breadcrumbs:o.breadcrumbs,title:"Bitbucket Checks"},{subTitle:n(()=>[r("div",P,[i(g,{title:e.$t("SETTINGS.INTEGRATIONS.BITBUCKET.HEADER.CONFIGURATIONS_TITLE",o.repositoriesWithConfiguration.length),variation:"gray-fill"},null,8,["title"])])]),rightContent:n(()=>[r("div",U,[i(a,{variation:"plain",size:"medium",onClick:o.handleUninstallIntegration},{default:n(()=>[y("Uninstall")]),_:1},8,["onClick"]),i(a,{size:"medium",variation:"tertiary",as:"link",to:"/settings/integrations/ci/checks/scans"},{default:n(()=>[w]),_:1})])]),_:1},8,["breadcrumbs"]),r("div",E,[i(m,{onReloadRepositories:o.getRepositories},null,8,["onReloadRepositories"])])],64))}const H=f(x,[["render",F]]);export{H as default};
