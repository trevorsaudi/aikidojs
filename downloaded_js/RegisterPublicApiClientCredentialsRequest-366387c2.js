import{_ as I,M as B,B as E,H as P,f as R,X as A,V as M,g3 as D,g4 as z,an as k,g5 as L,r as g,q as n,k as c,w as t,o as s,s as d,u as o,n as i,p as C,m as f,F as _,t as x,S as U}from"./index-13ff96f4.js";import{I as q}from"./InputCheckbox-81cb3ca6.js";import{i as F}from"./url-3f9718b2.js";import{B as H}from"./BaseRadioInput-a7ac3557.js";const N={components:{BaseModal:B,BaseParagraph:E,BaseHeading:P,BaseButton:R,XPreloader:A,InputCheckbox:q,InputText:M,BaseRadioInput:H},emits:["saved","close"],props:{credentials:{type:Object,default:()=>({})}},data(){return{isLoading:!0,selectedScopes:[],scopes:[],description:null,descriptionError:null,redirectUri:"",redirectUriError:null,appType:"private"}},async mounted(){await this.loadScopes(),await this.fillEditForm(),this.isLoading=!1},watch:{description(){this.isValidDescription&&this.descriptionError!==null&&(this.descriptionError=null)},redirectUri(){this.isValidRedirectUri&&this.redirectUriError!==null&&(this.redirectUriError=null)}},computed:{isEditting(){return Object.keys(this.credentials).length>0},issueScopes(){return this.scopes.filter(a=>a.includes("issues:"))},cloudScopes(){return this.scopes.filter(a=>a.includes("clouds:"))},basicScopes(){return this.scopes.filter(a=>a.includes("basics:"))},repositoryScopes(){return this.scopes.filter(a=>a.includes("repositories:"))},teamScopes(){return this.scopes.filter(a=>a.includes("teams:"))},reportScopes(){return this.scopes.filter(a=>a.includes("reports:"))},containerScopes(){return this.scopes.filter(a=>a.includes("containers:"))},userScopes(){return this.scopes.filter(a=>a.includes("users:"))},firewallScopes(){return this.scopes.filter(a=>a.includes("firewall:"))},customSastRulesScopes(){return this.scopes.filter(a=>a.includes("custom_sast_rules:"))},domainScopes(){return this.scopes.filter(a=>a.includes("domains:"))},virtualMachineScopes(){return this.scopes.filter(a=>a.includes("virtual_machines:"))},isConfirmButtonDisabled(){return this.selectedScopes.length===0},isValidDescription(){return this.description!==null&&this.description!==""},isValidRedirectUri(){return this.appType=="private"?!0:F(this.redirectUri)},headerText(){return this.isEditting?"Update API client":"Create API client credentials"},titleText(){return this.isEditting?"Update API client scopes":"Create credentials to access Aikido's public API"},buttonSubmitText(){return this.isEditting?"Update API client":"Create credentials"}},methods:{handleCloseModal(){this.$emit("close")},async loadScopes(){this.scopes=await D()},isSelected(a){return this.selectedScopes.some(h=>h===a)},handleToggleScope(a,h){if(h){this.selectedScopes.push(a);return}this.selectedScopes=this.selectedScopes.filter(S=>a!==S)},async handleCreateCredentials(){if(!this.isValidDescription){this.descriptionError="You must enter a description of what these credentials are for";return}if(!this.isValidRedirectUri){this.redirectUriError="Please enter a valid URL";return}if(this.isEditting)await z({credentials_id:this.credentials.id,scopes:this.selectedScopes,redirect_uri:this.redirectUri}),k.emit("oauthClientCredentialsUpdated"),this.$emit("saved");else{const a=await L(this.selectedScopes,this.description,this.redirectUri,this.appType);k.emit("oauthClientCredentialsCreated"),this.$emit("saved",a)}},async fillEditForm(){this.isEditting&&(this.selectedScopes=this.credentials.scopes.slice(),this.description=this.credentials.description,this.redirectUri=this.credentials.redirect_uri,this.appType=this.credentials.app_type)},getCheckboxInputClass(a){return this.isSelected(a)?"checkbox--checked":"checkbox--unchecked"}}},X={class:"relative flex flex-column gap-12px"},j={class:"flex flex-column gap-8px"},O={class:"flex flex-column gap-12px"},Y={class:"flex flex-column gap-8px"},W={class:"flex flex-wrap gap-8px"},Z={class:"flex flex-column gap-8px"},G={class:"flex flex-wrap gap-8px"},J={class:"flex flex-column gap-8px"},K={class:"flex flex-wrap gap-8px"},Q={class:"flex flex-column gap-8px"},$={class:"flex flex-wrap gap-8px"},ee={class:"flex flex-column gap-8px"},le={class:"flex flex-wrap gap-8px"},te={class:"flex flex-column gap-8px"},ae={class:"flex flex-wrap gap-8px"},se={class:"flex flex-column gap-8px"},ie={class:"flex flex-wrap gap-8px"},de={class:"flex flex-column gap-8px"},re={class:"flex flex-wrap gap-8px"},ne={class:"flex flex-column gap-8px"},ue={class:"flex flex-wrap gap-8px"},ce={class:"flex flex-column gap-8px"},oe={class:"flex flex-wrap gap-8px"},pe={class:"flex flex-column gap-8px"},he={class:"flex flex-wrap gap-8px"},me={class:"flex flex-column gap-8px"},fe={class:"flex flex-wrap gap-8px"},_e={class:"flex flex-column gap-12px"},xe={class:"flex align-center h-26px text-carbon-60"},ge={class:"flex align-center h-26px text-carbon-60"},Ce={class:"h-64px"};function Se(a,h,S,be,p,l){const r=g("BaseParagraph"),y=g("XPreloader"),T=g("BaseHeading"),b=g("InputText"),m=g("InputCheckbox"),V=g("BaseRadioInput"),v=g("BaseButton"),w=g("BaseModal");return n(),c(w,{width:600,onClose:l.handleCloseModal},{header:t(()=>[s(r,{color:"gray"},{default:t(()=>[d(o(l.headerText),1)]),_:1})]),content:t(()=>[i("div",X,[p.isLoading?(n(),c(y,{key:0,size:"medium",class:"supercenter",theme:a.transparent},null,8,["theme"])):C("",!0),s(T,{as:"h3"},{default:t(()=>[d(o(l.titleText),1)]),_:1}),l.isEditting?C("",!0):(n(),c(r,{key:1,size:"medium"},{default:t(()=>[d(" Create new client credentials which will allow you to authenticate with Aikido's public API client. ")]),_:1})),i("div",j,[s(b,{modelValue:p.description,"onUpdate:modelValue":h[0]||(h[0]=e=>p.description=e),title:"App name",placeholder:"Pied Piper",error:p.descriptionError,disabled:l.isEditting},null,8,["modelValue","error","disabled"])]),s(r,{size:"medium"},{default:t(()=>[d(" Select the scopes for the credentials below. The scopes will decide what API resources can be accessed with these credentials. You can create multiple credentials per account. ")]),_:1}),i("div",O,[i("div",Y,[s(r,{bold:""},{default:t(()=>[d("Issues")]),_:1}),i("div",W,[(n(!0),f(_,null,x(l.issueScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",Z,[s(r,{bold:""},{default:t(()=>[d("Clouds")]),_:1}),i("div",G,[(n(!0),f(_,null,x(l.cloudScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",J,[s(r,{bold:""},{default:t(()=>[d("Repositories")]),_:1}),i("div",K,[(n(!0),f(_,null,x(l.repositoryScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",Q,[s(r,{bold:""},{default:t(()=>[d("Containers")]),_:1}),i("div",$,[(n(!0),f(_,null,x(l.containerScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",ee,[s(r,{bold:""},{default:t(()=>[d("Domains")]),_:1}),i("div",le,[(n(!0),f(_,null,x(l.domainScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",te,[s(r,{bold:""},{default:t(()=>[d("Workspace")]),_:1}),i("div",ae,[(n(!0),f(_,null,x(l.basicScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",se,[s(r,{bold:""},{default:t(()=>[d("Teams")]),_:1}),i("div",ie,[(n(!0),f(_,null,x(l.teamScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",de,[s(r,{bold:""},{default:t(()=>[d("Users")]),_:1}),i("div",re,[(n(!0),f(_,null,x(l.userScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",ne,[s(r,{bold:""},{default:t(()=>[d("Reports")]),_:1}),i("div",ue,[(n(!0),f(_,null,x(l.reportScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",ce,[s(r,{bold:""},{default:t(()=>[d("Zen")]),_:1}),i("div",oe,[(n(!0),f(_,null,x(l.firewallScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",pe,[s(r,{bold:""},{default:t(()=>[d("Custom SAST Rules")]),_:1}),i("div",he,[(n(!0),f(_,null,x(l.customSastRulesScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])]),i("div",me,[s(r,{bold:""},{default:t(()=>[d("Virtual Machines")]),_:1}),i("div",fe,[(n(!0),f(_,null,x(l.virtualMachineScopes,e=>(n(),c(m,{key:e,modelValue:l.isSelected(e),name:e,inputClass:l.getCheckboxInputClass(e),"onUpdate:modelValue":u=>l.handleToggleScope(e,u)},{default:t(()=>[s(r,null,{default:t(()=>[d(o(e),1)]),_:2},1024)]),_:2},1032,["modelValue","name","inputClass","onUpdate:modelValue"]))),128))])])]),i("div",_e,[s(r,{bold:"",size:"medium",class:"mt-16px"},{default:t(()=>[d("App Type")]),_:1}),i("div",xe,[s(V,{id:"private",checked:p.appType=="private",value:p.appType,onSelect:h[1]||(h[1]=e=>p.appType="private"),required:"",disabled:l.isEditting},null,8,["checked","value","disabled"]),i("label",{for:"private",class:U(["cursor-pointer pl-8px",{disabled:l.isEditting}])},"Private: this app will only be used internally at "+o(a.$group.name),3)]),i("div",ge,[s(V,{id:"public",checked:p.appType=="public",value:p.appType,onSelect:h[2]||(h[2]=e=>p.appType="public"),required:"",disabled:l.isEditting},null,8,["checked","value","disabled"]),i("label",{for:"public",class:U(["cursor-pointer pl-8px",{disabled:l.isEditting}])},"Public: this app should be installable by 3rd party organizations using Aikido",2)]),i("div",Ce,[p.appType=="public"?(n(),c(b,{key:0,modelValue:p.redirectUri,"onUpdate:modelValue":h[3]||(h[3]=e=>p.redirectUri=e),title:"Redirect URI",placeholder:"https://aikido.dev/",error:p.redirectUriError},null,8,["modelValue","error"])):C("",!0)])])])]),footer:t(()=>[s(v,{onClicked:l.handleCloseModal,variation:"plain",class:"ml-auto"},{default:t(()=>[d("Cancel")]),_:1},8,["onClicked"]),s(v,{onClicked:l.handleCreateCredentials,disabled:l.isConfirmButtonDisabled},{default:t(()=>[d(o(l.buttonSubmitText),1)]),_:1},8,["onClicked","disabled"])]),_:1},8,["onClose"])}const ye=I(N,[["render",Se]]);export{ye as default};
