import{_ as q,d as j,a3 as x,r,q as l,k as h,B as k,w as e,n as u,o as t,s as o,u as b,m as f,p as v,V as M,f as S,M as E,H as D,f3 as L,an as y,A as B,F as C,t as P,f4 as N,X as V,Z as H,f5 as O,Q as z,f6 as W,f7 as X,f8 as Q}from"./index-13ff96f4.js";import{P as Y}from"./PageHeader-46c38a32.js";import{B as A}from"./BaseCard-471d3203.js";import{I as Z,R as G}from"./IncludeReportFields-959c2d1b.js";import{i as T}from"./email-46ee8eaa.js";import{i as J}from"./general-a1161a2a.js";import"./AuditReport-bfa18622.js";import"./DataTable-e31a825a.js";import"./DataTableCell-51c0104f.js";import"./languages-12749071.js";import"./RuleComplianceStatus-87ae0def.js";import"./GreenCheckMarkRoundedIcon-3695986c.js";import"./IssueGroupTypeColumn-03f014b0.js";import"./BracesIcon-0a8568f4.js";import"./BoxIcon-9908469f.js";import"./IssueStatusTag-dacefc0a.js";import"./DataTableSeverityIndicator-48ffb8dc.js";import"./slaSettings-fece48e7.js";import"./InputCheckbox-81cb3ca6.js";const K={props:{status:String,timestamp:Number,resolvedByName:String},components:{BasePill:j},computed:{formattedTimestamp(){if(this.timestamp)return x.fromUnix(this.timestamp).format(x.SHORT_DATE_FORMAT)},title(){return this.formattedTimestamp?this.resolvedByNameFirst?`${this.formattedStatus} by ${this.resolvedByNameFirst} on ${this.formattedTimestamp}`:`${this.formattedStatus} on ${this.formattedTimestamp}`:this.formattedStatus},resolvedByNameFirst(){if(this.resolvedByName)return this.resolvedByName.split(" ")[0]},formattedStatus(){switch(this.status){case"open":return"Requested";case"approved":return"Approved";case"rejected":return"Rejected";default:return this.status}},variation(){switch(this.status){case"open":return"orange";case"approved":return"green";case"rejected":return"red";default:return"gray"}}}};function ee(i,d,c,R,s,a){const n=r("BasePill");return l(),h(n,{variation:a.variation,title:a.title},null,8,["variation","title"])}const te=q(K,[["render",ee]]),se={props:{request:Object},components:{BaseCard:A,BaseParagraph:k},computed:{formattedRequestedAtTimestamp(){return x.fromUnix(this.request.requested_at).format(x.SHORT_DATE_FORMAT)},timestamp(){return this.request.status==="open"?this.request.requested_at:this.request.resolved_at}}},ae={class:"flex flex-column gap-12px"},re={class:"flex flex-column gap-4px"},oe={class:"flex flex-column gap-4px"},ie={key:0,class:"flex flex-column gap-4px"};function ne(i,d,c,R,s,a){const n=r("BaseParagraph"),m=r("BaseCard");return l(),h(m,{title:"Information"},{default:e(()=>[u("div",ae,[u("div",re,[t(n,{bold:""},{default:e(()=>[o("Name")]),_:1}),t(n,{truncate:!0,color:"subdued"},{default:e(()=>[o(b(c.request.requester_name),1)]),_:1})]),u("div",oe,[t(n,{bold:""},{default:e(()=>[o("Company name")]),_:1}),t(n,{truncate:!0,color:"subdued"},{default:e(()=>[o(b(c.request.requester_company_name),1)]),_:1})]),c.request.requester_email?(l(),f("div",ie,[t(n,{bold:""},{default:e(()=>[o("Email address")]),_:1}),t(n,{truncate:!0,color:"subdued"},{default:e(()=>[o(b(c.request.requester_email),1)]),_:1})])):v("",!0)])]),_:1})}const le=q(se,[["render",ne]]),de={props:{session:Object,reportId:Number},components:{InputText:M,BaseButton:S},data(){return{email:this.session.email}},computed:{isExpired(){return x.fromUnix(this.session.expires_at).isBefore(x.now().date)},isDisabled(){return!0},status(){return this.isExpired?"expired":this.session.viewed===1?"viewed":"active"},actionLabel(){switch(this.status){case"expired":return"Expired";case"viewed":return"Viewed";case"active":return"Shared";default:return this.status}}}},ue={class:"flex w-full gap-8px align-center"};function ce(i,d,c,R,s,a){const n=r("InputText"),m=r("BaseButton");return l(),f("div",ue,[t(n,{modelValue:s.email,"onUpdate:modelValue":d[0]||(d[0]=p=>s.email=p),placeholder:"Enter email address",class:"flex-1",readonly:"",disabled:""},null,8,["modelValue"]),t(m,{variation:"secondary",size:"small",disabled:a.isDisabled,class:"min-w-80px"},{default:e(()=>[o(b(a.actionLabel),1)]),_:1},8,["disabled"])])}const pe=q(de,[["render",ce]]),me={props:{reportId:Number},components:{BaseModal:E,BaseParagraph:k,BaseButton:S,BaseHeading:D,InputText:M},emits:["close"],data(){return{email:void 0,emailError:void 0,isSubmitting:!1}},watch:{email(i){this.emailError&&T(i)&&(this.emailError=void 0)}},computed:{isButtonDisabled(){return!J(this.email)}},methods:{async handleConfirm(){if(!T(this.email)){this.emailError="This email address is invalid";return}this.isSubmitting=!0;try{await L(this.reportId,this.email),this.$emit("close"),y.emit("auditReportShared"),Toast.success({title:"Report shared successfully",description:`This report has been shared successfully with ${this.email}`})}finally{this.isSubmitting=!1}}}},he={class:"flex flex-column gap-12px"};function fe(i,d,c,R,s,a){const n=r("BaseParagraph"),m=r("BaseHeading"),p=r("InputText"),_=r("BaseButton"),w=r("BaseModal");return l(),h(w,{width:600,onClose:d[2]||(d[2]=g=>i.$emit("close"))},{header:e(()=>[t(n,{color:"gray"},{default:e(()=>[o("Share report")]),_:1})]),content:e(()=>[u("div",he,[t(m,{as:"h3"},{default:e(()=>[o("Letâ€™s share this report")]),_:1}),t(n,{size:"medium",loose:""},{default:e(()=>[o(" Share this security audit report with colleagues or 3rd parties. Upon confirmation, they'll receive an email with a download link which is valid for 4 days. ")]),_:1}),t(p,{modelValue:s.email,"onUpdate:modelValue":d[0]||(d[0]=g=>s.email=g),name:"email",title:"Email address",placeholder:"your-email@email.com",error:s.emailError},null,8,["modelValue","error"])])]),footer:e(()=>[t(_,{onClicked:d[1]||(d[1]=g=>i.$emit("close")),variation:"plain",class:"ml-auto"},{default:e(()=>[o("Cancel")]),_:1}),t(_,{onClicked:a.handleConfirm,"is-loading":s.isSubmitting,disabled:a.isButtonDisabled},{default:e(()=>[o("Share report")]),_:1},8,["onClicked","is-loading","disabled"])]),_:1})}const _e=q(me,[["render",fe]]),we={props:{reportId:Number,sharedSessions:{type:Array,required:!0,deafault:()=>[]}},emits:["update"],components:{BaseCard:A,BaseButton:S,SharedWithEmailField:pe,BaseParagraph:k,ShareReportModal:_e},data(){return{showShareReportModal:!1}},methods:{handleShare(){if(B.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");this.showShareReportModal=!0},handleCloseShareModal(){this.showShareReportModal=!1}}},ge={class:"flex flex-column gap-16px"},xe={class:"flex flex-column gap-12px flex-1"},ve={class:"flex justify-center"};function qe(i,d,c,R,s,a){const n=r("BaseParagraph"),m=r("SharedWithEmailField"),p=r("BaseButton"),_=r("BaseCard"),w=r("ShareReportModal");return l(),f(C,null,[t(_,{title:"Shared with",class:"w-50p tablet_w-full"},{default:e(()=>[t(n,{class:"mb-12px"},{default:e(()=>[o("Add some email addresses you'd like to share this report with")]),_:1}),u("div",ge,[u("div",xe,[(l(!0),f(C,null,P(c.sharedSessions,g=>(l(),h(m,{key:g.id,session:g,"report-id":c.reportId},null,8,["session","report-id"]))),128))]),u("div",ve,[t(p,{variation:"primary",size:"small",onClick:a.handleShare},{default:e(()=>[o("Add email")]),_:1},8,["onClick"])])])]),_:1}),s.showShareReportModal?(l(),h(w,{key:0,"report-id":c.reportId,onClose:a.handleCloseShareModal},null,8,["report-id","onClose"])):v("",!0)],64)}const Re=q(we,[["render",qe]]),be={props:{request:Object,config:Object},emits:["cancel","confirm"],components:{BaseModal:E,BaseParagraph:k,BaseHeading:D,BaseButton:S},data(){return{isLoading:!1}},methods:{handleCancel(){this.$emit("cancel")},async handleConfirm(){this.isLoading=!0;try{const i=this.config.includedFields.map(d=>d.id);await N(this.request.id,i),Toast.success({title:"Request Approved",description:"The audit request has been successfully approved. The requester will receive an email shortly with the report attached."}),y.emit("auditReportRequestResolved"),this.$emit("confirm")}finally{this.isLoading=!1}}}},Be={class:"flex flex-column gap-12px"},ye=u("br",null,null,-1),Ce={class:"flex flex-column gap-12px"},Se={class:"list-disc pl-8px flex flex-column gap-4px"},ke={class:"flex flex-column gap-12px"},Ae={class:"list-disc pl-8px flex flex-column gap-4px"};function Te(i,d,c,R,s,a){const n=r("BaseParagraph"),m=r("BaseHeading"),p=r("BaseButton"),_=r("BaseModal");return l(),h(_,{onClose:a.handleCancel},{header:e(()=>[t(n,{color:"gray"},{default:e(()=>[o("Approve external audit report request")]),_:1})]),content:e(()=>[u("div",Be,[t(m,{as:"h3"},{default:e(()=>[o("Are you sure you'd like to approve this audit report request?")]),_:1}),t(n,{size:"medium",loose:""},{default:e(()=>[o(" By approving this request, we'll send this report to the selected email addresses."),ye,o("Please review the settings for the report below to confirm ")]),_:1})]),u("div",Ce,[t(n,null,{default:e(()=>[o("The report will include the following sections:")]),_:1}),u("ul",Se,[(l(!0),f(C,null,P(c.config.includedFields,w=>(l(),f("li",{key:w.id},[t(n,{bold:""},{default:e(()=>[o(b(w.label),1)]),_:2},1024)]))),128))])]),u("div",ke,[t(n,null,{default:e(()=>[o("The report will be send to the following email addresses:")]),_:1}),u("ul",Ae,[u("li",null,[t(n,{bold:""},{default:e(()=>[o(b(c.request.requester_email),1)]),_:1})])])])]),footer:e(()=>[t(p,{onClicked:a.handleCancel,variation:"tertiary",class:"ml-auto"},{default:e(()=>[o("Cancel")]),_:1},8,["onClicked"]),t(p,{onClicked:a.handleConfirm,variation:"success",isLoading:s.isLoading},{default:e(()=>[o("Approve request")]),_:1},8,["onClicked","isLoading"])]),_:1},8,["onClose"])}const Me=q(be,[["render",Te]]),Ee={components:{PageHeader:Y,XPreloader:V,StatusBadge:te,BaseButton:S,IncludeReportFields:Z,SharedSessions:Re,RequestInformation:le,ApproveRequestConfirmationModal:Me,ReportPreviewModal:G,BaseCard:A},created(){y.on("auditReportShared",this.getRequestDetails)},beforeUnmount(){y.off("auditReportShared",this.getRequestDetails)},data(){return{isLoading:!0,request:{},showApproveRequestConfirmationModal:!1,showReportPreview:!1,isDownloadingReport:!1,config:{includedFields:[],emailAddresses:[]}}},async mounted(){await this.getRequestDetails(),this.isLoading=!1},computed:{breadcrumbs(){return[{label:"Reports",href:"/reports"},{label:"Security audit reports",href:"/reports/audit-reports/external"},{label:"Inbox",href:"/reports/audit-reports/external/requests"},{label:"Detail"}]},formattedRequestedAtTimestamp(){return x.fromUnix(this.request.requested_at).format(x.SHORT_DATE_FORMAT)},downloadUrl(){var i;return(i=this.request.report)==null?void 0:i.download_url},timestamp(){return this.request.status==="open"?this.request.requested_at:this.request.resolved_at},initialSelectedFields(){return this.request.status==="approved"?Object.keys(this.request.report.sections):null},isAuditReportsEnabled(){return!!H.data.auditReports}},methods:{async getRequestDetails(){this.request=await O(this.$route.params.id)},async handleApproveRequest(){if(B.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");this.showApproveRequestConfirmationModal=!0,await this.getRequestDetails()},async handleRejectRequest(){if(B.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");await z({headerText:"Reject request",description:"Do you want to reject this request? We won't notify the requester about this.",buttonSubmitText:"Yes, reject"})&&(await W(this.request.id),Toast.success({title:"Request Rejected",description:"The audit request has been rejected."}),y.emit("auditReportRequestResolved"),await this.getRequestDetails())},async handleRequestApproved(){this.showApproveRequestConfirmationModal=!1,await this.getRequestDetails()},handleUpdateSelectedFields(i){this.config.includedFields=i},handleUpdateEmailAddresses(i){this.config.emailAddresses=i},handleShowPreview(){this.showReportPreview=!0},handleClosePreview(){this.showReportPreview=!1},async handleDownloadReport(){if(B.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");this.isDownloadingReport=!0;const i=await X(this.request.report.id);window.open(i,"_blank"),this.isDownloadingReport=!1},async handleCopyDownloadLink(){if(B.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");const i=await Q(this.request.report.id);window.isSecureContext&&(navigator.clipboard.writeText(i),Toast.show({title:"Download link copied"}))}}},De={key:0,class:"flex tablet_flex-column align-center gap-12px"},Pe={key:1,class:"flex tablet_flex-column align-center gap-12px"},Fe=u("i",{class:"icon icon-link"},null,-1),Ue={class:"page-content"},Ie={class:"flex flex-column flex-1 gap-24px"},$e={class:"flex gap-16px tablet_flex-column"};function je(i,d,c,R,s,a){const n=r("XPreloader"),m=r("StatusBadge"),p=r("BaseButton"),_=r("PageHeader"),w=r("RequestInformation"),g=r("IncludeReportFields"),F=r("BaseCard"),U=r("SharedSessions"),I=r("ReportPreviewModal"),$=r("ApproveRequestConfirmationModal");return l(),f(C,null,[s.isLoading?(l(),h(n,{key:0,class:"absolute-centered",theme:"transparent"})):(l(),f(C,{key:1},[t(_,{breadcrumbs:a.breadcrumbs,title:"Security audit report"},{subTitle:e(()=>[t(m,{status:this.request.status,timestamp:a.timestamp,resolvedByName:s.request.resolved_by_name},null,8,["status","timestamp","resolvedByName"])]),rightContent:e(()=>[this.request.status==="open"?(l(),f("div",De,[t(p,{size:"small",variation:"plain",onClicked:a.handleShowPreview},{default:e(()=>[o("Show preview")]),_:1},8,["onClicked"]),t(p,{size:"small",variation:"success",onClicked:a.handleApproveRequest},{default:e(()=>[o("Approve")]),_:1},8,["onClicked"]),t(p,{size:"small",variation:"destructive",onClicked:a.handleRejectRequest},{default:e(()=>[o("Reject")]),_:1},8,["onClicked"])])):v("",!0),this.request.status==="approved"?(l(),f("div",Pe,[t(p,{size:"small",variation:"blue",onClicked:a.handleCopyDownloadLink},{default:e(()=>[Fe,o("Copy download link ")]),_:1},8,["onClicked"]),t(p,{size:"small",variation:"primary",onClicked:a.handleDownloadReport,"is-loading":s.isDownloadingReport},{default:e(()=>[o("Download report")]),_:1},8,["onClicked","is-loading"])])):v("",!0)]),_:1},8,["breadcrumbs"]),u("div",Ue,[u("div",Ie,[t(w,{request:s.request},null,8,["request"]),u("div",$e,[t(F,{title:s.request.status==="open"?"Fields to include":"Included sections",class:"w-50p tablet_w-full"},{default:e(()=>[t(g,{"allow-edits":s.request.status==="open","initial-selected-fields":a.initialSelectedFields,onUpdate:a.handleUpdateSelectedFields},null,8,["allow-edits","initial-selected-fields","onUpdate"])]),_:1},8,["title"]),s.request.status==="approved"?(l(),h(U,{key:0,onUpdate:a.handleUpdateEmailAddresses,"shared-sessions":s.request.report.shared_sessions??[],"report-id":s.request.report.id,class:"w-50p tablet_w-full"},null,8,["onUpdate","shared-sessions","report-id"])):v("",!0)])])])],64)),s.showReportPreview?(l(),h(I,{key:2,onClose:a.handleClosePreview,"included-fields":s.config.includedFields},null,8,["onClose","included-fields"])):v("",!0),s.showApproveRequestConfirmationModal?(l(),h($,{key:3,request:s.request,config:s.config,onConfirm:a.handleRequestApproved,onCancel:d[0]||(d[0]=Le=>s.showApproveRequestConfirmationModal=!1)},null,8,["request","config","onConfirm"])):v("",!0)],64)}const it=q(Ee,[["render",je]]);export{it as default};
