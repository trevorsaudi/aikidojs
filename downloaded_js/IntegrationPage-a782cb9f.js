import{_ as v,X as T,f as V,V as A,N as B,r as i,q as o,m as d,o as n,p as E,n as a,w as l,s as u,u as b,k as S,z as R,a1 as P,F as y,t as k,ai as C,H as K,c6 as O}from"./index-13ff96f4.js";import{u as N,s as z,l as D,a as H,g as $,b as F}from"./sonarqube-6cfae9f5.js";import{P as U}from"./PageHeader-46c38a32.js";import{S as Q}from"./SettingsEmptyState-8e8644cd.js";import{E as L}from"./EmptyUsersIllustration-1a5638d0.js";import{T as G,a as M}from"./TableListHeader-e50d01d1.js";import{O as W}from"./OverviewEmptyState-c8440b9c.js";import{G as q}from"./GenericIllustration-4aca88e5.js";import{_ as Y}from"./ripples-df807ff5.js";import"./DataTable-e31a825a.js";const X={components:{XPreloader:T,SettingsEmptyState:Q,EmptyUsersIllustration:L,PageHeader:U,BaseButton:V,InputText:A,BaseSelect:B},props:{baseInstance:Object},emits:["cancel","save"],data(){var e;return{instance:this.baseInstance??{},instanceKind:(e=this.baseInstance)!=null&&e.organization?"managed":"self-managed",changeInstanceInfo:!1}},computed:{saveButtonText(){return this.baseInstance?"Update":"Create"},instanceKindOptions(){return[{id:"self-managed",title:"Self managed"},{id:"managed",title:"Hosted on sonarcloud.io"}]}},methods:{async submitDetails(){this.baseInstance?await this.updateInstance():await this.createInstance(),Toast.success({title:this.$t("NOTIFICATIONS.INTEGRATION_UPDATED.TITLE"),description:"Your changes have been saved. We will start scanning your SonarQube environment right away and show the relevant issues in Aikido."}),this.$emit("save")},async updateInstance(){await N(this.instance.instance_url,this.instance.access_token,this.instance.organization)},async createInstance(){await z(this.instance.instance_url,this.instance.access_token,this.instance.organization)}}},j={class:"box"},J={key:0,class:"flex align-center mb-16px"},Z={key:1,class:"flex flex-column gap-16px flex-wrap"},ee={key:2,class:"flex flex-column gap-16px flex-wrap"},ne={class:"mt-32px gap-12px flex"};function te(e,t,f,I,s,r){const _=i("BaseSelect"),m=i("InputText"),h=i("BaseButton");return o(),d("div",j,[f.baseInstance?E("",!0):(o(),d("div",J,[n(_,{class:"flex-1",id:"instance_kind",label:"Instance kind",modelValue:s.instanceKind,"onUpdate:modelValue":t[0]||(t[0]=c=>s.instanceKind=c),options:r.instanceKindOptions,placeholder:"Select the kind of instance...",sublabel:"Select whether your SonarQube environment is hosted on sonarcloud.io or if you host it yourself"},null,8,["modelValue","options"])])),s.instanceKind==="self-managed"?(o(),d("div",Z,[n(m,{title:"Access Token",placeholder:"*********",modelValue:s.instance.access_token,"onUpdate:modelValue":t[1]||(t[1]=c=>s.instance.access_token=c),modelModifiers:{trim:!0},name:"access_token",onEnterKeyPress:e.handleKeyDown,required:!0},null,8,["modelValue","onEnterKeyPress"]),n(m,{title:"Instance Url",placeholder:"https://sonarqube.example.com",modelValue:s.instance.instance_url,"onUpdate:modelValue":t[2]||(t[2]=c=>s.instance.instance_url=c),modelModifiers:{trim:!0},name:"instance_url",onEnterKeyPress:e.handleKeyDown,required:"true",type:"url"},null,8,["modelValue","onEnterKeyPress"])])):s.instanceKind==="managed"?(o(),d("div",ee,[n(m,{title:"Access Token",placeholder:"*********",modelValue:s.instance.access_token,"onUpdate:modelValue":t[3]||(t[3]=c=>s.instance.access_token=c),modelModifiers:{trim:!0},name:"access_token",onEnterKeyPress:e.handleKeyDown,required:!0},null,8,["modelValue","onEnterKeyPress"]),n(m,{title:"Organization key",placeholder:"example",modelValue:s.instance.organization,"onUpdate:modelValue":t[4]||(t[4]=c=>s.instance.organization=c),modelModifiers:{trim:!0},name:"organization",onEnterKeyPress:e.handleKeyDown,required:!0},null,8,["modelValue","onEnterKeyPress"])])):E("",!0),a("div",ne,[n(h,{size:"small",onClick:r.submitDetails},{default:l(()=>[u(b(r.saveButtonText),1)]),_:1},8,["onClick"]),n(h,{size:"small",variation:"tertiary",onClick:t[5]||(t[5]=c=>e.$emit("cancel"))},{default:l(()=>[u("Cancel")]),_:1})])])}const se=v(X,[["render",te]]),ae={emits:["viewInstructions"],components:{GenericIllustration:q,OverviewEmptyState:W},props:{title:{type:String,default:"Waiting..."},description:{type:String,default:"Waiting for first event..."}}},ie=a("div",{class:"mt-12px -mb-16px"},[a("img",{src:Y,width:"30"})],-1);function oe(e,t,f,I,s,r){const _=i("GenericIllustration"),m=i("OverviewEmptyState");return o(),S(m,{title:f.title,description:f.description,actionLabel:e.actionLabel,variation:"empty",onOnAction:t[0]||(t[0]=h=>e.$emit("viewInstructions"))},{subdescription:l(()=>[ie]),default:l(()=>[n(_)]),_:1},8,["title","description","actionLabel"])}const le=v(ae,[["render",oe]]),ce={components:{InputSwitch:R,TableList:G,TableListHeader:M,WaitingEmptyState:le,LoadingSkeleton:P},props:{isScanning:{type:Boolean,default:!1}},data(){return{unmappedRules:[],loaded:!1}},watch:{isScanning(e,t){t==!0&&e==!1&&this.loadUnmappedRules()}},async mounted(){await this.loadUnmappedRules()},methods:{async loadUnmappedRules(){this.unmappedRules=await D(),this.loaded=!0},async toggleActive(e,t){await H(e,t),this.loadUnmappedRules()}}},re={class:"thead mobile_hidden"},de={class:"tr"},ue={key:0,class:"tbody"},pe={class:"tr"},me={colspan:"3"},_e={key:1,class:"tbody"},he={class:"td"},fe={class:"td"},ge={class:"td"},be={key:2,class:"tbody"},Se={key:0,class:"tr"},ye=a("td",{colspan:"3"}," No unmapped SonarQube rules found. ",-1),ve=[ye],Ie={class:"tr mobile_flex mobile_flex-col"},we={class:"td mobile_max-w-full mobile_w-full max-w-0 mobile_border-b-0 truncate"},xe={class:"td mobile_max-w-full mobile_w-full w-15p max-w-0 mobile_border-b-0 collapsing"},Ee={class:"td mobile_max-w-full mobile_w-full w-10p max-w-0 mobile_border-b-0 collapsing"};function ke(e,t,f,I,s,r){const _=i("TableListHeader"),m=i("WaitingEmptyState"),h=i("LoadingSkeleton"),c=i("BaseParagraph"),w=i("InputSwitch"),g=i("TableList");return o(),S(g,null,{default:l(()=>[a("div",re,[a("div",de,[n(_,null,{default:l(()=>[u("SonarQube Rule")]),_:1}),n(_,null,{default:l(()=>[u("Amount Issues")]),_:1}),n(_,null,{default:l(()=>[u("Active")]),_:1})])]),f.isScanning?(o(),d("div",ue,[a("div",pe,[a("td",me,[n(m,{title:"Scanning...",description:"Unmapped SonarQube rules will appear here once the scan completed."})])])])):s.loaded?(o(),d("div",be,[s.unmappedRules.length==0?(o(),d("div",Se,ve)):E("",!0),(o(!0),d(y,null,k(s.unmappedRules,p=>(o(),d("div",Ie,[a("div",we,[n(c,null,{default:l(()=>[u(b(p.rule_title),1)]),_:2},1024),n(c,{color:"gray"},{default:l(()=>[u(b(p.rule_key),1)]),_:2},1024)]),a("div",xe,[n(c,null,{default:l(()=>[u(b(p.amount_issues),1)]),_:2},1024)]),a("div",Ee,[n(w,{modelValue:p.active,onClick:t[0]||(t[0]=C(()=>{},["stop"])),onChange:x=>r.toggleActive(p.rule_key,x)},null,8,["modelValue","onChange"])])]))),256))])):(o(),d("div",_e,[(o(),d(y,null,k(5,p=>a("div",{class:"tr",key:p},[a("div",he,[n(h,{height:"14px"})]),a("div",fe,[n(h,{height:"14px"})]),a("div",ge,[n(h,{height:"14px"})])])),64))]))]),_:1})}const Te=v(ce,[["render",ke]]),Ve={components:{XPreloader:T,SettingsEmptyState:Q,EmptyUsersIllustration:L,PageHeader:U,BaseButton:V,InputText:A,BaseSelect:B,SonarQubeIntegrationForm:se,BaseHeading:K,SonarQubeUnmappedRulesTable:Te},data(){return{isLoading:!0,instance:null,updateInstance:!1,unmappedRules:null,isScanning:!1}},async created(){await this.init(),this.isLoading=!1},computed:{breadcrumbs(){return[{label:"Settings",href:"/settings"},{label:"Integrations",href:"/settings/integrations"},{label:"SonarQube"}]},saveButtonText(){return this.instanceExists?"Update":"Create"},instanceKindOptions(){return[{id:"self-managed",title:"Self managed"},{id:"managed",title:"Hosted on sonarcloud.io"}]},showEmptyState(){return!this.isLoading&&!this.instance&&!this.updateInstance}},methods:{async init(){try{const e=await $({disable_toasts:!0});this.instance=e,this.instanceExists=!0,this.instanceKind=e.organization?"managed":"self-managed"}catch(e){if(e instanceof O.AxiosError&&e.response.status===404){this.instanceExists=!1,this.instance=null,this.instanceKind=null;return}throw new Error(e)}},handleShowForm(){this.updateInstance=!0},async handleScanInstance(){this.isScanning=!0,F().then(()=>{this.isScanning=!1}),this.$toast.success({title:"Scan started",description:"A scan for your SonarQube environment has started, we'll report the issues once this is done"})},async handleInstanceUpdated(){await this.init(),this.updateInstance=!1,this.handleScanInstance()},async handleDeleteInstance(){await this.$modal.show("DeleteSonarQubeIntegrationModal",{}),this.init()},redirectToHelpArticle(){const e="https://help.aikido.dev/category/third-party-scanners/sgGQ5YVpcnqV";window.open(e,"_blank")}}},Ae={class:"page-content"},Be={key:0},Ue={key:1,class:"flex flex-column gap-24px"},Qe={class:"flex flex-column gap-12px"},Le={class:"flex align-center gap-8px"},Re={class:"flex flex-column gap-12px"},Pe={class:"flex align-center gap-8px"},Ce={class:"flex flex-column gap-12px"};function Ke(e,t,f,I,s,r){const _=i("XPreloader"),m=i("PageHeader"),h=i("EmptyUsersIllustration"),c=i("SettingsEmptyState"),w=i("SonarQubeIntegrationForm"),g=i("BaseHeading"),p=i("BaseButton"),x=i("SonarQubeUnmappedRulesTable");return s.isLoading?(o(),S(_,{key:0,class:"supercenter",theme:"transparent"})):(o(),d(y,{key:1},[n(m,{title:"SonarQube Integration",breadcrumbs:r.breadcrumbs},null,8,["breadcrumbs"]),a("div",Ae,[r.showEmptyState?(o(),d("div",Be,[n(c,{title:e.$t("SETTINGS.SONARQUBE.OVERVIEW.EMPTY_STATE_TITLE"),description:e.$t("SETTINGS.SONARQUBE.OVERVIEW.EMPTY_STATE_DESCRIPTION"),actionLabel:e.$t("SETTINGS.SONARQUBE.OVERVIEW.EMPTY_STATE_ACTION_LABEL"),onAction:r.handleShowForm,secondaryActionLabel:"View Docs",onSecondaryAction:r.redirectToHelpArticle},{default:l(()=>[n(h)]),_:1},8,["title","description","actionLabel","onAction","onSecondaryAction"])])):(o(),d(y,{key:1},[s.updateInstance?(o(),S(w,{key:0,onCancel:t[0]||(t[0]=Oe=>s.updateInstance=!1),onSave:r.handleInstanceUpdated,baseInstance:s.instance},null,8,["onSave","baseInstance"])):(o(),d("div",Ue,[a("div",Qe,[n(g,{as:"h4"},{default:l(()=>[u("Actions")]),_:1}),a("div",Le,[n(p,{size:"small",onClick:r.handleScanInstance},{default:l(()=>[u("Scan instance")]),_:1},8,["onClick"]),n(p,{size:"small",variation:"secondary",onClick:r.handleShowForm},{default:l(()=>[u("Update credentials")]),_:1},8,["onClick"])])]),a("div",Re,[n(g,{as:"h4"},{default:l(()=>[u("Danger zone")]),_:1}),a("div",Pe,[n(p,{size:"small",variation:"destructive",onClick:r.handleDeleteInstance},{default:l(()=>[u("Unlink instance")]),_:1},8,["onClick"])])]),a("div",Ce,[n(g,{as:"h4",class:"mt-24px mb-12px"},{default:l(()=>[u("SonarQube Unmapped Rules")]),_:1}),n(x,{isScanning:s.isScanning},null,8,["isScanning"])])]))],64))])],64))}const Ye=v(Ve,[["render",Ke]]);export{Ye as default};
