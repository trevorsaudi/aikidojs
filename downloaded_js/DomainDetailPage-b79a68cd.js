import{_ as E,B as L,a2 as P,d as x,cs as N,an as A,a3 as k,A as w,bS as M,dz as U,c6 as V,dA as O,dB as X,r,k as n,m as I,o as m,w as o,n as c,F as q,q as i,ah as W,p as l,s as g,S as z,u as h,bn as H}from"./index-13ff96f4.js";import{P as F}from"./PageHeader-46c38a32.js";import{b as j}from"./dateFns-a344cb79.js";import G from"./DomainIssuesOverview-781cf52c.js";import{X as Q}from"./XTabs-d492da26.js";import{N as K}from"./NoAccess-b1a75b5c.js";import{B as J}from"./BulletPoint-1404881f.js";import{u as Y}from"./useDastScanningProgress-93621d89.js";import"./index-b87db690.js";import"./slaEmptyState-e877fc05.js";import"./QueueTable-de6aabd1.js";import"./DataTableCell-51c0104f.js";import"./IssueGroupSeverityColumn-7631c77a.js";import"./ActionMenu-3e4470bf.js";import"./SidebarActionMenu-1bf6804b.js";import"./CreateAutoFixProgressFlow-8111d22c.js";import"./RadioButtonList-1d4cdaad.js";import"./EnableIntegrationModal-48b01f56.js";import"./focusModePreference-150f170e.js";import"./TableListHeader-e50d01d1.js";import"./DataTable-e31a825a.js";import"./BaseRadioInput-a7ac3557.js";import"./BaseLabel-a1c0ca00.js";import"./AIText-891d4f7b.js";import"./InputCheckbox-81cb3ca6.js";import"./BreakSlashes-925eef0e.js";import"./UnignoreIssue-5dff8957.js";import"./CreateTicketModal-c14deeb1.js";import"./ManualInputSearchDropdown-6a7ece3e.js";import"./InputSearchDropdown-02988f6b.js";import"./repoName-872812ed.js";import"./taskTrackerNaming-55adac3e.js";import"./taskTrackerIcon-504ea566.js";import"./autofixable-c6560249.js";import"./autofixSastIssues-779ec5b4.js";import"./lock-files-cdbb050f.js";import"./BaseCodeBlock-cec75629.js";import"./string-814c5ffd.js";import"./ButtonMultiOption-12e505fb.js";import"./transform-c376ec3f.js";import"./linear-efb37b7f.js";import"./arc-12e4470a.js";import"./BaseForm-4c6fa06f.js";import"./BaseCard-471d3203.js";import"./AccordionContainer-09dc0ed4.js";import"./trycatch-83445d5b.js";import"./licenses-6ab38515.js";import"./BaseStatusLabel-0ccd2806.js";import"./DataTableSeverityIndicator-48ffb8dc.js";import"./IssueGroupTypeColumn-03f014b0.js";import"./BracesIcon-0a8568f4.js";import"./BoxIcon-9908469f.js";import"./StackedAvatars-4925baeb.js";import"./FilterButton-bb5393a7.js";import"./QueueSidebar-47492277.js";import"./QueueQuickFilter-70881bd4.js";import"./languages-12749071.js";import"./DastIllustration-f420fa73.js";import"./OverviewEmptyState-c8440b9c.js";import"./SlaEmptyState-a5a9e243.js";import"./GenericIllustration-4aca88e5.js";import"./BaseCallout-aea0aba4.js";const Z={components:{PageHeader:F,BaseParagraph:L,XTooltip:P,DomainIssuesOverview:G,BasePill:x,XTabs:Q,NoAccess:K,BulletPoint:J},data(){return{tab:this.$route.name,loaded:!1,domain:null,meta:null,hasNoAccess:!1,routesCount:0,shouldShowReAuthBanner:!1,shouldShowWhiteListIpBanner:!1}},setup(){var _;const t=N.resolve(window==null?void 0:window.location.pathname),s=((_=t==null?void 0:t.params)==null?void 0:_.domainId)??-1,{scanningProgress:p,registerScanStartedEvent:f,registerScanStoppedEvent:a,addListener:e,removeListener:S}=Y(-1,s);return{scanningProgress:p,registerScanStartedEvent:f,registerScanStoppedEvent:a,addScanEventListener:e,removeScanEventListener:S}},async mounted(){await this.loadData(),this.loaded=!0},created(){this.addScanEventListener(),A.on("dastScanCompleted",this.loadData)},beforeUnmount(){this.removeScanEventListener(),A.off("dastScanCompleted",this.loadData)},watch:{async domainId(){this.domainId&&await this.loadData()},tab(){this.$router.push({name:this.tab})},"$route.name"(){this.tab=this.$route.name}},computed:{domainName(){return this.domain.domain_name},domainId(){return this.$route.params.domainId},subtitle(){return`${this.domain.open_issues} issues`},breadcrumbs(){return[{label:"Settings",href:"/settings"},{label:"Domains & APIs",href:"/settings/domains"},{label:this.domainName}]},tabs(){const t=[{title:this.$t("DOMAIN_DETAIL.TABS.ISSUES"),id:"domainDetailIssueList"}];return this.domain.scan_type==="akto"&&t.push({title:this.$t("DOMAIN_DETAIL.TABS.REST_ROUTES"),id:"domainDetailRestRoutes"}),(this.domain.scan_type==="akto"||this.domain.scan_type==="akto_graphql")&&t.push({title:this.$t("DOMAIN_DETAIL.TABS.REQUEST_LOGS"),id:"domainDetailRequestLogs"}),t.push({title:this.$t("DOMAIN_DETAIL.TABS.CHECKS"),id:"domainDetailChecks"}),t},lastScan(){var t,s;return!((t=this.meta)!=null&&t.last_scanned_at)||((s=this.meta)==null?void 0:s.last_scanned_at)<=0?"No scans just yet":`Last scan ${j(this.meta.last_scanned_at)} ago`},nextScanTime(){var t;return(t=this.meta)!=null&&t.next_scan_at?`Next scan on ${k.fromUnix(this.meta.next_scan_at).format(k.SHORT_DATE_FORMAT)}`:null},isScanning(){var t;return((t=this.scanningProgress)==null?void 0:t.status)==="scanning"},scanningProgressValue(){var t;return((t=this.scanningProgress)==null?void 0:t.progress)??0},linkedResourceName(){return this.domain.scm_repo_id<1&&this.domain.container_id<1?null:this.domain.scm_repo_name||this.domain.container_name},linkedResourceUrl(){return this.domain.scm_repo_id>0?`/repositories/${this.domain.scm_repo_id}`:this.domain.container_id>0?`/container/${this.domain.container_id}`:null},linkedResourceIcon(){return this.domain.scm_repo_id>0?"icon-code-tags":this.domain.container_id>0?"icon-container":null},accessibilityStatusText(){return this.domain.configuration_issue?"Not Accessible":"Accessible"},accessibilityStatusColor(){return this.domain.configuration_issue?"#ff4a3e":"#00c07d"},scanType(){return this.domain.scan_type=="nuclei"?"Hosted":this.domain.scan_type=="akto"?"REST":this.domain.scan_type=="akto_graphql"?"GraphQL":"Front-End"},shouldShowAuthenticationLabel(){return this.domain.auth_config_id>0?!1:["akto","akto_graphql","owasp-zap"].includes(this.domain.scan_type)}},methods:{async loadData(){await Promise.allSettled([this.loadDomainDetails(),this.loadRoutesCount()]),this.setShouldShowReAuthBanner()},async handleStartScan(){if(w.hasExpiredFullTrial())return this.$modal.show("UpgradeAccountModal");try{this.registerScanStartedEvent(),await M(this.domainId),this.$toast.success("Scan successfully started")}catch(t){throw this.registerScanStoppedEvent(),t}},async loadDomainDetails(){try{this.domain=await U(this.domainId,{include_template_count:!0})}catch(t){t instanceof V.AxiosError&&t.response.status===498&&(this.hasNoAccess=!0)}this.meta={last_scanned_at:this.domain.last_scanned_at,next_scan_at:null}},handleShowScreenshots(){this.$modal.show("DomainDetailScreenshotsModal",{domainId:this.domainId,kind:"collect_credentials"})},handleShowAccessibilityScreenshot(){this.$modal.show("DomainDetailScreenshotsModal",{domainId:this.domainId,kind:"verify_domain_access"})},async loadRoutesCount(){this.routesCount=await O(this.domainId)},handleShowEditDomainAuthenticationConfigModal(){if(!w.isPayingProAndNotTrial()&&!this.$featureflags.authenticated_dast)return this.$modal.show("UpgradeAccountModal",{title:"Authenticated DAST is only available on Pro and Scale plans.",msg:"Upgrade now to a Pro or Scale plan to use authenticated DAST scanning."});this.$modal.show("EditDomainAuthenticationConfigModal",{domain:this.domain})},handleClickAuthenticatedLabel(){if(["akto","akto_graphql"].includes(this.domain.scan_type)){this.handleShowEditDomainAuthenticationConfigModal();return}const t=this.domain.auth_config_id>0;if(this.domain.scan_type=="owasp-zap"&&!t){this.handleShowEditDomainAuthenticationConfigModal();return}this.handleShowScreenshots()},async setShouldShowReAuthBanner(){if(!["akto","akto_graphql"].includes(this.domain.scan_type)){this.shouldShowReAuthBanner=!1,this.shouldShowWhiteListIpBanner=!1;return}const{is_auth_expired:s,is_ip_blocked:p}=await X(this.domainId);this.shouldShowReAuthBanner=s,this.shouldShowWhiteListIpBanner=p},openStaticIpInfoModal(){this.$modal.show("StaticIPInfoModal")}}},$={key:0,class:"loading-overlay"},tt=c("div",{class:"shimmer shimmer--purple shimmer--rtl"},null,-1),et=[tt],at={class:"flex gap-8px flex-wrap"},it={class:"pill__label"},nt={class:"flex align-center gap-4px"},ot={class:"pill__label"},st={class:"pill__label"},rt=c("i",{class:"icon icon-calender icon-12px valign-middle ml-8px"},null,-1),lt={class:"page-content"};function ct(t,s,p,f,a,e){const S=r("XPreloader"),_=r("NoAccess"),d=r("BasePill"),y=r("RouterLink"),D=r("BulletPoint"),T=r("XTooltip"),v=r("BaseParagraph"),C=r("XTabs"),B=r("PageHeader"),R=r("RouterView");return a.loaded?a.hasNoAccess?(i(),n(_,{key:1,type:"domain"})):(i(),I(q,{key:2},[m(B,{breadcrumbs:e.breadcrumbs,title:e.domainName},{rightContent:o(()=>[c("button",{class:z(["button-brand button--primary button--rounded button--normal button--border button--with-progress ws-nowrap",[e.isScanning&&"button--in-progress"]]),onClick:s[0]||(s[0]=(...u)=>e.handleStartScan&&e.handleStartScan(...u))},[e.isScanning?(i(),I("div",$,[c("div",{class:"loading-bar",style:W({width:`${e.scanningProgressValue}%`})},et,4)])):l("",!0),g(" Start scan ")],2)]),subTitle:o(()=>[c("div",at,[m(d,{title:e.subtitle,variation:"green"},null,8,["title"]),m(d,{title:e.scanType,variation:"gray-fill"},null,8,["title"]),a.domain.scan_type=="akto"?(i(),n(d,{key:0,title:t.$t("X_ROUTES",a.routesCount),variation:"green"},null,8,["title"])):l("",!0),a.domain.scan_type=="nuclei"?(i(),n(d,{key:1,variation:"gray-fill",class:"cursor-default"},{default:o(()=>[c("span",it,h(a.domain.tag_groups.join(", ")),1)]),_:1})):l("",!0),e.linkedResourceName?(i(),n(y,{key:2,to:e.linkedResourceUrl,class:"cursor-pointer"},{default:o(()=>[m(d,{variation:"gray-fill","base-icon":e.linkedResourceIcon,title:e.linkedResourceName},null,8,["base-icon","title"])]),_:1},8,["to"])):l("",!0),e.shouldShowAuthenticationLabel?(i(),n(d,{key:3,title:"Authentication",variation:"gray-fill",onClick:e.handleClickAuthenticatedLabel,class:"cursor-pointer"},null,8,["onClick"])):l("",!0),a.domain.auth_config_id>0?(i(),n(d,{key:4,title:"Authenticated",variation:"gray-fill",onClick:e.handleClickAuthenticatedLabel,class:"cursor-pointer"},null,8,["onClick"])):l("",!0),a.domain.scan_type!="akto"&&a.domain.scan_type!="akto_graphql"?(i(),n(d,{key:5,variation:"gray-fill",onClick:e.handleShowAccessibilityScreenshot,class:"cursor-pointer"},{default:o(()=>[c("div",nt,[m(D,{size:"small",color:e.accessibilityStatusColor},null,8,["color"]),c("p",ot,h(e.accessibilityStatusText),1)])]),_:1},8,["onClick"])):l("",!0),a.domain.scan_type=="nuclei"&&a.domain.used_templates_count>0?(i(),n(y,{key:6,to:`/domains/checks?scanner=nuclei&technologies=${a.domain.tag_groups.join(",")}`,class:"cursor-pointer"},{default:o(()=>[m(d,{variation:"gray-fill"},{default:o(()=>[c("span",st,h(a.domain.used_templates_count)+" checks ",1)]),_:1})]),_:1},8,["to"])):l("",!0)])]),footerRightContent:o(()=>[a.meta?(i(),n(v,{key:0,color:"subdued"},{default:o(()=>[g(h(e.lastScan)+" ",1),rt,e.nextScanTime?(i(),n(T,{key:0},{default:o(()=>[g(h(e.nextScanTime),1)]),_:1})):l("",!0)]),_:1})):l("",!0)]),tabs:o(()=>[m(C,{class:"page-tabs",tabs:e.tabs,modelValue:a.tab,"onUpdate:modelValue":s[1]||(s[1]=u=>a.tab=u)},null,8,["tabs","modelValue"])]),_:1},8,["breadcrumbs","title"]),c("div",lt,[m(R,null,{default:o(({Component:u})=>{var b;return[(i(),n(H(u),{domainId:e.domainId,lastScannedAt:(b=a.meta)==null?void 0:b.last_scanned_at,scanType:a.domain.scan_type,tagGroups:a.domain.tag_groups,shouldShowReAuthBanner:a.shouldShowReAuthBanner,shouldShowWhiteListIpBanner:a.shouldShowWhiteListIpBanner,onAuthenticate:e.handleClickAuthenticatedLabel,onWhitelistIp:e.openStaticIpInfoModal},null,40,["domainId","lastScannedAt","scanType","tagGroups","shouldShowReAuthBanner","shouldShowWhiteListIpBanner","onAuthenticate","onWhitelistIp"]))]}),_:1})])],64)):(i(),n(S,{key:0,class:"supercenter",theme:"transparent"}))}const fe=E(Z,[["render",ct]]);export{fe as default};
