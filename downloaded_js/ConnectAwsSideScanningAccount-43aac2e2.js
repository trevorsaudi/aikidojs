import{_ as g,bk as I,g as k,f as w,H as b,B as v,x as P,a2 as R,a as u,A as _,r as o,q as x,m as A,o as a,w as n,s as t,n as e,V as $,fu as W,F as z}from"./index-13ff96f4.js";import{P as E}from"./PageHeader-46c38a32.js";import{_ as V}from"./awsoutputtab-d18f8503.js";const L={props:{},emits:["cancel","continue"],components:{BaseBody:I,BaseLink:k,BaseButton:w,BaseHeading:b,BaseParagraph:v,BaseIcon:P,XTooltip:R},computed:{templateUrl(){return u()==="staging"?"https://aikido-staging-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy-instance-volumes-access.json":u()==="production"?"https://aikido-production-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy-instance-volumes-access.json":"https://aikido-dev-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy-instance-volumes-access.json"}},methods:{handleCancel(){this.$emit("cancel")},handleSubmit(){this.$emit("continue")},handleInstallIamRoleAndPolicy(){let i=`https://eu-central-1.console.aws.amazon.com/cloudformation/home?region=eu-central-1#/stacks/create/review?stackName=aikido-security-ec2-hard-drive-scanner-dev&templateURL=https://aikido-dev-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy-instance-volumes-access.json&param_ExternalId=aikido-${_.data.groupId}`;u()==="staging"?i=`https://eu-central-1.console.aws.amazon.com/cloudformation/home?region=eu-central-1#/stacks/create/review?stackName=aikido-security-ec2-hard-drive-scanner-staging&templateURL=https://aikido-staging-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy-instance-volumes-access.json&param_ExternalId=aikido-${_.data.groupId}`:u()==="production"&&(i=`https://eu-central-1.console.aws.amazon.com/cloudformation/home?region=eu-central-1#/stacks/create/review?stackName=aikido-security-ec2-hard-drive-scanner&templateURL=https://aikido-production-staticfiles-public.s3.eu-west-1.amazonaws.com/minimal-policy-instance-volumes-access.json&param_ExternalId=aikido-${_.data.groupId}`),window.open(i,"_blank")}}},U={class:"flex flex-column gap-12px"},N={class:"ul text-carbon-80"},T=e("strong",null,"«I acknowledge that AWS CloudFormation might create IAM resources»",-1),j=e("strong",null,"create stack",-1),H={class:"inline-flex gap-4px align-center"},F=e("strong",null,"outputs",-1),M=e("img",{src:V,class:"rounded-2px",width:"800"},null,-1),X=e("strong",null,"AikidoRoleARN",-1);function D(i,c,y,B,r,l){const s=o("BaseParagraph"),d=o("BaseLink"),m=o("XTooltip"),p=o("BaseIcon"),h=o("BaseButton");return x(),A("div",U,[a(s,null,{default:n(()=>[t(" Please go to your AWS account and login. You’ll need to complete the next few steps in the AWS UI. ")]),_:1}),e("div",null,[e("ul",N,[e("li",null,[a(s,null,{default:n(()=>[t("Log into your "),a(d,{href:"https://console.aws.amazon.com/",target:"_blank"},{default:n(()=>[t("AWS account")]),_:1}),t(".")]),_:1})]),e("li",null,[a(s,null,{default:n(()=>[t("Use the below button to create the required IAM Role & Policy using Cloudformation template.")]),_:1})]),e("li",null,[a(s,null,{default:n(()=>[t("You’ll also need to mark "),T]),_:1})]),e("li",null,[a(s,null,{default:n(()=>[t("Then click "),j]),_:1})]),e("li",null,[a(s,null,{default:n(()=>[t("In AWS Cloudformation, click the stack that was just created.")]),_:1})]),e("li",null,[a(s,null,{default:n(()=>[e("span",H,[t(" Navigate to the "),F,t(" tab. "),a(p,{icon:"icon-help",class:"cursor-help inline-flex"},{default:n(()=>[a(m,{noOpacity:""},{default:n(()=>[M]),_:1})]),_:1})])]),_:1})]),e("li",null,[a(s,null,{default:n(()=>[t("Copy the "),X,t(" and paste it below")]),_:1})])])]),a(s,{loose:!0},{default:n(()=>[t(" Via this IAM role, Aikido will be able to have the right permissions to take snapshots and have them scanned. Want to know what kind of permissions you'll be giving Aikido? "),a(d,{href:l.templateUrl,target:"_blank"},{default:n(()=>[t("Click here")]),_:1},8,["href"]),t(" to see the policy. ")]),_:1}),a(h,{variation:"blue",size:"small",onClicked:l.handleInstallIamRoleAndPolicy},{default:n(()=>[t("Create IAM Role & Policy")]),_:1},8,["onClicked"])])}const K=g(L,[["render",D]]),Y={components:{PageHeader:E,BaseHeading:b,BaseLink:k,InputText:$,BaseButton:w,BaseParagraph:v,CreateAwsEc2Role:K},data(){return{roleArn:"",isSaving:!1}},computed:{isFormValid(){return this.roleArn.trim()!==""},isSubmitButtonDisabled(){return!this.isFormValid},docsUrl(){return"https://help.aikido.dev/en/articles/8911170-container-scanning-for-aws-ecr-with-the-aikido-scanner"},breadcrumbs(){return[{label:"Side scanning"},{label:"Connect AWS account"}]}},methods:{handleCancel(){this.$router.back()},handleKeyDown(){this.isFormValid&&this.handleSubmit()},async handleSubmit(){if(!this.isFormValid)return;const i=this.$route.params.cloud_id;this.isSaving=!0;try{const c=await W({aws_role_arn:this.roleArn,cloud_id:i});return Toast.success({title:"AWS Ec2 environment connected",description:"We will scan this registry and show the repositories we found on the settings page"}),this.$router.push(`/clouds/${i}/virtual-machines`),c}finally{this.isSaving=!1}}}},q={class:"page-content bg-white"},Z={class:"flex flex-column gap-32px"},O={class:"flex flex-column gap-8px"},G={class:"flex flex-column gap-32px"},J={class:"flex flex-column gap-24px"},Q=e("hr",{class:"divider my-24px"},null,-1),ee={class:"flex flex-end gap-16px mt-12px justify-end"};function te(i,c,y,B,r,l){const s=o("PageHeader"),d=o("BaseHeading"),m=o("BaseLink"),p=o("BaseParagraph"),h=o("CreateAwsEc2Role"),C=o("InputText"),f=o("BaseButton");return x(),A(z,null,[a(s,{breadcrumbs:l.breadcrumbs,title:"AWS EC2 hard drive scanning"},null,8,["breadcrumbs"]),e("div",q,[e("div",Z,[e("div",O,[a(d,{as:"h3"},{default:n(()=>[t("Connect AWS EC2 environment")]),_:1}),a(p,{size:"medium",loose:""},{default:n(()=>[t(" Read our documentation on "),a(m,{href:l.docsUrl,target:"_blank"},{default:n(()=>[t("How to let Aikido scan your AWS instances")]),_:1},8,["href"]),t(". ")]),_:1})]),e("div",G,[e("div",J,[a(h),a(C,{title:"AWS Role ARN",placeholder:"arn:aws:iam::123830977344:role/aikido-security-ecr-readonly-AikidoSecurityRole-XYZXYZ123456",modelValue:r.roleArn,"onUpdate:modelValue":c[0]||(c[0]=S=>r.roleArn=S),modelModifiers:{trim:!0},name:"role_arn",onEnterKeyPress:l.handleKeyDown,required:!0},null,8,["modelValue","onEnterKeyPress"])])])]),e("div",null,[Q,e("div",ee,[a(f,{variation:"plain",onClicked:l.handleCancel},{default:n(()=>[t("Cancel")]),_:1},8,["onClicked"]),a(f,{disabled:l.isSubmitButtonDisabled,onClicked:l.handleSubmit,isLoading:r.isSaving},{default:n(()=>[t("Save")]),_:1},8,["disabled","onClicked","isLoading"])])])])],64)}const se=g(Y,[["render",te]]);export{se as default};
