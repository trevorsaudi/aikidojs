import{_ as w,B as I,d as x,a2 as E,A,r as d,q as o,k as l,w as a,o as s,n as _,u as C,s as r,ai as g,p as S,S as M,f as P,x as U,I as B,an as b,m as R,a_ as L,F as k,t as N}from"./index-13ff96f4.js";import{I as O}from"./InputCheckbox-81cb3ca6.js";import{D as V,a as G}from"./DataTable-e31a825a.js";import{g as z}from"./repositoryPaths-dd3d5f8e.js";import{a as H,D as F}from"./DataTableCell-51c0104f.js";import{D as j}from"./DataTableActionsCell-bde7169b.js";import{D as X}from"./DataTableCellSelectable-71ffdbc4.js";import"./ActionMenu-3e4470bf.js";const Z={props:{repository:Object,selectionMode:String,isSelected:Boolean},emits:["toggleSelected"],components:{DataTableRow:H,DataTableCell:F,DataTableActionsCell:j,DataTableCellSelectable:X,BaseParagraph:I,BasePill:x,XTooltip:E},computed:{isPayingAccount(){return A.isPaying()},isActive(){return!!this.repository.configuration},formattedMinimumSeverity(){return this.isActive?this.repository.configuration.minimum_severity:"-"},minimumSeverityTextColor(){if(!this.isActive)return"black";switch(this.repository.configuration.minimum_severity.toLowerCase()){case"critical":return"danger";case"high":return"warning";case"medium":return"blue";case"low":return"success";default:return"black"}},actionMenuSections(){return[{title:"Actions",items:[{label:"Manage configuration",icon:"icon-exception",useBaseIcon:!0,onClick:this.handleAddException},{hidden:!this.isActive,label:"Disable Configuration",onClick:this.handleRemoveException,icon:"icon-delete",iconColor:"red",useBaseIcon:!0,destructive:!0}]}]},repositoryPath(){return z(this.repository)},isTfvc(){return this.repository.scm_repo_uid.startsWith("tfvc_")}},methods:{getScanStatusLabelText(t){return t?"ON":"OFF"},getScanStatusLabelVariation(t){return t?"green":"gray-fill"},handleAddException(){this.$modal.show("ManageAzureDevopsChecksConfigurationModal",{repositories:[this.repository]})},handleRemoveException(){this.$modal.show("DeleteAzureDevopsChecksConfigurationModal",{repositories:[this.repository]})},handleToggleSelected(t){this.isTfvc||this.$emit("toggleSelected",{scmRepoId:this.repository.id,selected:t})},handleShowUpgradeModal(){return this.$modal.show("UpgradeAccountModal",{title:this.$t("SETTINGS.INTEGRATIONS.GITHUB_CHECKS.UPGRADE_MODAL.SAST_SCAN.TITLE"),msg:this.$t("SETTINGS.INTEGRATIONS.GITHUB_CHECKS.UPGRADE_MODAL.SAST_SCAN.DESCRIPTION")})}}},K={class:"flex flex-1 justify-between gap-8px"},W={class:"text-carbon-60"};function q(t,c,i,f,D,e){const T=d("DataTableCellSelectable"),h=d("BaseParagraph"),m=d("XTooltip"),u=d("BasePill"),n=d("DataTableCell"),y=d("DataTableActionsCell"),v=d("DataTableRow");return o(),l(v,{clickable:!e.isTfvc,onClick:c[1]||(c[1]=()=>e.handleToggleSelected(!i.isSelected)),class:M([{"data-table__row--greyed-out":!e.isActive},"hover-trigger"])},{default:a(()=>[s(T,{disabled:e.isTfvc,mode:i.selectionMode,selected:i.isSelected,"show-on-parent-hover":!0,onSelect:c[0]||(c[0]=p=>e.handleToggleSelected(p))},null,8,["disabled","mode","selected"]),s(n,null,{default:a(()=>[_("div",K,[s(h,null,{default:a(()=>[_("span",W,C(e.repositoryPath),1),r(" "+C(i.repository.scm_repo_name),1)]),_:1}),e.isTfvc?(o(),l(u,{key:0,title:"TFVC",variation:"gray-fill",class:"cursor-default brightness-95"},{default:a(()=>[s(m,null,{default:a(()=>[r("Configuration for TFVC repos not supported")]),_:1})]),_:1})):e.isActive?S("",!0):(o(),l(u,{key:1,class:"show-on-hover",title:"Configure",variation:"purple",onClick:g(e.handleAddException,["stop"])},null,8,["onClick"]))])]),_:1}),s(n,null,{default:a(()=>[s(h,{color:e.minimumSeverityTextColor,class:"text--capitalize"},{default:a(()=>[r(C(e.formattedMinimumSeverity),1)]),_:1},8,["color"])]),_:1}),s(n,null,{default:a(()=>[e.isActive?(o(),l(u,{key:0,title:e.getScanStatusLabelText(i.repository.configuration.fail_on_dependency_scan),variation:e.getScanStatusLabelVariation(i.repository.configuration.fail_on_dependency_scan)},null,8,["title","variation"])):(o(),l(h,{key:1,color:"gray"},{default:a(()=>[r("-")]),_:1}))]),_:1}),s(n,null,{default:a(()=>[!e.isPayingAccount&&e.isActive?(o(),l(u,{key:0,variation:"purple",title:"Upgrade",onClick:g(e.handleShowUpgradeModal,["stop"])},null,8,["onClick"])):e.isActive?(o(),l(u,{key:1,title:e.getScanStatusLabelText(i.repository.configuration.fail_on_sast_scan),variation:e.getScanStatusLabelVariation(i.repository.configuration.fail_on_sast_scan)},null,8,["title","variation"])):(o(),l(h,{key:2,color:"gray"},{default:a(()=>[r("-")]),_:1}))]),_:1}),s(n,null,{default:a(()=>[!e.isPayingAccount&&e.isActive?(o(),l(u,{key:0,variation:"purple",title:"Upgrade",onClick:g(e.handleShowUpgradeModal,["stop"])},null,8,["onClick"])):e.isActive?(o(),l(u,{key:1,title:e.getScanStatusLabelText(i.repository.configuration.fail_on_iac_scan),variation:e.getScanStatusLabelVariation(i.repository.configuration.fail_on_iac_scan)},null,8,["title","variation"])):(o(),l(h,{key:2,color:"gray"},{default:a(()=>[r("-")]),_:1}))]),_:1}),s(n,null,{default:a(()=>[!e.isPayingAccount&&e.isActive?(o(),l(u,{key:0,variation:"purple",title:"Upgrade",onClick:g(e.handleShowUpgradeModal,["stop"])},null,8,["onClick"])):e.isActive?(o(),l(u,{key:1,title:e.getScanStatusLabelText(i.repository.configuration.fail_on_secrets_scan),variation:e.getScanStatusLabelVariation(i.repository.configuration.fail_on_secrets_scan)},null,8,["title","variation"])):(o(),l(h,{key:2,color:"gray"},{default:a(()=>[r("-")]),_:1}))]),_:1}),t.$featureflags.enable_ci_malware_scan?(o(),l(n,{key:0},{default:a(()=>[!e.isPayingAccount&&e.isActive?(o(),l(u,{key:0,variation:"purple",title:"Upgrade",onClick:g(e.handleShowUpgradeModal,["stop"])},null,8,["onClick"])):e.isActive?(o(),l(u,{key:1,title:e.getScanStatusLabelText(i.repository.configuration.fail_on_malware_scan),variation:e.getScanStatusLabelVariation(i.repository.configuration.fail_on_malware_scan)},null,8,["title","variation"])):(o(),l(h,{key:2,color:"gray"},{default:a(()=>[r("-")]),_:1}))]),_:1})):S("",!0),e.isTfvc?(o(),l(n,{key:1})):(o(),l(y,{key:2,sections:e.actionMenuSections},null,8,["sections"]))]),_:1},8,["clickable","class"])}const J=w(Z,[["render",q]]),Q={components:{BaseButton:P,BaseIcon:U,DataTable:V,DataTableHeader:G,ConfigurationOverviewTableRow:J,InputSearch:B,InputCheckbox:O},props:{searchTerm:{type:String,default:""}},emits:["update:searchTerm"],inject:["repositories","isFetchingRepositories"],data(){return{selectedRepositories:[]}},async mounted(){b.on("azureDevopsChecksConfigurationUpdated",this.clearSelectedRepositories)},beforeUnmount(){b.off("azureDevopsChecksConfigurationUpdated",this.clearSelectedRepositories)},watch:{isFetchingRepositories(t){t?this.$globalLoadingIndicator.show():this.$globalLoadingIndicator.hide()},repositories(){const t=[];for(const c of this.selectedRepositories){const i=this.repositories.find(f=>f.id===c.id);if(!i){t.push(c);continue}t.push(i)}this.selectedRepositories=t}},computed:{nonTfvcRepos(){return this.repositories.filter(t=>!t.scm_repo_uid.startsWith("tfvc_"))},isPayingAccount(){return A.isPayingAndNoProTrial()},hasSelectedSomeRepos(){return this.selectedRepositories.length>0},hasSelectedAllRepos(){return this.nonTfvcRepos.every(t=>this.selectedRepositoryIds.includes(t.id))},selectionMode(){return this.hasSelectedSomeRepos?"edit":"display"},selectedRepositoryIds(){return this.selectedRepositories.map(t=>t.id)},allSelectedReposHaveConfiguration(){return this.selectedRepositories.length<1?!1:this.selectedRepositories.every(t=>!!t.configuration)}},methods:{handleUpdateSearch(t){this.$emit("update:searchTerm",t)},handleConfigureScans(){if(!this.isPayingAccount&&this.selectedRepositories.length>1){let t="";return A.isPaying()?t=this.$t("SETTINGS.INTEGRATIONS.AZURE_DEVOPS.UPGRADE_MODAL.TITLE_PRO_TRIAL"):t=this.$t("SETTINGS.INTEGRATIONS.AZURE_DEVOPS.UPGRADE_MODAL.TITLE"),this.$modal.show("UpgradeAccountModal",{title:t,msg:this.$t("SETTINGS.INTEGRATIONS.AZURE_DEVOPS.UPGRADE_MODAL.DESCRIPTION")})}this.$modal.show("ManageAzureDevopsChecksConfigurationModal",{repositories:this.selectedRepositories})},handleShowDeleteConfigurationModal(){this.$modal.show("DeleteAzureDevopsChecksConfigurationModal",{repositories:this.selectedRepositories})},handleToggleSelectAllrepos(t){if(t){let c=[];for(const i of this.nonTfvcRepos)this.selectedRepositoryIds.includes(i.id)||c.push(i);this.selectedRepositories=[...this.selectedRepositories,...c]}else{const c=this.repositories.map(i=>i.id);this.selectedRepositories=[...this.selectedRepositories.filter(i=>!c.includes(i.id))]}},handleToggleRepo({scmRepoId:t,selected:c}){if(c){if(this.selectedRepositoryIds.includes(t))return;const i=this.repositories.find(f=>f.id===t);if(!i)return;this.selectedRepositories.push(i)}else{const i=this.selectedRepositories.filter(f=>f.id!==t);this.selectedRepositories=[...i]}},clearSelectedRepositories(){this.selectedRepositories=[]}}},Y={class:"mb-16px flex align-center justify-between gap-12px"},$={class:"flex align-center gap-12px"},ee={key:0,class:"overflow-hidden p-1px"},te=_("i",{class:"icon icon-add inherit-font"},null,-1);function ie(t,c,i,f,D,e){const T=d("InputSearch"),h=d("BaseIcon"),m=d("BaseButton"),u=d("InputCheckbox"),n=d("DataTableHeader"),y=d("ConfigurationOverviewTableRow"),v=d("DataTable");return o(),R(k,null,[_("div",Y,[s(T,{modelValue:i.searchTerm,"onUpdate:modelValue":e.handleUpdateSearch,spacing:"compact"},null,8,["modelValue","onUpdate:modelValue"]),_("div",$,[s(L,{name:"expand-horizontal-"},{default:a(()=>[e.allSelectedReposHaveConfiguration?(o(),R("div",ee,[s(m,{onClick:e.handleShowDeleteConfigurationModal,variation:"filter",size:"small",class:"ws-nowrap"},{default:a(()=>[s(h,{icon:"icon-delete"}),r(" Disable Configuration ")]),_:1},8,["onClick"])])):S("",!0)]),_:1}),s(m,{onClick:e.handleConfigureScans,disabled:!e.hasSelectedSomeRepos,size:"small"},{default:a(()=>[te,r(" Configure Scans ")]),_:1},8,["onClick","disabled"])])]),s(v,null,{header:a(()=>[s(n,{width:"48px",alignment:"center",spacing:"compact"},{default:a(()=>[s(u,{"semi-checked":e.hasSelectedSomeRepos,modelValue:e.hasSelectedAllRepos,"onUpdate:modelValue":e.handleToggleSelectAllrepos},null,8,["semi-checked","modelValue","onUpdate:modelValue"])]),_:1}),s(n,{width:"auto"},{default:a(()=>[r("Repository")]),_:1}),s(n,{width:"160px"},{default:a(()=>[r("Minimum severity")]),_:1}),s(n,{width:"140px"},{default:a(()=>[r("Dependencies")]),_:1}),s(n,{width:"90px"},{default:a(()=>[r("SAST")]),_:1}),s(n,{width:"90px"},{default:a(()=>[r("IaC")]),_:1}),s(n,{width:"90px"},{default:a(()=>[r("Secrets")]),_:1}),t.$featureflags.enable_ci_malware_scan?(o(),l(n,{key:0,width:"90px"},{default:a(()=>[r("Malware")]),_:1})):S("",!0),s(n,{width:"48px",alignment:"center"})]),body:a(()=>[(o(!0),R(k,null,N(e.repositories,p=>(o(),l(y,{repository:p,selectionMode:e.selectionMode,isSelected:e.selectedRepositoryIds.includes(p.id),key:p.id,onToggleSelected:e.handleToggleRepo},null,8,["repository","selectionMode","isSelected","onToggleSelected"]))),128))]),_:1})],64)}const ue=w(Q,[["render",ie]]);export{ue as default};
