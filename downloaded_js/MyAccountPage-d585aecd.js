import{_ as y,B as E,x as P,r as i,q as l,k as m,w as o,o as n,s as r,u as h,y as S,n as u,m as x,t as $,F as w,p as V,z as A,A as b,C as L,D as C,E as B,G as I,H as U,J as M}from"./index-13ff96f4.js";import{P as T}from"./PageHeader-46c38a32.js";import{B as v}from"./BaseCard-471d3203.js";const z={props:{user:Object},components:{BaseParagraph:E,BaseIcon:P},computed:{authTypeIcon(){return this.user.auth_type==="github"?"icon-github":this.user.auth_type==="bitbucket"?"icon-bitbucket":this.user.auth_type==="google"?"icon-google":this.user.auth_type==="office365"?"icon-office-365":"icon-Gitlab"},formattedAuthType(){return this.user.auth_type==="github"?"GitHub":this.user.auth_type==="bitbucket"?"Bitbucket":this.user.auth_type==="google"?"Google":this.user.auth_type==="office365"?"Office365":this.user.auth_type==="gitlab"?"GitLab":this.user.auth_type}}};function D(e,t,d,k,a,s){const c=i("BaseIcon"),f=i("BaseParagraph");return l(),m(f,{class:"flex gap-8px align-center"},{default:o(()=>[n(c,{icon:s.authTypeIcon,color:"#141031"},null,8,["icon"]),r(" "+h(d.user.full_name)+" ("+h(s.formattedAuthType)+")",1)]),_:1})}const H=y(z,[["render",D]]),G={components:{BaseCard:v,BaseParagraph:E,LinkedUserAccount:H},data(){return{linkedUsers:[],isLoading:!0}},async mounted(){await this.listLinkedUsers(),this.isLoading=!1},computed:{},methods:{async listLinkedUsers(){this.linkedUsers=await S()}}},R={class:"flex flex-column gap-16px"},W={class:"flex flex-column gap-8px"},F=u("i",{class:"icon icon-link"},null,-1);function O(e,t,d,k,a,s){const c=i("BaseParagraph"),f=i("LinkedUserAccount"),p=i("BaseButton"),_=i("BaseCard");return l(),m(_,{title:"Personal Profile","is-loading":a.isLoading,class:"flex-1"},{default:o(()=>[u("div",R,[n(c,{size:"medium",bold:""},{default:o(()=>[r("Linked accounts")]),_:1}),u("div",W,[(l(!0),x(w,null,$(a.linkedUsers,g=>(l(),m(f,{key:g.id,user:g},null,8,["user"]))),128)),!e.$user.has_linked_users&&e.$featureflags.enable_user_account_merge&&!e.$user.is_support_user?(l(),m(p,{key:0,class:"mt-8px",as:"link",size:"small",variation:"tertiary",to:"/merge-logins"},{default:o(()=>[F,r(" Link a secondary user ")]),_:1})):V("",!0)])])]),_:1},8,["is-loading"])}const Y=y(G,[["render",O]]),j={components:{BaseCard:v,InputSwitch:A,BaseParagraph:E},data(){return{isLoading:!0,notificationSettings:{criticalEmailNotifications:!1,weeklyDigestEmailNotifications:!1},emailVerificationResent:!1,notificationEmail:"",notificationEmailVerified:!0}},async mounted(){await Promise.all([this.getEmailNotificationSettings(),this.fetchNotificationEmail()]),this.isLoading=!1},computed:{groupName(){return b.data.group.name}},methods:{async getEmailNotificationSettings(){var t,d;const e=await L();this.notificationSettings.criticalEmailNotifications=(t=e.group_based)==null?void 0:t.send_new_criticals,this.notificationSettings.weeklyDigestEmailNotifications=(d=e.group_based)==null?void 0:d.send_weekly_digest},async fetchNotificationEmail(){const{notifications_email:e,notifications_email_verified:t}=await C();this.notificationEmail=e,this.notificationEmailVerified=t},async handleToggleWeeklyDigestEmailNotifications(e){await B({send_weekly_digest:e});const t=e?"enabled":"disabled";this.$toast.success({title:"Setting updated",description:`You have successfully ${t} weekly digest emails.`})},async handleToggleCriticalIssueEmailNotifications(e){await B({send_new_criticals:e});const t=e?"enabled":"disabled";this.$toast.success({title:"Setting updated",description:`You have successfully ${t} email notifications for critical issues.`})},async resendEmailVerification(){this.emailVerificationResent=!0;try{await I(),this.$toast.success("Verification email sent successfully. Please check your inbox.")}catch{this.emailVerificationResent=!1}},async openNotificationEmailModal(){(await this.$modal.show("UpdateNotificationEmailModal",{notificationEmail:this.notificationEmail})).type=="saved"&&this.fetchNotificationEmail()}}},q={class:"flex flex-column mb-32px"},J={key:1},K={class:"flex flex-column gap-16px"},Q={class:"flex flex-column gap-8px"};function X(e,t,d,k,a,s){const c=i("BaseParagraph"),f=i("BaseIcon"),p=i("BaseLink"),_=i("InputSwitch"),g=i("BaseCard");return l(),m(g,{title:`Personal Email Notifications for ${e.$group.name}`,"is-loading":a.isLoading,class:"flex-1"},{default:o(()=>[u("div",q,[n(c,{size:"medium",bold:"",class:"mb-16px"},{default:o(()=>[r("Email address for Notifications")]),_:1}),n(c,{class:"flex align-center gap-8px"},{default:o(()=>[r(h(a.notificationEmail)+" ",1),n(f,{size:"12",icon:"icon-edit",class:"text-carbon-60 cursor-pointer",onClick:s.openNotificationEmailModal},null,8,["onClick"])]),_:1}),a.notificationEmailVerified?V("",!0):(l(),m(c,{key:0,size:"small",color:"gray",class:"mt-4px"},{default:o(()=>[r("Email Not Verified | "),a.emailVerificationResent?(l(),x("span",J,"Verification Email Sent")):(l(),m(p,{key:0,onClick:s.resendEmailVerification},{default:o(()=>[r("Resend Verification Email")]),_:1},8,["onClick"]))]),_:1}))]),u("div",K,[n(c,{size:"medium",bold:""},{default:o(()=>[r("Notify me about "+h(s.groupName),1)]),_:1}),u("div",Q,[n(_,{small:!0,modelValue:a.notificationSettings.weeklyDigestEmailNotifications,"onUpdate:modelValue":[t[0]||(t[0]=N=>a.notificationSettings.weeklyDigestEmailNotifications=N),s.handleToggleWeeklyDigestEmailNotifications],name:"receives_emails_for_weekly_digest","label-right":"Weekly digest on Monday"},null,8,["modelValue","onUpdate:modelValue"]),n(_,{small:!0,modelValue:a.notificationSettings.criticalEmailNotifications,"onUpdate:modelValue":[t[1]||(t[1]=N=>a.notificationSettings.criticalEmailNotifications=N),s.handleToggleCriticalIssueEmailNotifications],name:"receives_emails_for_critical_issues","label-right":"New critical issue detected"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:1},8,["title","is-loading"])}const Z=y(j,[["render",X]]),ee={components:{PageHeader:T,BaseHeading:U,AvatarImage:M,MyAccountProfile:Y,MyAccountNotifications:Z},mounted(){this.$breadcrumbs.show({breadcrumbs:[{label:"My Profile"}]})},beforeUnmount(){this.$breadcrumbs.hide()},computed:{userAvatar(){return b.data.user.avatar??null},userName(){return b.data.user.full_name??null}}},te={class:"page-content"},ie={class:"flex flex-1 gap-24px"};function ae(e,t,d,k,a,s){const c=i("AvatarImage"),f=i("PageHeader"),p=i("MyAccountProfile"),_=i("MyAccountNotifications");return l(),x(w,null,[n(f,{title:s.userName},{avatar:o(()=>[n(c,{class:"size-64 inline-block rounded-10",name:s.userName,src:s.userAvatar},null,8,["name","src"])]),_:1},8,["title"]),u("div",te,[u("div",ie,[n(p),n(_)])])],64)}const ce=y(ee,[["render",ae]]);export{ce as default};
